<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">

<html lang=en>
 <head><meta content="text/html; charset=utf-8" http-equiv=Content-Type>

  <title>CSS Writing Modes Module Level 3</title>
  <link href=default.css rel=stylesheet type="text/css">

  <style type="text/css">
    object { vertical-align: middle; }
    .sidebar { float: right; background: #eee; border: solid gray; margin: 1em; }
    .landscape { height: 10em; }
    .portrait { width: 10em; }
    .sidebar .figure { margin: 1em; }
    .sidebar object { margin: 0 auto; display: block; }
    .figurepair { display: table; margin: 1em auto; }
    .figurepair .figure { display: table-cell; }
     h2, .example { clear: both; }
    img, object { max-width: 100%; }
  </style>
  <link href="http://www.w3.org/StyleSheets/TR/W3C-WD.css" rel=stylesheet
  type="text/css">

 <body>
  <div class=head> <!--begin-logo-->
   <p><a href="http://www.w3.org/"><img alt=W3C height=48
    src="http://www.w3.org/Icons/w3c_home" width=72></a> <!--end-logo-->

   <h1>CSS Writing Modes Module Level 3</h1>

   <h2 class="no-num no-toc" id=longstatus-date>W3C Working Draft 04 February
    2011</h2>

   <dl>
    <dt>This version:

    <dd><a
     href="http://www.w3.org/TR/2011/WD-css3-writing-modes-20110204">http://www.w3.org/TR/2011/WD-css3-writing-modes-20110204</a>
     

    <dt>Latest version:

    <dd><a
     href="http://www.w3.org/TR/css3-writing-modes/">http://www.w3.org/TR/css3-writing-modes/</a>

    <dt>Previous version:

    <dd><a
     href="http://www.w3.org/TR/2010/WD-css3-writing-modes-20101202/">http://www.w3.org/TR/2010/WD-css3-writing-modes-20101202/</a>

    <dt>Editors:

    <dd><a href="http://fantasai.inkedblade.net/contact">Elika J. Etemad</a>
     (Invited Expert)

    <dd><a href="mailto:kojiishi@gluesoft.co.jp">Koji Ishii</a> (<a
     href="http://www.antenna.co.jp/">Antenna House</a>)

    <dd><a href="mailto:murakami@antenna.co.jp">Shinyu Murakami</a> (<a
     href="http://www.antenna.co.jp/">Antenna House</a>)

    <dt>Previous Editors:

    <dd><a href="mailto:paulnel@microsoft.com">Paul Nelson</a> (<a
     href="http://www.microsoft.com/">Microsoft</a>)

    <dd><a href="mailto:michelsu@microsoft.com">Michel Suignard</a> (<a
     href="http://www.microsoft.com/">Microsoft</a>)
   </dl>
   <!--begin-copyright-->
   <p class=copyright><a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright"
    rel=license>Copyright</a> &copy; 2011 <a
    href="http://www.w3.org/"><acronym title="World Wide Web
    Consortium">W3C</acronym></a><sup>&reg;</sup> (<a
    href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute
    of Technology">MIT</acronym></a>, <a href="http://www.ercim.eu/"><acronym
    title="European Research Consortium for Informatics and
    Mathematics">ERCIM</acronym></a>, <a
    href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
    and <a
    href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.</p>
   <!--end-copyright-->
   <hr title="Separator for header">
  </div>

  <h2 class="no-num no-toc" id=abstract>Abstract</h2>

  <p>CSS3 Writing Modes defines CSS features to support for various
   international writing modes, such as left-to-right (e.g. Latin or Indic),
   right-to-left (e.g. Hebrew or Arabic), bidirectional (e.g. mixed Latin and
   Arabic) and vertical (e.g. Asian scripts).

  <p>Inherently bottom-to-top scripts are not handled in this version. See <a
   href="#UTN22" rel=biblioentry>[UTN22]<!--{{UTN22}}--></a> for an
   explanation of relevant issues.

  <h2 class="no-num no-toc" id=status>Status of this document</h2>
  <!--begin-status-->

  <p><em>This section describes the status of this document at the time of
   its publication. Other documents may supersede this document. A list of
   current W3C publications and the latest revision of this technical report
   can be found in the <a href="http://www.w3.org/TR/">W3C technical reports
   index at http://www.w3.org/TR/.</a></em>

  <p>Publication as a Working Draft does not imply endorsement by the W3C
   Membership. This is a draft document and may be updated, replaced or
   obsoleted by other documents at any time. It is inappropriate to cite this
   document as other than work in progress.

  <p>The (<a
   href="http://lists.w3.org/Archives/Public/www-style/">archived</a>) public
   mailing list <a href="mailto:www-style@w3.org">www-style@w3.org</a> (see
   <a href="http://www.w3.org/Mail/Request">instructions</a>) is preferred
   for discussion of this specification. When sending e-mail, please put the
   text &#8220;css3-writing-modes&#8221; in the subject, preferably like
   this: &#8220;[<!---->css3-writing-modes<!---->] <em>&hellip;summary of
   comment&hellip;</em>&#8221;

  <p>This document was produced by the <a
   href="http://www.w3.org/Style/CSS/members">CSS Working Group</a> (part of
   the <a href="http://www.w3.org/Style/">Style Activity</a>).

  <p>This document was produced by a group operating under the <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February
   2004 W3C Patent Policy</a>. W3C maintains a <a
   href="http://www.w3.org/2004/01/pp-impl/32061/status"
   rel=disclosure>public list of any patent disclosures</a> made in
   connection with the deliverables of the group; that page also includes
   instructions for disclosing a patent. An individual who has actual
   knowledge of a patent which the individual believes contains <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
   Claim(s)</a> must disclose the information in accordance with <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
   6 of the W3C Patent Policy</a>.</p>
  <!--end-status-->

  <h2 class="no-num no-toc" id=Contents>Table of Contents</h2>
  <!--begin-toc-->

  <ul class=toc>
   <li><a href="#text-flow"><span class=secno>1. </span>Introduction to
    Writing Modes</a>

   <li><a href="#text-direction"><span class=secno>2. </span>Inline Direction
    and Bidirectionality</a>
    <ul class=toc>
     <li><a href="#direction"><span class=secno>2.1. </span>Specifying
      Directionality: the &lsquo;<code class=property>direction</code>&rsquo;
      property</a>

     <li><a href="#unicode-bidi"><span class=secno>2.2. </span>Embeddings and
      Overrides: the &lsquo;<code class=property>unicode-bidi</code>&rsquo;
      property</a>

     <li><a href="#bidi-example"><span class=secno>2.3. </span>Example of
      Bidirectional Text</a>

     <li><a href="#bidi-box-model"><span class=secno>2.4. </span>Box model
      for inline elements in bidirectional context</a>
    </ul>

   <li><a href="#vertical-intro"><span class=secno>3. </span> Introduction to
    Vertical Text</a>
    <ul class=toc>
     <li><a href="#writing-mode"><span class=secno>3.1. </span> Block Flow
      Direction: the &lsquo;<code class=property>writing-mode</code>&rsquo;
      property</a>
    </ul>

   <li><a href="#intro-text-layout"><span class=secno>4. </span> Introduction
    to Intrinsic Text Layout</a>
    <ul class=toc>
     <li><a href="#text-orientation"><span class=secno>4.1. </span>Orienting
      Text: the &lsquo;<code class=property>text-orientation</code>&rsquo;
      property</a>
    </ul>

   <li><a href="#abstract-box"><span class=secno>5. </span> Abstract Box
    Terminology</a>
    <ul class=toc>
     <li><a href="#abstract-dimensions"><span class=secno>5.1. </span>
      Logical Dimensions</a>

     <li><a href="#abstract-directions"><span class=secno>5.2. </span>
      Abstract and Physical Directions</a>

     <li><a href="#line-directions"><span class=secno>5.3. </span>
      Line-relative Directions</a>

     <li><a href="#logical-directions"><span class=secno>5.4. </span>
      Flow-relative Directions</a>

     <li><a href="#logical-to-physical"><span class=secno>5.5. </span>
      Abstract-to-Physical Mappings</a>
    </ul>

   <li><a href="#abstract-layout"><span class=secno>6. </span> Abstract Box
    Layout</a>
    <ul class=toc>
     <li><a href="#vertical-layout"><span class=secno>6.1. </span> Principles
      of Layout in Vertical Writing Modes</a>

     <li><a href="#dimension-mapping"><span class=secno>6.2. </span>
      Dimensional Mapping</a>

     <li><a href="#orthogonal-flows"><span class=secno>6.3. </span>
      Orthogonal Flows</a>
      <ul class=toc>
       <li><a href="#orthogonal-auto"><span class=secno>6.3.1. </span>
        Auto-sizing in Orthogonal Flows</a>

       <li><a href="#orthogonal-multicol"><span class=secno>6.3.2. </span>
        Multi-column Layout in Orthogonal Flows</a>

       <li><a href="#orthogonal-pagination"><span class=secno>6.3.3. </span>
        Paginating Orthogonal Flows</a>
      </ul>

     <li><a href="#logical-direction-layout"><span class=secno>6.4. </span>
      Flow-Relative Mappings</a>

     <li><a href="#line-mappings"><span class=secno>6.5. </span>
      Line-Relative Mappings</a>

     <li><a href="#physical-only"><span class=secno>6.6. </span> Purely
      Physical Mappings</a>

     <li><a href="#caption-side"><span class=secno>6.7. </span> Table Caption
      Mappings: the &lsquo;<code class=property>caption-side</code>&rsquo;
      property </a>
    </ul>

   <li><a href="#text-combine"><span class=secno>7. </span>Glyph Composition:
    the &lsquo;<code class=property>text-combine</code>&rsquo; property</a>

   <li class=no-num><a href="#acknowledgements">Acknowledgements</a>

   <li class=no-num><a href="#bidi-html">Appendix B: Bidi Rules for HTML</a>

   <li class=no-num><a href="#references">References</a>
    <ul class=toc>
     <li class=no-num><a href="#normative-references">Normative
      references</a>

     <li class=no-num><a href="#other-references">Other references</a>
    </ul>
  </ul>
  <!--end-toc-->

  <h2 id=text-flow><span class=secno>1. </span>Introduction to Writing Modes</h2>

  <p>CSS3 Writing Modes defines CSS features to support for various
   international writing modes, such as left-to-right (e.g. Latin or Indic),
   right-to-left (e.g. Hebrew or Arabic), bidirectional (e.g. mixed Latin and
   Arabic) and vertical (e.g. Asian scripts).

  <p>A <dfn id=writing-mode0>writing mode</dfn> in CSS is determined by the
   &lsquo;<a href="#writing-mode1"><code
   class=property>writing-mode</code></a>&rsquo;, &lsquo;<a
   href="#direction0"><code class=property>direction</code></a>&rsquo;, and
   &lsquo;<a href="#text-orientation0"><code
   class=property>text-orientation</code></a>&rsquo; properties. It is
   defined primarily in terms of its <a
   href="#inline-base-direction"><i>inline base direction</i></a> and <a
   href="#block-flow-direction"><i>block flow direction</i></a>:

  <div class=sidebar>
   <div class="figure right"> <object class=landscape
    data="diagrams/text-flow-vectors-tb.svg" type="image/svg+xml"></object>
    <p class=caption>Latin-based writing mode
   </div>

   <div class="figure left"> <object class=portrait
    data="diagrams/text-flow-vectors-lr-reverse.svg"
    type="image/svg+xml"></object>
    <p class=caption>Mongolian-based writing mode
   </div>

   <div class="figure right"> <object class=landscape
    data="diagrams/text-flow-vectors-tb.svg" type="image/svg+xml"></object>
    <object class=portrait data="diagrams/text-flow-vectors-rl.svg"
    type="image/svg+xml"></object>
    <p class=caption>Han-based writing mode
   </div>
  </div>

  <p>The <dfn id=inline-base-direction>inline base direction</dfn> is the
   primary direction in which content is ordered on a line and defines on
   which sides the "start" and "end" of a line are. The &lsquo;<a
   href="#direction0"><code class=property>direction</code></a>&rsquo;
   property specifies the inline base direction of an element and, together
   with the &lsquo;<a href="#unicode-bidi0"><code
   class=property>unicode-bidi</code></a>&rsquo; property and the inherent
   directionality of any text content, determines the ordering of
   inline-level content within a line.

  <p>The <dfn id=block-flow-direction>block flow direction</dfn> is the
   direction in which block-level boxes stack and the direction in which line
   boxes stack within a block container. The &lsquo;<a
   href="#writing-mode1"><code class=property>writing-mode</code></a>&rsquo;
   property determines the block flow direction.

  <p>A <dfn id=horizontal-writing-mode>horizontal writing mode</dfn> is one
   with horizontal lines of text, i.e. a downward or upward block flow. A
   <dfn id=vertical-writing-mode>vertical writing mode</dfn> is one with
   vertical lines of text, i.e. a leftward or rightward block flow.

  <p class=note>These terms should not be confused with <dfn
   id=vertical-block-flow>vertical block flow</dfn> (which is a downward or
   upward block flow) and <dfn id=horizontal-block-flow>horizontal block
   flow</dfn> (which is leftward or rightward block flow). To avoid
   confusion, the CSS specifications avoid this latter set of terms.

  <p>Writing systems typically have one or two native writing modes. Some
   examples are:

  <ul>
   <li>Latin-based systems are typically written using a left-to-right inline
    direction with a downward (top-to-bottom) block flow direction.

   <li>Arabic-based systems are typically written using a right-to-left
    inline direction with a downward (top-to-bottom) block flow direction.

   <li>Mongolian-based systems are typically written using a top-to-bottom
    inline direction with a rightward (left-to-right) block flow direction.

   <li>Han-based systems are commonly written using a left-to-right inline
    direction with a downward (top-to-bottom) block flow direction,
    <strong>or</strong> a top-to-bottom inline direction with a leftward
    (right-to-left) block flow direction. Many magazines and newspapers will
    mix these two writing modes on the same page.
  </ul>

  <p class=note>See Unicode Technical Note #22 <a href="#UTN22"
   rel=biblioentry>[UTN22]<!--{{UTN22}}--></a> (<a
   href="http://fantasai.inkedblade.net/style/discuss/vertical-text/paper">HTML
   version</a>) for a more in-depth introduction to writing modes and
   vertical text.

  <p class=issue>Point at Intro to Text Orientaiton section once it's
   written.

  <h2 id=text-direction><span class=secno>2. </span>Inline Direction and
   Bidirectionality</h2>

  <p>While the characters in most scripts are written from left to right,
   certain scripts are written from right to left. In some documents, in
   particular those written with the Arabic or Hebrew script, and in some
   mixed-language contexts, text in a single (visually displayed) block may
   appear with mixed directionality. This phenomenon is called <span
   class=index-def id=bidirectionality title="bidirectionality (bidi)"><dfn
   id=bidirectionality0>bidirectionality</dfn></span>, or "bidi" for short.

  <div class=figure>
   <pre>.manokim rak W3C ab nam
<!--  --> &lt;---------- --> &lt;-----</pre>

   <p>Bidirectionality</p>
  </div>

  <p>The Unicode standard (<a
   href="http://www.unicode.org/reports/tr9/">Unicode Standard Annex #9</a>)
   defines a complex algorithm for determining the proper ordering of
   bidirectional text. The algorithm consists of an implicit part based on
   character properties, as well as explicit controls for embeddings and
   overrides. CSS relies on this algorithm to achieve proper bidirectional
   rendering. The <span class=propinst-direction>&lsquo;<a
   href="#direction0"><code class=property>direction</code></a>&rsquo;</span>
   and <span class=propinst-unicode-bidi>&lsquo;<a
   href="#unicode-bidi0"><code
   class=property>unicode-bidi</code></a>&rsquo;</span> properties allow
   authors to specify how the elements and attributes of a document language
   map to this algorithm.

  <p>User agents that support bidirectional text must apply the Unicode
   bidirectional algorithm to every sequence of inline boxes uninterrupted by
   a forced (<a
   href="http://www.unicode.org/reports/tr9/#Bidirectional_Character_Types">bidi
   class B</a>) line break or block boundary. This sequence forms the
   "paragraph" unit in the bidirectional algorithm. The paragraph embedding
   level is set according to the value of the &lsquo;<a
   href="#direction0"><code class=property>direction</code></a>&rsquo;
   property of the containing block rather than by the heuristic given in
   steps P2 and P3 of the Unicode algorithm.

  <p>Because the base directionality of a text depends on the structure and
   semantics of the document, these properties should in most cases be used
   only to map bidi information in the markup to its corresponding CSS
   styles. If a document language provides markup features to control bidi,
   authors and users should use those features and not specify CSS rules to
   override them.

  <p>The HTML 4 specification (<a href="#HTML401"
   rel=biblioentry>[HTML401]<!--{{HTML401}}--></a>, section 8.2) defines
   bidirectionality behavior for HTML elements. The HTML 4 specification also
   contains more information on bidirectionality issues.

  <p class=note>Because HTML UAs can turn off CSS styling, we advise HTML
   authors to use the HTML &lsquo;<code class=property>dir</code>&rsquo;
   attribute and &lt;bdo&gt; element to ensure correct bidirectional layout
   in the absence of a style sheet.

  <h3 id=direction><span class=secno>2.1. </span>Specifying Directionality:
   the &lsquo;<a href="#direction0"><code
   class=property>direction</code></a>&rsquo; property</h3>

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=direction0>direction</dfn>

    <tr>
     <th>Value:

     <td>ltr | rtl

    <tr>
     <th>Initial:

     <td>ltr

    <tr>
     <th>Applies to:

     <td>all elements

    <tr>
     <th>Inherited:

     <td>yes

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed&#160;value:

     <td>specified value
  </table>

  <p>This property specifies the base directionality of text and elements on
   a line, and the directionality of embeddings and overrides (see &lsquo;<a
   href="#unicode-bidi0"><code class=property>unicode-bidi</code></a>&rsquo;)
   for the Unicode bidirectional algorithm. In addition, it affects the
   ordering of <a href="http://www.w3.org/TR/CSS21/tables.html">table</a>
   column layout, the direction of horizontal <a
   href="http://www.w3.org/TR/CSS21/visufx.html#overflow">overflow</a>, and
   the default alignment of text within a line, and other things that depend
   on the base inline base direction.

  <p>Values for this property have the following meanings:

  <dl>
   <dt><strong>ltr</strong>

   <dd>Left-to-right directionality.

   <dt><strong>rtl</strong>

   <dd>Right-to-left directionality.
  </dl>

  <p class=note>The &lsquo;<a href="#direction0"><code
   class=property>direction</code></a>&rsquo; property has no reordering in
   inline-level elements whose &lsquo;<a href="#unicode-bidi0"><code
   class=property>unicode-bidi</code></a>&rsquo; property's value is
   &lsquo;<code class=css>normal</code>&rsquo;.

  <p>The value of the &lsquo;<a href="#direction0"><code
   class=property>direction</code></a>&rsquo; property on the root element is
   also propagated to the initial containing block and, together with the
   &lsquo;<a href="#writing-mode1"><code
   class=property>writing-mode</code></a>&rsquo; property, determines the
   document's principal writing mode. (See <a
   href="#principal-writing-mode">below</a>.)

  <p class=note>Note that the &lsquo;<a href="#direction0"><code
   class=property>direction</code></a>&rsquo; property of the HTML BODY
   element is <em>not</em> propagated to the viewport. That special behavior
   only applies to the background and overflow properties.

  <p class=note>The &lsquo;<a href="#direction0"><code
   class=property>direction</code></a>&rsquo; property, when specified for
   table column elements, is not inherited by cells in the column since
   columns are not the ancestors of the cells in the document tree. Thus, CSS
   cannot easily capture the "dir" attribute inheritance rules described in
   <a href="#HTML401" rel=biblioentry>[HTML401]<!--{{HTML401}}--></a>,
   section 11.3.2.1.

  <h3 id=unicode-bidi><span class=secno>2.2. </span>Embeddings and Overrides:
   the &lsquo;<a href="#unicode-bidi0"><code
   class=property>unicode-bidi</code></a>&rsquo; property</h3>

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=unicode-bidi0>unicode-bidi</dfn>

    <tr>
     <th>Value:

     <td>normal | [ [ embed | isolate ] || [ plaintext | bidi-override ] ]

    <tr>
     <th>Initial:

     <td>normal

    <tr>
     <th>Applies to:

     <td>all elements, but see prose

    <tr>
     <th>Inherited:

     <td>no

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed&#160;value:

     <td>specified value
  </table>

  <p>Values for this property have the following meanings:

  <dl>
   <dt><strong>normal</strong>

   <dd>The element does not open an additional level of embedding with
    respect to the bidirectional algorithm. For inline-level elements,
    implicit reordering works across element boundaries.

   <dt><strong>embed</strong>

   <dd>If the element is inline-level, this value opens an additional level
    of embedding with respect to the bidirectional algorithm. The direction
    of this embedding level is given by the &lsquo;<a
    href="#direction0"><code class=property>direction</code></a>&rsquo;
    property. Inside the element, reordering is done implicitly. This
    corresponds to adding a LRE (U+202A; for &lsquo;<code
    class=css>direction: ltr</code>&rsquo;) or RLE (U+202B; for &lsquo;<code
    class=css>direction: rtl</code>&rsquo;) at the start of the element and a
    PDF (U+202C) at the end of the element.

   <dt><strong>bidi-override</strong>

   <dd>For inline-level elements this creates an override. For block-level,
    table-cell, table-caption, or inline-block elements this creates an
    override for inline-level descendants not within another block-level,
    table-cell, table-caption, or inline-block element. This means that
    inside the element, reordering is strictly in sequence according to the
    <span class=propinst-direction>&lsquo;<a href="#direction0"><code
    class=property>direction</code></a>&rsquo;</span> property; the implicit
    part of the bidirectional algorithm is ignored. This corresponds to
    adding a LRO (U+202D; for &lsquo;<code class=css>direction:
    ltr</code>&rsquo;) or RLO (U+202E; for &lsquo;<code class=css>direction:
    rtl</code>&rsquo;) at the start of the element and a PDF (U+202C) at the
    end of the element.

   <dt><strong>isolate</strong>

   <dd>For the purposes of the Unicode bidirectional algorithm, the contents
    of the element are considered to be inside a separate, independent
    paragraph, and for the purpose of bidi resolution in its containing bidi
    paragraph (if any), the element itself is treated as if it were an Object
    Replacement Character (U+FFFC). (If the element is broken across multiple
    lines, then each box of the element is treated as an Object Replacement
    Character.)

   <dt><strong>plaintext</strong>

   <dd>
    <p>For the purposes of the Unicode bidirectional algorithm, the base
     directionality of each "paragraph" for which the element is the
     containing block element is determined not by the element's computed
     &lsquo;<a href="#direction0"><code
     class=property>direction</code></a>&rsquo; as usual, but by following
     rules P1, P2, and P3 of the Unicode bidirectional algorithm. However, if
     no direction-determining character is found in step P2, then the value
     of the &lsquo;<a href="#direction0"><code
     class=property>direction</code></a>&rsquo; property is used instead.
     Note this value has no effect on inline elements.
  </dl>

  <p>The final order of characters in each block-level element is the same as
   if the bidi control codes had been added as described above, markup had
   been stripped, and the resulting character sequence had been passed to an
   implementation of the Unicode bidirectional algorithm for plain text that
   produced the same line-breaks as the styled text. In this process,
   non-textual entities such as images are treated as neutral characters,
   unless their <span class=propinst-unicode-bidi>&lsquo;<a
   href="#unicode-bidi0"><code
   class=property>unicode-bidi</code></a>&rsquo;</span> property has a value
   other than &lsquo;<code class=property>normal</code>&rsquo;, in which case
   they are treated as strong characters in the <span
   class=propinst-direction>&lsquo;<a href="#direction0"><code
   class=property>direction</code></a>&rsquo;</span> specified for the
   element.

  <p>Please note that in order to be able to flow inline boxes in a uniform
   direction (either entirely left-to-right or entirely right-to-left), more
   inline boxes (including anonymous inline boxes) may have to be created,
   and some inline boxes may have to be split up and reordered before
   flowing.

  <p>Because the Unicode algorithm has a limit of <em title="According to
   unicode 3.0, chapter 3, section 12, definition BD2. Specifically, page 58
   here: http://www.unicode.org/unicode/uni2book/ch03.pdf"> 61 levels</em> of
   embedding, care should be taken not to use <span
   class=propinst-unicode-bidi>&lsquo;<a href="#unicode-bidi0"><code
   class=property>unicode-bidi</code></a>&rsquo;</span> with a value other
   than &lsquo;<code class=property>normal</code>&rsquo; unless appropriate.
   In particular, a value of &lsquo;<code
   class=property>inherit</code>&rsquo; should be used with extreme caution.
   However, for elements that are, in general, intended to be displayed as
   blocks, a setting of &lsquo;<code class=css>unicode-bidi:
   isolate</code>&rsquo; is preferred to keep the element together in case
   display is changed to inline (see example below).

  <p>The following example shows an XML document with bidirectional text. It
   illustrates an important design principle: document language designers
   should take bidi into account both in the language proper (elements and
   attributes) and in any accompanying style sheets. The style sheets should
   be designed so that bidi rules are separate from other style rules, and
   such rules should not be overridden by other style sheets so that the
   document language's bidi behavior is preserved.

  <h3 id=bidi-example><span class=secno>2.3. </span>Example of Bidirectional
   Text</h3>

  <div class=example>
   <p>In this example, lowercase letters stand for inherently left-to-right
    characters and uppercase letters represent inherently right-to-left
    characters. The text stream is shown in logical backing store order.</p>

   <pre class=xml-example><code class=xml>
&lt;HEBREW&gt;
  &lt;PAR&gt;HEBREW1 HEBREW2 english3 HEBREW4 HEBREW5&lt;/PAR&gt;
  &lt;PAR&gt;HEBREW6 &lt;EMPH&gt;HEBREW7&lt;/EMPH&gt; HEBREW8&lt;/PAR&gt;
&lt;/HEBREW&gt;
&lt;ENGLISH&gt;
  &lt;PAR&gt;english9 english10 english11 HEBREW12 HEBREW13&lt;/PAR&gt;
  &lt;PAR&gt;english14 english15 english16&lt;/PAR&gt;
  &lt;PAR&gt;english17 &lt;HE-QUO&gt;HEBREW18 english19 HEBREW20&lt;/HE-QUO&gt;&lt;/PAR&gt;
&lt;/ENGLISH&gt;
    </code></pre>

   <p>Since this is arbitrary XML, the style sheet is responsible for setting
    the writing direction. This is the style sheet:</p>

   <pre>
/* Rules for bidi */
HEBREW, HE-QUO  {direction: rtl; unicode-bidi: embed;}
ENGLISH         {direction: ltr; unicode-bidi: embed;} 

/* Rules for presentation */
HEBREW, ENGLISH, PAR  {display: block;}
EMPH                  {font-weight: bold;}
    </pre>

   <p>The HEBREW element is a block with a right-to-left base direction, the
    ENGLISH element is a block with a left-to-right base direction. The PARs
    are blocks that inherit the base direction from their parents. Thus, the
    first two PARs are read starting at the top right, the final three are
    read starting at the top left. Please note that HEBREW and ENGLISH are
    chosen as element names for explicitness only; in general, element names
    should convey structure without reference to language.</p>

   <p>The EMPH element is inline-level, and since its value for <span
    class=propinst-unicode-bidi>&lsquo;<a href="#unicode-bidi0"><code
    class=property>unicode-bidi</code></a>&rsquo;</span> is &lsquo;<code
    class=property>normal</code>&rsquo; (the initial value), it has no effect
    on the ordering of the text. The HE-QUO element, on the other hand,
    creates an embedding.</p>

   <p>The formatting of this text might look like this if the line length is
    long:</p>

   <pre class=ascii-art>
               5WERBEH 4WERBEH english3 2WERBEH 1WERBEH

                                8WERBEH <b>7WERBEH</b> 6WERBEH

english9 english10 english11 13WERBEH 12WERBEH

english14 english15 english16

english17 20WERBEH english19 18WERBEH
    </pre>

   <p>Note that the HE-QUO embedding causes HEBREW18 to be to the right of
    english19.</p>

   <p>If lines have to be broken, it might be more like this:</p>

   <pre class=ascii-art>
       2WERBEH 1WERBEH
  -EH 4WERBEH english3
                 5WERB

   -EH <b>7WERBEH</b> 6WERBEH
                 8WERB

english9 english10 en-
glish11 12WERBEH
13WERBEH

english14 english15
english16

english17 18WERBEH
20WERBEH english19
    </pre>

   <p>Because HEBREW18 must be read before english19, it is on the line above
    english19. Just breaking the long line from the earlier formatting would
    not have worked. Note also that the first syllable from english19 might
    have fit on the previous line, but hyphenation of left-to-right words in
    a right-to-left context, and vice versa, is usually suppressed to avoid
    having to display a hyphen in the middle of a line.</p>
  </div>
  <!-- example -->

  <h3 id=bidi-box-model><span class=secno>2.4. </span>Box model for inline
   elements in bidirectional context</h3>
  <!-- CSS2.1 8.6 -->

  <p>For each line box, UAs must take the inline boxes generated for each
   element and render the margins, borders and padding in visual order (not
   logical order).

  <p>When the element's &lsquo;<a href="#direction0"><code
   class=property>direction</code></a>&rsquo; property is &lsquo;<code
   class=css>ltr</code>&rsquo;, the left-most generated box of the first line
   box in which the element appears has the left margin, left border and left
   padding, and the right-most generated box of the last line box in which
   the element appears has the right padding, right border and right margin.

  <p>When the element's &lsquo;<a href="#direction0"><code
   class=property>direction</code></a>&rsquo; property is &lsquo;<code
   class=css>rtl</code>&rsquo;, the right-most generated box of the first
   line box in which the element appears has the right padding, right border
   and right margin, and the left-most generated box of the last line box in
   which the element appears has the left margin, left border and left
   padding.

  <h2 id=vertical-intro><span class=secno>3. </span> Introduction to Vertical
   Text</h2>

  <p>In addition to extensions to CSS2.1&lsquo;<code class=css>s support for
   bidirectional text, this module introduces the rules and properties needed
   to support vertical text layout in CSS. </code>

  <p>Unlike languages that use the Latin script which are primarily laid out
   horizontally, Asian languages such as Chinese and Japanese can be laid
   vertically. The Japanese example below shows the same text laid out
   horizontally and vertically. In the horizontal case, text is read from
   left to right, top to bottom. For the vertical case, the text is read top
   to bottom, right to left. Indentation from the left edge in the
   left-to-right horizontal case translates to indentation from the top edge
   in the top-to-bottom vertical case.

  <div class=figure>
   <p><img alt="A comparison of horizontal and vertical Japanese shows that
    although the lines rotate, the characters remain upright. Some glyphs,
    however change: a period mark shifts from the bottom left of its glyph
    box to the top right. Running headers, however, may remain laid out
    horizontally across the top of the page." src=vert-horiz-comparison.png></p>

   <p class=caption>Comparison of vertical and horizontal Japanese: iBunko
    application (iOS)</p>
  </div>

  <p class=note>For Chinese and Japanese lines are ordered either right to
   left, while for Mongolian and Manchu left to right.

  <p>The change from horizontal to vertical writing can affect not just the
   layout, but also the typesetting. For example, the position of a
   punctuation mark within its spacing box can change from the horizontal to
   the vertical case, and in some cases alternate glyphs are used.

  <p>Vertical text that includes Latin script text or text from other scripts
   normally displayed horizontally can display that text in a number of ways.
   For example, Latin words can be rotated sideways, or each letter can be
   oriented upright:

  <div class=figure>
   <p><img alt="A dictionary definition for &#x30F4;&#x30A3;&#x30EB;&#x30B9;
    might write the English word &lsquo;<code
    class=property>virus</code>&rsquo; rotated 90&deg; clockwise, but stack
    the letters of the initialisms </code>&rsquo;RNA' and 'DNA' upright."
    src=vert-latin-layouts.png></p>

   <p class=caption>Examples of Latin in vertical Japanese: Daijirin Viewer
    1.4 (iOS)</p>
  </div>

  <p>In some special cases such as two-digit numbers in dates, text is fit
   compactly into a single vertical character box:

  <div class=figure>
   <p><img alt="An exerpt from MacFan shows several possible vertical layouts
    for numbers: the two-digit month and day are written as
    horizontal-in-vertical blocks; the years are written with each character
    upright; except in the English phrase &ldquo;for Mac 2011&rdquo;, where
    the date is rotated to match the rotated Latin."
    src=vert-number-layouts.png></p>

   <p class=caption>Mac Fan, December 2010, p.49</p>
  </div>

  <p>Layouts often involve a mixture of vertical and horizontal elements:

  <div class=figure>
   <p><img alt="Magazines often mix horizontal and vertical layout; for
    example, using one orientation for the main article text and a different
    one for sidebar or illustrative content." src=vert-horiz-combination.png></p>

   <p class=caption>Mixture of vertical and horizontal elements</p>
  </div>

  <p>Vertical text layouts also need to handle bidirectional text layout;
   clockwise-rotated Arabic, for example, is laid out bottom-to-top.

  <h3 id=writing-mode><span class=secno>3.1. </span> Block Flow Direction:
   the &lsquo;<a href="#writing-mode1"><code
   class=property>writing-mode</code></a>&rsquo; property</h3>

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=writing-mode1>writing-mode</dfn>

    <tr>
     <th>Value:

     <td>horizontal-tb | vertical-rl | vertical-lr

    <tr>
     <th>Initial:

     <td>horizontal-tb

    <tr>
     <th>Applies to:

     <td>All elements except table row groups, table column groups, table
      rows, and table columns

    <tr>
     <th>Inherited:

     <td>yes

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed&#160;value:

     <td>specified value
  </table>

  <p>This property sets the block flow direction. Possible values:

  <dl>
   <dt>horizontal-tb

   <dd>Top-to-bottom block flow. The writing mode is horizontal.

   <dt>vertical-rl

   <dd>Right-to-left block flow. The writing mode is vertical.

   <dt>vertical-lr

   <dd>Left-to-right block flow. The writing mode is vertical.
  </dl>

  <p>SVG1.1 <a href="#SVG11" rel=biblioentry>[SVG11]<!--{{!SVG11}}--></a>
   defines some additional values: &lsquo;<code class=css>lr</code>&rsquo;,
   &lsquo;<code class=css>lr-tb</code>&rsquo;, &lsquo;<code
   class=css>rl</code>&rsquo;, &lsquo;<code class=css>rl-tb</code>&rsquo;,
   &lsquo;<code class=css>tb</code>&rsquo;, and &lsquo;<code
   class=css>tb-rl</code>&rsquo;. These values are <em>deprecated</em> in any
   context except SVG1 documents. Implementations that wish to support them
   in the context of CSS must treat these values as follows:

  <table class=data>
   <thead>
    <tr>
     <th>SVG1

     <th>CSS

   <tbody>
    <tr>
     <td>lr

     <td rowspan=3>horizontal-tb

    <tr>
     <td>lr-tb

    <tr>
     <td>rl

    <tr>
     <td>tb

     <td rowspan=2>vertical-rl

    <tr>
     <td>tb-rl
  </table>

  <p class=note>In SVG1.1, these values set the <dfn
   id=inline-progression-direction>inline progression direction</dfn>, in
   other words, the direction the current text position advances each time a
   glyph is added. This is a geometric process that happens <a
   href="#after"><em>after</em></a> bidi reordering, and thus has no effect
   on the interpretation of the &lsquo;<a href="#direction0"><code
   class=property>direction</code></a>&rsquo; property (which is independent
   of &lsquo;<a href="#writing-mode1"><code
   class=property>writing-mode</code></a>&rsquo;). (See <a
   href="http://www.w3.org/TR/SVG/text.html#RelationshipWithBiDirectionality">Relationship
   with bidirectionality</a>. <a href="#SVG11"
   rel=biblioentry>[SVG11]<!--{{!SVG11}}--></a>) There are varying
   interpretations on whether this process causes "writing-mode: rl" to
   merely shift the text string or reverse the order of all glyphs in the
   text.

  <p class=issue>See <a href=test-writing-mode-direction.svg>this demo</a> to
   check out your implementation's interpretation! (Note that most SVG
   implementations don't support the &lsquo;<a href="#direction0"><code
   class=property>direction</code></a>&rsquo; property, and thus your results
   may be skewed on that account. Examine the red line of text: if the
   numbers are not in reverse order, your implementation doesn't support
   "direction: rtl".)

  <p>The &lsquo;<a href="#writing-mode1"><code
   class=property>writing-mode</code></a>&rsquo; property determines the
   direction of block flow. This determines the progression of block-level
   boxes in a block formatting context; the progression of line boxes in a
   block container that contains inlines; and the progression of rows in a
   table. By virtue of determining the stacking direction of line boxes, the
   &lsquo;<a href="#writing-mode1"><code
   class=property>writing-mode</code></a>&rsquo; property also determines
   whether line boxes and thus the writing mode is horizontal or vertical.

  <p>When set on the root element, the &lsquo;<a href="#writing-mode1"><code
   class=property>writing-mode</code></a>&rsquo; property together with the
   &lsquo;<a href="#direction0"><code
   class=property>direction</code></a>&rsquo; property determines the <dfn
   id=principal-writing-mode>principal writing mode</dfn> of the document.
   This writing mode is used, for example, to determine the default page
   progression direction. (See <a href="#CSS3PAGE"
   rel=biblioentry>[CSS3PAGE]<!--{{CSS3PAGE}}--></a>.) The &lsquo;<a
   href="#writing-mode1"><code class=property>writing-mode</code></a>&rsquo;
   value of the root element is also propagated to the initial containing
   block and sets the block flow direction of the initial block formatting
   context.

  <p class=note>Note that the &lsquo;<a href="#writing-mode1"><code
   class=property>writing-mode</code></a>&rsquo; property of the HTML BODY
   element is <em>not</em> propagated to the viewport. That special behavior
   only applies to the background and overflow properties.

  <p>If an element has a different block flow direction than its containing
   block:

  <ul>
   <li>If the element has a specified &lsquo;<code
    class=property>display</code>&rsquo; of &lsquo;<code
    class=css>inline</code>&rsquo;, its &lsquo;<code
    class=property>display</code>&rsquo; computes to &lsquo;<code
    class=property>inline-block</code>&rsquo;. <a href="#CSS21"
    rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>

   <li>If the element has a specified &lsquo;<code
    class=property>display</code>&rsquo; of &lsquo;<code
    class=css>run-in</code>&rsquo;, its &lsquo;<code
    class=property>display</code>&rsquo; computes to &lsquo;<code
    class=property>block</code>&rsquo;. <a href="#CSS21"
    rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>
  </ul>

  <p>If such an element is a block container, then it establishes a new block
   formatting context.

  <p>The content of replaced elements do not rotate due to the writing mode:
   images, for example, remain upright. However replaced content involving
   text (such as MathML content or form elements) should match the replaced
   element's writing mode and line orientation if the UA supports such a
   vertical writing mode for the replaced content.

  <div class=example>
   <p>In the following example, two blocks elements (1 and 3) separated by an
    image (2) are presented in various flow writing modes.</p>

   <p>Here is a diagram of horizontal writing mode (<code>writing-mode:
    horizontal-tb</code>):</p>

   <p><img alt="Diagram of horizontal layout: blocks 1, 2, and 3 are stacked
    top-to-bottom" height=300 src=horizontal.png width=219></p>

   <p>Here is a diagram for the right-to-left vertical writing mode commonly
    used in East Asia (<code>writing-mode: vertical-rl</code>):</p>

   <p><img alt="Diagram of a right-to-left vertical layout: blocks 1, 2, and
    3 are arranged side by side from right to left" height=191
    src=vertical-rl.png width=297></p>

   <p>And finally, here is a diagram for the left-to-right vertical writing
    mode used for Manchu and Mongolian (<code>writing-mode:
    vertical-lr</code>):</p>

   <p><img alt="Diagram of left-to-right vertical layout: blocks 1, 2, and 3
    are arranged side by side from left to right" height=191
    src=vertical-lr.png width=300></p>
  </div>

  <h2 id=intro-text-layout><span class=secno>4. </span> Introduction to
   Intrinsic Text Layout</h2>

  <p>[Describe here any necessary concepts from UTN22]

  <h3 id=text-orientation><span class=secno>4.1. </span>Orienting Text: the
   &lsquo;<a href="#text-orientation0"><code
   class=property>text-orientation</code></a>&rsquo; property</h3>

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=text-orientation0>text-orientation</dfn>

    <tr>
     <th>Value:

     <td>vertical-right | upright | rotate-right | rotate-left |
      rotate-normal | auto

    <tr>
     <th>Initial:

     <td>vertical-right

    <tr>
     <th>Applies to:

     <td>all elements except table row groups, rows, column groups, and
      columns

    <tr>
     <th>Inherited:

     <td>yes

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed&#160;value:

     <td>specified value
  </table>

  <p>This property specifies the orientation of characters within a line and
   sets the orientation of the line. Current values only have an effect in
   vertical writing modes. Values have the following meanings:

  <dl>
   <dt><dfn id=vertical-right>vertical-right</dfn>

   <dd>
    <p>In vertical writing modes, grapheme clusters from scripts that do not
     have an intrinsic vertical orientation are rotated 90&deg; clockwise
     from their standard orientation in horizontal text. Characters from
     scripts that do have an intrinsic vertical orientation are set in that
     orientation. When available, vertical glyph variants and vertical font
     metrics are used to set all punctuation and characters from any script
     that is not rotated. In vertical writing modes, this value puts the UA
     in a <i>vertical typographic mode</i> and is typical for layout of
     primarily vertical-script text.

   <dt><dfn id=upright>upright</dfn>

   <dd>
    <p>In vertical writing modes, grapheme clusters that do not have an
     intrinsic vertical orientation are rendered upright, i.e. in their
     standard horizontal orientation. Shaping characters from such scripts
     are shaped in their isolated forms. Characters from scripts that do have
     an intrinsic vertical orientation are set in that orientation. When
     available, vertical glyph variants and vertical font metrics are used to
     set the text. The UA should synthesize vertical font metrics for
     grapheme clusters that do not have any.

    <p>For the purposes of bidi reordering, this value causes all characters
     to be treated as strong LTR. This value causes the used value of
     &lsquo;<a href="#direction0"><code
     class=property>direction</code></a>&rsquo; to be &lsquo;<code
     class=css>ltr</code>&rsquo;.

    <p>In vertical writing modes, this value puts the UA in a <i>vertical
     typographic mode</i>.

   <dt><dfn id=rotate-right>rotate-right</dfn>

   <dd>
    <p>In vertical writing modes, this causes text to be set as if in a
     horizontal layout (using horizontal glyph variants and metrics), but
     rotated 90&deg; clockwise. This value puts the UA in a This value puts
     the UA in a <i>horizontal typographic mode</i> and can be used for
     &lsquo;<code class=css>vertical-rl</code>&rsquo; text in a primarily
     horizontal-script document.

   <dt><dfn id=rotate-left>rotate-left</dfn>

   <dd>
    <p>In vertical writing modes, this causes text to be set as if in a
     horizontal layout (using horizontal glyph variants and metrics), but
     rotated 90&deg; counter-clockwise. This value puts the UA in a
     <i>horizontal typographic mode</i> and can be used for &lsquo;<code
     class=css>vertical-lr</code>&rsquo; text in a primarily
     horizontal-script document.

    <p>If set on a non-replaced inline whose parent is not &lsquo;<a
     href="#rotate-left"><code class=css>rotate-left</code></a>&rsquo;, this
     forces &lsquo;<code class=css>isolate</code>&rsquo; to be added to the
     computed value of &lsquo;<a href="#unicode-bidi0"><code
     class=property>unicode-bidi</code></a>&rsquo;. Layout of text is exactly
     as for &lsquo;<a href="#rotate-right"><code
     class=css>rotate-right</code></a>&rsquo; except that the entire text
     content and baseline table of the element is mirrored: each box of the
     inline is mirrored around a vertical axis such that its content box does
     not move. (However the contents of atomic inlines are not mirrored; only
     their alignment is changed.) Similarly, if a child of the element has a
     &lsquo;<a href="#text-orientation0"><code
     class=property>text-orientation</code></a>&rsquo; value other than
     &lsquo;<a href="#rotate-left"><code
     class=css>rotate-left</code></a>&rsquo;, an analogous transformation is
     applied.

   <dt><dfn id=rotate-normal>rotate-normal</dfn>

   <dd>
    <p>This value is equivalent to &lsquo;<a href="#rotate-right"><code
     class=css>rotate-right</code></a>&rsquo; in &lsquo;<code
     class=css>vertical-rl</code>&rsquo; writing mode and equivalent to
     &lsquo;<a href="#rotate-left"><code
     class=css>rotate-left</code></a>&rsquo; in &lsquo;<code
     class=css>vertical-lr</code>&rsquo; writing mode.

   <dt><dfn id=auto>auto</dfn>

   <dd>
    <p><a href="#SVG11" rel=biblioentry>[SVG11]<!--{{!SVG11}}--></a> defines
     &lsquo;<code class=property>glyph-orientation-vertical</code>&rsquo; and
     &lsquo;<code class=property>glyph-orientation-horizontal</code>&rsquo;
     properties that were intended to control text orientation. These
     properties are <em>deprecated</em> and do not apply to non-SVG elements.
     If an implementation supports these properties, the &lsquo;<a
     href="#auto"><code class=css>auto</code></a>&rsquo; value when set on
     SVG elements indicates that the SVG &lsquo;<code
     class=property>glyph-orientation-vertical</code>&rsquo; and &lsquo;<code
     class=property>glyph-orientation-horizontal</code>&rsquo; behavior
     control the layout of text. Such UAs must set &lsquo;<code
     class=css>text-orientation: auto</code>&rsquo; on all <a
     href="http://www.w3.org/TR/SVG/intro.html#TermTextContentElement">SVG
     text content elements</a> in their default UA style sheet for SVG.

    <p>In all other contexts, and for implementations that do not support the
     glyph orientation properties, the &lsquo;<a href="#auto"><code
     class=css>auto</code></a>&rsquo; behavior is the same as for &lsquo;<a
     href="#vertical-right"><code class=css>vertical-right</code></a>&rsquo;.
     
  </dl>

  <div class=figure> <img alt="text-orientation: vertical-right, upright,
   rotate-left, and rotate-right" height=100 src=text-orientation.png
   width=192>
   <p class=caption>text-orientation: vertical-right, upright, rotate-left,
    and rotate-right</p>
  </div>

  <p class=issue>Baseline alignment is not yet defined.

  <p class=issue>Add section explaining native script orientations. Note that
   all wide characters are treated the same as ideographic. Link to
   definition of grapheme clusters in <a href="#UAX29"
   rel=biblioentry>[UAX29]<!--{{!UAX29}}--></a>.

  <p class=issue>Add appendix that describes interaction with OpenType
   features and font layout?

  <h2 id=abstract-box><span class=secno>5. </span> Abstract Box Terminology</h2>

  <p><a href="#CSS21" rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a> defines
   the box layout model of CSS in detail. However, it only defines the box
   model for the &lsquo;<code class=css>horizontal-tb</code>&rsquo; writing
   mode. CSS box layout in writing modes other than &lsquo;<code
   class=css>horizontal-tb</code>&rsquo; is analogous to the box layout
   defined in CSS2.1 if directions and dimensions are abstracted and remapped
   appropriately. This section defines abstract directional and dimensional
   terms and their mappings in order to define box layout for other writing
   modes, and to provide terminology for future specs to define their layout
   concepts abstactly.

  <h3 id=abstract-dimensions><span class=secno>5.1. </span> Logical
   Dimensions</h3>

  <dl>
   <dt><dfn id=block-flow-dimension>block flow dimension</dfn>

   <dd>The dimension perpendicular to the flow of text with in a line, the
    <i>vertical dimension</i> in horizontal writing modes, and the
    <i>horizontal dimension</i> in vertical writing modes.

   <dt><dfn id=inline-dimension>inline dimension</dfn>

   <dd>The dimension parallel to the flow of text within a line, i.e. the
    <i>horizontal dimension</i> in horizontal writing modes, and the
    <i>vertical dimension</i> in vertical writing modes.

   <dt><dfn id=inline-axis>inline-axis</dfn>

   <dd>The axis in the block flow dimension, i.e. the <i>vertical axis</i> in
    horizontal writing modes and the <i>horizontal axis</i> in vertical
    writing modes.

   <dt><dfn id=block-axis>block-axis</dfn>

   <dd>The axis in the inline dimension, i.e. the <i>horizontal axis</i> in
    horizontal writing modes and the <i>vertical axis</i> in vertical writing
    modes.

   <dt><dfn id=length>length</dfn> or <dfn id=logical-height>logical
    height</dfn>

   <dt>

   <dd>A measurement in the block flow dimension: refers to the physical
    height (vertical dimension) in horizontal writing modes, and to the
    physical width (horizontal dimension) in vertical writing modes.

   <dt><dfn id=measure>measure</dfn> or <dfn id=logical-width>logical
    width</dfn>

   <dt>

   <dd>A measurement in the inline dimension: refers to the physical width
    (horizontal dimension) in horizontal writing modes, and to the physical
    height (vertical dimension) in vertical writing modes. (The term <a
    href="#measure"><i>measure</i></a> derives from its <a
    href="http://en.wikipedia.org/wiki/Measure_%28typography%29">use in
    typography</a>.)
  </dl>

  <h3 id=abstract-directions><span class=secno>5.2. </span> Abstract and
   Physical Directions</h3>

  <p>The terms <dfn id=left>left</dfn>, <dfn id=right>right</dfn>, <dfn
   id=top>top</dfn>, and <dfn id=bottom>bottom</dfn> are always interpreted
   physically, i.e. with respect to the page independent of writing mode. Two
   abstract mappings are possible for these directions: line-relative and
   flow-relative, which are defined below.

  <p>Although they derive from the behavior of text, these directional terms
   exist even for boxes that do not contain any line boxes: they are
   calculated directly from the values of the &lsquo;<a
   href="#writing-mode1"><code class=property>writing-mode</code></a>&rsquo;,
   &lsquo;<a href="#text-orientation0"><code
   class=property>text-orientation</code></a>&rsquo;, and &lsquo;<a
   href="#direction0"><code class=property>direction</code></a>&rsquo;
   properties.

  <h3 id=line-directions><span class=secno>5.3. </span> Line-relative
   Directions</h3>

  <p>Although the block flow direction given by &lsquo;<a
   href="#writing-mode1"><code class=property>writing-mode</code></a>&rsquo;
   determines whether the line is oriented horizontally or vertically, it
   doesn't say anything about how the contents within the line are arranged.

  <p>The <dfn id=line-orientation>line orientation</dfn> determines which
   side of the line is the "top" and thus which sides are <dfn
   id=under>under</dfn> (ascender side) and <dfn id=over>over</dfn>
   (descender side) the line. This determines the interpretation of alignment
   in the transverse dimension of the line. It also determines the default
   <i>glyph orientation</i> for scripts in a non-native orientation. These
   characteristics are controlled by the &lsquo;<a
   href="#text-orientation0"><code
   class=property>text-orientation</code></a>&rsquo; property.

  <p>In addition to its <a href="#over"><i>over</i></a> and <a
   href="#under"><i>under</i></a> sides, a line box, even a
   vertically-oriented one, also has a "left" and "right" side, which we will
   call the <a href="#line-left"><i>line-left</i></a> and <a
   href="#line-right"><i>line-right</i></a> sides of the box (as distinct
   from the physical left and physical right sides of the box). The <dfn
   id=line-left>line-left</dfn> edge of a box is nominally the edge from
   which <abbr title=left-to-right>LTR</abbr> text would start. The <dfn
   id=line-right>line-right</dfn> edge of a box is nominally the edge from
   which <abbr title=right-to-left>RTL</abbr> text would start. Depending on
   the &lsquo;<a href="#writing-mode1"><code
   class=property>writing-mode</code></a>&rsquo; and &lsquo;<a
   href="#text-orientation0"><code
   class=property>text-orientation</code></a>&rsquo; properties, the
   line-left side of a box could be on the left, top, or bottom.

  <div class=figure> <object class=landscape
   data="diagrams/line-orient-up.svg" type="image/svg+xml"></object>
   <p class=caption>Line orientation compass</p>
  </div>

  <div class=figurepair>
   <div class=figure> <object class=portrait
    data="diagrams/line-orient-right.svg" type="image/svg+xml"></object>
    <p class=caption>Typical orientation in vertical</p>
   </div>

   <div class=figure> <object class=portrait
    data="diagrams/line-orient-left.svg" type="image/svg+xml"></object>
    <p class=caption>Line orientation with &lsquo;<code
     class=css>text-orientation: rotate-left</code>&rsquo;</p>
   </div>
  </div>

  <p class=note>Note also that while the <a href="#over"><i>over</i></a> and
   <a href="#under"><i>under</i></a> directions often map to the same
   directions as <a href="#before">before</a> and <a href="#after">after</a>
   respectively, this mapping is reversed for some combinations of &lsquo;<a
   href="#writing-mode1"><code class=property>writing-mode</code></a>&rsquo;
   and &lsquo;<a href="#text-orientation0"><code
   class=property>text-orientation</code></a>&rsquo;.

  <h3 id=logical-directions><span class=secno>5.4. </span> Flow-relative
   Directions</h3>

  <p>The <dfn id=flow-relative-directions>flow-relative directions</dfn> are
   <a href="#before">before</a>, <a href="#after">after</a>, <a
   href="#start">start</a>, and <a href="#end">end</a>. In an <abbr
   title=left-to-right>LTR</abbr> &lsquo;<code
   class=css>horizontal-tb</code>&rsquo; writing mode, they correspond to the
   top, bottom, left, and right directions, respectively.

  <p>The <dfn id=before>before</dfn> edge of a box is nominally the edge that
   comes earlier in the block progression, as determined by the &lsquo;<a
   href="#writing-mode1"><code class=property>writing-mode</code></a>&rsquo;
   poperty. Similarly the <dfn id=after>after</dfn> edge is the edge that
   comes later in the progression.

  <p>The <dfn id=start>start</dfn> edge of a box is nominally the edge from
   which text of its inline base direction will start. For boxes with a used
   &lsquo;<a href="#direction0"><code
   class=property>direction</code></a>&rsquo; value of &lsquo;<code
   class=css>ltr</code>&rsquo;, this means the <a
   href="#line-left"><i>line-left</i></a> edge. For boxes with a used
   &lsquo;<a href="#direction0"><code
   class=property>direction</code></a>&rsquo; value of &lsquo;<code
   class=css>rtl</code>&rsquo;, this means the <a
   href="#line-right"><i>line-right</i></a> edge. The edge opposite the start
   edge is the <dfn id=end>end</dfn> edge.

  <p class=note>Note that while determining the <a
   href="#before"><i>before</i></a> and <a href="#after"><i>after</i></a>
   edges of a box depends only on the &lsquo;<a href="#writing-mode1"><code
   class=property>writing-mode</code></a>&rsquo; property, determining the <a
   href="#start"><i>start</i></a> and <a href="#end"><i>end</i></a> edges of
   a box depends not only on the &lsquo;<a href="#writing-mode1"><code
   class=property>writing-mode</code></a>&rsquo; property but also the
   &lsquo;<a href="#direction0"><code
   class=property>direction</code></a>&rsquo; <em>and</em> &lsquo;<a
   href="#text-orientation0"><code
   class=property>text-orientation</code></a>&rsquo; properties.

  <div class=example>
   <p>An English (LTR-TB) block:</p>

   <pre class=ascii-art>
                  &lt;----- width / measure  -----&gt;

                             top side/
                            before side
                  +------------------------------+                  A
      left side/  |   ---inline direction --->   |  right side/     |
      start side  |  |                           |  end side        |
                  |  | block      * horizontal * |                height/
                  |  | direction  *writing mode* |                length
                  |  V                           |                  |
                  +------------------------------+                  V
                             bottom side/
                              after side
    </pre>
  </div>

  <div class=example>
   <p>A vertical Japanese block (TTB-RL):</p>

   <pre class=ascii-art>
                  &lt;----- width / length ------&gt;

                             top side/
                            start side
                  +------------------------------+                  A
      left side/  |    &lt;---block direction---    |  right side/     |
      after side  |                           |  |  before side     |
                  |  *  vertical  *     inline|  |                height/
                  |  *writing mode*  direction|  |                measure
                  |                           V  |                  |
                  +------------------------------+                  V
                            bottom side/
                             end side
    </pre>
  </div>

  <h3 id=logical-to-physical><span class=secno>5.5. </span>
   Abstract-to-Physical Mappings</h3>

  <p>The following table summarizes the abstract-to-physical mappings:

  <table class=data>
   <caption>Abstract-Physical Mapping</caption>

   <thead>
    <tr>
     <th scope=row>&lsquo;<a href="#writing-mode1"><code
      class=property>writing-mode</code></a>&rsquo;

     <th colspan=2>&lsquo;<code class=css>horizontal-tb</code>&rsquo;

     <th colspan=4>&lsquo;<code class=css>vertical-rl</code>&rsquo;

     <th colspan=4>&lsquo;<code class=css>vertical-lr</code>&rsquo;

    <tr>
     <th scope=row>&lsquo;<a href="#text-orientation0"><code
      class=property>text-orientation</code></a>&rsquo;

     <th colspan=2>&mdash;

     <th colspan=2>&lsquo;<a href="#rotate-left"><code
      class=css>rotate-left</code></a>&rsquo;

     <th colspan=2><abbr title="vertical-right, upright,
      rotate-right">*right</abbr>

     <th colspan=2>&lsquo;<a href="#rotate-left"><code
      class=css>rotate-left</code></a>&rsquo;

     <th colspan=2><abbr title="vertical-right, upright,
      rotate-right">*right</abbr>

    <tr>
     <th scope=row>&lsquo;<a href="#direction0"><code
      class=property>direction</code></a>&rsquo;

     <th>&lsquo;<code class=css>ltr</code>&rsquo;

     <th>&lsquo;<code class=css>rtl</code>&rsquo;

     <th>&lsquo;<code class=css>ltr</code>&rsquo;

     <th>&lsquo;<code class=css>rtl</code>&rsquo;

     <th>&lsquo;<code class=css>ltr</code>&rsquo;

     <th>&lsquo;<code class=css>rtl</code>&rsquo;

     <th>&lsquo;<code class=css>ltr</code>&rsquo;

     <th>&lsquo;<code class=css>rtl</code>&rsquo;

     <th>&lsquo;<code class=css>ltr</code>&rsquo;

     <th>&lsquo;<code class=css>rtl</code>&rsquo;

   <tbody>
    <tr>
     <th scope=row>length

     <td colspan=2>height

     <td colspan=8>width

    <tr>
     <th scope=row>measure

     <td colspan=2>width

     <td colspan=8>height

    <tr>
     <th scope=row>before

     <td colspan=2>top

     <td colspan=4>right

     <td colspan=4>left

    <tr>
     <th scope=row>after

     <td colspan=2>bottom

     <td colspan=4>left

     <td colspan=4>right

    <tr>
     <th scope=row>start

     <td>left

     <td>right

     <td>bottom

     <td>top

     <td>top

     <td>bottom

     <td>bottom

     <td>top

     <td>top

     <td>bottom

    <tr>
     <th scope=row>end

     <td>right

     <td>left

     <td>top

     <td>bottom

     <td>bottom

     <td>top

     <td>top

     <td>bottom

     <td>bottom

     <td>top

   <tbody>
    <tr>
     <th scope=row>over

     <td colspan=2>top

     <td colspan=2>left

     <td colspan=2>right

     <td colspan=2>left

     <td colspan=2>right

    <tr>
     <th scope=row>under

     <td colspan=2>bottom

     <td colspan=2>right

     <td colspan=2>left

     <td colspan=2>right

     <td colspan=2>left

    <tr>
     <th scope=row>line-left

     <td colspan=2>left

     <td colspan=2>bottom

     <td colspan=2>top

     <td colspan=2>bottom

     <td colspan=2>top

    <tr>
     <th scope=row>line-right

     <td colspan=2>right

     <td colspan=2>top

     <td colspan=2>bottom

     <td colspan=2>top

     <td colspan=2>bottom
  </table>

  <h2 id=abstract-layout><span class=secno>6. </span> Abstract Box Layout</h2>

  <h3 id=vertical-layout><span class=secno>6.1. </span> Principles of Layout
   in Vertical Writing Modes</h3>

  <p>CSS box layout in vertical writing modes is analogous to layout in the
   horizontal writing modes, following the principles outlined below:

  <p>Layout calculation rules (such as those in CSS2.1, Section 10.3) that
   apply to the horizontal dimension in horizontal writing modes instead
   apply to the vertical dimension in vertical writing modes. Likewise,
   layout calculation rules (such as those in CSS2.1, Section 10.6) that
   apply to the vertical dimension in horizontal writing modes instead apply
   to the horizontal dimension in vertical writing modes. Thus:

  <ul>
   <li>
    <p>Layout rules that refer to the width use the height instead, and vice
     versa.

   <li>
    <p>Layout rules that refer to the &lsquo;<code
     class=css>*-left</code>&rsquo; and &lsquo;<code
     class=css>*-right</code>&rsquo; box properties (border, margin, padding)
     use &lsquo;<code class=css>*-top</code>&rsquo; and &lsquo;<code
     class=css>*-bottom</code>&rsquo; instead, and vice versa.

    <p class=note>Which side of the box the property applies to doesn't
     change: only which values are inputs to which layout calculations
     changes. The &lsquo;<code class=property>margin-left</code>&rsquo;
     property still affects the lefthand margin, for example; however in a
     &lsquo;<code class=css>vertical-rl</code>&rsquo; writing mode it takes
     part in margin collapsing in place of &lsquo;<code
     class=property>margin-bottom</code>&rsquo;.</p>

   <li>
    <p>Layout rules that depend on the &lsquo;<a href="#direction0"><code
     class=property>direction</code></a>&rsquo; property to choose between
     left and right (e.g. overflow, overconstraint resolution, the initial
     value for &lsquo;<code class=property>text-align</code>&rsquo;, table
     column ordering) are abstracted to the <a href="#start">start</a> and <a
     href="#end">end</a> sides and applied appropriately.
  </ul>

  <p>For features such as text alignment, floating, and list marker
   positioning, that primarily reference the left or right sides of the line
   box or its longitudinal parallels and therefore have no top or bottom
   equivalent, the <a href="#line-left">line left</a> and <a
   href="#line-right">line right</a> sides are used as the reference for the
   left and right sides respectively.

  <p>Likewise for features such as underlining, overlining, and baseline
   alignment (the unfortunately-named &lsquo;<code
   class=property>vertical-align</code>&rsquo;), that primarily reference the
   top or bottom sides of the linebox or its transversal parallels and
   therefore have no left or right equivalent, the <a href="#over">over</a>
   and <a href="#under">under</a> sides are used as the reference for the top
   and bottom sides respectively.

  <p>The details of these mappings are provided below.

  <h3 id=dimension-mapping><span class=secno>6.2. </span> Dimensional Mapping</h3>
  <!--
  <p>Properties that are named in terms of the x and y axes are
    logical with respect to the block flow direction rather than absolute
    with respect to the page. Specifically:

  <ul>
    <li>The &lsquo;<code class=css>repeat-x</code>&rsquo; keyword of &lsquo;<code class=property>background-repeat</code>&rsquo; tiles in the
      inline dimension of the element, which is not necessarily the
      horizontal dimension. [[!CSS21]] [[!CSS3BG]]
    <li>The &lsquo;<code class=css>repeat-y</code>&rsquo; keyword of &lsquo;<code class=property>background-repeat</code>&rsquo; tiles in the
      block flow dimension of the element, whcih is not necessarily
      the vertical dimenion. [[!CSS21]] [[!CSS3BG]]
    <li>The &lsquo;<code class=property>overflow-x</code>&rsquo; property controls overflow in the inline
      dimension of the element. [[!CSS3UI]]
    <li>The &lsquo;<code class=property>overflow-y</code>&rsquo; property controls overflow in the block
      flow dimension of the element. [[!CSS3UI]]
  </ul>
-->

  <p>Certain properties behave logically as follows:

  <ul>
   <li>The first and second values of the &lsquo;<code
    class=property>border-spacing</code>&rsquo; property represent spacing
    between columns and rows respectively, not necessarily the horizontal and
    vertical spacing respectively. <a href="#CSS21"
    rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>

   <li>The &lsquo;<code class=property>line-height</code>&rsquo; property
    always refers to the logical height. <a href="#CSS21"
    rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>
  </ul>

  <p>The height properties (&lsquo;<code class=property>height</code>&rsquo;,
   &lsquo;<code class=property>min-height</code>&rsquo;, and &lsquo;<code
   class=property>max-height</code>&rsquo;) refer to the physical height, and
   the width properties (&lsquo;<code class=property>width</code>&rsquo;,
   &lsquo;<code class=property>min-width</code>&rsquo;, and &lsquo;<code
   class=property>max-width</code>&rsquo;) refer to the physical width.
   However, the rules used to calculate box dimensions and positions are
   logical.

  <p>For example, the calculation rules in <a
   href="http://www.w3.org/TR/CSS21/visudet.html#Computing_widths_and_margins">CSS2.1
   Section 10.3</a> are used for the inline dimension measurements: they
   apply to the measure (which could be either the physical width or physical
   height) and to the the start and end margins, padding, and border.
   Likewise the calculation rules in <a
   href="http://www.w3.org/TR/CSS21/visudet.html#Computing_heights_and_margins">CSS2.1
   Section 10.6</a> are used in the block dimension: they apply to the length
   and to the before and after margins, padding, and border. <a href="#CSS21"
   rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>

  <p>As a corollary, percentages on the margin and padding properties, which
   are always calculated with respect to the containing block width in
   CSS2.1, are calculated with respect to the <a
   href="#measure"><em>measure</em></a> of the containing block in CSS3.

  <h3 id=orthogonal-flows><span class=secno>6.3. </span> Orthogonal Flows</h3>

  <p>When an element has a different &lsquo;<a href="#writing-mode1"><code
   class=property>writing-mode</code></a>&rsquo; from its containing block
   two cases are possible:

  <ul>
   <li>The two writing modes are parallel to each other. (For example,
    &lsquo;<code class=css>vertical-rl</code>&rsquo; and &lsquo;<code
    class=css>vertical-lr</code>&rsquo;).

   <li>The two writing modes are perpendicular to each other. (For example,
    &lsquo;<code class=css>horizontal-tb</code>&rsquo; and &lsquo;<code
    class=css>vertical-rl</code>&rsquo;).
  </ul>

  <p>To handle the second case, for the purposes of calculating the layout of
   the box, the physical dimensions corresponding to the length and measure
   of the containing block are determined using the writing mode of the box
   under consideration, not the writing mode of the element associated with
   the containing block.

  <p>For example, if a vertical block is placed inside a horizontal block,
   then when calculating the physical height (which is the measure) of the
   child block the physical height of the parent block is used to calculate
   the measure of the child's containing block, even though the physical
   height is the length, not the measure, of the parent block.

  <p>It is common in CSS for a containing block to have a defined measure,
   but not a defined length. This typically happens in CSS2.1 when a
   containing block has an &lsquo;<a href="#auto"><code
   class=css>auto</code></a>&rsquo; height, for example: its width is given
   by the calculations in <a
   href="http://www.w3.org/TR/CSS21/visudet.html#blockwidth">10.3.3</a>, but
   its length depends on its contents. In such cases the <i>available
   measure</i> is defined, but the <i>available length</i> is infinite.

  <p>Orthogonal flows allow the opposite to happen: for the <i>available
   length</i> to be defined, but the <i>available measure</i> to be infinite.
   In such cases a percentage of the containing block measure cannot be
   defined, and thus the initial containing block's measure is used to
   calculate such percentages instead. <span class=issue>Is this definition
   of percentages a good idea?</span>

  <h4 id=orthogonal-auto><span class=secno>6.3.1. </span> Auto-sizing in
   Orthogonal Flows</h4>

  <p>If the computed measure of an element establishing an orthogonal flow is
   &lsquo;<a href="#auto"><code class=css>auto</code></a>&rsquo;, then the
   used measure is calculated as the shrink-to-fit (&lsquo;<code
   class=css>fit-content</code>&rsquo;) value using the initial containing
   block's measure as the available size in the shrink-to-fit algorithm.

  <p class=note>As with other shrink-to-fit boxes, the width and height
   calculations occur before auto margin calculations in the inline
   dimension, and therefore a block box establishing an orthogonal flow, once
   sized, can be aligned or centered within its containing block just like
   other block-level elements by using auto margins.

  <h4 id=orthogonal-multicol><span class=secno>6.3.2. </span> Multi-column
   Layout in Orthogonal Flows</h4>

  <p>If the UA supports CSS Multi-column Layout <a href="#CSS3COL"
   rel=biblioentry>[CSS3COL]<!--{{!CSS3COL}}--></a>, then for the case where
   the available length is defined but the available measure is infinite and
   the element's measure is unconstrained (is not fixed and has no maximum):

  <ul>
   <li>If &lsquo;<code class=property>column-count</code>&rsquo; and
    &lsquo;<code class=property>column-width</code>&rsquo; are both &lsquo;<a
    href="#auto"><code class=css>auto</code></a>&rsquo;, then the
    &lsquo;<code class=property>column-count</code>&rsquo; is assumed to be
    &lsquo;<code class=css>1</code>&rsquo;, and the following rules apply.

   <li>If the &lsquo;<code class=property>column-count</code>&rsquo; is not
    &lsquo;<a href="#auto"><code class=css>auto</code></a>&rsquo;, the column
    width is calculated as if the element's containing block were the initial
    containing block, and the rest of the layout is calculated as described
    below for non-&lsquo;<a href="#auto"><code
    class=css>auto</code></a>&rsquo; column widths.

   <li>If the &lsquo;<code class=property>column-width</code>&rsquo; is not
    &lsquo;<a href="#auto"><code class=css>auto</code></a>&rsquo;, the
    available length is used to calculate the column length by subtracting
    out the element's margins, borders, and padding in the block dimension
    and flooring the result at zero. The used column-count and the used
    measure of the element then follow from filling the resulting columns
    with the element's content.
  </ul>

  <h4 id=orthogonal-pagination><span class=secno>6.3.3. </span> Paginating
   Orthogonal Flows</h4>

  <p><em>This section is informative.</em>

  <p>With regards to pagination, the rules in CSS2.1 still hold in vertical
   writing modes and orthogonal flows: page break opportunities do not occur
   inside line boxes, only between them. Note that UAs that support <a
   href="#CSS3COL" rel=biblioentry>[CSS3COL]<!--{{!CSS3COL}}--></a> may break
   between columns, however. <span class=issue>Does CSS3 Multicol specify
   this <a
   href="http://lists.w3.org/Archives/Public/www-style/2007Nov/0112.html">as
   requested</a>?</span>

  <p>Note that if content spills outside the pagination stream established by
   the root element, the UA is not required to print such content. Authors
   wishing to mix writing modes with long streams of text are thus encouraged
   to use CSS columns to keep all content flowing in the document's
   pagination direction.

  <div class=note>
   <p>In other words, if your document would require two scrollbars on the
    screen it probably won't all print. Fix your layout, e.g. by using <a
    href="http://www.w3.org/TR/css3-multicol/">columns</a> so that it all
    scrolls (and therefore paginates) in one direction if you want to make
    sure it'll all print. T-shaped documents tend not to print well.
  </div>

  <h3 id=logical-direction-layout><span class=secno>6.4. </span>
   Flow-Relative Mappings</h3>

  <p>Flow-relative directions are calculated with respect to the writing mode
   of the element and used to abstract layout related to padding and border
   properties. For example, if an element had computed values of &lsquo;<code
   class=css>direction: ltr; writing-mode: vertical-lr; text-orientation:
   vertical-right</code>&rsquo;, &lsquo;<code
   class=property>padding-top</code>&rsquo; would give its start padding, and
   &lsquo;<code class=property>padding-left</code>&rsquo; would give its
   before padding.

  <p>Flow-relative directions are calculated with respect to the writing mode
   of the <em>parent</em> of the element and used to abstract layout related
   to the margin properties and the &lsquo;<a href="#top"><code
   class=property>top</code></a>&rsquo;, &lsquo;<a href="#bottom"><code
   class=property>bottom</code></a>&rsquo;, &lsquo;<a href="#left"><code
   class=property>left</code></a>&rsquo;, and &lsquo;<a href="#right"><code
   class=property>right</code></a>&rsquo; properties. (For the root element,
   which has no parent, the values of the writing mode of the element is used
   instead.)

  <p>The <a
   href="http://www.w3.org/TR/CSS21/box.html#collapsing-margins">margin
   collapsing rules</a> apply exactly with the <em>before margin</em>
   substituted for the top margin and the <em>after margin</em> substituted
   for the bottom margin. Similarly the padding and border on the same side
   as the before margin is substituted for the top padding and border, and
   the padding and border on the same side as the after margin for the bottom
   padding and border. Note this means only before and after margins ever
   collapse.

  <p class=note>The parent element is used instead of the containing block,
   because the benefit of using the containing block is very rare, but the
   cost to implement it is rather high for implementations that do
   abstract-physical mapping at cascade time.

  <p>The start and end directions are also used for inline layout as follows:
   

  <ul>
   <li>The initial value of the &lsquo;<code
    class=property>text-align</code>&rsquo; property aligns to the start edge
    of the line box.

   <li>The &lsquo;<code class=property>text-indent</code>&rsquo; property
    indents from the start edge of the line box.
  </ul>

  <h3 id=line-mappings><span class=secno>6.5. </span> Line-Relative Mappings</h3>

  <p>The <dfn id=line-relative-directions>line-relative directions</dfn> are
   <a href="#over">over</a>, <a href="#under">under</a>, <a
   href="#line-left">line-left</a>, and <a href="#line-right">line-right</a>.
   In an <abbr title=left-to-right>LTR</abbr> &lsquo;<code
   class=css>horizontal-tb</code>&rsquo; writing mode, they correspond to the
   top, bottom, left, and right directions, respectively.

  <p>The line-right and line-left directions are calculated with respect to
   the writing mode of the element and used to interpret the &lsquo;<a
   href="#left"><code class=css>left</code></a>&rsquo; and &lsquo;<a
   href="#right"><code class=css>right</code></a>&rsquo; values of the
   following properties:

  <ul>
   <li>the &lsquo;<code class=property>text-align</code>&rsquo; property <a
    href="#CSS21" rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>
  </ul>

  <p>The line-right and line-left directions are calculated with respect to
   the writing mode of the <em>containing block</em> of the element and used
   to interpret the &lsquo;<a href="#left"><code
   class=css>left</code></a>&rsquo; and &lsquo;<a href="#right"><code
   class=css>right</code></a>&rsquo; values of the following properties:

  <ul>
   <li>the &lsquo;<code class=property>float</code>&rsquo; property <a
    href="#CSS21" rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>

   <li>the &lsquo;<code class=property>clear</code>&rsquo; property <a
    href="#CSS21" rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>
  </ul>

  <p>The over and under directions are calculated with respect to the writing
   mode of the element and used to define the interpretation of the "top"
   (over edge) and "bottom" (under edge) of the line box as follows:

  <ul>
   <li>For the &lsquo;<code class=property>vertical-align</code>&rsquo;
    property, the "top" of the line box is the over edge; the "bottom" of the
    line box is the under edge. Positive length and percentage values shift
    the baseline towards the over edge. <a href="#CSS21"
    rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>

   <li>For the &lsquo;<code class=property>text-decoration</code>&rsquo;
    property, the underline is drawn on the under side of the text; the
    overline is drawn on the over side of the text. <a href="#CSS21"
    rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a> <span class=note>Note that
    the CSS Text Module defines this in more detail and provides additional
    controls for controlling the position of underlines and overlines. <a
    href="#CSS3TEXT" rel=biblioentry>[CSS3TEXT]<!--{{CSS3TEXT}}--></a></span>
    
  </ul>

  <h3 id=physical-only><span class=secno>6.6. </span> Purely Physical
   Mappings</h3>

  <p>The following values are purely physical in their definitions and do not
   respond to changes in writing mode:

  <ul>
   <li>all values of &lsquo;<code
    class=property>background-repeat</code>&rsquo;

   <li>the &lsquo;<code class=css>rect()</code>&rsquo; notation of the
    &lsquo;<code class=property>clip</code>&rsquo; property <a href="#CSS21"
    rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>

   <li>the offsets of the &lsquo;<code
    class=property>box-shadow</code>&rsquo; and &lsquo;<code
    class=property>text-shadow</code>&rsquo; properties
  </ul>

  <h3 id=caption-side><span class=secno>6.7. </span> Table Caption Mappings:
   the &lsquo;<code class=property>caption-side</code>&rsquo; property</h3>

  <p>This module introduces two new values to the &lsquo;<code
   class=property>caption-side</code>&rsquo; property: &lsquo;<a
   href="#before"><code class=css>before</code></a>&rsquo; and &lsquo;<a
   href="#after"><code class=css>after</code></a>&rsquo;, which position the
   caption before and after the table box, respectively. For tables with
   &lsquo;<code class=css>horizontal-tb</code>&rsquo; writing mode, they are
   equivalent to the existing &lsquo;<a href="#top"><code
   class=css>top</code></a>&rsquo; and &lsquo;<a href="#bottom"><code
   class=css>bottom</code></a>&rsquo; values, respectively. <a href="#CSS21"
   rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>

  <p>Implementations that support the &lsquo;<a href="#top"><code
   class=css>top</code></a>&rsquo; and &lsquo;<a href="#bottom"><code
   class=css>bottom</code></a>&rsquo; values of the &lsquo;<code
   class=property>caption-side</code>&rsquo; property but do not support side
   captions (i.e. &lsquo;<a href="#left"><code
   class=css>left</code></a>&rsquo; and &lsquo;<a href="#right"><code
   class=css>right</code></a>&rsquo; captions in horizontal writing modes)
   must treat &lsquo;<a href="#top"><code class=css>top</code></a>&rsquo; and
   &lsquo;<a href="#bottom"><code class=css>bottom</code></a>&rsquo; as
   &lsquo;<a href="#before"><code class=css>before</code></a>&rsquo;, when
   the table is in a vertical writing mode.

  <p>For implementations that do support side captions (i.e. the &lsquo;<a
   href="#left"><code class=css>left</code></a>&rsquo; and &lsquo;<a
   href="#right"><code class=css>right</code></a>&rsquo; values), this module
   also introduces the &lsquo;<a href="#start"><code
   class=css>start</code></a>&rsquo; and &lsquo;<a href="#end"><code
   class=css>end</code></a>&rsquo; values, which behave similarly and which
   position the caption on the start and end sides of the table box,
   calculated with respect to the writing mode of the table element. For such
   implementations, the &lsquo;<a href="#top"><code
   class=css>top</code></a>&rsquo; and &lsquo;<a href="#bottom"><code
   class=css>bottom</code></a>&rsquo; values must place the caption on the
   top and bottom sides of the table box, respectively. <!--
<h3 id="html-attributes">HTML Attributes</h3>

  <p>This section defines the mapping of HTML presentational attributes
    in CSS. This section is normative for user agents supporting HTML
    in addition to the &lsquo;<code class=property>writing-mode</code>&rsquo; property. [[!HTML40]] [[!HTML5]]

  <h4 id="width-height-attributes">The <code>width</code> and <code>height</code> attributes</h4>

  <p>The HTML <code>width</code> and <code>height</code> attributes refer
    to the physical width and height for elements that that are replaced,
    i.e.
    <code>&lt;applet&gt;</code>,
    <code>&lt;embed&gt;</code>,
    <code>&lt;iframe&gt;</code>,
    <code>&lt;img&gt;</code>,
    <code>&lt;object&gt;</code>,
    <code>&lt;canvas&gt;</code>,
    and
    <code>&lt;video&gt;</code>

  <p>Form elements elements contain text, therefore their contents should be
    affected by writing mode, in which case these attributes refer to the
    <em>logical</em> width and height. The UA may, however, choose not
    to rotate nor flip these elements in vertical writing modes if it is not
    capable, and in that case, these attributes remain physical.</p>
    <p class="issue">when not to rotate form elements/MathML,
      should treat them as images (always upright)
      or to force writing-mode to always calculate to horizontal-tb?</p>

  <p>On table-related elements (<code>&lt;table&gt;</code>, <code>&lt;colgroup&gt;</code>,
    <code>&lt;col&gt;</code>, <code>&lt;tr&gt;</code>, <code>&lt;th&gt;</code>,
    <code>&lt;td&gt;</code>) the <code>width</code> and <code>height</code>
    attributes are always logical.

  <p>The <code>size</code> attribute of the <code>&lt;hr&gt;</code> element
    is also logical (refers to the logical height).

  <h4 id="alignment-attributes">Alignment, Float and Clear Attributes</h4>

  <p>The following attributes behave the same way as their corresponding
    CSS properties:</p>

  <ul>
    <li><code>align</code> as &lsquo;<code class=property>float</code>&rsquo; or &lsquo;<code class=property>text-align</code>&rsquo;</li>
    <li><code>clear</code> as &lsquo;<code class=property>clear</code>&rsquo;</li>
    <li><code>valign</code> as &lsquo;<code class=property>vertical-align</code>&rsquo;</li>
  </ul>

  <h4 id="spacing-attributes">Spacing Attributes</h4>

  <p>The following attributes are logical and, as margins, are logical
    with respect to the writing mode of the <em>parent</em> element.</p>

  <ul>
    <li><code>hspace</code> as start and end margins</li>
    <li><code>vspace</code> as before and after margins</li>
    <li>marginwidth</li>
    <li>marginheight</li>
  </ul>
-->
   

  <h2 id=text-combine><span class=secno>7. </span>Glyph Composition: the
   &lsquo;<a href="#text-combine0"><code
   class=property>text-combine</code></a>&rsquo; property</h2>

  <table class=propdef>
   <tbody>
    <tr>
     <th>Name:

     <td><dfn id=text-combine0>text-combine</dfn>

    <tr>
     <th>Value:

     <td>none | [ horizontal &lt;number&gt;? ]

    <tr>
     <th>Initial:

     <td>none

    <tr>
     <th>Applies to:

     <td>non-replaced inline elements

    <tr>
     <th>Inherited:

     <td>no

    <tr>
     <th>Percentages:

     <td>N/A

    <tr>
     <th>Media:

     <td>visual

    <tr>
     <th>Computed&#160;value:

     <td>specified value
  </table>

  <p>This property allows the combination of multiple characters into the
   space of a single character. For text layout purposes, e.g. bidi ordering,
   line-breaking, emphasis marks, text-decoration, etc. the resulting
   composition is treated as a single glyph representing the Object
   Replacement Character U+FFFC. Values have the following meanings:

  <dl>
   <dt><dfn id=none title="text-combine:none">none</dfn>

   <dd>No special processing.

   <dt><dfn id=horizontal title="text-combine:horizontal">horizontal</dfn>

   <dd>
    <p>In vertical writing mode, attempt to display the text contents of the
     element horizontally within the vertical line box, ideally within the
     space of one ideographic character (1em square).

    <p>The glyphs are stacked horizontally (similar to the contents of an
     inline-box with a horizontal writing mode and a line-height of 1em) and
     the baseline of the resulting composition chosen such that it is
     centered between the content edges of its parent inline box.

    <p>The UA should determine how to render the composed glyph into the
     space. If the UA has compressed glyphs available for the contents of the
     element, then it may use those glyphs to attempt sizing the contents to
     1em square. For example, a two digit number may use halfwidth or
     proportional glyphs, a three-digit number may use 1/3-em glyphs (if
     available, else halfwidth glyphs), etc.

    <p>The UA may scale the contents to fit instead, or in addition to the
     method above.

    <p>In horizontal mode, or if the number of grapheme clusters in the
     element exceeds the number specified (if any), this value is equivalent
     to &lsquo;<code class=css>none</code>&rsquo;.
  </dl>

  <div class=example>
   <p>In East Asian documents, the &lsquo;<code class=css>text-combine:
    horizontal</code>&rsquo; effect is often used to display Latin-based
    strings such as components of a date or letters of an initialism, always
    in a horizontal writing mode regardless of the writing mode of the line:</p>

   <div class=figure>
    <p><img alt="Diagram of tate-chu-yoko, showing the two digits of a date
     set halfwidth side-by-side in a vertical column of text" class=example
     src=tate-chu-yoko.png>

    <p class=caption>Example of horizontal-in-vertical <i
     lang=ja>tate-chu-yoko</i></p>
   </div>

   <p>The figure is the result of the rules</p>

   <pre>
<!-- -->.num { text-combine: horizontal; }
    </pre>

   <p>and the following markup:</p>

   <pre>
<!-- -->&#x5E73;&#x6210;&lt;span class=&quot;num&quot;&gt;20&lt;/span&gt;&#x5E74;
<!-- -->&lt;span class=&quot;num&quot;&gt;4&lt;/span&gt;&#x6708;
<!-- -->&lt;span class=&quot;num&quot;&gt;16&lt;/span&gt;&#x65E5;&#x306B;
    </pre>

   <p>In Japanese, this effect is known as <i lang=ja>tate-chu-yoko</i>.
  </div>

  <p class=issue>Some people have requested a way to have numbers
   automatically text-combine'd. Maybe a text-auto-combine property? Note
   that whether a number should be tate-chu-yoko'd is often
   context-sensitive: this would give very weird results when applied to an
   arbitrary paragraph.

  <h2 class=no-num id=acknowledgements>Acknowledgements</h2>

  <p>John Daggett, Martin Heijdra, Paul Nelson, Michel Suignard, Steve Zilles

  <h2 class=no-num id=bidi-html>Appendix B: Bidi Rules for HTML</h2>

  <p>The style sheet rules that would achieve the bidi behaviors specified in
   <a href="#HTML401" rel=biblioentry>[HTML401]<!--{{HTML401}}--></a> for the
   HTML Strict doctype are given below:

  <pre>
/* HTML dir attribute creates an embedding */
*[dir="ltr"]    { direction: ltr; unicode-bidi: embed; }
*[dir="rtl"]    { direction: rtl; unicode-bidi: embed; }

/* BDO element creates an override */
bdo[dir="ltr"]  { direction: ltr; unicode-bidi: bidi-override; }
bdo[dir="rtl"]  { direction: rtl; unicode-bidi: bidi-override; }

/* HTML4.01:8.2.6 - preserve bidi behavior if 'display' is changed */
html, body,
div, address, blockquote, p,
ul, ol, li, dl, dt, dd,
fieldset, form,
h1, h2, h3, h4, h5, h6,
{ unicode-bidi: isolate; }
  </pre>

  <h2 class=no-num id=references>References</h2>

  <h3 class=no-num id=normative-references>Normative references</h3>
  <!--begin-normative-->
  <!-- Sorted by label -->

  <dl class=bibliography>
   <dt style="display: none"><!-- keeps the doc valid if the DL is empty -->
    <!---->

   <dt id=CSS21>[CSS21]

   <dd>Bert Bos; et al. <a
    href="http://www.w3.org/TR/2009/CR-CSS2-20090908"><cite>Cascading Style
    Sheets Level 2 Revision 1 (CSS 2.1) Specification.</cite></a> 8 September
    2009. W3C Candidate Recommendation. (Work in progress.) URL: <a
    href="http://www.w3.org/TR/2009/CR-CSS2-20090908">http://www.w3.org/TR/2009/CR-CSS2-20090908</a>
    </dd>
   <!---->

   <dt id=CSS3COL>[CSS3COL]

   <dd>H&#229;kon Wium Lie. <a
    href="http://www.w3.org/TR/2009/CR-css3-multicol-20091217"><cite>CSS
    Multi-column Layout Module.</cite></a> 17 December 2009. W3C Candidate
    Recommendation. (Work in progress.) URL: <a
    href="http://www.w3.org/TR/2009/CR-css3-multicol-20091217">http://www.w3.org/TR/2009/CR-css3-multicol-20091217</a>
    </dd>
   <!---->

   <dt id=SVG11>[SVG11]

   <dd>Erik Dahlstr&#246;m; et al. <a
    href="http://www.w3.org/TR/2010/WD-SVG11-20100622"><cite>Scalable Vector
    Graphics (SVG) 1.1 (Second Edition).</cite></a> 22 June 2010. W3C Working
    Draft. (Work in progress.) URL: <a
    href="http://www.w3.org/TR/2010/WD-SVG11-20100622">http://www.w3.org/TR/2010/WD-SVG11-20100622</a>
    </dd>
   <!---->

   <dt id=UAX29>[UAX29]

   <dd>Mark Davis. <a
    href="http://www.unicode.org/unicode/reports/tr29/tr29-9.html"><cite>Text
    Boundaries.</cite></a> 25 March 2005. Unicode Standard Annex #29. URL: <a
    href="http://www.unicode.org/unicode/reports/tr29/tr29-9.html">http://www.unicode.org/unicode/reports/tr29/tr29-9.html</a>
    </dd>
   <!---->
  </dl>
  <!--end-normative-->

  <h3 class=no-num id=other-references>Other references</h3>
  <!--begin-informative-->
  <!-- Sorted by label -->

  <dl class=bibliography>
   <dt style="display: none"><!-- keeps the doc valid if the DL is empty -->
    <!---->

   <dt id=CSS3PAGE>[CSS3PAGE]

   <dd>Melinda Grant; H&#229;kon Wium Lie. <a
    href="http://www.w3.org/TR/2006/WD-css3-page-20061010"><cite>CSS3 Module:
    Paged Media.</cite></a> 10 October 2006. W3C Working Draft. (Work in
    progress.) URL: <a
    href="http://www.w3.org/TR/2006/WD-css3-page-20061010">http://www.w3.org/TR/2006/WD-css3-page-20061010</a>
    </dd>
   <!---->

   <dt id=CSS3TEXT>[CSS3TEXT]

   <dd>Elika J. Etemad; Koji Ishii; Shinyu Murakami. <a
    href="http://www.w3.org/TR/2010/WD-css3-text-20101005"><cite>CSS Text
    Level 3.</cite></a> 5 October 2010. W3C Working Draft. (Work in
    progress.) URL: <a
    href="http://www.w3.org/TR/2010/WD-css3-text-20101005">http://www.w3.org/TR/2010/WD-css3-text-20101005</a>
    </dd>
   <!---->

   <dt id=HTML401>[HTML401]

   <dd>David Raggett; Ian Jacobs; Arnaud Le Hors. <a
    href="http://www.w3.org/TR/1999/REC-html401-19991224"><cite>HTML 4.01
    Specification.</cite></a> 24 December 1999. W3C Recommendation. URL: <a
    href="http://www.w3.org/TR/1999/REC-html401-19991224">http://www.w3.org/TR/1999/REC-html401-19991224</a>
    </dd>
   <!---->

   <dt id=UTN22>[UTN22]

   <dd>Elika J. Etemad. <a href="http://unicode.org/notes/tn22/"><cite>Robust
    Vertical Text Layout.</cite></a> 25 April 2005. Unicode Technical Note
    #22. URL: <a
    href="http://unicode.org/notes/tn22/">http://unicode.org/notes/tn22/</a></dd>
   <!---->
  </dl>
  <!--end-informative-->
  <!-- Add property index and alphabetic index? -->
