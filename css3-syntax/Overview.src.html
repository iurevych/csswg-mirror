<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<!-- vim:expandtab:tabstop=2:shiftwidth=2:textwidth=72:
  -->
<html>
<!-- the command line to process is this is:

num -l 2 template.html | toc -l 2 | incl | xref | index |\
perl -I../bin ../bin/propindex | cite-mkbib ../biblio.ref \
>template-processed.html


To do: add longdesc

-->
<head>
  <title>CSS3 module: Syntax</title>
  <link rel="stylesheet" type="text/css" href="default.css">
  <link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/TR/W3C-MO">
</head>

<body>

<div class="head">
<p><a class="logo" rel="home" href="http://www.w3.org/"><img height="48"
width="72" alt="W3C" src="http://www.w3.org/Icons/w3c_home"></a><a
class="logo" rel="in-activity" href="../"><img
src="../../../Woolly/woolly-icon.png" height="48" width="72"
alt=" CSS WG"></a></p>

<h1>CSS3 module: Syntax</h1>

<h2 class="no-num no-toc">W3C Working Draft [DATE: 13 August 2003]</h2>
<dl>
  <dt>This version:</dt>
    <dd><a
      href="http://www.w3.org/TR/[YEAR]/WD-css3-syntax-[ISODATE]">http://www.w3.org/TR/[YEAR]/WD-css3-syntax-[ISODATE]</a></dd>
  <dt>Latest version:</dt>
    <dd><a
      href="http://www.w3.org/TR/css3-syntax">http://www.w3.org/TR/css3-syntax</a></dd>
  <dt>Previous version:</dt>
    <dd><a href="http://www.w3.org/TR/2003/WD-css3-syntax-20030813">http://www.w3.org/TR/2003/WD-css3-syntax-20030813</a></dd>
  <dt>Editor:</dt>
    <dd><a href="http://dbaron.org/">L. David Baron</a>, &lt;<a href="mailto:dbaron@dbaron.org">dbaron@dbaron.org</a>&gt;</dd>
  <dt>Additional Contributors:</dt>
	<dd>Original CSS2 Authors</dd>
	<dd>Bert Bos (W3C), &lt;<a href="mailto:bert@w3.org">bert@w3.org</a>&gt;</dd>
	<dd>Peter Linss (Netscape)</dd>
</dl>
<!--begin-copyright-->

<p>[Here will be included the file "../copyright.inc"]</p>
<!--end-copyright-->
<hr title="Separator for header">
</div>

<h2 class="no-num no-toc" id="abstract">Abstract</h2>

<p>This CSS3 module describes the basic structure of CSS style sheets,
some of the details of the syntax, and the rules for parsing CSS
style sheets.  It also describes (in some cases, informatively) how
stylesheets can be linked to documents and how those links can be
media-dependent.  Additional details of the syntax of some parts of CSS
described in other modules will be described in those modules.  The
selectors module has a grammar for selectors.  Modules that define
properties give the grammar for the values of those properties, in a
format described in this document.</p>

<h2 class="no-num no-toc" id="status">Status of this document</h2>

<p><em>This section describes the status of this document at the
time of its publication. Other documents may supersede this
document. A list of current W3C publications and the latest revision
of this technical report can be found in the <a
href="http://www.w3.org/TR/">W3C technical reports index</a> at
http://www.w3.org/TR/.  The latest revision can also be found by
following the "Latest Version" link above.</em></p>

<p>
This document is a draft of one of the modules of CSS Level 3 (CSS3).
Some parts of the document are derived from the CSS Level 1 and CSS
Level 2 recommendations, and those parts are thus relatively stable.
However, it is otherwise an early draft, and considerable revision is
expected in later drafts, especially in formalization of error handling
behavior, the conformance requirements for partial implementations
(given the modularization of CSS3), and integration with other CSS3
modules.
</p>

<p>This document is a working draft of the CSS working group
which is part of the <a href="http://www.w3.org/Style/">style
activity</a> (see <a
href="http://www.w3.org/Style/Activity">summary</a>).
</p>

<p>The working group would like to receive feedback: 
 discussion takes place on the (<a href="http://lists.w3.org/Archives/Public/www-style/">archived</a>) 
  public mailing list <a href="http://www.w3.org/Mail/Lists.html#www-style">www-style@w3.org</a> (see <a href="http://www.w3.org/Mail/Request">instructions</a>). W3C Members 
  can also send comments directly to the CSS working group. </p>

<p>This is a draft document and may be updated, replaced or
obsoleted by other documents at any time. It is inappropriate to cite
this document as other than work in progress.
Its publication does not imply endorsement by the W3C membership or the
<a href="http://www.w3.org/Style/Group/">CSS &amp FP Working Group</a>
(<a href="http://cgi.w3.org/MemberAccess/AccessRequest">members only</a>).
</p>

<p>Patent disclosures relevant to CSS may be found on the Working Group's
public <a href="http://www.w3.org/Style/CSS/Disclosures"
rel="disclosure">patent disclosure page.</a></p>

<p>This document may be available in translations in the future. The English
version of this specification is the only normative version.</p>

<h2 class="no-num no-toc" id="contents">Table of contents</h2>
<!--toc-->
<hr>


<h2>Dependencies on other modules</h2>

<p>This CSS3 module
depends on the following other CSS3 modules:</p>
<ul>
  <li>Selectors [[!SELECT]]</li>
  <li>CSS3 module: Values &amp; Units [[!CSS3VAL]]</li>
  <li>CSS3 module: Cascading &amp; Inheritance [[!CSS3CASCADE]]</li>
</ul>

<p>It has non-normative (informative) references to the following other
CSS3 modules:</p>
<ul>
  <li>CSS3 module: Paged media [[CSS3PAGE]]</li>
  <li>CSS3 module: Speech [[CSS3SPEECH]]</li>
  <li>Media queries [[MEDIAQ]]</li>
  <li>Syntax of CSS rules in HTML's "style" attribute [[CSSSTYLEATTR]]</li>
</ul>

<h2>Introduction</h2>

<p>This specification describes the basic syntax of CSS3 and the syntax
conventions used in the property definitions spread through the CSS3
modules.  The syntax of CSS3 has some error-handling requirements for
forward-compatibility, but much of the error-handling behavior depends
on the user agent.</p>

<h2>CSS style sheet representation</h2>

<p>A CSS style sheet is a sequence of characters from the Universal
Character Set (see [[!ISO10646]]). For transmission and storage, these
characters must be <dfn title="character
encoding">encoded</dfn> by a character encoding that supports the set
of characters available in US-ASCII (e.g., ISO-8859-x, Shift_JIS, etc.).
A <span id="BOM" class="index">byte order mark (BOM)</span>, as described in
section 2.7 of [[!UNICODE310]], that begins the sequence of characters
should not be considered, for purposes of applying the grammar below, as
a part of the style sheet.  For a good introduction to character sets and
character encodings, please consult the HTML 4.0 specification
([[!HTML40]], chapter 5). See also the XML 1.0 specification ([[XML10]],
sections 2.2 and 4.3.3).</p>

<p>When a style sheet is embedded in another document, such as in the
STYLE element or "style" attribute of HTML, the style sheet shares the
character encoding of the whole document.</p>

<p>When a style sheet resides in a separate file, user agents must
observe the following <span class="index" title="character
encoding::user agent's determination of">priorities</span> when
determining a style sheet's <span class="index" title="character
encoding::default|default::character encoding">character
encoding</span> (from highest priority to lowest):</p>

<ol>
<li>A character encoding specified by a higher level protocol (e.g., the
"charset" parameter to the MIME type specified in an HTTP "Content-Type"
field).
(The HTTP protocol ([[!HTTP11]], section 3.7.1) mentions ISO-8859-1 as a
default character encoding when the "charset" parameter is absent from
the "Content-Type" header field. In practice, this recommendation has
proved useless because some servers don't allow a "charset" parameter to
be sent, and others may not be configured to send the parameter.
Therefore, user agents must not assume any default value for the
"charset" parameter, but must instead look for the <span
class="index">@charset</span> rule.)
</li>
<li>The <dfn>@charset</dfn>
at-rule.</li>
<li>Assume that the style sheet is UTF-8.</li>
</ol>

<p>Since the third point differs from CSS1 and CSS2, authors should not
rely on user agents to assume that style sheets without encoding
information are UTF-8 encoded.  Authors should specify the encoding
using one of the first two methods.</p>

<p>At most one @charset rule may appear in an external
style sheet &mdash; it must <em>not</em> appear in an embedded style sheet
&mdash; and it must appear at the very start of the style sheet, not preceded
by any characters (except for the optional Byte Order Mark <a
href="#BOM">described
above)</a>. After "@charset", authors specify the name of a
character encoding. The name must be a charset name as described in
the IANA registry (See [[!RFC2978]]. Also, see [[CHARSETS]] for a complete
list of charsets). For example:</p>

<div class="example"><p>
@charset "ISO-8859-1";
</div>

<p>This specification does not mandate which character encodings
a user agent must support.
<span class="issue">[Should we require a certain minimal set, such as
UTF-8 and UCS2?]</span>
</p>

<p>Note that reliance on the @charset construct theoretically poses a
problem since there is no <em>a priori</em> information on how it is
encoded. In practice, however, the encodings in wide use on the
Internet are either based on ASCII, UTF-16, UCS-4, or (rarely) on
EBCDIC.  This means that in general, the initial byte values of a
style sheet enable a user agent to detect the encoding family reliably,
which provides enough information to decode the @charset rule, which
in turn determines the exact character encoding.</p>

<div class="issue">[Should this specification describe how to handle
encoding errors?  Can a user agent ignore the <code>@charset</code> rule
if it's wrong?  What if the user agent does not support the encoding
used?  Should this specification describe how to handle a
<code>@charset</code> rule that specifies a character encoding that is
incompatible with the family of encodings used to decode the
<code>@charset</code> rule (and BOM) itself?]</div>

<!-- More examples of good encodings to use? -IJ -->

<!-- Encodings not to use? (cf. HTML 4.0) -IJ -->

<h3>Referring to characters not represented in a character encoding</h3>

<p>A style sheet may have to refer to characters that cannot be
represented in the current character encoding.  These characters must
be written as <span title="backslash escapes">escaped</span> references to
ISO 10646 characters. These escapes serve the same purpose as numeric
character references in HTML or XML documents (see [[!HTML40]],
chapters 5 and 25).

<p>The character escape mechanism should be used when only a few
characters must be represented this way. If most of a style sheet
requires escaping, authors should encode it with a more appropriate
encoding (e.g., if the style sheet contains a lot of Greek characters,
authors might use "ISO-8859-7" or "UTF-8").

<p>Intermediate processors using a different character encoding may
translate these escaped sequences into byte sequences of that
encoding. Intermediate processors must not, on
the other hand, alter escape sequences that cancel the special meaning
of an ASCII character.

<p><a href="#conformance">Conforming user agents</a> must
correctly map to Unicode all characters in any character encodings
that they recognize (or they must behave as if they did).

<p>For example, a style sheet transmitted as ISO-8859-1
(Latin-1) cannot contain Greek letters directly:
"&#954;&#959;&#965;&#961;&#959;&#962;" (Greek: "kouros") has to be
written as "\3BA\3BF\3C5\3C1\3BF\3C2".

<div class="note"><p>
<em><strong>Note.</strong>
In HTML 4.0,
numeric character references are interpreted in "style" attribute
values but not in the content of the STYLE element. Because of this
asymmetry, we recommend that authors use the CSS character
escape mechanism rather than numeric character references
for both the "style" attribute and the STYLE element.
For example, we recommend:</em></p>

<pre class="html-example">
&lt;span style="voice-family: D\FC rst"&gt;...&lt;/span&gt;
</pre>

<p><em>rather than:</em></p>

<pre class="html-example">
&lt;span style="voice-family: D&amp;#252;rst"&gt;...&lt;/span&gt;
</pre>
</div>

<h3>The <dfn>text/css</dfn> content type</h3>

<p>CSS style sheets that exist in separate files are sent over the
Internet as a sequence of bytes accompanied by encoding
information<!--(see [[!HTML40]], chapter 5)-->. The structure of the
transmission, termed a <dfn title="message entity">message
entity,</dfn> is defined by MIME and HTTP 1.1 (see
[[!RFC2045]] and [[!HTTP11]]). A message entity with a content type of
"text/css" represents an independent CSS style sheet. The "text/css"
content type has been registered by RFC 2318 ([[!RFC2318]]).</p>

<h2 id="syntax">General syntax of CSS</h2>

<p>This section describes a grammar (and <dfn>forward-compatible
parsing</dfn> rules) common to any version of CSS (including
CSS3).  Future versions of CSS will adhere to this core syntax, although
they may add additional syntactic constraints.</p>

<p>See the <a href="#characters">section on characters and case</a> for
information on case-sensitivity.</p>

<p>These descriptions are normative.

<h3 id="characters">Characters and case</h3>
<p>  The following rules always hold:</p>

<UL>
    <li><p>All CSS style sheets are <span class="index" title="case
    sensitivity">case-insensitive</span>, except for parts that are
    not under the control of CSS. For example, the case-sensitivity of
    values of the HTML attributes "id" and "class", of font names, and
    of URIs lies outside the scope of this specification. Note in
    particular that element names are case-insensitive in HTML, but
    case-sensitive in XML.</p></li>

    <li><p>In CSS3, <dfn title="identifier">identifiers</dfn>
    (including element names, classes, and IDs in 
    selectors (see [[!SELECT]] <span class="issue">[or is this still
    true]</span>)) can contain only the
    characters [A-Za-z0-9] and ISO 10646 characters 161 and higher,
    plus the hyphen (-) and the underscore (_); they cannot start with a
    digit or a hyphen followed by a digit. They can also contain escaped
    characters and any ISO 10646
    character as a numeric code (see next item).
    <span class="example">For instance, the identifier
    "<code>B&amp;W?</code>" may
    be written as "<code>B\&amp;W\?</code>" or "<code>B\26
    W\3F</code>".</span>
    (See [[!UNICODE310]] and [[!ISO10646]].)</p></li>

    <li><p>In CSS3, a backslash (\) character indicates three types of
    <dfn title="backslash escapes">character escapes</dfn>.</p>

    <p>First, inside a string (see [[!CSS3VAL]]), a backslash
    followed by a newline is ignored (i.e., the string is deemed not
    to contain either the backslash or the newline).</p>

    <p>Second, it cancels the meaning of special CSS characters.
        Any character (except a hexadecimal digit) can be escaped
        with a backslash to remove its special meaning.
        For example, <samp>"\""</samp> is a string consisting of one
        double quote. Style sheet preprocessors must not remove
       these backslashes from a style sheet since that would
       change the style sheet's meaning.</p>

    <p>Third, backslash escapes allow authors to refer to characters
    they can't easily put in a style sheet. In this case, the backslash
    is followed by at most six hexadecimal digits (0..9A..F), which
    stand for the ISO 10646 ([[!ISO10646]]) character with
    that number. If a digit or letter follows the hexadecimal number,
    the end of the number needs to be made clear. There are two ways
    to do that:</p>

    <ol>
    <li>with a space (or other whitespace character): "\26 B" ("&amp;B").
        In this case, user agents should treat a "CR/LF" pair 
        (13/10) as a single
        whitespace character.</li>
    <li>by providing exactly 6 hexadecimal digits: "\000026B" ("&amp;B")</li>
    </ol>

    <p>In fact, these two methods may be combined. Only one whitespace
    character is ignored after a hexadecimal escape. Note that this means
    that a "real" space after the escape sequence must itself either be
    escaped or doubled.</p>
    </li>

    <li><p>Backslash escapes are always considered to be part of an
    <span>identifier</span> or a string (i.e.,
    "\7B" is not punctuation, even though "{" is, and "\32" is allowed
    at the start of a class name, even though "2" is not).</p></li>
  </ul>

<h3 id="tokenization">Tokenization</h3>

<p class="issue">[This needs to be integrated with the selectors module.
How should that be done?]</p>

<p>All levels of CSS &mdash; level 1, level 2, level 3, and any future levels
&mdash; use the same core syntax. This allows UAs to parse (though not
completely understand) style sheets written in levels of CSS that didn't
exist at the time the UAs were created. Designers can use this feature
to create style sheets that work with older user agents, while also
exercising the possibilities of the latest levels of CSS.</p>

<p>At the lexical level, CSS style sheets consist of a sequence of
tokens.  Hexadecimal codes (e.g., <code>#x20</code>) refer to ISO 10646
([[!ISO10646]]).  In case of multiple matches, the longest match
determines the token.</p>

<p>The following productions are <em>parts</em> of tokens:</p>

<p class="issue">[We need something to allow signs on integers.  Do we need to
go as far as css3-selectors?]</p>

<table>
<tr><td id="SUBTOK-ident">ident	<td>::=<td><code>'-'? <a href="#SUBTOK-nmstart">nmstart</a> <a href="#SUBTOK-nmchar">nmchar</a>*</code>
<tr><td id="SUBTOK-name">name	<td>::=<td><code><a href="#SUBTOK-nmchar">nmchar</a>+</code>
<tr><td id="SUBTOK-nmstart">nmstart	<td>::=<td><code>[a-zA-Z] | '_' | <a href="#SUBTOK-nonascii">nonascii</a> | <a href="#SUBTOK-escape">escape</a></code>
<tr><td id="SUBTOK-nonascii">nonascii	<td>::=<td><code>[#x80-#xD7FF#xE000-#xFFFD#x10000-#x10FFFF]</code>
<tr><td id="SUBTOK-unicode">unicode	<td>::=<td><code>'\' [0-9a-fA-F]{1,6} <a href="#SUBTOK-wc">wc</a>?</code>
<tr><td id="SUBTOK-escape">escape	<td>::=<td><code><a href="#SUBTOK-unicode">unicode</a> | '\' [#x20-#x7E#x80-#xD7FF#xE000-#xFFFD#x10000-#x10FFFF]</code>
<tr><td id="SUBTOK-nmchar">nmchar	<td>::=<td><code>[a-zA-Z0-9] | '-' | '_' | <a href="#SUBTOK-nonascii">nonascii</a> | <a href="#SUBTOK-escape">escape</a></code>
<tr><td id="SUBTOK-num">num	<td>::=<td><code>[0-9]+ | [0-9]* '.' [0-9]+</code>
<tr><td id="SUBTOK-string">string	<td>::=<td><code>'"' (<a href="#SUBTOK-stringchar">stringchar</a> | "'")* '"' | "'" (<a href="#SUBTOK-stringchar">stringchar</a> | '"')* "'"</code>
<tr><td id="SUBTOK-stringchar">stringchar <td>::=<td><code><a href="#SUBTOK-urlchar">urlchar</a> | #x20 | '\' <a href="#SUBTOK-nl">nl</a></code>
<tr><td id="SUBTOK-urlchar">urlchar <td>::=<td><code>[#x9#x21#x23-#x26#x27-#x7E] | <a href="#SUBTOK-nonascii">nonascii</a> | <a href="#SUBTOK-escape">escape</a></code>
<tr><td id="SUBTOK-nl">nl	<td>::=<td><code>#xA | #xD #xA | #xD | #xC</code>
<tr><td id="SUBTOK-w">w	<td>::=<td><code><a href="#SUBTOK-wc">wc</a>*</code>
<tr><td id="SUBTOK-wc">wc	<td>::=<td><code>#x9 | #xA | #xC | #xD | #x20</code>
</table>


<p>The following productions are the complete list of tokens in
CSS3:</p>

<table>
<tr><td id="TOK-IDENT">IDENT	<td>::=<td><code><a href="#SUBTOK-ident">ident</a></code>
<tr><td id="TOK-ATKEYWORD">ATKEYWORD	<td>::=<td><code>'@' <a href="#SUBTOK-ident">ident</a></code>
<tr><td id="TOK-STRING">STRING	<td>::=<td><code><a href="#SUBTOK-string">string</a></code>
<tr><td id="TOK-HASH">HASH	<td>::=<td><code>'#' <a href="#SUBTOK-name">name</a></code>
<tr><td id="TOK-NUMBER">NUMBER	<td>::=<td><code><a href="#SUBTOK-num">num</a></code>
<tr><td id="TOK-PERCENTAGE">PERCENTAGE	<td>::=<td><code><a href="#SUBTOK-num">num</a> '%'</code>
<tr><td id="TOK-DIMENSION">DIMENSION	<td>::=<td><code><a href="#SUBTOK-num">num</a> <a href="#SUBTOK-ident">ident</a></code>
<tr><td id="TOK-URI">URI	<td>::=<td><code>"url(" <a href="#SUBTOK-w">w</a> (<a href="#SUBTOK-string">string</a> | <a href="#SUBTOK-urlchar">urlchar</a>* ) <a href="#SUBTOK-w">w</a> ")"</code>
<tr><td id="TOK-UNICODE-RANGE">UNICODE-RANGE	<td>::=<td><code>"U+" [0-9A-F?]{1,6} ('-' [0-9A-F]{1,6})?</code>
<tr><td id="TOK-CDO">CDO	<td>::=<td><code>"&lt;!--"</code>
<tr><td id="TOK-CDC">CDC	<td>::=<td><code>"--&gt;"</code>
<tr><td id="TOK-S">S	<td>::=<td><code><a href="#SUBTOK-wc">wc</a>+</code>
<tr><td id="TOK-COMMENT">COMMENT	<td>::=<td><code>"/*" [^*]* '*'+ ([^/] [^*]* '*'+)* "/"</code>
<tr><td id="TOK-FUNCTION">FUNCTION	<td>::=<td><code><a href="#SUBTOK-ident">ident</a> '('</code>
<tr><td id="TOK-INCLUDES">INCLUDES	<td>::=<td><code>"~="</code>
<tr><td id="TOK-DASHMATCH">DASHMATCH	<td>::=<td><code>"|="</code>
<tr><td id="TOK-PREFIXMATCH">PREFIXMATCH	<td>::=<td><code>"^="</code>
<tr><td id="TOK-SUFFIXMATCH">SUFFIXMATCH	<td>::=<td><code>"$="</code>
<tr><td id="TOK-SUBSTRINGMATCH">SUBSTRINGMATCH	<td>::=<td><code>"*="</code>
<tr><td id="TOK-CHAR">CHAR	<td>::=<td>any other character not matched by the above rules, except for <code>"</code> or <code>'</code>
<tr><td id="TOK-BOM">BOM	<td>::=<td><code>#xFEFF</code>
</table>

<p>

  Since any single character other than ' or " that cannot be part of a
  larger token is a single character token, there cannot be errors in
  tokenization other than the inability to tokenize an unmatched
  quotation mark.  If at some point it is not possible to continue
  tokenizing an incoming style sheet, the remainder of the style sheet
  should be ignored and only the largest initial segment of the
  style sheet that can be tokenized according to the above rules (that
  is, the entire style sheet except for the part from the unmatched
  (single or double) quotation mark to the end) should be used to form
  the sequence of tokens to be parsed according to the grammar.

</p>

<p class="issue">[This isn't exactly right.  Since the string token can't
contain newlines that aren't escaped by backslashes, an untokenizable
sequence can occur in the middle of a file.  Would it be better to
change things so that unmatched quotation marks become single-character
tokens and all character streams are tokenizable?]</p>

<h3>Grammar</h3>

<h4>Principles of CSS error handling</h4>

<p>All levels of CSS, starting from CSS1, have required that user agents
ignore certain types of invalid style sheets in well-defined ways.  This
allows forward-compatibility, since it allows future extensions to CSS
within basic grammatical constraints that will be ignored in
well-defined ways by user agents implementing earlier versions of
CSS.</p>

<p>Handling of CSS that is not valid CSS3 but is valid according to the
forward-compatible syntax requires first determining the beginning and
end of the part that is invalid and then handling that part in a
specified way.  The latter is described in the <a
href="#error-handling">rules for handling parsing errors</a>.  The
mechanism for the former is described within the grammar.</p>

<p>The handling of style sheets that do not parse according to the
forward-compatible core syntax is not defined by this specification.
<span class="issue">[Should it be?]</span>
</p>

<p>Certain productions within the grammar are <dfn>error handling
points</dfn>.  Every error handling point has a backup production that
is to be used if it is not possible to parse the stream of tokens based
on the primary production.  If the error handling production is
represented as <code>prod</code>, then the backup production is
represented as <code>FAIL(prod)</code>.</p>

<p class="issue">[The <a href="#detailed-grammar">grammar</a> given in
Appendix D
of CSS2 still needs to be incorporated into this specification.  The editor
hopes that it can be done by unifying it with the forward-compatible grammar
into a single grammar that describes both the rules for forward-compatible
parsing and the syntax of what is currently possible in CSS, but that may not
be possible.  However, hopefully it will be possible to do this by
describing the general grammar in terms of the concepts described in the
previous paragraph.]</p>

<p>Excluding the transformation of a production into its backup
production, this grammar is LL(1).  <span class="issue">[We should
explain briefly what this means, except that it's probably not true.
It's probably just LALR(1).]</span>
</p>

<p>The portion of a CSS style sheet that is to be used is the largest
initial stream of the tokens resulting from the <a
href="#tokenization">tokenization process</a> that can be parsed
according to the grammar presented in this chapter.  (For example, if a
brace closing a declaration block <span class="issue">[link-ify
this]</span> is not present, the declaration block
must be ignored since the closing brace is required to satisfy this
grammar.)  <span class="issue">[This might lead to highly unexpected
behavior when there's an extra closing brace (etc.).  Do we really want
this?]</span></p>

<p>Some of the constraints of CSS are not expressed in the grammar.  For
example, an <code>@charset</code> rule is not permitted in an embedded
style sheet, or a namespace prefix that has not been defined by an
<code>@namespace</code> rule is an invalid selector.  These constraints
should be handled just as a parsing error would be (by ignoring out to
the next backup production) unless specified otherwise.</p>

<h4>Style sheets</h4>

<p>Below is the core syntax for CSS.  Lowercase identifiers represent
productions in this grammar, uppercase identifiers represent tokens (see
above), and characters in single quotes (') represent CHAR tokens (see
above).  The sections that follow describe
how to use it.</p>

<p class="issue">[This might need better integration with the selectors
module, although maybe it's ok.]</p>

<PRE>
stylesheet  : [ CDO | CDC | S | statement ]*;
statement   : ruleset | at-rule;
at-rule     : ATKEYWORD S* any* [ block | ';' S* ];
block       : '{' S* [ any | block | ATKEYWORD S* | ';' S* ]* '}' S*;
ruleset     : selector? '{' S* declaration? [ ';' S* declaration? ]* '}' S*;
selector    : any+;
declaration : property ':' S* value;
property    : IDENT S*;
value       : [ any | block | ATKEYWORD S* ]+;
any         : [ IDENT | NUMBER | PERCENTAGE | DIMENSION | STRING
              | DELIM | URI | HASH | UNICODE-RANGE | INCLUDES
              | FUNCTION S* any* ')' | DASHMATCH | '(' S* any* ')'
              | '[' S* any* ']' ] S*;
</PRE>

<div class="issue">
[The definitions of these productions should be spread below into the
prose describing what they mean.  Furthermore, they should be combined
with the Appendix D grammar from CSS2, perhaps using notation like:
<table>
<tr><td>ruleset</td><td>::=</td><td>...</td></tr>
<tr><td>FAIL(ruleset)</td><td>::=</td><td>...</td></tr>
</table>
]</div>

<p><dfn>COMMENT</dfn> tokens do not occur
in the grammar (to keep it readable), but any number of these tokens
may appear anywhere between other tokens.

<p>The token S in the grammar above stands for <dfn>whitespace</dfn>.
Only the characters "space" (Unicode
code 32), "tab" (9), "line feed" (10), "carriage return" (13), and
"form feed" (12) can occur in whitespace. Other space-like characters,
such as "em-space" (8195) and "ideographic space" (12288), are never
part of whitespace.

<h3 id="keywords">Keywords</h3>

<!-- provide better explanation of where keywords appear:
media types, at-rules, etc. -IJ -->

<p>Keywords have the form of identifiers. Keywords must not be placed
between quotes ("..." or '...'). Thus,

<pre>
red
</pre>

<p>is a keyword, but

<pre>
"red"
</pre>

<p>is not. (It is a string.) Other illegal examples:

<div class="illegal example"><p>
<pre>
width: "auto";
border: "none";
background: "red";
</pre>
</div>


<h3>Statements</h3>

<p>A CSS style sheet, for any version of CSS, consists of a list of
<em class="index">statements</em>
(see the grammar above).  There are two kinds of statements: <em
class="index">at-rules</em>
and <em class="index" title="rule sets">rule
sets.</em> There may be <a href="#whitespace">whitespace</a>
around the statements.</p>

<h3><dfn>At-rules</dfn></h3>

<p> At-rules start with an <DFN>at-keyword</DFN>, an '@' character
followed immediately by an <span>identifier</span> (for example, '@import',
'@page').

<p> An at-rule consists of everything up to and including the next
semicolon (;) or the next <a href="#block">block,</a> whichever comes
first. A CSS user agent that encounters an unrecognized or misplaced
at-rule must <span class="index">ignore</span> the whole of the at-rule and continue
parsing after it.</p>

<div class="illegal example"><p>
Assume, for example, that a CSS3 parser encounters this style sheet:

<PRE>
@import "subs.css";
h1 { color: blue }
@import "list.css";
</PRE>

<p>The second '<code>@import</code>' is illegal according to CSS3 since
'<code>@import</code>' rules must occur before all rules other than
'<code>@charset</code>' rules.  The CSS3 parser
<span class="index" title="ignore">ignores</span>
the whole at-rule, effectively reducing the style sheet to:

<PRE>
@import "subs.css";
h1 { color: blue }
</PRE>
</div>

<div class="illegal example"><p>
In the following example, the second '@import' rule is invalid,
since it occurs inside a '@media' <a href="#block">block</a>.

<PRE>
@import "subs.css";
@media print {
  @import "print-main.css";
  BODY { font-size: 10pt }
}
h1 {color: blue }
</PRE>
</div>

<h3><dfn>Blocks</dfn></h3>

<p> A <span class="index"><em>block</em></span>
starts with a left curly brace ({) and ends with the matching right
curly brace (}). In between there may be any characters, except that
parentheses ((&nbsp;)), brackets ([&nbsp;]) and braces ({&nbsp;}) must
always occur in
matching pairs and may be nested. Single (') and double quotes (")
<!-- " --> must also occur in matching pairs, and characters between them
are parsed as a <span class="index">string</span>.
See <a href="#tokenization">Tokenization</a> above for the definition
of a string.


<div class="illegal example">
<p> Here is an example of a block. Note that the right brace between
the double quotes does not match the opening brace of the block, and that the
second single quote is an <span title="backslash escapes">escaped
character</span>, and thus doesn't match the first single quote:

<PRE>
{ causta: "}" + ({7} * '\'') }
</PRE>

<p>Note that the above rule is not valid CSS3, but it is still
a block as defined above.
</div>

<h3>Rule sets, declaration blocks, and selectors</h3>

<p> A rule set (also called "rule") consists of a selector followed by
a declaration block.

<p> A <dfn>declaration-block</dfn> (also
called a {}-block in the following text) starts with a left curly
brace ({) and ends with the matching right curly brace (}). In between
there must be a list of zero or more semicolon-separated (;)
declarations.

<p>The <dfn>selector</dfn> (see the Selectors module
[[!SELECT]]) consists of everything up to (but
not including) the first left curly brace ({).  A selector always goes
together with a {}-block. When a user agent can't parse the selector (i.e., it
is not valid CSS3), it must <span class="index">ignore</span> the {}-block as well.

<p>CSS3 gives a special meaning to the comma (,) in
selectors. However, since it is not known if the comma may acquire
other meanings in future versions of CSS, the whole statement should
be <span class="index" title="ignore">ignored</span> if there is an error anywhere in the
selector, even though the rest of the selector may look reasonable in
CSS3.

<DIV class=illegal example>
<p>For example, since the "&amp;" is not a valid token in a CSS3
selector, a CSS3 user agent must
<span class="index">ignore</span>
the whole second line, and not set the color of H3 to red:
<PRE>
h1, h2 {color: green }
h3, h4 &amp; h5 {color: red }
h6 {color: black }
</PRE>
</DIV>

<div class="example"><p>
<p>Here is a more complex example. The first two pairs of curly braces
are inside a string, and do not mark the end of the selector. This is
a valid CSS3 statement.
<PRE>
p[example="public class foo\
{\
    private int x;\
\
    foo(int x) {\
        this.x = x;\
    }\
\
}"] { color: red }
</PRE>

<div class="note"><p>
<em><strong>Note.</strong>
The <span class="css">\</span> characters in the above example cause the
newlines to be ignored.  Newlines can be placed in strings only using the
correct numeric character escape.  See <a href="#characters">characters
and case</a> above.
</em></p></div>
</div>

<h3 id="declarations">Declarations and properties</h3>

<p> A <dfn>declaration</dfn> is either empty or
consists of a <dfn>property</dfn>, followed by a colon (:), followed by
a value. Around each of these there may be <a
href="#whitespace">whitespace</a>.

<p>Because of the way selectors work, multiple declarations for the
same selector may be organized into semicolon (;) separated
groups.</p>

<div class="example"><p>
Thus, the following rules:</p>
<pre>
h1 { font-weight: bold }
h1 { font-size: 2em }
h1 { line-height: 1.2 }
h1 { font-family: Helvetica, Arial, sans-serif }
h1 { font-variant: normal }
h1 { font-style: normal }
</pre>

<p>are equivalent to:</p>

<pre>
h1 {
  font-weight: bold;
  font-size: 2em;
  line-height: 1.2;
  font-family: Helvetica, Arial, sans-serif; 
  font-variant: normal;
  font-style: normal
}
</pre>
</div>

<p>A property is an <span>identifier</span>. Any character may occur
in the value, but parentheses ("(&nbsp;)"), brackets ("[&nbsp;]"),
braces ("{&nbsp;}"), single
quotes (') and double quotes (") <!-- " --> must come in matching
pairs, and semicolons not in strings must be <span title="backslash
escapes">escaped</span>. Parentheses, brackets, and
braces may be nested. Inside the quotes, characters are parsed as a
string.

<p>The syntax of <dfn title="value">values</dfn>
is specified separately for each property, but in any case, values are
built from identifiers, strings, numbers, lengths, percentages, URIs,
colors, angles, times, and frequencies.

<p>A user agent must <span class="index">ignore</span> a declaration with an invalid property
name or an invalid value. Every CSS3 property has its own syntactic
and semantic restrictions on the values it accepts.

<div class="illegal example"><p>
For example, assume a CSS3 parser encounters this style sheet:

<PRE>
h1 { color: red; font-style: 12px }  /* Invalid value: 12px */
p { color: blue;  font-vendor: any;  /* Invalid prop.: font-vendor */
    font-variant: small-caps }
em em { font-style: normal }
</PRE>

<p> The second declaration on the first line has an invalid value
'12pt'. The second declaration on the second line contains an
undefined property 'font-vendor'. The CSS3 parser will <span
class="index">ignore</span> these
declarations, effectively reducing the style sheet to:

<PRE class="example">
h1 { color: red; }
p { color: blue;  font-variant: small-caps }
em em { font-style: normal }
</PRE>
</div>

<h3><dfn>Comments</dfn></h3>

<p><span class="index">Comments </span> begin
with the characters "/*" and end with the characters "*/". They may
occur anywhere between tokens,
and their contents have no influence on the rendering.  Comments may
not be nested.

<p>CSS also allows the SGML comment delimiters ("&lt;!--" and
"--&gt;") in certain places, but they do not delimit CSS
comments. They are permitted so that style rules appearing in an HTML
source document (in the STYLE element) may be hidden from pre-HTML 3.2
user agents. See the HTML 4.0 specification ([[!HTML40]]) for more information.

<h2 id="error-handling">Rules for handling parsing errors or unsupported features</h2>

<p class="issue">[Hopefully (assuming it can be formalized within the
rules above) this section will not need so much detail and can be folded
into the previous section.]</p>

<p>In some cases, user agents must ignore part of an illegal style
sheet. This specification defines <dfn>ignore</dfn> to mean
that the user agent parses the illegal part according to the grammar
above (in order to find its
beginning and end), but otherwise acts as if it had not been there.</p>

<p>If a style sheet cannot be parsed according to the grammar above, the
user agent must behave the same as it would if the style sheet had the
smallest sequence of characters removed from its end that would allow
it to be parsed according to the grammar.</p>

<p>To ensure that new properties and new values for existing
properties can be added in the future, user agents are required to
obey the following rules when they encounter the following
scenarios:</p>

<UL>
<LI><strong>Unknown properties.</strong> User agents must <span
class="index">ignore</span> a <a
href="#declarations">declaration</a> with an unknown
property. For example, if the style sheet is:

<PRE class="illegal example">
h1 { color: red; rotation: 70minutes }
</PRE>

<p> the user agent will treat this as if the style sheet had been

<PRE class="example">
H1 { color: red }
</PRE>

<LI id="illegalvalues"><strong>Illegal values.</strong> User agents must ignore a
declaration with an illegal value. For example:

<PRE class="illegal example">
img { float: left }       /* correct CSS3 */
img { float: left here }  /* "here" is not a value of 'float' */
img { background: "red" } /* keywords cannot be quoted in CSS3 */
img { border-width: 3 }   /* a unit must be specified for length values */
</PRE>

A CSS3 parser would honor the first rule and
<span class="index">ignore</span>
the rest, as if the style sheet had been:

<PRE class="example">
img { float: left }
img { }
img { }
img { }
</PRE>

<p>A user agent conforming to a future CSS specification may accept one or
more of the other rules as well.</p>

<p class="issue">[A general comment on how to handle negative numbers
when disallowed might be useful.  It should be a parsing error (and thus
ignored).  We might want to add additional grammar productions for
potentially negative numbers.]</p>

</li>

<li><strong>Malformed declarations.</strong>  User agents must handle
unexpected tokens encountered while parsing a declaration by reading
until the end of the declaration, while observing the rules for matching
pairs of (), [], {}, "", and '', and correctly handling escapes. For
example, a malformed declaration may be missing a property, colon (:) or
value.  The following are all equivalent:

<pre class="example"><code>
p { color:green }
p { color:green; color }  /* malformed declaration missing ':', value */
p { color:red;   color; color:green }  /* same with expected recovery */
p { color:green; color: } /* malformed declaration missing value */
p { color:red;   color:; color:green } /* same with expected recovery */
p { color:green; color{;color:maroon} } /* unexpected tokens { } */
p { color:red;   color{;color:maroon}; color:green } /* same with recovery */
</code></pre>

</li>


<LI><strong>Invalid at-keywords.</strong> User agents must <span
class="index">ignore</span> an
invalid at-keyword together with everything following it, up to and
including the next semicolon (;) or block ({...}), whichever
comes first. For example, consider the following:

<PRE class="illegal example">
@three-dee {
  @background-lighting {
    azimuth: 30deg;
    elevation: 190deg;
  }
  h1 { color: red }
}
h1 { color: blue }
</PRE>

<p> The '@three-dee' at-rule is not part of CSS3. Therefore, the whole
at-rule (up to, and including, the third right curly brace) is <span
class="index" title="ignore">ignored.</span> A
CSS3 user agent <span class="index" title="ignore">ignores</span> it, effectively reducing the style sheet
to:</p>

<PRE class="example">
h1 { color: blue }
</PRE>
</li>

<li id="unsupportedvalues">

<p><strong>Unsupported Values</strong>If a UA does not support a
particular value, it should <em>ignore</em> that value when parsing
stylesheets, as if that value was an <a href="#illegalvalues">illegal
value</a>.  For example:</p>

<div class="example">
<pre>
  h3 {
    display: inline;
    display: run-in;
  }
</pre>
</div>

<p>  
A UA that supports the 'run-in' value for the 'display' property will
accept the first display declaration and then "write over" that value with
the second display declaration. A UA that does not support the 'run-in'
value will process the first display declaration and ignore the second
display declaration.
</p>

</li>

</UL>

<h3>Partial implementations</h3>

<p>CSS3, unlike CSS1 and CSS2, is modular and thus allows for partial
implementations.  The conformance requirements of some modules may also allow
for conformant implementations to implement only part of a module.</p>

<p>Implementations that do not implement a feature of any CSS3 module
(whether a property, an at-rule, or a property value) should behave as
they would according to the forward-compatible parsing rules had that
feature not been part of a known CSS specification.</p>

<h2>Vendor-specific extensions</h2>

<p>Although proprietary extensions should be avoided in general, there
are situations (experiments, implementations of W3C drafts that have not
yet reached Candidate Recommendation, intra-nets, debugging, etc.) where
it is convenient to add some nonstandard, i.e., proprietary identifiers
to a CSS style sheet. It is often hard to predict how long these
proprietary extensions will be in use and hard to avoid that their names
clash with new, standard properties or with other proprietary
properties. Therefore the CSS Working Group proposes the following
simple naming convention. A proprietary name should have a prefix
consisting of:</p>

<ol>
  <li>an underscore ("_") or a dash ("-"),</li>
  <li>the (possibly abbreviated) name of the company, organization, etc. that
    created it,</li>
  <li>an underscore or a dash.</li>
</ol>

<p>Some examples (and the companies/organizations that created them):</p>
<ul>
  <li><em>-moz-box-sizing,</em> <em>-moz-border-radius</em> (The Mozilla
    Organization)</li>
  <li><em>-wap-accesske</em>y (The WAP Forum)</li>
  <li><em>_xyz-dwiw</em> (hypothetical)</li>
</ul>

<p>The advantage of the initial dash is that it is not a valid start character
for identifiers in CSS, so it is guaranteed never to be used by any current or
future level of CSS. CSS-conforming parsers will skip rules that contain
identifiers with such a character.
<span class="issue">[Should the grammar allow
'-' as part of identifiers or should it require that vendors who use '-' to
begin identifiers extend the grammar in their tokenizer?  Currently it
does, but perhaps it shouldn't.]</span></p>

<p>That is also a possible disadvantage: a conforming parser will skip them,
so in order to use them, an extended parser is required.</p>

<p>For that reason, the underscore is also proposed. Although it is a valid
start character, the CSS Working Group believes it will never define any
identifiers that start with that character.</p>

<h3>Historical notes</h3>

<p><em>This section is informative, not normative.</em></p>

<p>Microsoft created a number of proprietary properties for use inside their
Microsoft Office product, at a time when there was not yet a consensus in the
working group about the naming convention. They chose to prefix properties
with "mso-" rather than "-mso-".</p>

<p>At the time of writing, the following prefixes are known to exist:</p>
<ul>
  <li><em>mso-</em> (Microsoft Corporation)</li>
  <li><em>-moz-</em> (The Mozilla Organization)</li>
  <li><em>-o-</em> (Opera Software)</li>
  <li><em>-atsc</em>- (Advanced Television Standards Committee)</li>
  <li><em>-wap-</em> (The WAP Forum)</li>
</ul>

<h2 id="conf">Conformance</h2>

<p>The key words <dfn>"MUST"</dfn>,
<dfn>"MUST NOT"</dfn>, <dfn>"REQUIRED"</dfn>, <dfn>"SHALL"</dfn>, <dfn
>"SHALL NOT"</dfn>, <dfn>"SHOULD"</dfn>, <dfn>"SHOULD NOT"</dfn>,
<dfn>"RECOMMENDED"</dfn>, <dfn>"MAY"</dfn>, and <dfn>"OPTIONAL"</dfn> in this document
are to be interpreted as described in RFC&nbsp;2119 (see [[!RFC2119]]).
However, for readability, these words do not appear in all uppercase
letters in this specification.</p>

<h3>Definitions</h3>

<p class="issue">[Some of these need heavy rewriting given
modularization.  I've avoided substituting CSS3 where it's clearly not
going to be appropriate.]</p>

<p>This module and other CSS3 modules rely on the following
definitions:</p>

<dl>

<dt><dfn>Style sheet</dfn>

<dd>A set of statements that specify presentation of a document.

<p>Style sheets may have three different origins: <a
href="#author">author</a>, <a href="#user">user</a>, and <a
href="#user-agent">user agent</a>. The interaction of these sources is
described in the cascading and
inheritance module [[!CSS3CASCADE]].</p>

<dt><dfn>Valid style sheet</dfn>

<dd>The validity of a style sheet depends on the level of CSS
used for the style sheet. All valid CSS1 style sheets are valid CSS&nbsp;2.1
style sheets, but some changes from CSS1 mean that
a few CSS1 style sheets will have slightly different semantics in
CSS&nbsp;2.1. Some features in CSS2 are not part of CSS&nbsp;2.1, so not all CSS2
style sheets are valid CSS&nbsp;2.1 style sheets.

<P>A valid CSS&nbsp;2.1 style sheet must be written according to the <a
href="#detailed-grammar">grammar of CSS&nbsp;2.1</a>. Furthermore, it must contain
only at-rules, property names, and property values defined in this
specification. An <dfn>illegal</dfn> (invalid) at-rule,
property name, or property value is one that is not valid.

<dt><dfn>Ignore</dfn>

<dd>This term has three slightly different meanings in this specification.
First, a CSS parser must follow certain rules when it discovers unknown
or illegal syntax in a style sheet. The parser must then ignore certain
parts of the style sheets. The exact rules for what parts must be
ignored is given in these section: <a href="#declaration">Declarations
and properties</a>, <a href="#error-handling">Rules for handling parsing
errors</a>, <a href="#unsupportedvalues">Unsupported Values</a>, or may be
explained in the text where the term "ignore" appears. Second, a user
agent may (and, in some cases must) disregard certain properties or
values in the style sheet even if the syntax is legal. For example,
table-column-group elements cannot have borders around them, so the
border properties must be ignored.

<dt><dfn>Author</dfn>
<dd>An author is a person who writes
documents and associated style sheets. An 
<dfn>authoring tool</dfn>
generates documents and associated style sheets.</dd>

<dt><dfn>User</dfn> 
<dd> A user is a person who interacts with a user agent to view, hear, or
otherwise use a document and its associated style sheet. The user
may provide a personal style sheet that encodes personal
preferences.
</dd>

<dt><dfn>User agent (UA)</dfn>
<dd>A <dfn title="user agent|UA">user
agent</dfn> is any program that interprets a document written in
the document language and applies associated style sheets according
to the terms of this specification. A user agent may display a
document, read it aloud, cause it to be printed, convert it
to another format, etc.</dd>

<DD>An HTML user agent is one that supports the HTML 2.x, HTML 3.x, or
HTML 4.x specifications. A user agent that supports XHTML [[XHTML10]],
but not HTML (as listed in the previous sentence) is not considered an
HTML user agent for the purpose of conformance with this
specification.

</dl>


<h3 id="conf-UA">User agent conformance</h3>

<p class="issue">[This section should contain rules for user style sheet
conformance, author style sheet disabling, handling parsing errors,
etc., from the CSS2.1 specification.]</p>


<h4>Error conditions</h4>

<P>In general, this document does not specify error handling behavior
for user agents (e.g., how they behave when they cannot find
a resource designated by a URI).

<P>However, user agents must observe the <a
href="#error-handling">rules for handling parsing errors</a>.

<P>Since user agents may vary in how they handle error conditions,
authors and users must not rely on specific error recovery behavior.


<h3 id="conf-SS">Style sheet conformance</h3>

<h3 id="conf-AT">Authoring tool conformance</h3>

<p>Authoring tools may use a modified form of the <a
href="#error-handling">rules for handling parsing errors</a>:  when
those rules require that user agents <em>ignore</em> something,
authoring tools are not required to ignore it.  However, authoring tools
should not present such parts of the style sheet to the user in the same
way as valid parts of the style sheet.  In so far as authoring tools
display the application of a style sheet to a document, they are required
to meet the <a href="#conf-UA">user agent conformance</a> rules.</p>

<p class="issue">[informative reference to canonicalization proposal?]</p>


<h2 id="property-defs">Format of property definitions in other modules</h2>

<p>Each CSS property definition begins with a summary of key
information that resembles the following:</p>

<div class="propdef">
<dl>
<dt><dfn class="propdef-title">'property-name'</dfn>

<dd>
<table class="propinfo" cellspacing=0 cellpadding=0>
<tr valign=baseline><td><em>Value:</em>&nbsp;&nbsp;<td>legal values
&amp; syntax
<tr valign=baseline><td><em>Initial:</em>&nbsp;&nbsp;<td>initial value
<tr valign=baseline><td><em>Applies to:</em>&nbsp;&nbsp;<td>elements
this property applies to
<tr valign=baseline><td><em>Inherited:</em>&nbsp;&nbsp;<td>whether the
property is inherited
<tr valign=baseline><td><em>Computed Value:</em>&nbsp;&nbsp;<td>the
computed value of the property
<tr valign=baseline><td><em>Percentages:</em>&nbsp;&nbsp;<td>how
percentage values are interpreted
<tr valign=baseline><td><em>Media:</em>&nbsp;&nbsp;<td>which media
groups the property applies to
</table>

</dl>
</div>

<h3 id="property-def-value">Value</h3>

<p>This part specifies the set of valid values for the property. Value
types may be designated in several ways:

<ol>
<li> keyword values (e.g., auto, disc, etc.)

<li> basic data types, which appear between "&lt;" and "&gt;" (e.g.,
&lt;length&gt;, &lt;percentage&gt;, etc.). In the electronic version
of the document, each instance of a basic data type links to its
definition.

<li> types that have the same range of values as a property bearing
the same name (e.g., &lt;'border-width'&gt;
&lt;'background-attachment'&gt;, etc.).  In this case, the type name
is the property name (complete with quotes) between "&lt;" and "&gt;"
(e.g., &lt;'border-width'&gt;).  Such a type does <strong>not</strong>
include the value 'inherit'.  In the electronic version of the
document, each instance of this type of non-terminal links to the
corresponding property definition.


<li> non-terminals that do not share the same name as a property. In this
case, the non-terminal name appears between "&lt;" and "&gt;", as in
&lt;border-width&gt;.  Notice the distinction between
&lt;border-width&gt; and &lt;'border-width'&gt;; the latter is defined
in terms of the former. The definition of a non-terminal is located
near its first appearance in the specification.  In the electronic
version of the document, each instance of this type of value links to
the corresponding value definition.
</ol>

<p>Other words in these definitions are keywords that must appear
literally, without quotes (e.g., red). The slash (/) and the comma (,)
must also appear literally.

<p>Values may be arranged as follows:</p>

<ul>
<li>Several juxtaposed words mean that all of them must occur, in the
given order.
<li>A bar (|) separates two or more alternatives: 
exactly one of them must occur.
<li>A double bar (||) separates
two or more options: one or more of them must occur, in any order.
<li>Brackets ([&nbsp;]) are for grouping. 
</ul>

<p>Juxtaposition is stronger than the double bar, and the double bar
is stronger than the bar. Thus, the following lines are equivalent:
<PRE>
    a b   |   c || d e
  [ a b ] | [ c || [ d e ]]
</PRE>

<p> Every type, keyword, or bracketed group may be followed by one of
the following modifiers:</p>

  <UL>
    <LI>
      An asterisk (*) indicates that the preceding type, word, or group
      occurs zero or more times.

    <LI>
      A plus (+) indicates that the preceding type, word, or group 
      occurs one or more times.

    <LI>
      A question mark (?) indicates that the preceding type, word, or
      group is optional.

    <LI>
      A pair of numbers in curly braces ({A,B}) indicates that the
      preceding type, word, or group occurs at least A and at most
      B times.
  </UL>


<p>The following examples illustrate different value types:

<BLOCKQUOTE>
    <EM>Value:</EM> N | NW | NE<BR>
    <EM>Value:</EM> [ &lt;length&gt; | thick | thin ]{1,4}<BR>
    <EM>Value:</EM> [&lt;family-name&gt; , ]* &lt;family-name&gt;<BR>
    <EM>Value:</EM> &lt;uri&gt;? &lt;color&gt; [ / &lt;color&gt; ]?<BR>
    <EM>Value:</EM> &lt;uri&gt; || &lt;color&gt;<BR>
</BLOCKQUOTE>

<p>See the values and units [[!CSS3VAL]] module for the formal
definitions of the basic values types.</p>

<p class="issue">[We need a more formal grammar for parsing of
properties.  Refer to section on keywords (they can't be quoted).]</p>

<h4><code>initial</code> and <code>inherit</code> values</h4>

<p>In addition to the legal values stated, <code>initial</code> and
<code>inherit</code> values are also legal for every property.  The
meaning of these values is described in the Values &amp; Units
[[!CSS3VAL]] and Cascading &amp; Inheritance [[!CSS3CASCADE]] modules.
</p>

<h3 id="property-def-initial">Initial</h3>

<p>This part specifies the property's initial value. If the property
is <a href="#property-def-inherited">inherited</a>, this is the value
that is given to the root element of the <span>document tree</span>.
Please consult
the the Cascading &amp; Inheritance module [[!CSS3CASCADE]] for information
about the interaction between style sheet-specified, inherited, and
initial values.


<h3 id="property-def-applies">Applies to</h3>

<p>This part lists the elements to which the property applies. All
elements are considered to have all properties, but some properties
have no rendering effect on some types of elements. For example, <span
class="propinst-white-space">'white-space'</span> only affects
block-level elements.

<h3 id="property-def-inherited">Inherited</h3>

<p>This part indicates whether the value of the property is inherited
from an ancestor element by default ("Inherited: yes") or the
value of the property is its <a href="#property-def-initial">initial
value</a> by default ("Inherited: no").  Please consult the Cascading
&amp; Inheritance Module [[!CSS3CASCADE]] for information about the
interaction between style sheet-specified, inherited, and initial
values.</p>

<h3 id="property-def-computed">Computed value</h3>

<p>This part indicates the computed value of the property.  The concept
of computed value is described in the Cascading &amp; Inheritance Module
[[!CSS3CASCADE]].  (It is needed both for inheritance and for the
definitions of some DOM properties.)</p>

<p>When the computed value line says "as specified", then for the
special <span>'initial'</span> and <span>'inherit'</span> values, the
computed value is as though the initial value or the inherited value had
been specified -- it is not 'initial' or 'inherit' itself.  <span
class="issue">[Check this with the definition of "specified value".  It
may not be needed.]<span></p>

<p class="issue">[What is the computed value for elements to which the
property does not apply?  Do some existing inherited properties rely on
inheritance through elements to which the property doesn't apply?]</p>

<h3 id="property-def-percent">Percentage values</h3>

<p>This part indicates how percentages should be interpreted, if they occur in
the value of the property. If "N/A" appears here, it means that the
property does not accept percentages as values.

<h3 id="media-groups">Media groups</h3>

<p class="issue">[Some of this needs to be relaxed to deal with
profiles.]</p>

<P><em>This section is informative, not normative.</em></P>

<p>This part indicates the media groups for which the property must be
implemented by a conforming user agent.
Since properties
generally apply to several media, the "Applies to media" section of each
property definition lists media groups rather than individual media
types.
User agents must support the
property if they support rendering to the media types included in
these media groups.
Each property applies to all media types in the media groups
listed in its definition.
</p>

<P>CSS3 defines the following media groups: </P>
<ul>
<li>
<dfn title="'continuous' media group">continuous</dfn>
or <dfn title="'paged' media group">paged</dfn>.

<li><dfn title="'visual' media group">visual,</dfn> 
<dfn title="'audio' media group">audio,</dfn> 
<dfn title="'speech' media group">speech,</dfn> 
or <dfn title="'tactile' media group">tactile</dfn>.
<li><dfn title="'grid' media group">grid</dfn> (for
character grid devices), or
<dfn title="'bitmap' media group">bitmap</dfn>.

<li><dfn title="'interactive' media group">interactive</dfn> (for
devices that allow user interaction), or
<dfn title="'static' media group">static</dfn> (for
those that don't).

<li><dfn title="'all' media group">all</dfn> (includes all media
types)
</ul>

<p>The following table shows the relationships
between media groups and media types:</p>

<TABLE border 
       summary="Relationship between media groups and media types">
<CAPTION>Relationship between media groups and media types</CAPTION>
<TR><TH>Media Types <TH colspan="4">Media Groups
<TR><TH>&nbsp;
    <TH>continuous/paged
    <TH>visual/audio/speech/tactile
    <TH>grid/bitmap
    <TH>interactive/static
<!--
<TR><TH>audio<TD align="center">continuous<TD align="center">audio<TD align="center">N/A<TD align="center">both</TR>
-->
<TR><TH>braille<TD align="center">continuous<TD align="center">tactile<TD align="center">grid<TD align="center">both</TR>
<TR><TH>embossed<TD align="center">paged<TD align="center">tactile<TD align="center">grid<TD align="center">static</TR>
<TR><TH>handheld<TD align="center">both<TD align="center">visual, audio, speech<TD
align="center">both<TD align="center">both</TR>
<TR><TH>print<TD align="center">paged<TD align="center">visual<TD
align="center">bitmap<TD align="center">static</TR>
<TR><TH>projection<TD align="center">paged<TD align="center">visual<TD align="center">bitmap<TD align="center">interactive</TR>
<TR><TH>screen<TD align="center">continuous<TD align="center">visual, audio<TD align="center">bitmap<TD align="center">both</TR>
<TR><TH>speech<TD align="center">continuous<TD align="center">speech<TD align="center">N/A<TD align="center">both</TR>
<TR><TH>tty<TD align="center">continuous<TD align="center">visual<TD align="center">grid<TD align="center">both</TR>
<TR><TH>tv<TD align="center">both<TD align="center">visual, audio<TD align="center">bitmap<TD align="center">both</TR>
</TABLE>

<h3>Shorthand properties</h3>

<p>Some properties are <dfn title="shorthand
property">shorthand properties</dfn>, meaning they allow
authors to specify the values of several properties with a single
property.</p>

<p>For instance, the <span class="propinst-font">'font'</span> property
is a shorthand property for setting <span
class="propinst-font-style">'font-style'</span>, <span
class="propinst-font-variant">'font-variant'</span>, <span
class="propinst-font-weight">'font-weight'</span>, <span
class="propinst-font-size">'font-size'</span>, <span
class="propinst-line-height">'line-height'</span>, and <span
class="propinst-font-family">'font-family'</span> all at once.</p>

<p>The syntax of a shorthand property may allow some of the properties
that can be specified by that shorthand to be omitted.  When such values
are omitted from a shorthand form, each "missing" property is assigned
its initial value (see the Cascading &amp; Inheritance module
[[!CSS3CASCADE]]).  The definition of a shorthand property may further say
that it resets the definitions of other properties to their initial
value.</p>

<div class="example"><p>
The multiple style rules of this example:</p>

<pre>
h1 { 
  font-weight: bold; 
  font-size: 2em;
  line-height: 1.2; 
  font-family: Helvetica, Arial, sans-serif; 
  font-variant: normal;
  font-style: normal;
  font-stretch: normal;
  font-size-adjust: none
}
</pre>

<p>may be rewritten with a single shorthand property:</p>

<pre>
h1 { font: bold 2em/1.2 Helvetica, Arial, sans-serif }
</pre>

<p>In this example, <span
class="propinst-font-variant">'font-variant'</span>, <span
class="propinst-font-stretch">'font-stretch'</span>, <span
class="propinst-font-size-adjust">'font-size-adjust'</span>, and <span
class="propinst-font-style">'font-style'</span> 
take their initial values.</p>
</div>

<h2 id="detailed-grammar">Appendix: Second grammar</h2>

<p class="issue">[This grammar was the Appendix D grammar of CSS2,
augmented by the additions from the @namespace draft.  It needs to be
incorporated into the above normative text in some way.]</p>

<p>The grammar below defines the syntax of CSS2. It is in some sense,
however, a superset of CSS2 as this specification imposes additional
semantic constraints not expressed in this grammar. A conforming UA
must also adhere to the <a href="#syntax">
forward-compatible parsing rules</a>, the <a
href="#property-defs">property and value notation</a>,
and the unit notation. In
addition, the document language may impose restrictions, e.g. HTML
imposes restrictions on the possible values of the "class"
attribute.</p>

<!-- IJ: There used to be a link to "unit notation", but I couldn't
find anything in the spec that corresponded. -->

<h3>Grammar</h3>

<p>The grammar below is <span class="index"
title="LL(1)">LL(1)</span> (but note that most UA's should not use it
directly, since it doesn't express the forward-compatible <a
href="#syntax">parsing conventions</a>, only the
CSS3 syntax).  The format of the productions is optimized for human
consumption and some shorthand notation beyond Yacc (see [[YACC]]) is
used:</p>

<p class="issue">[It's probably not LL(1), but rather just LALR(1).]</p>

<p class="issue">[This needs a lot more revisions to reflect all the
additions in CSS3.]</p>

<p class="issue">[This doesn't allow nested at-rules, such as
<code>@page</code> inside <code>@media</code>.  Do we want to allow
this?]</p>

<ul>
<li><strong>*</strong>: 0 or more
<li><strong>+</strong>: 1 or more
<li><strong>?</strong>: 0 or 1 
<li><strong>|</strong>: separates alternatives 
<li><strong>[&nbsp;]</strong>: grouping
</ul>

<p>The productions are:

<pre>
stylesheet
  : [ CHARSET_SYM S* STRING S* ';' ]?
    [S|CDO|CDC]* [ import [S|CDO|CDC]* ]*
    [ namespace [S|CDO|CDC]* ]*
    [ [ ruleset | media | page | font_face ] [S|CDO|CDC]* ]*
  ;
import
  : IMPORT_SYM S*
    [STRING|URI] S* [ medium [ ',' S* medium]* ]? ';' S*
  ;
namespace
  : NAMESPACE_SYM S* [namespace_prefix S*]? [STRING|URI] S* ';' S*
  ;
namespace_prefix
  : IDENT
  ;
media
  : MEDIA_SYM S* medium [ ',' S* medium ]* '{' S* ruleset* '}' S*
  ;
medium
  : IDENT S*
  ;
page
  : PAGE_SYM S* IDENT? pseudo_page? S*
    '{' S* declaration [ ';' S* declaration ]* '}' S*
  ;
pseudo_page
  : ':' IDENT
  ;
font_face
  : FONT_FACE_SYM S*
    '{' S* declaration [ ';' S* declaration ]* '}' S*
  ;
operator
  : '/' S* | ',' S* | /* empty */
  ;
combinator
  : '+' S* | '>' S* | /* empty */
  ;
unary_operator
  : '-' | '+'
  ;
property
  : IDENT S*
  ;
ruleset
  : selector [ ',' S* selector ]*
    '{' S* declaration [ ';' S* declaration ]* '}' S*
  ;
<span class="index">selector</span>
  : simple_selector [ combinator simple_selector ]*
  ;
simple_selector
  : element_name? [ HASH | class | attrib | pseudo ]* S*
  ;
class
  : '.' IDENT
  ;
element_name
  : IDENT | '*'
  ;
attrib
  : '[' S* IDENT S* [ [ '=' | INCLUDES | DASHMATCH ] S*
    [ IDENT | STRING ] S* ]? ']'
  ;
pseudo
  : ':' [ IDENT | FUNCTION S* IDENT S* ')' ]
  ;
declaration
  : property ':' S* expr prio?
  | /* empty */
  ;
prio
  : IMPORTANT_SYM S*
  ;
expr
  : term [ operator term ]*
  ;
term
  : unary_operator?
    [ NUMBER S* | PERCENTAGE S* | LENGTH S* | EMS S* | EXS S* | ANGLE S* |
      TIME S* | FREQ S* | function ]
  | STRING S* | IDENT S* | URI S* | UNICODERANGE S* | hexcolor
  ;
function
  : FUNCTION S* expr ')' S*
  ;
/*
 * There is a constraint on the <span class="index">color</span> that it must
 * have either 3 or 6 hex-digits (i.e., [0-9a-fA-F])
 * after the "#"; e.g., "#000" is OK, but "#abcd" is not.
 */
hexcolor
  : HASH S*
  ;
</pre>

<h3>Lexical scanner</h3>

<p> The following is the <dfn>tokenizer</dfn>, written in Flex (see [[FLEX]])
notation. The tokenizer is case-insensitive.</p>

<p>The two occurrences of "\377" represent the highest character
number that current versions of Flex can deal with (decimal 255). They
should be read as "\4177777" (decimal 1114111), which is the highest
possible code point in <span class="index">Unicode</span>/<span class="index">ISO-10646</span>, except excluding the characters
excluded in the <code><a href="#SUBTOK-nonascii">nonascii</a></code>
production above.</p>

<!-- ignored whitespace after Unicode escape, is it OK? -->
<pre>
%option case-insensitive

h		[0-9a-f]
nonascii	[\200-\377]
unicode		\\{h}{1,6}[ \t\r\n\f]?
escape		{unicode}|\\[ -~\200-\377]
nmstart		[a-z]|{nonascii}|{escape}
nmchar		[a-z0-9-]|{nonascii}|{escape}
string1		\"([\t !#$%&amp;(-~]|\\{nl}|\'|{nonascii}|{escape})*\"
string2		\'([\t !#$%&amp;(-~]|\\{nl}|\"|{nonascii}|{escape})*\'

ident		[-]?{nmstart}{nmchar}*
name		{nmchar}+
num		[0-9]+|[0-9]*"."[0-9]+
string		{string1}|{string2}
url		([!#$%&amp;*-~]|{nonascii}|{escape})*
w		[ \t\r\n\f]*
nl		\n|\r\n|\r|\f
range		\?{1,6}|{h}(\?{0,5}|{h}(\?{0,4}|{h}(\?{0,3}|{h}(\?{0,2}|{h}(\??|{h})))))

%%

[ \t\r\n\f]+		{return S;}

\/\*[^*]*\*+([^/][^*]*\*+)*\/	/* ignore comments */

"&lt;!--"			{return CDO;}
"-->"			{return CDC;}
"~="			{return INCLUDES;}
"|="			{return DASHMATCH;}

{string}		{return STRING;}

{ident}			{return IDENT;}

"#"{name}		{return HASH;}

"@import"		{return IMPORT_SYM;}
"@page"			{return PAGE_SYM;}
"@media"		{return MEDIA_SYM;}
"@font-face"		{return FONT_FACE_SYM;}
"@charset"		{return CHARSET_SYM;}
"@namespace"		{return NAMESPACE_SYM;}

"!{w}important"		{return IMPORTANT_SYM;}

{num}em			{return EMS;}
{num}ex			{return EXS;}
{num}px			{return LENGTH;}
{num}cm			{return LENGTH;}
{num}mm			{return LENGTH;}
{num}in			{return LENGTH;}
{num}pt			{return LENGTH;}
{num}pc			{return LENGTH;}
{num}deg		{return ANGLE;}
{num}rad		{return ANGLE;}
{num}grad		{return ANGLE;}
{num}ms			{return TIME;}
{num}s			{return TIME;}
{num}Hz			{return FREQ;}
{num}kHz		{return FREQ;}
{num}{ident}		{return DIMEN;}
{num}%			{return PERCENTAGE;}
{num}			{return NUMBER;}

"url("{w}{string}{w}")"	{return URI;}
"url("{w}{url}{w}")"	{return URI;}
{ident}"("		{return FUNCTION;}

U\+{range}		{return UNICODERANGE;}
U\+{h}{1,6}-{h}{1,6}	{return UNICODERANGE;}

.			{return *yytext;}
</pre>


<h2 class="no-num">Changes from CSS2</h2>

<p>This section is informative.</p>

<p>
  The parts of CSS2 that have become part of this CSS3 draft are
  sections 1.3.2 (1.4.2 in CSS 2.1), 1.3.3 (1.4.3 in CSS2.1), 3 (parts),
  4.1, 4.2, 4.4, and 6.3, 7, and Appendix D.  This draft also contains
  new material on namespaces and on vendor extensions to CSS that began
  as separate documents.
</p>

<ul>
  <li>The text taken from Chapter 1 of CSS2 is now normative rather than
  informative.</li>

  <li>added the section on vendor extensions and added the
  <span class="css">'-'</span> character to the
  ident productions so that identifiers can begin with it</li>

  <li>modified the rules for handling parsing errors
  to allow implementations that support only parts of CSS3</li>

  <li>described how style sheets that cannot be parsed according to the
  grammar should be handled (by saying that parsing uses the parseable
  initial sequence of tokens)</li>

  <li><span class="issue">[to be done]</span> described handling of unmatched quotation marks (by saying that
  tokenization uses the tokenizable initial sequence of characters)</li>

  <li><span class="issue">[to be done]</span> formalized the error handling rules by combining the
  forward-compatible grammar in chapter 4 with the CSS2 grammar in
  Appendix D.</li>

  <li>combined DELIM and other single character tokens into CHAR</li>

  <li>explicitly stated that the byte order mark should be ignored for
  purposes of the grammar</li>

  <li>Changed the acceptable characters to exclude surrogate blocks and
  #xFFFE, #xFFFF, as in XML.</li>

  <li>Changed the rules on what to do when a character encoding is not
  specified.</li>

</ul>

<h2 class="no-num">Acknowledgments</h2>

<p>Since most of this draft is taken from CSS2, it would not have been
possible to write it so easily without the work of the editors and
authors of [[CSS1]] and [[CSS2]].  This draft also borrows heavily from
earlier drafts on CSS namespace support by Peter Linss [[CSS3NAMESPACE]]
and early (unpublished) drafts on vendor extensions to CSS by Bert Bos.
Many current and former members of the working group have contributed to
this document.  Discussions on <code><a
href="http://lists.w3.org/Archives/Public/www-style/">www-style@w3.org</a></code>
and in other places have also contributed ideas to this specification.
Comments from Glenn Adams, Bj&ouml;rn H&ouml;hrmann, and Etan Wexler
have been particularly helpful.</p>

<h2 class="no-num">References</h2>

<h3 class="no-num">Normative references</h3>

<!-- begin-normative -->
<p>[Here will be inserted the file "normative.inc"]</p>
<!-- end-normative -->

<h3 class="no-num">Other references</h3>

<!-- begin-informative -->
<p>[Here will be inserted the file "informative.inc"]</p>
<!-- end-informative -->

<h2 class="no-num">Index</h2>
<!--index-->
</body>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-declaration:"~/SGML/HTML4.decl"
sgml-default-doctype-name:"html"
sgml-minimize-attributes:t
sgml-nofill-elements:("pre" "style" "br")
sgml-live-element-indicator:t
End:
-->
</html>
