<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en-US">
 <head>
  <title>CSSOM View Module</title>

  <style type="text/css">
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   dfn { font-weight:bold; font-style:normal }
   div.example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   p.note {  margin-left:2em; color:green; font-style:italic; font-weight:bold }
   p.note::before { content:"Note: " }
   .issue { padding:.5em; border:solid red }
   .issue::before { content:"Issue: " }
   xem.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
   em.ct { font-weight:bold; font-style:normal }
   code { color:orangered }
   code :link, code :visited { color:inherit }
  </style>

  <link rel="stylesheet" href="http://www.w3.org/StyleSheets/TR/W3C-[STATUS]">
 </head>

 <body class="draft">
  <div class="head">
   <!--logo-->
  
   <h1 id="cssom-view-module">CSSOM View Module</h1>

   <h2 class="no-num no-toc" id="w3c-doctype">[LONGSTATUS] [DATE: 3 August 2002]</h2>

   <dl>

    <dt>This Version:</dt>
    <dd><a href="[VERSION]/">http://www.w3.org/TR/[YEAR]/ED-cssom-view-[CDATE]/</a></dd>

    <dt>Latest Version:</dt>
    <dd><a href="http://www.w3.org/TR/cssom-view/">http://www.w3.org/TR/cssom-view/</a></dd>

    <dt>Previous Versions:</dt>
    <dd><a href="http://www.w3.org/TR/2008/WD-cssom-view-20080222/">http://www.w3.org/TR/2008/WD-cssom-view-20080222/</a></dd>
    <dd><a href="http://www.w3.org/TR/2000/REC-DOM-Level-2-Views-20001113/">http://www.w3.org/TR/2000/REC-DOM-Level-2-Views-20001113/</a></dd>

    <dt>Editor:</dt>
    <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a>
    (<a href="http://www.opera.com/">Opera Software ASA</a>)
    &lt;<a href="mailto:annevk@opera.com">annevk@opera.com</a>&gt;</dd>
   </dl>

   <!-- copyright -->
  </div>

  <hr>

  <h2 id="abstract" class="no-num no-toc">Abstract</h2>

  <p>The APIs introduced by this specification provide authors with a way to
  inspect and manipulate the visual view of a document. This includes
  getting the position of element layout boxes, obtaining the width
  of the viewport through script, and also scrolling an element.</p>

  <p>The CSSOM View Module also supercedes DOM Level 2 Views and therefore
  defines the <code>AbstractView</code> and <code>DocumentView</code>
  interfaces and extensions for them.</p>



  <h2 id="sotd" class="no-num no-toc">Status of this Document</h2>

  <!-- status -->



  <h2 id="toc" class="no-num no-toc">Table of Contents</h2>

  <!-- toc -->



  <h2 id="conformance">Conformance Criteria</h2>
  
  <p>Everything in this specification is normative except for diagrams,
  examples, notes and sections marked non-normative.</p>

  <p>The key word <em class="ct">must</em>, <em class="ct">must not</em>,
  <em class="ct">should</em> and <em class="ct">may</em> in this document
  are to be interpreted as described in RFC 2119.
  [<cite><span>RFC2119</span></cite>]</p>
  
  <p>A conforming user agent implements all the requirements made by this
  specification.</p>


  <h3 id="dependencies">Dependencies</h3>

  <p>This specification depends on several definitions and features defined
  in the HTML&nbsp;5 specification. [<cite><span>HTML5</span></cite>]</p>
  
  <p>This specification also depends on several features defined in the
  DOM Level 2 Events and DOM Level 3 Core specifications.
  [<cite><span>DOM2Events</span></cite>]
  [<cite><span>DOM3Core</span></cite>]</p>


  <h3 id="terminology">Terminology</h3>

  <p>The terms <dfn>HTML element</dfn>, <dfn>view</dfn> and <dfn>default
  view</dfn> are defined by the HTML&nbsp;5 specification.
  [<cite><span>HTML5</span></cite>]</p>

  <p><dfn>The HTML <code>body</code> element</dfn> is the first
  <code>body</code> <span>HTML element</span> child of the root <span>HTML
  element</span> <code>html</code>.</p>



  <h2 id="dom-features">DOM Features</h2>

  <p>This specification defines the
  <a href="http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMFeatures">DOM
  feature</a> "<code>Views</code>" for versions "<code>2.0</code>" and
  "<code>3.0</code>". User agents supporting this specification
  <em class="ct">must</em> support that feature and versions.
  [<cite><span>DOM3Core</span></cite>]</p>

  <p>Authors are encouraged to stay away from DOM features as user agents
  claiming to support the DOM feature might not support the feature you need
  and user agents supporting parts of the specification might not claim
  support for the DOM feature.</p>



  <h2 id="the-abstractview-interface">The <code title="">AbstractView</code> Interface</h2>

  <p>The <code>AbstractView</code> interface is a base interface that all
  <span title="view">views</span> <em class="ct">must</em> derive from.</p>
  
  <pre class="idl">interface <dfn id="abstractview">AbstractView</dfn> {
  readonly attribute <span>DocumentView</span> <span title="abstractview-document">document</span>;
  readonly attribute <span>Media</span> <span title="abstractview-media">media</span>;
};</pre>
  
  <p>The <dfn id="abstractview-document" title="abstractview-document"><code>document</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the object
  implementing the <code>DocumentView</code> interface that is associated
  with the <span>view</span>.</p>
  
  <p>The
  <dfn id="abstractview-media" title="abstractview-media"><code>media</code></dfn>
  attribute, on getting, <em class="ct">must</em> return an object
  implementing the <code>Media</code> interface. It
  <em class="ct">must</em> always return the same object.</p>


  <h3 id="the-media-interface">The <code title="">Media</code> Interface</h3>

  <pre class="idl">interface <dfn id="media">Media</dfn> {
  readonly attribute DOMString <span>type</span>;
  boolean <span title="media-matchmedium">matchMedium</span>(in DOMString <var title="">mediaquery</var>);
};</pre>

  <p>The <dfn id="media-type"><code>type</code></dfn> attribute, on getting,
  <em class="ct">must</em> return the string that represents the media type
  of the current <span>view</span> used for rendering the
  <code>Document</code>. The media types are defined by CSS 2.1
  (<code>screen</code>, <code>print</code>, et cetera).
  [<cite><span>CSS21</span></cite>]</p>

  <p>The
  <dfn id="media-matchmedium" title="media-matchmedium"><code>matchMedium(<var>mediaquery</var>)</code></dfn>
  method, when invoked, <em class="ct">must</em> return the result of the
  following algorithm:</p>

  <ol>
   <li>If <var title="">mediaquery</var> can be parsed according to the
   rules given in the Media Queries specification and matches the state of
   the current <span>view</span> return <code>true</code> and terminate
   this algorithm.</li>

   <li>Otherwise, return <code>false</code>.</li>
  </ol>


  <h2 id="the-screenview-interface">The <code title="">ScreenView</code> Interface</h2>

  <p>An object implementing the <code>ScreenView</code> interface represents
  a <span>view</span> for visual media. If the <span>default view</span> is
  visual the <span title="documentview-defaultview">defaultView</span>
  attribute on the <code>Document</code> object <em class="ct">must</em>
  return an object implementing this interface.</p>

  <pre class="idl">interface <dfn id="screenview">ScreenView</dfn> : <span>AbstractView</span> {
  // viewport
  readonly attribute long <span>innerWidth</span>;
  readonly attribute long <span>innerHeight</span>;
  readonly attribute long <span>pageXOffset</span>;
  readonly attribute long <span>pageYOffset</span>;
  void <span title="screenview-scroll">scroll</span>(in long <var title="">x</var>, in long <var title="">y</var>);
  void <span title="screenview-scrollto">scrollTo</span>(in long <var title="">x</var>, in long <var title="">y</var>);
  void <span title="screenview-scrollby">scrollBy</span>(in long <var title="">x</var>, in long <var title="">y</var>);

  // client
  readonly attribute long <span>screenX</span>;
  readonly attribute long <span>screenY</span>;
  readonly attribute long <span>outerWidth</span>;
  readonly attribute long <span>outerHeight</span>;

  // output device
  readonly attribute <span>Screen</span> <span title="screenview-screen">screen</span>;
};</pre>

  <p>The <dfn id="screenview-innerwidth"><code>innerWidth</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the viewport width
  as number of CSS pixels.
  <span class="note">This is including, if rendered, the vertical
  scrollbar.</span></p>

  <p>The <dfn id="screenview-innerheight"><code>innerHeight</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the viewport height
  as number of CSS pixels. <span class="note">This is including, if
  rendered, the horizontal scrollbar.</span></p>

  <p>The <dfn id="screenview-pagexoffset"><code>pageXOffset</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the x-coordinate,
  relative to the initial containing block origin, of the left of the
  viewport as number of CSS pixels.</p>

  <p>The <dfn id="screenview-pageyoffset"><code>pageYOffset</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the y-coordinate,
  relative to the initial containing block origin, of the top of the
  viewport as number of CSS pixels.</p>

  <p>When the
  <dfn id="screenview-scroll" title="screenview-scroll"><code>scroll(<var title="">x</var>,<var title="">y</var>)</code></dfn>
  method is invoked, the user agent <em class="ct">must</em> align the
  x-coordinate <var title="">x</var> of the canvas with the left of the
  viewport and align the y-coordinate <var title="">y</var> of the canvas
  with the top of the viewport.</p>
  <!-- XXX negative arguments ignored... not canvas but content height or
  something -->

  <p>When the
  <dfn id="screenview-scrollto" title="screenview-scrollto"><code>scrollTo(<var title="">x</var>,<var title="">y</var>)</code></dfn>
  method is invoked, the user agent <em class="ct">must</em> act as if the
  <code title="screenview-scroll">scroll()</code> method was invoked with
  the same arguments.</p>

  <p>When the
  <dfn id="screenview-scrollby" title="screenview-scrollby"><code>scrollBy(<var title="">x</var>,<var title="">y</var>)</code></dfn>
  method is invoked, the user agent <em class="ct">must</em> act as if the
  <code title="screenview-scroll">scroll()</code> method was invoked with
  <var title="">x</var> plus <code>pageXOffset</code> as first argument and
  <var title="">y</var> plus <code>pageYOffset</code> as second
  argument.</p>

  <p>The <dfn id="screenview-screenx"><code>screenX</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the x-coordinate,
  relative to the origin of the screen of the output device, of the top of
  the client window as number of pixels, or zero if there is no such
  thing.</p>

  <p>The <dfn id="screenview-screeny"><code>screenY</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the y-coordinate,
  relative to the origin of the screen of the output device, of the left of
  the client window as number of pixels, or zero if there is no such
  thing.</p>

  <p>The <dfn id="screenview-outerwidth"><code>outerWidth</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the width of the
  client window as number of CSS pixels. If there is no client window this
  attribute <em class="ct">must</em> return zero.</p>

  <p>The <dfn id="screenview-outerheight"><code>outerHeight</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the height of the
  client window as number of CSS pixels. If there is no client window
  this attribute <em class="ct">must</em> return zero.</p>

  <p>The
  <dfn id="screenview-screen" title="screenview-screen"><code>screen</code></dfn>
  attribute, on getting, <em class="ct">must</em> return an object
  implementing the <code>Screen</code> interface. It
  <em class="ct">must</em> always return the same object.</p>


  <h3 id="the-screen-interface">The <code title="">Screen</code> Interface</h3>

  <p>As its name suggests, the <code>Screen</code> interface represents
  information about the screen of the output device.</p>

  <pre class="idl">interface <dfn id="screen">Screen</dfn> {
  readonly attribute unsigned long <span>availWidth</span>;
  readonly attribute unsigned long <span>availHeight</span>;
  readonly attribute unsigned long <span>width</span>;
  readonly attribute unsigned float <span>height</span>;
  readonly attribute unsigned float <span>colorDepth</span>;
  readonly attribute unsigned float <span>pixelDepth</span>;
};</pre>

  <p>The <dfn id="screen-availwidth"><code>availWidth</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the available width
  of the rendering surface of the output device as number of CSS pixels.</p>

  <p>The <dfn id="screen-availheight"><code>availHeight</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the available
  height of the rendering surface of the output device as number of CSS
  pixels.</p>

  <p>The <dfn id="screen-width"><code>width</code></dfn> attribute, on
  getting, <em class="ct">must</em> return the width of the output device as
  number of CSS pixels.</p>

  <p>The <dfn id="screen-height"><code>height</code></dfn> attribute, on
  getting, <em class="ct">must</em> return the height of the output device
  as number of CSS pixels.</p>

  <p>The <dfn id="screen-colordepth"><code>colorDepth</code></dfn> and
  <dfn id="screen-pixeldepth"><code>pixelDepth</code></dfn> attributes
  <em class="ct">must</em> both return the lowest number of bits from the
  color components of the output device. If the device is not a color device
  these attributes <em class="ct">must</em> return zero.</p>
  <!-- pixelDepth is not supported by Internet Explorer 7 -->


  <h2 id="the-documentview-interface">The <code title="">DocumentView</code> Interface</h2>

  <p>Objects implementing the <code>Document</code> interface, as defined in
  DOM Level 3 Core, <em class="ct">must</em> also implement the
  <code>DocumentView</code> interface.
  [<cite><span>DOM3Core</span></cite>]</p>

  <pre class="idl">interface <dfn id="documentview">DocumentView</dfn> {
  readonly attribute <span>AbstractView</span> <span>defaultView</span>;
  Element <span>elementFromPoint</span>(in unsigned long <var title="">x</var>, in unsigned long <var title="">y</var>);
};</pre>

  <p>The <dfn id="documentview-defaultview"><code>defaultView</code></dfn>
  attribute, on getting, <em class="ct">must</em> return an object
  implementing the <code>AbstractView</code> interface that is the
  <span>default view</span> for this document. If there is no default view
  available this attribute <em class="ct">must</em> return
  <code>null</code>.</p>

  <p>The
  <dfn id="documentview-elementfrompoint" title="elementfrompoint"><code>elementFromPoint(<var title="">x</var>,
  <var title="">y</var>)</code></dfn> method, when invoked,
  <em class="ct">must</em> return the element at <var>x</var>,<var>y</var>
  in the viewport. The element to be returned is determined through hit
  testing. If either argument is negative or if there is no element at
  the given position the method, when invoked, <em class="ct">must</em>
  return <code>null</code>.</p>

  <p class="note">The specifics of hit testing are out of scope of this
  specification. Hit testing may be defined in a future revision of CSS or
  HTML&nbsp;5.</p>


  <h2 id="the-elementview-interface">The <code title="">ElementView</code> Interface</h2>

  <p>Objects implementing the <code>Element</code> interface, as defined by
  DOM Level 3 Core, <em class="ct">must</em> also implement the
  <code>ElementView</code> interface. [<cite><span>DOM3Core</span></cite>]</p>

  <pre class="idl">interface <dfn id="elementview">ElementView</dfn> {
  <span>TextRectangleList</span> <span>getClientRects</span>();
  <span>TextRectangle</span> <span>getBoundingClientRect</span>();
};</pre>


  <h3>The <code title="">getClientRects()</code> and
  <code title="">getBoundingClientRect()</code> methods</h3>

  <p>The <code>getClientRects()</code> and <code>getBoundingClientRect</code>
  methods provide information about the position of the border box edges of
  an element relative to the viewport.</p>

  <p>The
  <dfn id="elementview-getclientrects"><code>getClientRects()</code></dfn>
  method, when invoked, <em class="ct">must</em> return the result of the
  following algorithm:</p>

  <ol>
   <li><p>If the element on which it was invoked does not have an associated
   CSS layout box return an empty (static) <code>TextRectangleList</code>
   object and stop this algorithm.</p></li>

   <li><p>Return a (static) <code>TextRectangleList</code> object containing
   a list of (static) <code>TextRectangle</code> objects in content order
   describing the border boxes, even if they are empty, for the element on
   which it was invoked.</p></li>
  </ol>

  <p>The
  <dfn id="elementview-getboundingclientrect"><code>getBoundingClientRect()</code></dfn>
  method, when invoked, <em class="ct">must</em> return the result of the
  following algorithm:</p>

  <ol>
   <li><p>If the element on which it was invoked does not have an associated
   CSS layout box return a (static) <code>TextRectangle</code> object whose
   <code title="textrectangle-top">top</code>,
   <code title="textrectangle-right">right</code>,
   <code title="textrectangle-bottom">bottom</code> and
   <code title="textrectangle-left">left</code> members are zero.</p></li>

   <li><p>Let <var>list</var> be the result of invoking
   <code>getClientRects()</code> on the same element this method was invoked
   on.</p></li>
   
   <li><p>If <var>list</var> is empty return a (static)
   <code>TextRectangle</code> object whose
   <code title="textrectangle-top">top</code>,
   <code title="textrectangle-right">right</code>,
   <code title="textrectangle-bottom">bottom</code> and
   <code title="textrectangle-left">left</code> members are zero.</p></li>

   <li><p>Otherwise, return a union of the border boxes in <var>list</var>,
   excluding border boxes that are empty, as a single
   <code>TextRectangle</code> object. If all border boxes are empty let the
   <code title="textrectangle-top">top</code> attribute of the new
   <code>TextRectangle</code> object be the value of the
   <code title="textrectangle-top">top</code> attribute of the first border
   box in the list returned. Do likewise for
   <code title="textrectangle-left">left</code> and then let
   <code title="textrectangle-bottom">bottom</code> be equal to
   <code title="textrectangle-bottom">top</code> and
   <code title="textrectangle-right">right</code> to
   <code title="textrectangle-left">left</code>.</p></li>
  </ol>



  <h2 id="the-htmlelementview-interface">The <code title="">HTMLElementView</code> Interface</h2>
  
  <p>Objects implementing the <code>HTMLElement</code> interface, as defined
  by HTML&nbsp;5, <em class="ct">must</em> also implement the
  <code>HTMLElementView</code> interface.
  [<cite><span>HTML5</span></cite>]</p>
  
  <pre class="idl">interface <dfn id="htmlelementview">HTMLElementView</dfn> {
  readonly attribute Element <span>offsetParent</span>;
  readonly attribute long <span>offsetTop</span>;
  readonly attribute long <span>offsetLeft</span>;
  readonly attribute long <span>offsetWidth</span>;
  readonly attribute long <span>offsetHeight</span>;

           attribute long <span>scrollTop</span>;   // scroll on setting
           attribute long <span>scrollLeft</span>;  // scroll on setting
  readonly attribute long <span>scrollWidth</span>;
  readonly attribute long <span>scrollHeight</span>;

  readonly attribute long <span>clientTop</span>;
  readonly attribute long <span>clientLeft</span>;
  readonly attribute long <span>clientWidth</span>;
  readonly attribute long <span>clientHeight</span>;
};</pre>


  <h3 id="offset-attributes">The <code title="">offsetParent</code>,
  <code title="">offsetTop</code>, <code title="">offsetLeft</code>, 
  <code title="">offsetWidth</code>, and <code title="">offsetHeight</code>
  attributes</h3>

  <p>The
  <dfn id="elementview-offsetparent"><code>offsetParent</code></dfn>
  attribute, when called on element <var>A</var>,
  <em class="ct">must</em> return the element determined by the following
  algorithm:</p>

  <ol>
   <li>
    <p>If any of the following holds true return <code>null</code> and stop
    this algorithm:</p>
    
    <ul>
     <li><var>A</var> is the root element.</li>

     <li><var>A</var> is <span>the HTML <code>body</code>
     element</span>.</li>

     <li>The computed value of the <code>position</code> property for
     element <var>A</var> is <code>fixed</code>.</li>
    </ul>
   </li>

   <li><p>If <var>A</var> is an <code>area</code> <span>HTML element</span>
   which has a <code>map</code> <span>HTML element</span> somewhere in the
   ancestor chain return the nearest ancestor <code>map</code>
   <span>HTML element</span> and stop this algorithm.</p></li>

   <li>
    <p>Return the nearest ancestor element of <var>A</var> for
    which at least one of the following is true and stop this algorithm if
    such an ancestor is found:</p>

    <ul>
     <li>The computed value of the <code>position</code> property is not
     <code>static</code>.</li>

     <li>It is <span>the HTML <code>body</code> element</span>.</li>

     <li>The computed value of the <code>position</code> property of
     <var>A</var> is <code>static</code> and the ancestor is one of the
     following <span title="HTML element">HTML elements</span>:
     <code>td</code>, <code>th</code>, or <code>table</code>.</li>
    </ul>
   </li>

   <li><p>Return <code>null</code>.</p></li>
  </ol>

  <p>The <dfn id="elementview-offsettop"><code>offsetTop</code></dfn>
  attribute, when called on element <var>A</var>,
  <em class="ct">must</em> return the value that is the result of the
  following algorithm:</p>

  <ol>
   <li><p>If element <var>A</var> is <span>the HTML <code>body</code>
   element</span>, has a computed value of the <code>display</code> property
   of <code>none</code>, or does not have an associated CSS layout box
   return zero and stop this algorithm.</p></li>

   <li><p>If the <code>offsetParent</code> of element <var>A</var> is
   <code>null</code> or <span>the HTML <code>body</code> element</span>
   return the y-coordinate of the top border edge of element <var>A</var>,
   as number of CSS pixels, and then stop this algorithm.</p></li>

   <li><p>Return the result of subtracting the y-coordinate of the top
   padding edge of the <code>offsetParent</code> of element <var>A</var>
   from the y-coordinate of the top border edge of element <var>A</var>,
   relative to the initial containing block origin, as number of CSS
   pixels.</p></li>
  </ol>

  <p>The <dfn id="elementview-offsetleft"><code>offsetLeft</code></dfn>
  attribute, when called on element <var>A</var>,
  <em class="ct">must</em> return the value that is the result of the
  following algorithm:</p>

  <ol>
   <li><p>If element <var>A</var> is <span>the HTML <code>body</code>
   element</span>, has a computed value of the <code>display</code> propery
   that is <code>none</code>, or does not have an associated CSS layout box
   return zero and stop this algorithm.</p></li>

   <li><p>If the <code>offsetParent</code> of element <var>A</var> is
   <code>null</code> or <span>the HTML <code>body</code> element</span>
   return the x-coordinate of the left border edge of element <var>A</var>,
   as number of CSS pixels, and then stop this algorithm.</p></li>

   <li><p>Return the result of subtracting the x-coordinate of the left
   padding edge of the <code>offsetParent</code> of element <var>A</var>
   from the x-coordinate of the left border edge of element <var>A</var>,
   relative to the initial containing block origin, as number of CSS
   pixels.</p></li>
  </ol>

  <!--
   When html:area has an html:map and that has an associated html:img

   The shape attribute is set to default
     offsetLeft and offsetTop are 0.
   The shape attribute is set to circle
     offsetLeft is the center-x value minus the radius and offsetTop is the center-y value minus the radius.
   The shape attribute is set to rect
   The shape attribute is set to poly
     offsetLeft is the minimum of all x values and offsetTop is the minimum of all y values.
   -->

  <p>The <dfn id="elementview-offsetwidth"><code>offsetWidth</code></dfn>
  attribute, when called on element <var>A</var>,
  <em class="ct">must</em> return value that is the result of the following
  algorithm:</p>
  
  <ol>
   <li><p>If element <var>A</var> does not have an associated CSS
   layout box return zero and stop this algorithm.</p></li>

   <li><p>Return the number of CSS pixels of the border box width of element
   <var>A</var>.</p></li>
  </ol>

  <p>The <dfn id="elementview-offsetheight"><code>offsetHeight</code></dfn>
  attribute, when called on element <var>A</var>,
  <em class="ct">must</em> return value that is the result of the following
  algorithm:</p>
  
  <ol>
   <li><p>If element <var>A</var> does not have an associated CSS
   layout box return zero and stop this algorithm.</p></li>

   <li><p>Return the number of CSS pixels of the border box height of element
   <var>A</var>.</p>
  </ol>


  <h3 id="scroll-attributes">The <code title="">scrollTop</code>,
  <code title="">scrollLeft</code>, <code title="">scrollWidth</code>, and
  <code title="">scrollHeight</code> attributes</h3>

  <p class="note">The definitions below make a distinction between content
  and content box dimensions.</p>

  <p>The <dfn id="elementview-scrolltop"><code>scrollTop</code></dfn>
  attribute, when called on element <var>A</var>, <em class="ct">must</em>
  return the value that is the result of running the following
  algorithm:</p>
  
  <ol>
   <li><p>If element <var>A</var> does not have an associated CSS
   layout box return zero and stop this algorithm.</p></li>

   <li><p>Return the y-coordinate of the content at the alignment point with
   the top of the content box of element <var>A</var>, as number of CSS
   pixels.</p></li>
  </ol>

  <p>When setting the <code>scrollTop</code> attribute to
  <var title="">y</var> on element <var>A</var> user agents
  <em class="ct">must</em> run the
  following algorithm:</p>

  <ol>
   <li><p>If element <var>A</var> does not have an associated CSS layout box
   or vertical overflow stop this algorithm.</p></li>

   <li><p>If <var title="">y</var> is negative act as if it was zero.</p></li>

   <li><p>If <var title="">y</var> is greater than the content height minus
   the content box height act as if it was the content height minus the
   content box height.</p></li>

   <li><p>Align y-coordinate <var title="">y</var> with the top of the
   content box of element <var>A</var>.</p></li>
  </ol>

  <p>The <dfn id="elementview-scrollleft"><code>scrollLeft</code></dfn>
  attribute, when called on element <var>A</var>,
  <em class="ct">must</em> return the value that is the result of running the
  following algorithm:</p>

  <ol>
   <li><p>If element <var>A</var> does not have an associated CSS
   layout box return zero and stop this algorithm.</p></li>

   <li><p>Return the x-coordinate of the content at the alignment point with
   the left of the content box of element <var>A</var>, as number of CSS
   pixels.</p></li>
  </ol>
  
  <p>When setting the <code>scrollLeft</code> attribute to <var title="">x</var>
  on element <var>A</var> user agents <em class="ct">must</em> run the
  following algorithm:</p>
  
  <ol>
   <li><p>If element <var>A</var> does not have an associated CSS layout box
   or horizontal overflow stop this algorithm.</p></li>

   <li><p>If <var title="">x</var> is negative act as if it was zero.</p></li>

   <li><p>If <var title="">x</var> is greater than the content width minus
   the content box width act as if it was the content width minus the
   content box width.</p></li>

   <li><p>Align x-coordinate <var title="">x</var> with the left of the
   content box of element <var>A</var>.</p></li>
  </ol>

  <p>The <dfn id="elementview-scrollwidth"><code>scrollWidth</code></dfn>
  attribute, when called on element <var>A</var>,
  <em class="ct">must</em> return value that is the result of the following
  algorithm:</p>
  
  <ol>
   <li><p>If element <var>A</var> does not have an associated CSS
   layout box return zero and stop this algorithm.</p></li>

   <li><p>Return the computed value of the <code>padding-left</code> property
   of element <var>A</var>, plus the computed value of the <code>padding-right</code>
   property of element <var>A</var>, plus the combined width of the margin box
   children of element <var>A</var> subtracting all the collapsed margins of
   those children, as number of CSS pixels.</p></li>
  </ol>
  <!-- XXX content height? --> 

  <p>The <dfn id="elementview-scrollheight"><code>scrollHeight</code></dfn>
  attribute, when called on element <var>A</var>,
  <em class="ct">must</em> return value that is the result of the following
  algorithm:</p>

  <ol>
   <li><p>If element <var>A</var> does not have an associated CSS
   layout box return zero and stop this algorithm.</p></li>

   <li><p>Return the computed value of the <code>padding-top</code> property
   of element <var>A</var>, plus the computed value of the <code>padding-bottom</code>
   property of element <var>A</var>, plus the combined height of the margin box
   children of element <var>A</var> subtracting all the collapsed margins
   of those children, as number of CSS pixels.</p></li>
  </ol>
  <!-- XXX content width? -->

  <!-- for inline boxes offsetWidth and offsetHeight are identical to offset* -->


  <h3 id="client-attributes">The <code title="">clientTop</code>,
  <code title="">clientLeft</code>, <code title="">clientWidth</code>, and
  <code title="">clientHeight</code> attributes</h3>

  <p>The <dfn id="elementview-clienttop"><code>clientTop</code></dfn>
  attribute, when called on element <var>A</var>,
  <em class="ct">must</em> return the result of the following algorithm:</p>

  <ol>
   <li><p>If element <var>A</var> does not have an associated CSS
   layout box or if it is an inline box return zero and stop this
   algorithm.</p></li>

   <li><p>Return the computed value of the <code>border-top-width</code>
   property as number of CSS pixels plus the width of any scrollbar rendered
   between the top padding box and top border box as number of CSS
   pixels.</p></li>
  </ol>

  <p>The <dfn id="elementview-clientleft"><code>clientLeft</code></dfn>
  attribute, when called on element <var>A</var>,
  <em class="ct">must</em> return the result of the following algorithm:</p>

  <ol>
   <li><p>If element <var>A</var> does not have an associated CSS
   layout box or if it is an inline box return zero and stop this
   algorithm.</p></li>

   <li><p>Return the computed value of the <code>border-left-width</code>
   property as number CSS pixels plus the width of any scrollbar rendered
   between the left padding box and left border box as number of CSS
   pixels.</p></li>
  </ol>

  <p>The <dfn id="elementview-clientwidth"><code>clientWidth</code></dfn>
  attribute, when called on element <var>A</var>,
  <em class="ct">must</em> return the result of the following algorithm:</p>

  <ol>
   <li><p>If element <var>A</var> does not have an associated CSS
   layout box or if it is an inline box return zero and stop this
   algorithm.</p></li>

   <li><p>If element <var>A</var> is the root element return the width of
   the viewport as number of CSS pixels and stop this algorithm.</p></li>

   <li><p>Return the width of the padding box of element <var>A</var>
   (excluding the width of any rendered scrollbar between the padding and
   border box) as number of CSS pixels.</p></li>
  </ol>

  <p>The <dfn id="elementview-clientheight"><code>clientHeight</code></dfn>
  attribute, when called on element <var>A</var>,
  <em class="ct">must</em> return the result of the following algorithm:</p>
  
  <ol>
   <li><p>If element <var>A</var> does not have an associated CSS
   layout box or if it is an inline box return zero and stop this
   algorithm.</p></li>

   <li><p>If element <var>A</var> is the root element return the height of
   the viewport as number of CSS pixels and stop this algorithm.</p></li>

   <li><p>Return the height of the padding box of element <var>A</var>
   (excluding the width of any rendered scrollbar between the padding and
   border box) as number of CSS pixels.</p></li>
  </ol>



  <h2 id="the-rangeview-interface">The <code title="">RangeView</code> Interface</h2>

  <p>Objects implementing the <code>Range</code> interface, as defined by
  DOM Level 2 Traversal and Range, <em class="ct">must</em> also implement
  the <code>RangeView</code> interface.
  [<cite><span>DOM2TR</span></cite>]</p>

  <pre class="idl">interface <dfn>RangeView</dfn> {
  <span>TextRectangleList</span> <span title="rangeview-getclientrects">getClientRects</span>();
  <span>TextRectangle</span> <span title="rangeview-getboundingclientrect">getBoundingClientRect</span>();
};</pre>

  <p>The
  <dfn id="rangeview-getclientrects" title="rangeview-getclientrects"><code>getClientRects()</code></dfn>
  method, when invoked, <em class="ct">must</em> return an empty (static)
  <code>TextRectangleList</code> object if the range is empty (if the
  boundary-points are identical) and otherwise a (static)
  <code>TextRectangleList</code> object based on the following
  conditions:</p>
  
  <ul>
   <li>For each element selected by the range, whose parent is not selected
   by the range, include the border boxes returned by invoking
   <code>getClientRects()</code> on the element.</li>
   
   <li>For each <code>Text</code> node selected or partially selected by the
   range, include a <code>TextRectangle</code> object for each CSS box
   associated with the text in the range (the part that is selected, not the
   whole line box). The bounds of these <code>TextRectangle</code> objects
   are computed using font metrics; thus, for horizontal writing, the
   vertical dimension of each box is determined by the font ascent and
   descent, and the horizontal dimension by the text advance width.</li>
   
   <li>The <code>TextRectangle</code> objects are in content order.</li>
  </ul>

  <p>The
  <dfn id="rangeview-getboundingclientrect" title="rangeview-getboundingclientrect"><code>getBoundingClientRect()</code></dfn>
  method, when invoked, <em class="ct">must</em> return the result of the
  following algorithm:</p>
  
  <ol>
   <li><p>Let <var>list</var> be the result of invoking
   <code title="rangeview-getclientrects">getClientRects()</code> on the
   same range this method was invoked on.</p></li>
   
   <li><p>If <var>list</var> is empty return a (static)
   <code>TextRectangle</code> object whose
   <code title="textrectangle-top">top</code>,
   <code title="textrectangle-right">right</code>,
   <code title="textrectangle-bottom">bottom</code> and
   <code title="textrectangle-left">left</code> members are zero.</p></li>

   <li><p>Otherwise, return a union of the boxes in <var>list</var>,
   excluding boxes that are empty, as a single <code>TextRectangle</code>
   object. If all boxes are empty let the
   <code title="textrectangle-top">top</code> attribute of the new
   <code>TextRectangle</code> object be the value of the
   <code title="textrectangle-top">top</code> attribute of the first border
   box in the list returned. Do likewise for
   <code title="textrectangle-left">left</code> and then let
   <code title="textrectangle-bottom">bottom</code> be equal to
   <code title="textrectangle-bottom">top</code> and
   <code title="textrectangle-right">right</code> to
   <code title="textrectangle-left">left</code>.</p></li>
  </ol>




  <h2 id="the-mouseeventview-interface">The <code title="">MouseEventView</code> Interface</h2>

  <p>Objects implementing the <code>MouseEvent</code> interface, as defined
  by DOM Level 2 Events, <em class="ct">must</em> also implement the
  <code>MouseEventView</code> interface. In case of conflict with the
  <code>MouseEvent</code> interface the implementation of the conflicting
  members <em class="ct">must</em> be as prescribed by this specification.
  [<cite><span>DOM2Events</span></cite>]</p>

  <pre class="idl">interface <dfn>MouseEventView</dfn> {
  readonly attribute long <span title="mouseeventview-screenx">screenX</span>;
  readonly attribute long <span title="mouseeventview-screeny">screenY</span>;

  readonly attribute long <span>pageX</span>;
  readonly attribute long <span>pageY</span>;

  readonly attribute long <span>clientX</span>;
  readonly attribute long <span>clientY</span>;

  readonly attribute long <span>offsetX</span>;
  readonly attribute long <span>offsetY</span>;

  // historical; equivalent to clientX, clientY
  readonly attribute long <span title="mouseeventview-x">x</span>;
  readonly attribute long <span title="mouseeventview-y">y</span>;
};</pre>

  <p>The
  <dfn id="mouseeventview-screenx" title="mouseeventview-screenx"><code>screenX</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the x-coordinate,
  as number of CSS pixels, of the position where the event occurred relative
  to the origin of the screen.</p>

  <p>The
  <dfn id="mouseeventview-screeny" title="mouseeventview-screeny"><code>screenY</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the y-coordinate,
  as number of CSS pixels, of the position where the event occurred relative
  to the origin of the screen.</p>
  
  <p>The <dfn id="mouseeventview-pagex"><code>pageX</code></dfn> attribute,
  on getting, <em class="ct">must</em> return the horizontal coordinate, as
  number of CSS pixels, of the position where the event occurred relative to
  the origin of the initial containing block.</p>

  <p>The <dfn id="mouseeventview-pagey"><code>pageY</code></dfn> attribute,
  on getting, <em class="ct">must</em> return the y-coordinate, as number of
  CSS pixels, of the position where the event occurred relative to the
  origin of the initial containing block.</p>
  
  <p>The <dfn id="mouseeventview-clientx"><code>clientX</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the x-coordinate,
  as number of CSS pixels, of the position where the event occurred relative
  to the origin of the viewport.</p>

  <p>The <dfn id="mouseeventview-clienty"><code>clientY</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the y-coordinate,
  as number of CSS pixels, of the position where the event occurred relative
  to the origin of the viewport.</p>
  
  <p>The <dfn id="mouseeventview-offsetx"><code>offsetX</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the x-coordinate,
  as number of CSS pixels, of the position where the event
  occurred relative to the origin of the padding box of the target
  node.</p>

  <p>The <dfn id="mouseeventview-offsety"><code>offsetY</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the y-coordinate,
  as number of CSS pixels, of the position where the event
  occurred relative to the origin of the padding box of the target
  node.</p>

  <p>The
  <dfn id="mouseeventview-x" title="mouseeventview-x"><code>x</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the value of
  <code>clientX</code>.</p>

  <p>The
  <dfn id="mouseeventview-y" title="mouseeventview-y"><code>y</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the value of
  <code>clientY</code>.</p>

  <p class="note">The <code title="mouseeventview-x">x</code> and
  <code title="mouseeventview-y">y</code> attributes are included for
  historical reasons.</p>


  <h2>Rectangles</h2>


  <h3 id="the-textrectanglelist-interface">The <code title="">TextRectangleList</code> Interface</h3>

  <p>The <code>TextRectangleList</code> object consists of an ordered list
  of <code>TextRectangle</code> objects.</p>

  <pre class="idl">interface <dfn>TextRectangleList</dfn> {
  readonly attribute unsigned long <span title="textrectanglelist-length">length</span>;
  <span>TextRectangle</span> <span title="textrectanglelist-item">item</span>(in unsigned long <var title="">index</var>);
};</pre>

  <p>The
  <dfn id="textrectanglelist-length" title="textrectanglelist-length"><code>length</code></dfn>
  attribute <em class="ct">must</em> return the total number of
  <code>TextRectangle</code> objects associated with the object.</p>

  <p>The
  <dfn id="textrectanglelist-item" title="textrectanglelist-item"><code>item(<var title="">index</var>)</code></dfn>
  method, when invoked, <em class="ct">must</em> raise an
  <code>INDEX_SIZE_ERR</code> exception when <var title="">index</var> is
  negative or greater than the number of <code>TextRectangle</code> objects
  associated with the object. Otherwise, the <code>TextRectangle</code>
  object at <var title="">index</var> <em class="ct">must</em> be
  returned.</p>

  <p>In ECMAScript implementations, objects that implement the
  <code>TextRectangleList</code> interface <em class="ct">must</em> also
  have a <code>[[Get]]</code> method that, when invoked with a number, acts
  like the <code title="textrectanglelist-item">item()</code> method would
  when invoked with that argument.</p>


  <h3 id="the-textrectangle-interface">The <code title="">TextRectangle</code> Interface</h3>

  <p>Objects implementing the <code>TextRectangle</code> interface represent
  a rectangular box. The type of box is specified by the method that returns
  a <code>TextRectangle</code> object.</p>

  <pre class="idl">interface <dfn>TextRectangle</dfn> {
  readonly attribute float <span title="textrectangle-top">top</span>;
  readonly attribute float <span title="textrectangle-right">right</span>;
  readonly attribute float <span title="textrectangle-bottom">bottom</span>;
  readonly attribute float <span title="textrectangle-left">left</span>;
};</pre>

  <p>The
  <dfn id="textrectangle-top" title="textrectangle-top"><code>top</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the y-coordinate,
  relative to the viewport origin, of the top of the rectangle box as number
  of CSS pixels.</p>

  <p>The
  <dfn id="textrectangle-right" title="textrectangle-right"><code>right</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the x-coordinate,
  relative to the viewport origin, of the right of the rectangle box as
  number of CSS pixels.</p>

  <p>The
  <dfn id="textrectangle-bottom" title="textrectangle-bottom"><code>bottom</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the y-coordinate,
  relative to the viewport origin, of the bottom of the rectangle box as
  number of CSS pixels.</p>

  <p>The
  <dfn id="textrectangle-left" title="textrectangle-left"><code>left</code></dfn>
  attribute, on getting, <em class="ct">must</em> return the x-coordinate,
  relative to the viewport origin, of the left of the rectangle box as
  number of CSS pixels.</p>

  <!-- XXX svg:foreignObject is not defined anywhere for practical purpose
  <p class="note">The <code>svg:foreignObject</code> element represents an
  initial containing block for its descendents.</p>
  -->


  <h2 class="no-num">References</h2>

  <p>All references are normative<!--, unless stated otherwise-->.</p>

  <dl>
   <dt>[<dfn id="ref-css21">CSS21</dfn>]</dt>
   <dd><cite><a href="http://www.w3.org/TR/CSS21">Cascading Style Sheets
   Level 2 Revision 1</a></cite>, B. Bos, T. &Ccedil;elik, I. Hickson, H.
   Wium Lie, editors. W3C, June 2007.</dd>

   <dt>[<dfn id="ref-dom2events">DOM2Events</dfn>]</dt>
   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-2-Events/">Document
   Object Model (DOM) Level 2 Events Specification</a></cite>, T. Pixley,
   editor. W3C, November 2000.</dd>

   <dt>[<dfn id="ref-dom2tr">DOM2TR</dfn>]</dt>
   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-2-Traversal-Range/">Document
   Object Model (DOM) Level 2 Traversal and Range Specification</a></cite>,
   J. Kesselman, J. Robie, M. Champion, P. Sharpe, V. Apparao, L. Wood,
   editors. W3C, November 2000.</dd>

   <dt>[<dfn id="ref-dom3core">DOM3Core</dfn>]</dt>
   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-3-Core">Document Object
   Model (DOM) Level 3 Core Specification</a></cite>, A. Le Hors, P. Le
   H&eacute;garet, L. Wood, G. Nicol, J. Robie, M. Champion, S. Byrne,
   editors. W3C, April 2004.</dd>

   <dt>[<dfn id="ref-html5">HTML5</dfn>]</dt>
   <dd><cite><a href="http://www.w3.org/html/wg/html5/">HTML&nbsp;5</a></cite>
   (work in progress), I. Hickson, D. Hyatt, editors. W3C, 2008.</dd>
   <dd><cite><a href="http://www.whatwg.org/specs/web-apps/current-work/">HTML&nbsp;5</a></cite>
   (work in progress), I. Hickson, editor. WHATWG, 2008.</dd>

   <dt>[<dfn id="ref-rfc2119">RFC2119</dfn>]</dt>
   <dd><cite><a href="http://ietf.org/rfc/rfc2119">Key words for use in RFCs to
   Indicate Requirement Levels</a></cite>, S. Bradner. IETF, March 1997.</dd>
  </dl>

  <h2 class="no-num">Acknowledgments</h2>

  <p>The editor would like to thank

  Alexey Feldgendler,
  David Vest,
  Hallvord R. M. Steen, 
  Morten Stenshorne,
  Peter-Paul Koch,
  Robert O'Callahan,
  Simon Pieters, and
  Tarquin Wilton-Jones

  for their contributions to this document.</p>

  <p>Special thanks to the Microsoft employees who first implemented many of
  the features specified in this draft, which were first widely deployed by
  the Windows Internet Explorer browser.</p>
 </body>
</html>
