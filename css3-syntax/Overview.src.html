<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">
<!-- vim:expandtab:tabstop=2:shiftwidth=2:textwidth=72:
  -->
<html>
<!-- the command line to process is this is:

num -l 2 template.html | toc -l 2 | incl | xref | index |\
perl -I../bin ../bin/propindex | cite-mkbib ../biblio.ref \
>template-processed.html


To do: add longdesc

-->
<head>
  <title>CSS3 module: Syntax</title>
  <link rel="stylesheet" type="text/css" href="http://www.w3.org/Style/Group/css3-src/default.css">
  <link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/TR/W3C-MO">
</head>

<body>

<div class="head">
<p><a class="logo" rel="home" href="http://www.w3.org/"><img height="48"
width="72" alt="W3C " src="http://www.w3.org/Icons/w3c_home"></a><a
class="logo" rel="in-activity" href="../"><img
src="../../../Woolly/woolly-icon.png" height="48" width="72"
alt="CSS WG "></a></p>

<h1>CSS3 module: Syntax</h1>

<h2 class="no-num no-toc">W3C Working Draft, [07 Jul 2003]</h2>
<dl>
  <dt>This version:</dt>
    <dd><a
      href="[http://www.w3.org/ThisVersionURI]">[http://www.w3.org/ThisVersionURI]</a></dd>
  <dt>Latest version:</dt>
    <dd><a
      href="[http://www.w3.org/LatestVersionURI]">[http://www.w3.org/LatestVersionURI]</a></dd>
  <dt>Previous version:</dt>
    <dd><a
      href="[http://www.w3.org/PreviousVersionURI]">[http://www.w3.org/PreviousVersionURI]</a></dd>
  <dt>Editor:</dt>
    <dd>L. David Baron, &lt;<a href="mailto:dbaron@dbaron.org">dbaron@dbaron.org</a>&gt;</dd>
  <dt>Additional Contributors:</dt>
	<dd>Original CSS2 Authors</dd>
	<dd>Bert Bos (W3C), &lt;<a href="mailto:bert@w3.org">bert@w3.org</a>&gt;</dd>
	<dd>Peter Linss (Netscape)</dd>
</dl>
<!--begin-include "../copyright.inc"-->

<p>[Here will be included the file "../copyright.inc"]</p>
<!--end-include-->
<hr title="Separator for header">
</div>

<h2 class="no-num no-toc" id="abstract">Abstract</h2>

<p>This CSS3 module describes the basic structure of CSS style sheets,
some of the details of the syntax, and the rules for parsing CSS
style sheets.  Additional details of the syntax of some parts of CSS
described in other modules will be described in those modules.  The
selectors module has a grammar for selectors.  Modules that define
properties give the grammar for the values of those properties, in a
format described in this document.</p>

<h2 class="no-num no-toc" id="status">Status of this document</h2>

<p>
This document is a draft of one of the "modules" for the upcoming CSS3
specification.
</p>
<p>This document is a working draft of the CSS &amp; FP working group
which is part of the <a href="http://www.w3.org/Style/">style
activity</a>.
</p>
<p>The working group would like to receive feedback: comments on this draft may 
  be sent to one of the editors, discussion takes place on the (<a href="http://lists.w3.org/Archives/Public/www-style/">archived</a>) 
  public mailing list <a href="http://www.w3.org/Mail/Lists.html#www-style">www-style@w3.org</a> (see <a href="http://www.w3.org/Mail/Request">instructions</a>). W3C Members 
  can also send comments directly to the CSS &amp; FP working group. </p>
<p>This working draft may be updated, replaced or rendered obsolete by
other W3C documents at any time. It is inappropriate to use W3C
Working Drafts as reference material or to cite them as other than
"work in progress". Its publication does not imply endorsement by the
W3C membership or the <a href="http://www.w3.org/Style/Group">CSS &amp FP Working Group</a> (<a href="http://cgi.w3.org/MemberAccess/AccessRequest">members only</a>).
</p>

<p>A list of current W3C Recommendations and other technical documents
including Working Drafts and Notes can be found at <a
href="http://www.w3.org/TR">http://www.w3.org/TR</a>.</p>

<h2 class="no-num no-toc" id="contents">Table of contents</h2>
<!--toc-->
<hr>


<h2>Dependencies on other modules</h2>

<p>This CSS3 module
depends on the following other CSS3 modules:</p>
<ul>
  <li>Selectors [[!SELECT]]</li>
  <li>CSS3 module: Values &amp; Units [[!CSS3VAL]]</li>
  <li>CSS3 module: Cascading &amp; Inheritance [[!CSS3CASCADE]]</li>
</ul>

<p>It has non-normative (informative) references to the following other
CSS3 modules:</p>
<ul>
  <li>Media queries [[MEDIAQ]]</li>
  <li>Generated Content [[CSS3GENCON]]</li>
</ul>

<h2>Introduction</h2>

<p>This specification describes the basic syntax of CSS3 and the syntax
conventions used in the property definitions spread through the CSS3
modules.  The syntax of CSS3 has some error-handling requirements for
forward-compatibility, but much of the error-handling behavior is
user-agent dependent.</p>

<h2>CSS style sheet representation</h2>

<p>A CSS style sheet is a sequence of characters from the Universal
Character Set (see [[!ISO10646]]). For transmission and storage, these
characters must be <span class="index-def" title="character
encoding">encoded</span> by a character encoding that supports the set
of characters available in US-ASCII (e.g., ISO 8859-x, SHIFT JIS, etc.).
A <span id="BOM" class="index-inst">byte order mark (BOM)</span>, as described in
section 2.7 of [[!UNICODE310]], that begins the sequence of characters
should not be considered, for purposes of applying the grammar below, as
a part of the style sheet.  For a good introduction to character sets and
character encodings, please consult the HTML 4.0 specification
([[!HTML40]], chapter 5), See also the XML 1.0 specification ([[XML10]],
sections 2.2 and 4.3.3, and <span class="issue">[where is the property
index going to be?]</span>.

<p>When a style sheet is embedded in another document, such as in the
STYLE element or "style" attribute of HTML, the style sheet shares the
character encoding of the whole document.

<p>When a style sheet resides in a separate file, user agents must
observe the following <span class="index-inst" title="character
encoding::user agent's determination of">priorities</span> when
determining a style sheet's <span class="index-inst" title="character
encoding::default|default::character encoding">character
encoding</span> (from highest priority to lowest):</p>

<ol>
<li>A character set specified by a higher level protocol (e.g., the
"charset" parameter to the MIME type specified in an HTTP "Content-Type"
field).
(The HTTP protocol ([[HTTP11]], section 3.7.1) mentions ISO-8859-1 as a
default character encoding when the "charset" parameter is absent from
the "Content-Type" header field. In practice, this recommendation has
proved useless because some servers don't allow a "charset" parameter to
be sent, and others may not be configured to send the parameter.
Therefore, user agents must not assume any default value for the
"charset" parameter, but must instead look for the <span
class="index-inst" title="@charset">@charset</span> rule.)
</li>
<li>The <span class="index-def" title="@charset">@charset</span>
at-rule.</li>
<li>Assume that the stylesheet is UTF-8.</li>
</ol>

<p>Since the third point differs from CSS1 and CSS2, authors should not
rely on user agents to assume that stylesheets without encoding
information are UTF-8 encoded.  Authors should specify the encoding
using one of the first two methods.</p>

<p>At most one @charset rule may appear in an external
style sheet -- it must <em>not</em> appear in an embedded style sheet
-- and it must appear at the very start of the style sheet, not preceded
by any characters (except for the optional Byte Order Mark <a
href="#BOM">described
above)</a>. After "@charset", authors specify the name of a
character encoding. The name must be a charset name as described in
the IANA registry (See [[!RFC2978]]. Also, see [[CHARSETS]] for a complete
list of charsets). For example:</p>

<div class="example"><p>
@charset "ISO-8859-1";
</div>

<p>This specification does not mandate which character encodings
a user agent must support.
<span class="issue">Should we require a certain minimal set, such as
UTF-8 and UCS2?</span>
</p>

<p>Note that reliance on the @charset construct theoretically poses a
problem since there is no <em>a priori</em> information on how it is
encoded. In practice, however, the encodings in wide use on the
Internet are either based on ASCII, UTF-16, UCS-4, or (rarely) on
EBCDIC.  This means that in general, the initial byte values of a
style sheet enable a user agent to detect the encoding family reliably,
which provides enough information to decode the @charset rule, which
in turn determines the exact character encoding.


<!-- More examples of good encodings to use? -IJ -->

<!-- Encodings not to use? (cf. HTML 4.0) -IJ -->

<h3>Referring to characters not represented in a character encoding</h3>

<p>A style sheet may have to refer to characters that cannot be
represented in the current character encoding.  These characters must
be written as <a href="#escaped-characters">escaped</a> references to
ISO 10646 characters. These escapes serve the same purpose as numeric
character references in HTML or XML documents (see [[!HTML40]],
chapters 5 and 25).

<p>The character escape mechanism should be used when only a few
characters must be represented this way. If most of a style sheet
requires escaping, authors should encode it with a more appropriate
encoding (e.g., if the style sheet contains a lot of Greek characters,
authors might use "ISO-8859-7" or "UTF-8").

<p>Intermediate processors using a different character encoding may
translate these escaped sequences into byte sequences of that
encoding. Intermediate processors must not, on
the other hand, alter escape sequences that cancel the special meaning
of an ASCII character.

<p><a href="conform.html#conformance">Conforming user agents</a> must
correctly map to Unicode all characters in any character encodings
that they recognize (or they must behave as if they did).

<p>For example, a style sheet transmitted as ISO-8859-1
(Latin-1) cannot contain Greek letters directly:
"&#954;&#959;&#965;&#961;&#959;&#962;" (Greek: "kouros") has to be
written as "\3BA\3BF\3C5\3C1\3BF\3C2".

<div class="note"><p>
<em><strong>Note.</strong>
In HTML 4.0,
numeric character references are interpreted in "style" attribute
values but not in the content of the STYLE element. Because of this
asymmetry, we recommend that authors use the CSS character
escape mechanism rather than numeric character references
for both the "style" attribute and the STYLE element.
For example, we recommend:</em></p>

<pre class="html-example">
&lt;SPAN style="voice-family: D\FC rst"&gt;...&lt;/SPAN&gt;
</pre>

<p><em>rather than:</em></p>

<pre class="html-example">
&lt;SPAN style="voice-family: D&amp;#252;rst"&gt;...&lt;/SPAN&gt;
</pre>
</div>

<h3 id="text-css" class="index-def" title="text/css">The text/css content type</h3>

<p>CSS style sheets that exist in separate files are sent over the
Internet as a sequence of bytes accompanied by encoding
information<!--(see [[HTML40]], chapter 5)-->. The structure of the
transmission, termed a <span class="index-def" title="message
entity"><a name="message-entity"><strong>message
entity,</strong></a></span> is defined by MIME and HTTP 1.1 (see
[[!RFC2045]] and [[!HTTP11]]). A message entity with a content type of
"text/css" represents an independent CSS style sheet. The "text/css"
content type has been registered by RFC 2318 ([[!RFC2318]]).</p>

<h2 id="syntax">General syntax of CSS</h2>

<p>This section describes a grammar (and <span class="index-def"
title="forward-compatible parsing"><dfn>forward-compatible
parsing</dfn></span> rules) common to any version of CSS (including
CSS3).  Future versions of CSS will adhere to this core syntax, although
they may add additional syntactic constraints.</p>

<p>See the <a href="#characters">section on characters and case</a> for
information on case-sensitivity.</p>

<p>These descriptions are normative.

<h3 id="characters">Characters and case</h3>
<p>  The following rules always hold:</p>

<UL>
    <LI> All CSS style sheets are <span class="index-inst" title="case
    sensitivity">case-insensitive</span>, except for parts that are
    not under the control of CSS. For example, the case-sensitivity of
    values of the HTML attributes "id" and "class", of font names, and
    of URIs lies outside the scope of this specification. Note in
    particular that element names are case-insensitive in HTML, but
    case-sensitive in XML.

    <LI> In CSS3, <span class="index-def"
    title="identifier|identifier, definition of"><a
    name="value-def-identifier"><dfn>identifiers</dfn></a></span>
    (including element names, classes, and IDs in <a
    href="selector.html">selectors</a>) can contain only the
    characters [A-Za-z0-9] and ISO 10646 characters 161 and higher,
    plus the hyphen (-); they cannot start with a hyphen or a
    digit. They can also contain escaped characters and any ISO 10646
    character as a numeric code (see next item).
    <span class="example">For instance, the identifier "B&amp;W?" may
    be written as "B\&amp;W\?" or "B\26 W\3F".</span>
    <p>Note that Unicode is code-by-code equivalent to ISO 10646 (see
    [[!UNICODE310]] and [[!ISO10646]]).

    <LI> In CSS3, a backslash (\) character indicates three types of
    <span class="index-def" title="backslash escapes">
    <a name="escaped-characters">character escapes</a></span>.

    <p>First, inside a <a href="#strings">string</a>, a backslash
    followed by a newline is ignored (i.e., the string is deemed not
    to contain either the backslash or the newline).

    <p>Second, it cancels the meaning of special CSS characters.
        Any character (except a hexadecimal digit) can be escaped
        with a backslash to remove its special meaning.
        For example, <samp>"\""</samp> is a string consisting of one
        double quote. Style sheet preprocessors must not remove
       these backslashes from a style sheet since that would
       change the style sheet's meaning.

    <p>Third, backslash escapes allow authors to refer to characters
    they can't easily put in a style sheet. In this case, the backslash
    is followed by at most six hexadecimal digits (0..9A..F), which
    stand for the ISO 10646 ([[!ISO10646]]) character with
    that number. If a digit or letter follows the hexadecimal number,
    the end of the number needs to be made clear. There are two ways
    to do that:

    <ol>
    <li>with a space (or other whitespace character): "\26 B" ("&amp;B").
        In this case, user agents should treat a "CR/LF" pair 
        (13/10) as a single
        whitespace character.
    <li>by providing exactly 6 hexadecimal digits: "\000026B" ("&amp;B")
    </ol>

    <p>In fact, these two methods may be combined. Only one whitespace
    character is ignored after a hexadecimal escape. Note that this means
    that a "real" space after the escape sequence must itself either be
    escaped or doubled.

    <LI>Backslash escapes are always considered to be part of an <a
    href="#value-def-identifier">identifier</a> or a string (i.e.,
    "\7B" is not punctuation, even though "{" is, and "\32" is allowed
    at the start of a class name, even though "2" is not).
  </UL>

<h3 id="tokenization">Tokenization</h3>

<p class="issue">This needs to be integrated with the selectors module.
How should that be done?</p>

<p>All levels of CSS -- level 1, level 2, level 3, and any future levels
-- use the same core syntax. This allows UAs to parse (though not
completely understand) style sheets written in levels of CSS that didn't
exist at the time the UAs were created. Designers can use this feature
to create style sheets that work with older user agents, while also
exercising the possibilities of the latest levels of CSS.</p>

<p>At the lexical level, CSS style sheets consist of a sequence of
tokens.  Hexadecimal codes (e.g., <code>#x20</code>) refer to ISO 10646
([[!ISO10646]]).  In case of multiple matches, the longest match
determines the token.</p>

<p>The following productions are <em>parts</em> of tokens:</p>

<p class="issue">We need something to allow signs on integers.  Do we need to
go as far as css3-selectors?</p>

<table>
<tr><td id="SUBTOK-ident">ident	<td>::=<td><code><a href="#SUBTOK-nmstart">nmstart</a> <a href="#SUBTOK-nmchar">nmchar</a>*</code>
<tr><td id="SUBTOK-name">name	<td>::=<td><code><a href="#SUBTOK-nmchar">nmchar</a>+</code>
<tr><td id="SUBTOK-nmstart">nmstart	<td>::=<td><code>[a-zA-Z] | '-' | '_' | <a href="#SUBTOK-nonascii">nonascii</a> | <a href="#SUBTOK-escape">escape</a></code>
<tr><td id="SUBTOK-nonascii">nonascii	<td>::=<td><code>[#x80-#xD7FF#xE000-#xFFFD#x10000-#x10FFFF]</code>
<tr><td id="SUBTOK-unicode">unicode	<td>::=<td><code>'\' [0-9a-fA-F]{1,6} <a href="#SUBTOK-wc">wc</a>?</code>
<tr><td id="SUBTOK-escape">escape	<td>::=<td><code><a href="#SUBTOK-unicode">unicode</a> | '\' [#x20-#x7E#x80-#xD7FF#xE000-#xFFFD#x10000-#x10FFFF]</code>
<tr><td id="SUBTOK-nmchar">nmchar	<td>::=<td><code>[a-zA-Z0-9] | '-' | '_' | <a href="#SUBTOK-nonascii">nonascii</a> | <a href="#SUBTOK-escape">escape</a></code>
<tr><td id="SUBTOK-num">num	<td>::=<td><code>[0-9]+ | [0-9]* '.' [0-9]+</code>
<tr><td id="SUBTOK-string">string	<td>::=<td><code>'"' (<a href="#SUBTOK-stringchar">stringchar</a> | "'")* '"' | "'" (<a href="#SUBTOK-stringchar">stringchar</a> | '"')* "'"</code>
<tr><td id="SUBTOK-stringchar">stringchar <td>::=<td><code><a href="#SUBTOK-urlchar">urlchar</a> | #x20 | '\' <a href="#SUBTOK-nl">nl</a></code>
<tr><td id="SUBTOK-urlchar">urlchar <td>::=<td><code>[#x9#x21#x23-#x26#x27-#x7E] | <a href="#SUBTOK-nonascii">nonascii</a> | <a href="#SUBTOK-escape">escape</a></code>
<tr><td id="SUBTOK-nl">nl	<td>::=<td><code>#xA | #xD #xA | #xA | #xC</code>
<tr><td id="SUBTOK-w">w	<td>::=<td><code><a href="#SUBTOK-wc">wc</a>*</code>
<tr><td id="SUBTOK-wc">wc	<td>::=<td><code>#x9 | #xA | #xC | #xD | #x20</code>
</table>


<p>The following productions are the complete list of tokens in
CSS3:</p>

<table>
<tr><td id="TOK-IDENT">IDENT	<td>::=<td><code><a href="#SUBTOK-ident">ident</a></code>
<tr><td id="TOK-ATKEYWORD">ATKEYWORD	<td>::=<td><code>'@' <a href="#SUBTOK-ident">ident</a></code>
<tr><td id="TOK-STRING">STRING	<td>::=<td><code><a href="#SUBTOK-string">string</a></code>
<tr><td id="TOK-HASH">HASH	<td>::=<td><code>'#' <a href="#SUBTOK-name">name</a></code>
<tr><td id="TOK-NUMBER">NUMBER	<td>::=<td><code><a href="#SUBTOK-num">num</a></code>
<tr><td id="TOK-PERCENTAGE">PERCENTAGE	<td>::=<td><code><a href="#SUBTOK-num">num</a> '%'</code>
<tr><td id="TOK-DIMENSION">DIMENSION	<td>::=<td><code><a href="#SUBTOK-num">num</a> <a href="#SUBTOK-ident">ident</a></code>
<tr><td id="TOK-URI">URI	<td>::=<td><code>"url(" <a href="#SUBTOK-w">w</a> (<a href="#SUBTOK-string">string</a> | <a href="#SUBTOK-urlchar">urlchar</a>* ) <a href="#SUBTOK-w">w</a> ")"</code>
<tr><td id="TOK-UNICODE-RANGE">UNICODE-RANGE	<td>::=<td><code>"U+" [0-9A-F?]{1,6} ('-' [0-9A-F]{1,6})?</code>
<tr><td id="TOK-CDO">CDO	<td>::=<td><code>"&lt;!--"</code>
<tr><td id="TOK-CDC">CDC	<td>::=<td><code>"--&gt;"</code>
<tr><td id="TOK-S">S	<td>::=<td><code><a href="#SUBTOK-wc">wc</a>+</code>
<tr><td id="TOK-COMMENT">COMMENT	<td>::=<td><code>"/*" [^*]* '*'+ ([^/] [^*]* '*'+)* "/"</code>
<tr><td id="TOK-FUNCTION">FUNCTION	<td>::=<td><code><a href="#SUBTOK-ident">ident</a> '('</code>
<tr><td id="TOK-INCLUDES">INCLUDES	<td>::=<td><code>"~="</code>
<tr><td id="TOK-DASHMATCH">DASHMATCH	<td>::=<td><code>"|="</code>
<tr><td id="TOK-PREFIXMATCH">PREFIXMATCH	<td>::=<td><code>"^="</code>
<tr><td id="TOK-SUFFIXMATCH">SUFFIXMATCH	<td>::=<td><code>"$="</code>
<tr><td id="TOK-SUBSTRINGMATCH">SUBSTRINGMATCH	<td>::=<td><code>"*="</code>
<tr><td id="TOK-CHAR">CHAR	<td>::=<td>any other character not matched by the above rules, except for <code>"</code> or <code>'</code>
<tr><td id="TOK-BOM">BOM	<td>::=<td><code>#xFEFF</code>
</table>

<p>

  Since any single character other than ' or " that cannot be part of a
  larger token is a single character token, there cannot be errors in
  tokenization other than the inability to tokenize an unmatched
  quotation mark.  If at some point it is not possible to continue
  tokenizing an incoming style sheet, the remainder of the style sheet
  should be ignored and only the largest initial segment of the
  style sheet that can be tokenized according to the above rules (that
  is, the entire style sheet except for the part from the unmatched
  (single or double) quotation mark to the end) should be used to form
  the sequence of tokens to be parsed according to the grammar.

</p>

<p class="issue">This isn't exactly right.  Since the string token can't
contain newlines that aren't escaped by backslashes, an untokenizable
sequence can occur in the middle of a file.  Would it be better to
change things so that unmatched quotation marks become single-character
tokens and all character streams are tokenizable?</p>

<h3>Grammar</h3>

<h4>Principles of CSS error handling</h4>

<p>All levels of CSS, starting from CSS1, have required that user agents
ignore certain types of invalid style sheets in well-defined ways.  This
allows forward-compatibility, since it allows future extensions to CSS
within basic grammatical constraints that will be ignored in
well-defined ways by user agents implementing earlier versions of
CSS.</p>

<p>Handling of CSS that is not valid CSS3 but is valid according to the
forward-compatible syntax requires first determining the beginning and
end of the part that is invalid and then handling that part in a
specified way.  The latter is described in the <a
href="error-handling">rules for handling parsing errors</a>.  The
mechanism for the former is described within the grammar.</p>

<p>The handling of style sheets that do not parse according to the
forward-compatible core syntax is not defined by this specification.
<span class="issue">Should it be?</span>
</p>

<p>Certain productions within the grammar are <dfn>error handling
points</dfn>.  Every error handling point has a backup production that
is to be used if it is not possible to parse the stream of tokens based
on the primary production.  If the error handling production is
represented as <code>prod</code>, then the backup production is
represented as <code>FAIL(prod)</code>.</p>

<p class="issue">The grammar given in <a
href="http://www.w3.org/TR/1998/REC-CSS2-19980512/grammar.html">Appendix D</a>
of CSS2 still needs to be incorporated into this specification.  The editor
hopes that it can be done by unifying it with the forward-compatible grammar
into a single grammar that describes both the rules for forward-compatible
parsing and the syntax of what is currently possible in CSS, but that may not
be possible.  However, hopefully it will be possible to do this by
describing the general grammar in terms of the concepts described in the
previous paragraph.</p>

<p>Excluding the transformation of a production into its backup
production, this grammar is LL(1).  <span class="issue">We should
explain briefly what this means, except that it's probably not true.
It's probably just LALR(1).</span>
</p>

<p>The portion of a CSS style sheet that is to be used is the largest
initial stream of the tokens resulting from the <a
href="#tokenization">tokenization process</a> that can be parsed
according to the grammar presented in this chapter.  (For example, if a
brace opening a declaration block <span class="issue">(link-ify
this)</span> is not present, the declaration block
must be ignored since the closing brace is required to satisfy this
grammar.)</p>

<p>Some of the constraints of CSS are not expressed in the grammar.  For
example, an <code>@charset</code> rule is not permitted in an embedded
style sheet, or a namespace prefix that has not been defined by an
<code>@namespace</code> rule is an invalid selector.  These constraints
should be handled just as a parsing error would be (by ignoring out to
the next backup production) unless specified otherwise.</p>

<h4>Style sheets</h4>

<p>Below is the core syntax for CSS.  Lowercase identifiers represent
productions in this grammar, uppercase identifiers represent tokens (see
above), and characters in single quotes (') represent CHAR tokens (see
above).  The sections that follow describe
how to use it.

<PRE>
stylesheet  : [ CDO | CDC | S | statement ]*;
statement   : ruleset | at-rule;
at-rule     : ATKEYWORD S* any* [ block | ';' S* ];
block       : '{' S* [ any | block | ATKEYWORD S* | ';' ]* '}' S*;
ruleset     : selector? '{' S* declaration? [ ';' S* declaration? ]* '}' S*;
selector    : any+;
declaration : property ':' S* value;
property    : IDENT S*;
value       : [ any | block | ATKEYWORD S* ]+;
any         : [ IDENT | NUMBER | PERCENTAGE | DIMENSION | STRING
              | DELIM | URI | HASH | UNICODE-RANGE | INCLUDES
              | FUNCTION any* ')' | DASHMATCH | '(' any* ')' | '[' any* ']' ] S*;
</PRE>

<div class="issue">
The definitions of these productions should be spread below into the
prose describing what they mean.  Furthermore, they should be combined
with the Appendix D grammar from CSS2, perhaps using notation like:
<table>
<tr><td>ruleset</td><td>::=</td><td>...</td></tr>
<tr><td>FAIL(ruleset)</td><td>::=</td><td>...</td></tr>
</table>
</div>

<p><a name="comment">COMMENT</a> tokens do not occur
in the grammar (to keep it readable), but any number of these tokens
may appear anywhere between other tokens.

<p>The token S in the grammar above stands for <A
name="whitespace">whitespace</a>. Only the characters "space" (Unicode
code 32), "tab" (9), "line feed" (10), "carriage return" (13), and
"form feed" (12) can occur in whitespace. Other space-like characters,
such as "em-space" (8195) and "ideographic space" (12288), are never
part of whitespace.

<h3 id="keywords">Keywords</h3>

<!-- provide better explanation of where keywords appear:
media types, at-rules, etc. -IJ -->

<p>Keywords have the form of identifiers. Keywords must not be placed
between quotes ("..." or '...'). Thus,

<pre>
red
</pre>

<p>is a keyword, but

<pre>
"red"
</pre>

is not. (It is a <a href="#strings">string</a>.) Other illegal examples:

<div class="illegal-example"><p>
<pre>
width: "auto";
border: "none";
font-family: "serif";
background: "red";
</pre>
</div>


<h3>Statements</h3>

<p> A CSS style sheet, for any version of CSS, consists of a list of
<span class="index-inst" title="statements"><em>statements</em></span>
(see the grammar above).  There are two kinds of statements: <span
class="index-inst" title="at-rules"><em>at-rules</em></span>
and <span class="index-inst" title="rule sets"><em>rule
sets.</em></span> There may be <a href="#whitespace">whitespace</a>
around the statements.

<p>In this specification, the expressions "immediately before" or
"immediately after" mean with no intervening whitespace or comments.

<!-- Should comments be defined as whitespace? -->

<h3 id="at-rules" class="index-def" title="at-rules">At-rules</h3>

<p> At-rules start with an <DFN>at-keyword</DFN>, an '@' character
followed immediately by an <a
href="#value-def-identifier">identifier</a> (for example, '@import',
'@page').

<p> An at-rule consists of everything up to and including the next
semicolon (;) or the next <a href="#block">block,</a> whichever comes
first. A CSS user agent that encounters an unrecognized at-rule must
<span class="index-inst" title="ignore"><a href="#ignore">ignore</a></span>
the whole of the at-rule and continue parsing after it.

<p>CSS3 user agents must <span class="index-inst" title="ignore"><a
href="#ignore">ignore</a></span> any <a
href="cascade.html#at-import">'@import'</a> rule that occurs inside a <a
href="#block">block</a> or that doesn't precede all rule sets.

<div class="illegal-example"><p>
Assume, for example, that a CSS3 parser encounters this style sheet:

<PRE>
@import "subs.css";
H1 { color: blue }
@import "list.css";
</PRE>

<p> The second '@import' is illegal according to CSS3. The CSS3 parser
<span class="index-inst" title="ignore"><a href="#ignore">ignores</a></span>
the whole at-rule, effectively reducing the style sheet to:

<PRE>
@import "subs.css";
H1 { color: blue }
</PRE>
</div>

<div class="illegal-example"><p>
In the following example, the second '@import' rule is invalid,
since it occurs inside a '@media' <a href="#block">block</a>.

<PRE>
@import "subs.css";
@media print {
  @import "print-main.css";
  BODY { font-size: 10pt }
}
H1 {color: blue }
</PRE>
</div>

<h3 id="index-def" class="index-def" title="block">Blocks</h3>

<p> A <span class="index-inst" title="block"><em>block</em></span>
starts with a left curly brace ({) and ends with the matching right
curly brace (}). In between there may be any characters, except that
parentheses ((&nbsp;)), brackets ([&nbsp;]) and braces ({&nbsp;}) must
always occur in
matching pairs and may be nested. Single (') and double quotes (")
<!-- " --> must also occur in matching pairs, and characters between them
are parsed as a <span class="index-inst" title="string">string</span>.
See <a href="#tokenization">Tokenization</a> above for the definition
of a string.


<div class="illegal-example">
<p> Here is an example of a block. Note that the right brace between
the double quotes does not match the opening brace of the block, and that the
second single quote is an <a href="#escaped-characters">escaped
character</a>, and thus doesn't match the first single quote:

<PRE>
{ causta: "}" + ({7} * '\'') }
</PRE>

<p>Note that the above rule is not valid CSS3, but it is still
a block as defined above.
</div>

<h3>Rule sets, declaration blocks, and selectors</h3>

<p> A rule set (also called "rule") consists of a selector followed by
a declaration block.

<p> A <span class="index-def"
title="declaration-block"><dfn>declaration-block</dfn></span> (also
called a {}-block in the following text) starts with a left curly
brace ({) and ends with the matching right curly brace (}). In between
there must be a list of zero or more semicolon-separated (;)
declarations.

<p>The <span class="index-def"
title="selector"><em>selector</em></span> (see also the section on <a
href="selector.html">selectors</a>) consists of everything up to (but
not including) the first left curly brace ({).  A selector always goes
together with a {}-block. When a user agent can't parse the selector (i.e., it
is not valid CSS3), it must <span class="index-inst" title="ignore"><a
href="#ignore">ignore</a></span> the {}-block as well.

<p>CSS3 gives a special meaning to the comma (,) in
selectors. However, since it is not known if the comma may acquire
other meanings in future versions of CSS, the whole statement should
be <span class="index-inst" title="ignore"><a
href="#ignore">ignored</a></span> if there is an error anywhere in the
selector, even though the rest of the selector may look reasonable in
CSS3.

<DIV class=illegal-example>
<p>For example, since the "&amp;" is not a valid token in a CSS3
selector, a CSS3 user agent must
<span class="index-inst" title="ignore"><a href="#ignore">ignore</a></span>
the whole second line, and not set the color of H3 to red:
<PRE>
H1, H2 {color: green }
H3, H4 &amp; H5 {color: red }
H6 {color: black }
</PRE>
</DIV>

<div class="example"><p>
<p>Here is a more complex example. The first two pairs of curly braces
are inside a string, and do not mark the end of the selector. This is
a valid CSS3 statement.
<PRE>
P[example="public class foo\
{\
    private int x;\
\
    foo(int x) {\
        this.x = x;\
    }\
\
}"] { color: red }
</PRE>

<div class="note"><p>
<em><strong>Note.</strong>
The <span class="css">\</span> characters in the above example cause the
newlines to be ignored.  Newlines can be placed in strings only using the
correct numeric character escape.  See <a href="#characters">characters
and case</a> above.
</em></p></div>
</div>

<h3>Declarations and properties</h3>

<p> A <span class="index-def"
title="declaration"><dfn>declaration</dfn></span> is either empty or
consists of a <span class="index-def"
title="property">property</span>, followed by a colon (:), followed by
a value. Around each of these there may be <a
href="#whitespace">whitespace</a>.

<p>Because of the way selectors work, multiple declarations for the
same selector may be organized into semicolon (;) separated
groups.</p>

<div class="example"><p>
Thus, the following rules:</p>
<pre>
H1 { font-weight: bold }
H1 { font-size: 12pt }
H1 { line-height: 14pt }
H1 { font-family: Helvetica }
H1 { font-variant: normal }
H1 { font-style: normal }
</pre>

<p>are equivalent to:</p>

<pre>
H1 {
  font-weight: bold;
  font-size: 12pt;
  line-height: 14pt;
  font-family: Helvetica;
  font-variant: normal;
  font-style: normal
}
</pre>
</div>

<p>A property is an <a
href="#value-def-identifier">identifier</a>. Any character may occur
in the value, but parentheses ("(&nbsp;)"), brackets ("[&nbsp;]"),
braces ("{&nbsp;}"), single
quotes (') and double quotes (") <!-- " --> must come in matching
pairs, and semicolons not in strings must be <a
href="#escaped-characters">escaped</a>. Parentheses, brackets, and
braces may be nested. Inside the quotes, characters are parsed as a
string.

<p>The syntax of <span class="index-def" title="value">values</span>
is specified separately for each property, but in any case, values are
built from identifiers, strings, numbers, lengths, percentages, URIs,
colors, angles, times, and frequencies.

<p>A user agent must <span class="index-inst" title="ignore"><a
href="#ignore">ignore</a></span> a declaration with an invalid property
name or an invalid value. Every CSS3 property has its own syntactic
and semantic restrictions on the values it accepts.

<div class="illegal-example"><p>
For example, assume a CSS3 parser encounters this style sheet:

<PRE>
H1 { color: red; font-style: 12pt }  /* Invalid value: 12pt */
P { color: blue;  font-vendor: any;  /* Invalid prop.: font-vendor */
    font-variant: small-caps }
EM EM { font-style: normal }
</PRE>

<p> The second declaration on the first line has an invalid value
'12pt'. The second declaration on the second line contains an
undefined property 'font-vendor'. The CSS3 parser will <span
class="index-inst" title="ignore"><a href="#ignore">ignore</a></span> these
declarations, effectively reducing the style sheet to:

<PRE class="example">
H1 { color: red; }
P { color: blue;  font-variant: small-caps }
EM EM { font-style: normal }
</PRE>
</div>

<h3 id="comments" class="index-def" title="comments">Comments</h3>

<p><span class="index-inst" title="comments">Comments </span> begin
with the characters "/*" and end with the characters "*/". They may
occur anywhere between tokens,
and their contents have no influence on the rendering.  Comments may
not be nested.

<p>CSS also allows the SGML comment delimiters ("&lt;!--" and
"--&gt;") in certain places, but they do not delimit CSS
comments. They are permitted so that style rules appearing in an HTML
source document (in the STYLE element) may be hidden from pre-HTML 3.2
user agents. See the HTML 4.0 specification ([[HTML40]]) for more information.

<h2 id="error-handling">Rules for handling parsing errors or unsupported features</h2>

<p class="issue">Hopefully (assuming it can be formalized within the
rules above) this section will not need so much detail and can be folded
into the previous section.</p>

<p>In some cases, user agents must ignore part of an illegal style
sheet. This specification defines <span class="index-def"
title="ignore"><a name="ignore"><dfn>ignore</dfn></a></span> to mean
that the user agent parses the illegal part according to the grammar
above (in order to find its
beginning and end), but otherwise acts as if it had not been there.</p>

<p>If a style sheet cannot be parsed according to the grammar above, the
user agent must behave the same as it would if the style sheet had the
smallest sequence of characters removed from its end that would allow
it to be parsed according to the grammar.</p>

<p>To ensure that new properties and new values for existing
properties can be added in the future, user agents are required to
obey the following rules when they encounter the following
scenarios:</p>

<UL>
<LI><strong>Unknown properties.</strong> User agents must <span
class="index-inst" title="ignore"><a href="#ignore">ignore</a></span> a <a
href="syndata.html#declaration">declaration</a> with an unknown
property. For example, if the style sheet is:

<PRE class="illegal-example">
H1 { color: red; rotation: 70minutes }
</PRE>

<p> the user agent will treat this as if the style sheet had been

<PRE class="example">
H1 { color: red }
</PRE>

<LI><strong>Illegal values.</strong> User agents must ignore a
declaration with an illegal value. For example:

<PRE class="illegal-example">
IMG { float: left }       /* correct CSS3 */
IMG { float: left here }  /* "here" is not a value of 'float' */
IMG { background: "red" } /* keywords cannot be quoted in CSS3 */
IMG { border-width: 3 }   /* a unit must be specified for length values */
</PRE>

A CSS3 parser would honor the first rule and
<span class="index-inst" title="ignore"><a href="#ignore">ignore</a></span>
the rest, as if the style sheet had been:

<PRE class="example">
IMG { float: left }
IMG { }
IMG { }
IMG { }
</PRE>

<p>A user agent conforming to a future CSS specification may accept one or
more of the other rules as well.</p>

<p class="issue">A general comment on how to handle negative numbers
when disallowed might be useful.  Is it handled by truncation or is it a
parser error?</p>

<LI><strong>Invalid at-keywords.</strong> User agents must <span
class="index-inst" title="ignore"><a href="#ignore">ignore</a></span> an
invalid at-keyword together with everything following it, up to and
including the next semicolon (;) or block ({...}), whichever
comes first. For example, consider the following:

<PRE class="illegal-example">
@three-dee {
  @background-lighting {
    azimuth: 30deg;
    elevation: 190deg;
  }
  H1 { color: red }
}
H1 { color: blue }
</PRE>

<p> The '@three-dee' at-rule is not part of CSS3. Therefore, the whole
at-rule (up to, and including, the third right curly brace) is <span
class="index-inst" title="ignore"><a href="#ignore">ignored.</a></span> A
CSS3 user agent <span class="index-inst" title="ignore"><a
href="#ignore">ignores</a></span> it, effectively reducing the style sheet
to:</p>

<PRE class="example">
H1 { color: blue }
</PRE>

</UL>

<h3>Partial implementations</h3>

<p>CSS3, unlike CSS1 and CSS2, is modular and thus allows for partial
implementations.  The conformance requirements of some modules may also allow
for conformant implementations to implement only part of a module.</p>

<p>Implementations that do not implement a feature of any CSS3 module
(whether a property, an at-rule, or a property value) should behave as
they would according to the forward-compatible parsing rules had that
feature not been part of a known CSS specification.</p>

<h2>Vendor-specific extensions</h2>

<p>Although proprietary extensions should be avoided in general, there
are situations (experiments, implementations of W3C drafts that have not
yet reached Candidate Recommendation, intra-nets, debugging, etc.) where
it is convenient to add some nonstandard, i.e., proprietary identifiers
to a CSS style sheet. It is often hard to predict how long these
proprietary extensions will be in use and hard to avoid that their names
clash with new, standard properties or with other proprietary
properties. Therefore the CSS Working Group proposes the following
simple naming convention. A proprietary name should have a prefix
consisting of:</p>

<ol>
  <li>an underscore ("_") or a dash ("-"),</li>
  <li>the (possibly abbreviated) name of the company, organization, etc. that
    created it,</li>
  <li>an underscore or a dash.</li>
</ol>

<p>Some examples (and the companies/organizations that created them):</p>
<ul>
  <li><em>-moz-box-sizing,</em> <em>-moz-border-radius</em> (The Mozilla
    Organization)</li>
  <li><em>-wap-accesske</em>y (The WAP Forum)</li>
  <li><em>_xyz-dwiw</em> (hypothetical)</li>
</ul>

<p>The advantage of the initial dash is that it is not a valid start character
for identifiers in CSS, so it is guaranteed never to be used by any current or
future level of CSS. CSS-conforming parsers will skip rules that contain
identifiers with such a character.
<span class="issue">[Should the grammar allow
'-' as part of identifiers or should it require that vendors who use '-' to
begin identifiers extend the grammar in their tokenizer?  Currently it
does, but perhaps it shouldn't.]</span></p>

<p>That is also a possible disadvantage: a conforming parser will skip them,
so in order to use them, an extended parser is required.</p>

<p>For that reason, the underscore is also proposed. Although it is a valid
start character, the CSS Working Group believes it will never define any
identifiers that start with that character.</p>

<h3>Historical notes</h3>

<p>Microsoft created a number of proprietary properties for use inside their
Microsoft Office product, at a time when there was not yet a consensus in the
working group about the naming convention. They chose to prefix properties
with "mso-" rather than "-mso-".</p>

<p>At the time of writing, the following prefixes are known to exist:</p>
<ul>
  <li><em>mso-</em> (Microsoft Corporation)</li>
  <li><em>-moz-</em> (The Mozilla Organization)</li>
  <li><em>-opera-</em> (Opera Software)</li>
  <li><em>-atsc</em>- (Advanced Television Standards Committee)</li>
  <li><em>-wap-</em> (The WAP Forum)</li>
</ul>

<h2>Associating style sheets with documents</h2>

<h3>Media types</h3>

<h4>Introduction to media types</h4>

<p>One of the most important features of style sheets is that they
specify how a document is to be presented on different media: on the
screen, on paper, with a speech synthesizer, with a braille device,
etc.</p>

<p>Certain CSS properties are only designed for certain media (e.g.,
the <span class="propinst-cue-before">'cue-before'</span> property for
aural user agents). On occasion, however, style sheets for different
media types may share a property, but require different values for
that property. For example, the <span
class="propinst-font-size">'font-size'</span> property is useful both
for screen and print media. However, the two media are different
enough to require different values for the common property; a document
will typically need a larger font on a computer screen than on paper.
Experience also shows that sans-serif fonts are easier to read on
screen, while fonts with serifs are easier to read on paper.  For
these reasons, it is necessary to express that a style sheet -- or a
section of a style sheet -- applies to certain media types.</p>

<h4>Specifying media-dependent style sheets</h4>

<p>There are currently two ways to specify media dependencies for
style sheets:</p>

<ul>

<li>Specify the target medium for a set of style rules with the <span
class="index-inst" title="@media"><code>@media</code></span> at-rule.

<div class="example"><p>
<PRE>
@media print {
  /* style rules for print go here */
}
</PRE>
</div>
</li>

<li><p>Specify the target media for an entire style sheet at the point
where the stylesheet is linked to the document.</p>

<p>If the style sheet is linked to the document by being imported (with
an <a href="#at-import"><code>@import</code> rule</a>) from another
style sheet, the target media can be specified as part of the
<span class="index-inst" title="@import"><code>@import</code></span> at-rule:

<div class="example"><p>
<PRE>
@import url("loudvoice.css") aural;
</PRE>
</div>

<p>If the style sheet is linked to the document through a <a
href="#associating-author">linking mechanism within the document</a>,
then it may be possible to specify the target medium within the document
language. For example, in HTML 4.0 ([[HTML40]]), the <code>media</code>
attribute on the <code>link</code> element specifies the target media of
an external style sheet:</p>

<div class="example"><p>

<PRE>
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"&gt;
&lt;html&gt;
   &lt;head&gt;
      &lt;title&gt;Link to a target medium&lt;/title&gt;
      &lt;link rel="stylesheet" type="text/css" 
	 media="print, handheld" href="foo.css"&gt;
   &lt;/head&gt;
   &lt;body&gt;
      &lt;p&gt;The body...
   &lt;/body&gt;
&lt;/html&gt;
</PRE>
</div>
</UL>

<h4 id="at-media-rule">The <code>@media</code> rule</h4> 

<p>An <span class="index-def" title="@media"><code>@media</code></span>
rule specifies the target <a href="#media-types">media types</a>
(separated by commas) of a set of rules (delimited by curly braces).
The @media construct allows style sheet rules for various media in the
same style sheet:</p>

<div class="example"><p>
<pre>
  @media print {
    BODY { font-size: 12pt; }
    H1 { font-size: 24pt; }
  }
  @media screen {
    BODY { font-size: medium; }
    H1 { font-size: 2em; }
  }
  @media screen, print {
    BODY { line-height: 1.2; }
  }
</pre>
</div>


<h4 id="media-types">Recognized media types</h4> 

<p>A CSS <span class="index-def" title="media type"><dfn>media
type</dfn></span> names a set of CSS properties.  A user agent that
claims to support a media type by name must implement all of the
properties that apply to that media type.

<p>The names chosen for CSS media types reflect target devices for
which the relevant properties make sense. In the following list of CSS
media types, the parenthetical descriptions are not normative. They
only give a sense of what device the media type is meant to refer to.

<dl>
<dt><strong>all</strong>
<dd>Suitable for all devices.

<dt><strong>aural</strong> 
<dd>Intended for speech synthesizers. See the 
section on <a href="./aural.html">aural style sheets</a> for details.

<dt><strong>braille</strong>
<dd>Intended for braille tactile feedback devices.

<dt><strong>embossed</strong>
<dd>Intended for paged braille printers.

<dt><strong>handheld</strong>
<dd>Intended for handheld devices (typically small
screen, monochrome, limited bandwidth).

<dt><strong>print</strong> 
<dd>Intended for paged, opaque material and for documents viewed on
screen in print preview mode.  Please consult the section on <a
href="page.html">paged media</a> for information about formatting
issues that are specific to paged media.

<dt><strong>projection</strong>
<dd>Intended for projected presentations, for
example projectors or print to transparencies.
Please consult the section on <a href="page.html">paged media</a> for
information about formatting issues that are specific to paged media.

<dt><strong>screen</strong> 
<dd>Intended primarily for color computer screens. 

<dt><strong>tty</strong>
<dd>Intended for media using a fixed-pitch character grid, such as
teletypes, terminals, or portable devices with limited display
capabilities. Authors should not use <a
href="syndata.html#pixel-units">pixel units</a> with the "tty" media
type.

<dt><strong>tv</strong>
<dd>Intended for television-type devices (low 
resolution, color, limited-scrollability screens, sound available). 
</dl>

<p>Media type names are case-insensitive.  

<p>Due to rapidly changing technologies, CSS3 does not specify a
definitive list of media types that may be values for <span
class="index-inst" title="@media">@media</span>.</p>

<div class="note"><p>
<em><strong>Note.</strong>
Future versions of CSS may extend this list. Authors
should not rely on media type names that are not yet defined
by a CSS specification.
</em>
</div>

<h4>Extensions to media types</h4>

<p>The Media Queries
Module [[MEDIAQ]] defines an extended mechanism for media type
specification.</p>

<h3 id="associating-UA">User-agent style sheets</h3>

<h3 id="associating-user">User style sheets</h3>

<h3 id="associating-author">Author style sheets</h3>

<p>This section is informative.</p>

<p class="issue">Add informative references to [[HTML40]],
[[CSSSTYLEATTR]] and xml-stylesheet [[XMLSTYLE]].</p>

<h3 id="at-import">Style sheets including other style sheets: 
the <code>@import</code> rule</h3>

<p class="issue">[Refer to cascade?]</p>

<p class="issue">[State that the media part prevents the import from
being processed if the medium doesn't match, but it doesn't "associate"
the media with the style sheet so that it can't be imported some other
way.  Further, state that @import without a medium must ignore any
medium specified for the same style sheet in a link from a document]</p>


<h2>Defining namespaces:  the <code>@namespace</code> rule</h2>

<p>The @namespace rule allows the style sheet author to declare a namespace
prefix and associate it to a given namespace URI.
The prefix applies only to the style sheet in
which it is declared, and not any imported style sheets or any other
style sheets applying to the document.
This namespace prefix
can then be used as a namespace prefix as described in other modules,
for example the Selectors Module [[SELECT]] or the Generated Content
module [[CSS3GENCON]].
Any @namespace rules
must follow all @import and @charset rules and precede all other rule sets
in a style sheet. This is to avoid any confusion or issues regarding the
scope of the declared namespace.
</p>

<p>If the optional namespace prefix is omitted, then the namespace URI
is considered to be the default namespace. The default namespace applies
only to type selectors that have no explicit namespace prefix declared
as described in the Selectors Module [[!SELECT]].</p>

<p>A prefix, once declared, may be used in selectors and property values
as described in other modules.  Those modules should define the use of a
namespace prefix that has not been properly declared as a parsing error
that will cause the selector or declaration (etc.) to be considered
invalid and ignored.</p>

<p>If a namespace prefix is declared more than once, the last occurrence
will be used.</p>

<div class="example">
  <p>Examples:</p>
  <pre>@namespace url(http://www.w3.org/1999/xhtml);
@namespace svg url(http://www.w3.org/2000/svg);</pre>

  <p>The first rule declares a default namespace
  <code>http://www.w3.org/1999/xhtml</code> to be applied only to type
  selectors that have no explicit namespace component.</p>

  <p>The second rule declares a namespace prefix <code>svg</code> that
  is used to apply the namespace <code>http://www.w3.org/2000/svg</code>
  where the <code>svg</code> namespace prefix is used.</p>

</div>


<h2 id="conf">Conformance</h2>

<p>The key words <span class="index-def" title="MUST">"MUST"</span>,
<span class="index-def" title="MUST NOT">"MUST NOT"</span>, <span
class="index-def" title="REQUIRED">"REQUIRED"</span>, <span
class="index-def" title="SHALL">"SHALL"</span>, <span
class="index-def" title="SHALL NOT">"SHALL NOT"</span>, <span
class="index-def" title="SHOULD">"SHOULD"</span>, <span
class="index-def" title="SHOULD NOT">"SHOULD NOT"</span>, <span
class="index-def" title="RECOMMENDED">"RECOMMENDED"</span>, <span
class="index-def" title="MAY">"MAY"</span>, and <span
class="index-def" title="OPTIONAL">"OPTIONAL"</span> in this document
are to be interpreted as described in RFC&nbsp;2119 (see [[!RFC2119]]).
However, for readability, these words do not appear in all uppercase
letters in this specification.</p>

<p>At times, this specification recommends good practice
for authors and user agents.  These recommendations are not normative
and conformance with this specification does not depend on their
realization. These recommendations contain the expression "We
recommend ...", "This specification recommends ...", or some similar
wording.</p>

<h3>Definitions</h3>

<p>This module and other CSS3 modules rely on the following
definitions:</p>

<dl>

<dt><strong><span class="index-def" title="style sheet">Style
sheet</span></strong>

<dd>A set of statements that specify presentation of a document.

<P>Style sheets may have three different origins: <a
href="#author">author</a>, <a href="#user">user</a>, and <a
href="#user-agent">user agent</a>. The interaction of these sources is
described in the section on <a href="cascade.html">cascading and
inheritance</a>.

<dt><strong><a name="valid-style-sheet">Valid style sheet</a></strong>

<dd>The <span class="index-def" title="valid style
sheet">validity</span> of a style sheet depends on the level of CSS
used for the style sheet. All valid CSS1 style sheets are valid CSS&nbsp;2.1
style sheets, but some changes from CSS1 mean that
a few CSS1 style sheets will have slightly different semantics in
CSS&nbsp;2.1. Some features in CSS2 are not part of CSS&nbsp;2.1, so not all CSS2
style sheets are valid CSS&nbsp;2.1 style sheets.

<P>A valid CSS&nbsp;2.1 style sheet must be written according to the <a
href="grammar.html">grammar of CSS&nbsp;2.1</a>. Furthermore, it must contain
only at-rules, property names, and property values defined in this
specification. An <span class="index-def"
title="illegal"><strong>illegal</strong></span> (invalid) at-rule,
property name, or property value is one that is not valid.

<dt><strong><span class="index-def" title="source document">Source
document</span></strong>

<dd>The document to which one or more style sheets apply. This is
encoded in some language that represents the document as a tree of <a
href="#element">elements</a>. Each element consists of a name that
identifies the type of element, optionally a number of <a
href="#attribute">attributes</a>, and a (possibly empty) <a
href="#content">content</a>.</dd>

<dt><strong><span class="index-def" title="document language"><a
name="doclanguage">Document language</a></span></strong>

<dd>The encoding language of the source document (e.g., HTML, XHTML or
SVG). CSS is used to describe the presentation of document languages
and CSS does not change the underlying semantics of the document
languages.

<dt><strong><span class="index-def" title="element"><a
name="element">Element</a></span></strong>

<dd>(An SGML term, see [[!ISO8879]].) The primary syntactic constructs
of the document language. Most CSS style sheet rules use the names of
these elements (such as P, TABLE, and OL in HTML) to specify
how the elements should be rendered.

<dt><strong><span class="index-def" title="replaced element">
<a name="replaced-element">Replaced
element</a></span></strong>

<dd>An element for which the CSS formatter knows only the intrinsic
dimensions. In HTML, IMG and OBJECT elements can be replaced elements.
For example, the content of the IMG element is often replaced by the
image that the "src" attribute designates. 

<dt><strong><span class="index-def" title="intrinsic
dimensions"><a name="intrinsic">Intrinsic dimensions</a></span></strong>

<dd>The width and height as defined by the element itself, not imposed
by the surroundings. CSS does not define how the intrinsic dimensions
are found. In CSS&nbsp;2.1 it is assumed that all replaced elements,
and only replaced elements, come with intrinsic dimensions.

<dt><strong><span class="index-def" title="attribute"><a
name="attribute">Attribute</a></span></strong>

<dd>A value associated with an element, consisting of a name, and an
associated (textual) value.

<dt><strong><span class="index-def" title="content"><a
name="content">Content</a></span></strong>

<dd>The content associated with an element in the
source document.  Some elements have no content, in which case they are
called <strong><span
class="index-def" title="empty">empty</span></strong>. The content of
an element may include text, and it may include a number of
sub-elements, in which case the element is called the <strong><span
class="index-def" title="parent">parent</span></strong> of those
sub-elements.


<dt><strong><span class="index-def" title="ignore">Ignore</span></strong>

<dd>This term has three slightly different meanings this specification. First, a CSS parser must follow certain rules when it discovers unknown or illegal syntax in a style sheet. The parser must then ignore certain parts of the style sheets. The exact rules for what parts must be ignored is given in these section: <a href="syndata.html#q8">Declarations and properties</a>, <a href="syndata.html#parsing-errors">Rules for handling parsing errors</a>, <a href="syndata.html#q20">Unsupported Values</a>, or may be explained in the text where the term "ignore" appears. Second, a user agent may (and, in some cases must) disregard certain properties or values in the style sheet even if the syntax is legal. For example, table-column-group elements cannot have borders around them, so the border properties must be ignored.


<dt><strong><span class="index-def" title="rendered
content|content::rendered"><a name="rendered-content">Rendered
content</a></span></strong>

<dd>The content of an element after the rendering that applies to it
according to the relevant style sheets has been applied. The rendered
content of a <a href="#replaced-element">replaced element</a> comes
from outside the source document.  Rendered content may also be
alternate text for an element (e.g., the value of the XHTML "alt"
attribute), and may include items inserted implicitly or explicitly by
the style sheet, such as bullets, numbering, etc.

<dt><strong><span class="index-def" title="document tree">
<a name="doctree">Document
tree</a></span></strong>

<dd>The tree of elements encoded in the source document. Each element
in this tree has exactly one parent, with the exception of the
<strong><span class="index-def" title="root"><a
name="root">root</a></span></strong> element, which has none.

<dt><strong><span class="index-def"
title="child">Child</span></strong>

<dd>An element A is called the child of element B if and only if B is
the parent of A.

<dt><strong><span class="index-def"
title="descendant">Descendant</span></strong>

<dd>An element A is called a descendant of an element B, if either (1)
A is a child of B, or (2) A is the child of some element C that is a
descendant of B.

<dt><strong><span class="index-def"
title="ancestor">Ancestor</span></strong>

<dd>An element A is called an ancestor of an element B, if and only if
B is a descendant of A.

<dt><strong><span class="index-def"
title="sibling">Sibling</span></strong>

<dd>An element A is called a sibling of an element B, if and only if B
and A share the same parent element. Element A is a preceding sibling
if it comes before B in the document tree. Element B is a following
sibling if it comes after A in the document tree.

<dt><strong><span class="index-def" title="preceding
element|element::preceding"><a name="preceding">Preceding element</a></span></strong>

<dd>An element A is called a preceding element of an element B, if and
only if (1) A is an ancestor of B or (2) A is a preceding sibling of
B.

<dt><strong><span class="index-def" title="following
element|element::following">Following element</span></strong>

<dd>An element A is called a following element of an element B, if and
only if B is a preceding element of A.

<dt><strong><strong><a name="author">Author</a></strong></strong>
<dd>An author is a person who writes
documents and associated style sheets. An 
<span class="index-def" title="authoring tool"><strong>authoring tool</strong></span>
generates documents and associated style sheets.</dd>

<dt><strong><strong><a name="user">User</a></strong></strong> 
<dd> A user is a person who interacts with a user agent to view, hear, or
otherwise use a document and its associated style sheet. The user
may provide a personal style sheet that encodes personal
preferences.
</dd>

<dt><strong><strong><a name="user-agent">User agent (UA)</a></strong></strong>
<dd>A <span class="index-def" title="user agent|UA">user
agent</span> is any program that interprets a document written in
the document language and applies associated style sheets according
to the terms of this specification. A user agent may display a
document, read it aloud, cause it to be printed, convert it
to another format, etc.</dd>

<DD>An HTML user agent is one that supports the HTML 2.x, HTML 3.x, or
HTML 4.x specifications. A user agent that supports XHTML [[XHTML10]],
but not HTML (as listed in the previous sentence) is not considered an
HTML user agent for the purpose of conformance with this
specification.

</dl>


<h3 id="conf-UA">User agent conformance</h3>

<p class="issue">Note rules for user style sheet conformance, Author style sheet disabling,
etc.</p>
<p class="issue">Mention rules for handling parsing errors, especially</p>

<p class="issue">Rewrite the text below (from CSS2) in light of
modularization.</p>

<P>This section defines <span class="index-def"
title="conformance">conformance</span> with the CSS&nbsp;2.1
specification only. There may be other levels of CSS in the future
that may require a user agent to implement a different set of features
in order to conform.

<P>In general, the following points must be observed by a user agent
claiming conformance to this specification:</P>

<ol>

<li>It must support one or more of the CSS&nbsp;2.1 <a href="media.html">media types</a>.

<li>For each source document, it must attempt to retrieve all 
associated style sheets that are appropriate for the supported media
types. If it cannot retrieve all associated style sheets (for instance,
because of network errors), it must display the document using those
it can retrieve.

<li>It must parse the style sheets according to this specification.
In particular, it must recognize all at-rules, blocks, declarations,
and selectors (see the <a href="grammar.html">grammar of CSS&nbsp;2.1</a>).
If a user agent encounters a property that applies for a supported
media type, the user agent must parse the value according to the property
definition. This means that the user agent must accept all valid
values and must  
<span class="index-inst" title="ignore">ignore</span> declarations with
invalid values. User
agents must <span class="index-inst" title="ignore">ignore</span>
rules that apply to unsupported <a href="media.html">media
types</a>.

<!-- Define "accept"? Include statement that conforming user
agents may only allow one value for certain properties (for
backwards compatibility, see CSS1 for list of these properties),
i.e., the default style sheet value -IJ -->

<li>For each element in a <a href="#doctree">document tree</a>, it
must assign a value for every applicable property according to the
property's definition and the rules of <a
href="cascade.html">cascading and inheritance</a>.

<li>If the source document comes with alternate style sheet sets (such as
with the "alternate" keyword in HTML 4.0 [[HTML40]]), the UA must
allow the user to select which style sheet set the UA should apply.

</ol>

<P>Not every user agent must observe every point, however:</p>

<ul>

<li>An application that reads style sheets without rendering any
content (e.g., a CSS&nbsp;2.1 validator) must respect points 1-3.

<li>An authoring tool is only required to output <a
href="#valid-style-sheet">valid style sheets</a>

<li>A user agent that <em>renders</em> a document with associated style
sheets must respect points 1-5 and render the document
according to the media-specific requirements set forth in this
specification. <a href="cascade.html#actual-value">Values</a> 
may be approximated when required by the user agent.

</ul>

<P>The inability of a user agent to implement part of this
specification due to the limitations of a particular device (e.g., a
user agent cannot render colors on a monochrome monitor or page) does
not imply non-conformance. </P>

<p>UAs must allow users to specify a file that contains the user style
sheet. UAs that run on devices without any means of writing or
specifying files are exempted from this requirement. Additionally, UAs
may offer other means to specify user preferences, for example through
a GUI.

<p>CSS2.1 does not define which properties apply to form controls and
frames, or how CSS can be used to style them. User agents may apply CSS
properties to these elements. Authors are recommended to treat such
support as experimental. A future level of CSS may specify this further.


<h4>Error conditions</h4>

<P>In general, this document does not specify error handling behavior
for user agents (e.g., how they behave when they cannot find
a resource designated by a URI).

<P>However, user agents must observe the <a
href="syndata.html#parsing-errors">rules for handling parsing errors</a>.

<P>Since user agents may vary in how they handle error conditions,
authors and users must not rely on specific error recovery behavior.


<h3 id="conf-SS">Style sheet conformance</h3>

<h3 id="conf-AT">Authoring tool conformance</h3>

<p>Authoring tools may use a modified form of the <a
href="#error-handling">rules for handling parsing errors</a>:  when
those rules require that user agents <em>ignore</em> something,
authoring tools are not required to ignore it.  However, authoring tools
should not present such parts of the style sheet to the user in the same
way as valid parts of the style sheet.  In so far as authoring tools
display the application of a style sheet to a document, they are required
to meet the <a href="#conf-UA">user agent conformance</a> rules.</p>

<p class="issue">(informative reference to canonicalization proposal?)</p>


<h2 id="property-defs">Format of property definitions in other modules</h2>

<p>Each CSS property definition begins with a summary of key
information that resembles the following:</p>

<div class="propdef">
<dl><dt>
<a name="propdef-property-name"
class="propdef-title"><strong>'property-name'</strong></a>

<dd>
<table class="propinfo" cellspacing=0 cellpadding=0>
<tr valign=baseline><td><em>Value:</em>&nbsp;&nbsp;<td>legal values
&amp; syntax
<tr valign=baseline><td><em>Initial:</em>&nbsp;&nbsp;<td>initial value
<tr valign=baseline><td><em>Applies to:</em>&nbsp;&nbsp;<td>elements
this property applies to
<tr valign=baseline><td><em>Inherited:</em>&nbsp;&nbsp;<td>whether the
property is inherited
<tr valign=baseline><td><em>Computed Value:</em>&nbsp;&nbsp;<td>the
computed value of the property
<tr valign=baseline><td><em>Percentages:</em>&nbsp;&nbsp;<td>how
percentage values are interpreted
<tr valign=baseline><td><em>Media:</em>&nbsp;&nbsp;<td>which media
groups the property applies to
</table>

</dl>
</div>

<h3 id="property-def-value">Value</h3>

<p>This part specifies the set of valid values for the property. Value
types may be designated in several ways:

<ol>
<li> <a name="syndata.html#keywords">keyword</a> values (e.g., auto,
disc, etc.)

<li> basic data types, which appear between "&lt;" and "&gt;" (e.g.,
&lt;length&gt;, &lt;percentage&gt;, etc.). In the electronic version
of the document, each instance of a basic data type links to its
definition.

<li> types that have the same range of values as a property bearing
the same name (e.g., &lt;'border-width'&gt;
&lt;'background-attachment'&gt;, etc.).  In this case, the type name
is the property name (complete with quotes) between "&lt;" and "&gt;"
(e.g., &lt;'border-width'&gt;).  Such a type does <strong>not</strong>
include the value 'inherit'.  In the electronic version of the
document, each instance of this type of non-terminal links to the
corresponding property definition.


<li> non-terminals that do not share the same name as a property. In this
case, the non-terminal name appears between "&lt;" and "&gt;", as in
&lt;border-width&gt;.  Notice the distinction between
&lt;border-width&gt; and &lt;'border-width'&gt;; the latter is defined
in terms of the former. The definition of a non-terminal is located
near its first appearance in the specification.  In the electronic
version of the document, each instance of this type of value links to
the corresponding value definition.
</ol>

<p>Other words in these definitions are keywords that must appear
literally, without quotes (e.g., red). The slash (/) and the comma (,)
must also appear literally.

<p>Values may be arranged as follows:</p>

<ul>
<li>Several juxtaposed words mean that all of them must occur, in the
given order.
<li>A bar (|) separates two or more alternatives: 
exactly one of them must occur.
<li>A double bar (||) separates
two or more options: one or more of them must occur, in any order.
<li>Brackets ([&nbsp;]) are for grouping. 
</ul>

<p>Juxtaposition is stronger than the double bar, and the double bar
is stronger than the bar. Thus, the following lines are equivalent:
<PRE>
    a b   |   c || d e
  [ a b ] | [ c || [ d e ]]
</PRE>

<p> Every type, keyword, or bracketed group may be followed by one of
the following modifiers:</p>

  <UL>
    <LI>
      An asterisk (*) indicates that the preceding type, word, or group
      occurs zero or more times.

    <LI>
      A plus (+) indicates that the preceding type, word, or group 
      occurs one or more times.

    <LI>
      A question mark (?) indicates that the preceding type, word, or
      group is optional.

    <LI>
      A pair of numbers in curly braces ({A,B}) indicates that the
      preceding type, word, or group occurs at least A and at most
      B times.
  </UL>


<p>The following examples illustrate different value types:

<BLOCKQUOTE>
    <EM>Value:</EM> N | NW | NE<BR>
    <EM>Value:</EM> [ &lt;length&gt; | thick | thin ]{1,4}<BR>
    <EM>Value:</EM> [&lt;family-name&gt; , ]* &lt;family-name&gt;<BR>
    <EM>Value:</EM> &lt;uri&gt;? &lt;color&gt; [ / &lt;color&gt; ]?<BR>
    <EM>Value:</EM> &lt;uri&gt; || &lt;color&gt;<BR>
</BLOCKQUOTE>

<p class="issue">We need a more formal grammar for parsing of
properties.  Refer to section on keywords (they can't be quoted).</p>

<p class="issue">Need to cite values & units module here.</p>

<h4><code>initial</code> and <code>inherit</code> values</h4>

<p>In addition to the legal values stated, <code>initial</code> and
<code>inherit</code> values are also legal for every property.  The
meaning of these values is described in the Values &amp; Units
[[CSS3VAL]] and Cascading &amp; Inheritance [[CSS3CASCADE]] modules.
</p>

<h3 id="property-def-initial">Initial</h3>

<p>This part specifies the property's initial value. If the property
is <a href="#property-def-inherited">inherited</a>, this is the value
that is given to the root element of the <a
href="conform.html#doctree">document tree</a>. Please consult
the section on <a href="cascade.html">the cascade</a> for information
about the interaction between style sheet-specified, inherited, and
initial values.


<h3 id="property-def-applies">Applies to</h3>

<p>This part lists the elements to which the property applies. All
elements are considered to have all properties, but some properties
have no rendering effect on some types of elements. For example, <span
class="propinst-white-space">'white-space'</span> only affects
block-level elements.

<h3 id="property-def-inherited">Inherited</h3>

<p>This part indicates whether the value of the property is inherited
from an ancestor element by default ("Inherited: yes") or the
value of the property is its <a href="#property-def-initial">initial
value</a> by default ("Inherited: no").  Please consult the Cascading
&amp; Inheritance Module [[CSS3CASCADE]] for information about the
interaction between style sheet-specified, inherited, and initial
values.</p>

<h3 id="property-def-computed">Computed value</h3>

<p>This part indicates the computed value of the property.  The concept
of computed value is described in the Cascading &amp; Inheritance Module
[[CSS3CASCADE]].  (It is needed both for inheritance and for the
definitions of some DOM properties.)</p>

<p class="issue">What is the computed value for elements to which the
property does not apply?  Do some existing inherited properties rely on
inheritance through elements to which the property doesn't apply?</p>

<h3 id="property-def-percent">Percentage values</h3>

<p>This part indicates how percentages should be interpreted, if they occur in
the value of the property. If "N/A" appears here, it means that the
property does not accept percentages as values.

<h3 id="media-groups">Media groups</h3>

<p class="issue">Some of this needs to be relaxed to deal with
profiles.</p>

<p>This part indicates the media groups for which the property must be
implemented by a conforming user agent.
Since properties
generally apply to several media, the "Applies to media" section of each
property definition lists media groups rather than individual media
types.
User agents must support the
property if they support rendering to the media types included in
these <a href="#def-media-groups">media groups</a>.
Each property applies to all media types in the media groups
listed in its definition.
</p>

<p>CSS3 defines the following <dfn id="def-media-groups" title="media
group">media groups</dfn> based on the <a href="#media-types">recognized
media types</a>:</p>

<ul>
<li>
<span class="index-def" title="'continuous' media group"><a
name="continuous-media-group"><strong>continuous</strong></a></span>
or <span class="index-def" title="'paged' media group"><a
name="paged-media-group"><strong>paged</strong></a></span>.
"Both" means that the property in question applies to both media groups.
<li><span
class="index-def" title="'visual' media group"><a
name="visual-media-group"> <strong>visual</strong></a>,</span> <span
class="index-def" title="'aural' media group"><a
name="aural-media-group"><strong>aural</strong></a>,</span> or <span
class="index-def" title="'tactile' media group"><a
name="tactile-media-group"><strong>tactile</strong></a></span>.
<li><span
class="index-def" title="'grid' media group"><a
name="grid-media-group"><strong>grid</strong></a></span> (for
character grid devices), or
<span
class="index-def" title="'bitmap' media group"><a
name="bitmap-media-group"><strong>bitmap</strong></a></span>.
"Both" means that the property in question applies to both media
groups.
<li><span
class="index-def" title="'interactive' media group"><a
name="interactive-media-group"><strong>interactive</strong></a></span> (for
devices that allow user interaction), or
<span
class="index-def" title="'static' media group"><a
name="static-media-group"><strong>static</strong></a></span> (for
those that don't).
"Both" means that the property in question applies to both media
groups.
<li><span class="index-def" title="'all'
media group"> <a name="all-media-group"><strong>all</strong></a></span>
(includes all media types)
</ul>

<p>The following table shows the relationships
between media groups and media types:</p>

<TABLE border 
       summary="Relationship between media groups and media types">
<CAPTION>Relationship between media groups and media types</CAPTION>
<TR><TH>Media Types <TH colspan="4">Media Groups
<TR><TH>&nbsp;
    <TH>continuous/paged
    <TH>visual/aural/tactile
    <TH>grid/bitmap
    <TH>interactive/static
<TR><TH>aural<TD align="center">continuous<TD align="center">aural<TD align="center">N/A<TD align="center">both</TR>
<TR><TH>braille<TD align="center">continuous<TD align="center">tactile<TD align="center">grid<TD align="center">both</TR>
<TR><TH>emboss<TD align="center">paged<TD align="center">tactile<TD align="center">grid<TD align="center">both</TR>
<TR><TH>handheld<TD align="center">both<TD align="center">visual<TD
align="center">both<TD align="center">both</TR>
<TR><TH>print<TD align="center">paged<TD align="center">visual<TD
align="center">bitmap<TD align="center">static</TR>
<TR><TH>projection<TD align="center">paged<TD align="center">visual<TD align="center">bitmap<TD align="center">static</TR>
<TR><TH>screen<TD align="center">continuous<TD align="center">visual<TD align="center">bitmap<TD align="center">both</TR>
<TR><TH>tty<TD align="center">continuous<TD align="center">visual<TD align="center">grid<TD align="center">both</TR>
<TR><TH>tv<TD align="center">both<TD align="center">visual, aural<TD align="center">bitmap<TD align="center">both</TR>
</TABLE>

<h3>Shorthand properties</h3>

<p>Some properties are <span class="index-def" title="shorthand
property"><dfn>shorthand properties</dfn></span>, meaning they allow
authors to specify the values of several properties with a single
property.</p>

<p>For instance, the <span class="propinst-font">'font'</span> property
is a shorthand property for setting <span
class="propinst-font-style">'font-style'</span>, <span
class="propinst-font-variant">'font-variant'</span>, <span
class="propinst-font-weight">'font-weight'</span>, <span
class="propinst-font-size">'font-size'</span>, <span
class="propinst-line-height">'line-height'</span>, and <span
class="propinst-font-family">'font-family'</span> all at once.</p>

<p>The syntax of a shorthand property may allow some of the properties
that can be specified by that shorthand to be omitted.  When such values
are omitted from a shorthand form, each "missing" property is assigned
its initial value (see the section on <a href="cascade.html">the
cascade</a>).  The definition of a shorthand property may further say
that it resets the definitions of other properties to their initial
value.</p>

<div class="example"><p>
The multiple style rules of this example:</p>

<pre>
H1 { 
  font-weight: bold; 
  font-size: 12pt;
  line-height: 14pt; 
  font-family: Helvetica; 
  font-variant: normal;
  font-style: normal;
  font-stretch: normal;
  font-size-adjust: none
}
</pre>

<p>may be rewritten with a single shorthand property:</p>

<pre>
H1 { font: bold 12pt/14pt Helvetica }
</pre>

<p>In this example, <span
class="propinst-font-variant">'font-variant'</span>, <span
class="propinst-font-stretch">'font-stretch'</span>, <span
class="propinst-font-size-adjust">'font-size-adjust'</span>, and <span
class="propinst-font-style">'font-style'</span> 
take their initial values.</p>
</div>

<h2>Appendix: Second grammar</h2>

<p class="issue">This grammar was the Appendix D grammar of CSS2,
augmented by the additions from the @namespace draft.  It needs to be
incorporated into the above normative text in some way.</p>

<p>The grammar below defines the syntax of CSS2. It is in some sense,
however, a superset of CSS2 as this specification imposes additional
semantic constraints not expressed in this grammar. A conforming UA
must also adhere to the <a href="./syndata.html#syntax">
forward-compatible parsing rules</a>, the <a
href="./about.html#property-defs">property and value notation</a>,
and the unit notation. In
addition, the document language may impose restrictions, e.g. HTML
imposes restrictions on the possible values of the "class"
attribute.</p>

<!-- IJ: There used to be a link to "unit notation", but I couldn't
find anything in the spec that corresponded. -->

<h3>Grammar</h3>

<p>The grammar below is <span class="index-inst"
title="LL(1)">LL(1)</span> (but note that most UA's should not use it
directly, since it doesn't express the forward-compatible <a
href="#syntax">parsing conventions</a>, only the
CSS3 syntax).  The format of the productions is optimized for human
consumption and some shorthand notation beyond Yacc (see [[YACC]]) is
used:</p>

<p class="issue">It's probably not LL(1), but rather just LALR(1).</p>

<p class="issue">This needs a lot more revisions to reflect all the
additions in CSS3.</p>

<ul>
<li><strong>*</strong>: 0 or more
<li><strong>+</strong>: 1 or more
<li><strong>?</strong>: 0 or 1 
<li><strong>|</strong>: separates alternatives 
<li><strong>[&nbsp;]</strong>: grouping
</ul>

<p>The productions are:

<pre>
stylesheet
  : [ CHARSET_SYM S* STRING S* ';' ]?
    [S|CDO|CDC]* [ import [S|CDO|CDC]* ]*
    [ namespace [S|CDO|CDC]* ]*
    [ [ ruleset | media | page | font_face ] [S|CDO|CDC]* ]*
  ;
import
  : IMPORT_SYM S*
    [STRING|URI] S* [ medium [ ',' S* medium]* ]? ';' S*
  ;
namespace
  : NAMESPACE_SYM S* [namespace_prefix S*]? [STRING|URI] S* ';' S*
  ;
namespace_prefix
  : IDENT
  ;
media
  : MEDIA_SYM S* medium [ ',' S* medium ]* '{' S* ruleset* '}' S*
  ;
medium
  : IDENT S*
  ;
page
  : PAGE_SYM S* IDENT? pseudo_page? S*
    '{' S* declaration [ ';' S* declaration ]* '}' S*
  ;
pseudo_page
  : ':' IDENT
  ;
font_face
  : FONT_FACE_SYM S*
    '{' S* declaration [ ';' S* declaration ]* '}' S*
  ;
operator
  : '/' S* | ',' S* | /* empty */
  ;
combinator
  : '+' S* | '>' S* | /* empty */
  ;
unary_operator
  : '-' | '+'
  ;
property
  : IDENT S*
  ;
ruleset
  : selector [ ',' S* selector ]*
    '{' S* declaration [ ';' S* declaration ]* '}' S*
  ;
<span class="index-inst" title="selector">selector</span>
  : simple_selector [ combinator simple_selector ]*
  ;
simple_selector
  : element_name? [ HASH | class | attrib | pseudo ]* S*
  ;
class
  : '.' IDENT
  ;
element_name
  : IDENT | '*'
  ;
attrib
  : '[' S* IDENT S* [ [ '=' | INCLUDES | DASHMATCH ] S*
    [ IDENT | STRING ] S* ]? ']'
  ;
pseudo
  : ':' [ IDENT | FUNCTION S* IDENT S* ')' ]
  ;
declaration
  : property ':' S* expr prio?
  | /* empty */
  ;
prio
  : IMPORTANT_SYM S*
  ;
expr
  : term [ operator term ]*
  ;
term
  : unary_operator?
    [ NUMBER S* | PERCENTAGE S* | LENGTH S* | EMS S* | EXS S* | ANGLE S* |
      TIME S* | FREQ S* | function ]
  | STRING S* | IDENT S* | URI S* | UNICODERANGE S* | hexcolor
  ;
function
  : FUNCTION S* expr ')' S*
  ;
/*
 * There is a constraint on the <span class="index-inst" title="color">color</span> that it must
 * have either 3 or 6 hex-digits (i.e., [0-9a-fA-F])
 * after the "#"; e.g., "#000" is OK, but "#abcd" is not.
 */
hexcolor
  : HASH S*
  ;
</pre>

<h3>Lexical scanner</h3>

<p> The following is the <span class="index-def"
title="tokenizer">tokenizer</span>, written in Flex (see [[FLEX]])
notation. The tokenizer is case-insensitive.</p>

<p>The two occurrences of "\377" represent the highest character
number that current versions of Flex can deal with (decimal 255). They
should be read as "\4177777" (decimal 1114111), which is the highest
possible code point in <span class="index-inst"
title="unicode">Unicode</span>/<span class="index-inst"
title="iso-10646">ISO-10646</span>, except excluding the characters
excluded in the <code><a href="#SUBTOK-nonascii">nonascii</a></code>
production above.</p>

<!-- ignored whitespace after Unicode escape, is it OK? -->
<pre>
%option case-insensitive

h		[0-9a-f]
nonascii	[\200-\377]
unicode		\\{h}{1,6}[ \t\r\n\f]?
escape		{unicode}|\\[ -~\200-\377]
nmstart		[a-z-]|{nonascii}|{escape}
nmchar		[a-z0-9-]|{nonascii}|{escape}
string1		\"([\t !#$%&amp;(-~]|\\{nl}|\'|{nonascii}|{escape})*\"
string2		\'([\t !#$%&amp;(-~]|\\{nl}|\"|{nonascii}|{escape})*\'

ident		{nmstart}{nmchar}*
name		{nmchar}+
num		[0-9]+|[0-9]*"."[0-9]+
string		{string1}|{string2}
url		([!#$%&amp;*-~]|{nonascii}|{escape})*
w		[ \t\r\n\f]*
nl		\n|\r\n|\r|\f
range		\?{1,6}|{h}(\?{0,5}|{h}(\?{0,4}|{h}(\?{0,3}|{h}(\?{0,2}|{h}(\??|{h})))))

%%

[ \t\r\n\f]+		{return S;}

\/\*[^*]*\*+([^/][^*]*\*+)*\/	/* ignore comments */

"&lt;!--"			{return CDO;}
"-->"			{return CDC;}
"~="			{return INCLUDES;}
"|="			{return DASHMATCH;}

{string}		{return STRING;}

{ident}			{return IDENT;}

"#"{name}		{return HASH;}

"@import"		{return IMPORT_SYM;}
"@page"			{return PAGE_SYM;}
"@media"		{return MEDIA_SYM;}
"@font-face"		{return FONT_FACE_SYM;}
"@charset"		{return CHARSET_SYM;}
"@namespace"		{return NAMESPACE_SYM;}

"!{w}important"		{return IMPORTANT_SYM;}

{num}em			{return EMS;}
{num}ex			{return EXS;}
{num}px			{return LENGTH;}
{num}cm			{return LENGTH;}
{num}mm			{return LENGTH;}
{num}in			{return LENGTH;}
{num}pt			{return LENGTH;}
{num}pc			{return LENGTH;}
{num}deg		{return ANGLE;}
{num}rad		{return ANGLE;}
{num}grad		{return ANGLE;}
{num}ms			{return TIME;}
{num}s			{return TIME;}
{num}Hz			{return FREQ;}
{num}kHz		{return FREQ;}
{num}{ident}		{return DIMEN;}
{num}%			{return PERCENTAGE;}
{num}			{return NUMBER;}

"url("{w}{string}{w}")"	{return URI;}
"url("{w}{url}{w}")"	{return URI;}
{ident}"("		{return FUNCTION;}

U\+{range}		{return UNICODERANGE;}
U\+{h}{1,6}-{h}{1,6}	{return UNICODERANGE;}

.			{return *yytext;}
</pre>


<h2 class="no-num">Changes from CSS2</h2>

<p>This section is informative.</p>

<p>
  The parts of CSS2 that have become part of this CSS3 draft are
  sections 1.3.2 (1.4.2 in CSS 2.1), 1.3.3 (1.4.3 in CSS2.1), 3 (parts),
  4.1, 4.2, 4.4, and 6.3, 7, and Appendix D.  This draft also contains
  new material on namespaces and on vendor extensions to CSS that began
  as separate documents.
</p>

<ul>
  <li>The text taken from Chapter 1 of CSS2 is now normative rather than
  informative.</li>

  <li>added the section on vendor extensions and added the
  <span class="css">'-'</span> character to the
  nmstart macro so that identifiers can begin with it</li>

  <li>modified the rules for handling parsing errors
  to allow implementations that support only parts of CSS3</li>

  <li>described how style sheets that cannot be parsed according to the
  grammar should be handled (by saying that parsing uses the parseable
  initial sequence of tokens)</li>

  <li><span class="issue">(to be done)</span> described handling of unmatched quotation marks (by saying that
  tokenization uses the tokenizable initial sequence of characters)</li>

  <li><span class="issue">(to be done)</span> formalized the error handling rules by combining the
  forward-compatible grammar in chapter 4 with the CSS2 grammar in
  Appendix D.</li>

  <li>combined DELIM and other single character tokens into CHAR</li>

  <li>explicitly stated that the byte order mark should be ignored for
  purposes of the grammar</li>

  <li>Changed the acceptable characters to exclude surrogate blocks and
  #xFFFE, #xFFFF, as in XML.</li>

</ul>

<h2 class="no-num">Acknowledgments</h2>

<p>Since most of this draft is taken from CSS2, it would not have been
possible to write it so easily without the work of the editors and
authors of [[CSS1]] and [[CSS2]].  This draft also borrows heavily from
earlier drafts on CSS namespace support by Peter Linss [[CSS3NAMESPACE]]
and early (unpublished) drafts on vendor extensions to CSS by Bert Bos.
Many current and former members of the working group have contributed to
this document.  Discussions on <code><a
href="http://lists.w3.org/Archives/Public/www-style/">www-style@w3.org</a></code>
and in other places have also contributed ideas to this specification.
Comments from Glenn Adams, Bj&ouml;rn H&ouml;hrmann, and Etan Wexler
have been particularly helpful.</p>

<h2 class="no-num">References</h2>

<h3 class="no-num">Normative references</h3>

<!-- begin-normative -->
<p>[Here will be inserted the file "normative.inc"]</p>
<!-- end-normative -->

<h3 class="no-num">Other references</h3>

<!-- begin-informative -->
<p>[Here will be inserted the file "informative.inc"]</p>
<!-- end-informative -->

<h2 class="no-num">Index</h2>
<!--index-->
</body>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-declaration:"~/SGML/HTML4.decl"
sgml-default-doctype-name:"html"
sgml-minimize-attributes:t
sgml-nofill-elements:("pre" "style" "br")
sgml-live-element-indicator:t
End:
-->
</html>
