<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>CSS Writing Modes Module Level 3</title>
  <link rel="stylesheet" type="text/css" href="../default.css">
  <style type="text/css">
    object { vertical-align: middle; }
    .sidebar { float: right; background: #eee; border: solid gray; margin: 1em; }
    .landscape { height: 10em; }
    .portrait { width: 10em; }
    .sidebar .figure { margin: 1em; }
    .sidebar object { margin: 0 auto; display: block; }
    .figurepair { display: table; margin: 1em auto; }
    .figurepair .figure { display: table-cell; }
     h2, .example { clear: both; }
  </style>
  <link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/tr/W3C-ED.css">
</head>

<body>

<div class="head">

<!--logo-->

<h1>CSS Writing Modes Module Level 3</h1>

<h2 class="no-num no-toc">[LONGSTATUS] [DATE]</h2>
<dl>
  <dt>This version:</dt>
    <dd><a href="http://dev.w3.org/csswg/css3-writing-modes/">http://dev.w3.org/csswg/css3-writing-modes/</a>
  <dt>Latest version:</dt>
    <dd><a
      href="http://www.w3.org/TR/css3-writing-modes/">http://www.w3.org/TR/css3-writing-modes/</a></dd>
  <dt>Previous version:</dt>
    <dd><a
      href="http://www.w3.org/TR/2003/CR-css3-text-20030514/">http://www.w3.org/TR/2003/CR-css3-text-20030514/</a></dd>
  <dt>Editors:</dt>
    <dd><a href="http://fantasai.inkedblade.net/contact">Elika J. Etemad</a> (Invited Expert)</dd>
    <dd><a href="mailto:kojiishi@gluesoft.co.jp">Koji Ishii</a> (<a href="http://www.antenna.co.jp/">Antenna House</a>)</dd>
    <dd><a href="mailto:murakami@antenna.co.jp">Shinyu Murakami</a> (<a href="http://www.antenna.co.jp/">Antenna House</a>)</dd>
  <dt>Previous Editors:</dt>
    <dd><a href="mailto:paulnel@microsoft.com">Paul Nelson</a> (<a href="http://www.microsoft.com/">Microsoft</a>)</dd>
    <dd><a href="mailto:michelsu@microsoft.com">Michel Suignard</a> (<a href="http://www.microsoft.com/">Microsoft</a>)</dd>
</dl>

<!--begin-copyright-->
<p>[Here will be included the file "../copyright.inc"]</p>
<!--end-copyright-->

<hr title="Separator for header">
</div>

<h2 class="no-num no-toc" id="abstract">Abstract</h2>

  <p>This module specifies the text layout model in CSS and the properties
    that control it. It covers bidirectional and vertical text.</p>

<h2 class="no-num no-toc" id="status">Status of this document</h2>

<!--status-->

<h2 class="no-num no-toc" id="Contents">Contents</h2>

<!--toc-->

<h2 id="intro">Introduction</h2>

  <p>This module defines support for various international writing directions,
    such as left-to-right (e.g., Latin scripts), right-to-left (e.g., Hebrew
    or Arabic), bidirectional (e.g., mixing Latin with Arabic) and vertical
    (e.g., Asian scripts).</p>

  <p>Inherently bottom-to-top scripts are not handled in this version. See
    [[UTN22]] for an explanation of relevant issues.</p>

<h2 id="text-flow">Writing Modes and Terminology</h2>

  <p>A <dfn>writing mode</dfn> in CSS is determined by the 'writing-mode',
    'direction', and 'text-orientation' properties. It is defined primarily
    in terms of its <i>inline base direction</i> and <i>block flow
    direction</i>:

  <div class="sidebar">
    <div class="figure right">
      <object data="diagrams/text-flow-vectors-tb.svg" type="image/svg+xml"
        class="landscape"></object>
      <p class="caption">Latin-based writing mode
    </div>
      <div class="figure left">
        <object data="diagrams/text-flow-vectors-lr-reverse.svg" type="image/svg+xml"
          class="portrait"></object>
        <p class="caption">Mongolian-based writing mode
      </div>
      <div class="figure right">
        <object data="diagrams/text-flow-vectors-tb.svg" type="image/svg+xml"
          class="landscape"></object>
        <object data="diagrams/text-flow-vectors-rl.svg" type="image/svg+xml"
          class="portrait"></object>
        <p class="caption">Han-based writing mode
      </div>
  </div>

  <p>The <dfn>inline base direction</dfn> is the primary direction in which
    content is ordered on a line and defines on which sides the "start"
    and "end" of a line are. The 'direction' property specifies the
    inline base direction of an element and, together with the 'unicode-bidi'
    property and the inherent directionality of any text content, determines
    the ordering of inline-level content within a line.

  <p>The <dfn>block flow direction</dfn> is the direction in which
    block-level boxes stack  and the direction in which line boxes stack
    within a block container. The 'writing-mode' property determines the
    block flow direction.</p>

  <p>A <dfn>horizontal writing mode</dfn> is one with horizontal lines of
    text, i.e. a downward or upward block flow. A <dfn>vertical writing
    mode</dfn> is one with vertical lines of text, i.e. a leftward or
    rightward block flow.

  <p class="note">These terms should not be confused with
    <dfn>vertical block flow</dfn> (which is a downward or
    upward block flow) and <dfn>horizontal block flow</dfn> (which is
    leftward or rightward block flow). To avoid confusion, the CSS
    specifications avoid this latter set of terms.</p>

  <p>Writing systems typically have one or two native writing modes. Some
    examples are:
  <ul>
    <li>Latin-based systems are typically written using a left-to-right inline
      direction with a downward (top-to-bottom) block flow direction.
    <li>Arabic-based systems are typically written using a right-to-left
      inline direction with a downward (top-to-bottom) block flow direction.
    <li>Mongolian-based systems are typically written using a top-to-bottom
      inline direction with a rightward (left-to-right) block flow direction.
    <li>Han-based systems are commonly written using a left-to-right inline direction
      with a downward (top-to-bottom) block flow direction, <strong>or</strong>
      a top-to-bottom inline direction with a leftward (right-to-left) block
      flow direction. Many magazines and newspapers will mix these two writing
      modes on the same page.
  </ul>

  <p>Some additional characteristics, the line orientation and glyph
    orientation, are primarily used to handle scripts placed in a non-native
    writing mode. The <dfn>line orientation</dfn> determines which side of
    the line is the "top" and thus which sides are <dfn>under</dfn> or
    <dfn>over</dfn> the line. This determines the interpretation of
    alignment in the transverse dimension of the line. It also determines
    the default <dfn>glyph orientation</dfn> for scripts in a non-native
    orientation. These characteristics are controlled by the 'text-orientation'
    property.

  <div class="example">
    <p>In the following example, two blocks elements (1 and 3) separated
      by an image (2) are presented in various flow writing modes.</p>

    <p>Here is a diagram of horizontal writing mode (<code>writing-mode: horizontal-tb</code>):</p>

    <p><img alt="Diagram of horizontal layout: blocks 1, 2, and 3 are stacked top-to-bottom"
            src="horizontal.png" width="219" height="300" ></p>

    <p>Here is a diagram for the right-to-left vertical writing mode commonly
      used in East Asia (<code>writing-mode: vertical-rl</code>):</p>

    <p><img alt="Diagram of a right-to-left vertical layout: blocks 1, 2,
                  and 3 are arranged side by side from right to left"
              src="vertical-rl.png" height="191" width="297" ></p>

    <p>And finally, here is a diagram for the left-to-right vertical
      writing mode used for Uighur and Mongolian (<code>writing-mode: lr</code>):</p>

    <p><img alt="Diagram of left-to-right vertical layout: blocks 1, 2,
                  and 3 are arranged side by side from left to right"
            src="vertical-lr.png" height="191" width="300" ></p>
  </div>

  <p class="note">See Unicode Technical Note #22 [[UTN22]]
    (<a href="http://fantasai.inkedblade.net/style/discuss/vertical-text/paper">HTML version</a>)
    for a more in-depth introduction to writing modes and vertical text.

<h2 id="text-direction">Inline Direction and Bidirectionality</h2>

  <p>While the characters in most scripts are written from left to right,
    certain scripts are written from right to left. In some documents,
    in particular those written with the Arabic  or Hebrew script, and in
    some mixed-language contexts, text in a single (visually displayed)
    block may appear with mixed directionality. This phenomenon is called
    <span class="index-def" title="bidirectionality (bidi)"><dfn>bidirectionality</dfn></span>, or
    "bidi" for short.</p>

  <p>The Unicode standard (<a href="http://www.unicode.org/reports/tr9/">Unicode Standard Annex #9</a>) defines a complex
    algorithm for determining the proper ordering of bidirectional text. The
    algorithm consists of an implicit part based on character properties,
    as well as explicit controls for embeddings and overrides. CSS relies
    on this algorithm to achieve proper bidirectional rendering. The <span
    class="propinst-direction">'direction'</span> and <span
    class="propinst-unicode-bidi">'unicode-bidi'</span> properties allow
    authors to specify how the elements and attributes of a document
    language map to this algorithm.</p>

  <p>User agents that support bidirectional text must apply the Unicode
    bidirectional algorithm to every sequence of inline boxes uninterrupted
    by a forced (<a href="http://www.unicode.org/reports/tr9/#Bidirectional_Character_Types">bidi class B</a>)
    line break or block boundary. This sequence forms the "paragraph" unit
    in the bidirectional algorithm. The paragraph embedding level is set
    according to the value of the 'direction' property of the containing
    block rather than by the heuristic given in steps P2 and P3 of the Unicode
    algorithm.</p>

  <p>Because the base directionality of a text depends on the structure and
    semantics of the document, these properties should in most cases be
    used only to map bidi information in the markup to its corresponding
    CSS styles. If a document language provides markup features to control
    bidi, authors and users should use those features and not specify CSS
    rules to override them.</p>

  <p>The HTML 4 specification ([[HTML401]], section 8.2) defines
    bidirectionality behavior for HTML elements. The HTML 4 specification
    also contains more information on bidirectionality issues.</p>

  <p class="note">Because HTML UAs can turn off CSS styling, we advise HTML 
    authors to use the HTML 'dir' attribute and &lt;bdo&gt; element to
    ensure correct bidirectional layout in the absence of a style sheet.</p>  

<h3 id="direction">Specifying Directionality: the 'direction' property</h3>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>direction</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td>ltr | rtl </td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>ltr</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>all elements</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>yes</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>N/A</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>specified value</td>
      </tr>
    </tbody>
  </table>

  <p>This property specifies the base directionality of text and elements
    on a line, and the directionality of embeddings and overrides (see
    'unicode-bidi') for the Unicode
    bidirectional algorithm. In addition, it affects the ordering of <a
    href="http://www.w3.org/TR/CSS21/tables.html">table</a> column layout,
    the direction of horizontal <a href="http://www.w3.org/TR/CSS21/visufx.html#overflow">overflow</a>,
    and the default alignment of text within a line, and other things
    that depend on the base inline base direction.</p>

  <p>Values for this property have the following meanings:</p>

  <dl>
   <dt><strong>ltr</strong></dt>
   <dd>Left-to-right directionality.</dd>
   <dt><strong>rtl</strong></dt>
   <dd>Right-to-left directionality.</dd>
  </dl>

  <p class="note">The 'direction' property has no reordering in inline-level
    elements whose 'unicode-bidi' property's value is ''normal''.</p>

  <p>The value of the 'direction' property on the root element is also
    propagated to the initial containing block and, together with the
    'writing-mode' property, determines the document's principal writing
    mode. (See <a href="#principal-writing-mode">below</a>.)

  <p class="note">Note that the 'direction' property of the HTML BODY
    element is <em>not</em> propagated to the viewport. That special
    behavior only applies to the background and overflow properties.

  <p class="note">The 'direction'
     property, when specified for table column elements, is not inherited by
     cells in the column since columns are not the ancestors of the cells in
     the document tree. Thus, CSS cannot easily capture the "dir" attribute
     inheritance rules described in [[HTML401]], section 11.3.2.1.

<h3 id="unicode-bidi">Embeddings and Overrides: the 'unicode-bidi' property</h3>

    <table class="propdef">
      <tbody>
        <tr>
          <th>Name:</th>
          <td><dfn>unicode-bidi</dfn></td>
        </tr>
        <tr>
          <th>Value:</th>
          <td>normal | [ [ embed | isolate ] || [ plaintext | bidi-override ] ]</td>
        </tr>
        <tr>
          <th>Initial:</th>
          <td>normal</td>
        </tr>
        <tr>
          <th>Applies to:</th>
          <td>all elements, but see prose</td>
        </tr>
        <tr>
          <th>Inherited:</th>
          <td>no</td>
        </tr>
        <tr>
          <th>Percentages:</th>
          <td>N/A</td>
        </tr>
        <tr>
          <th>Media:</th>
          <td>visual</td>
        </tr>
        <tr>
          <th>Computed&#160;value:</th>
          <td>specified value</td>
        </tr>
      </tbody>
    </table>

  <p>Values for this property have the following meanings:</p>

  <dl>
    <dt><strong>normal</strong></dt>
    <dd>The element does not open an additional level of embedding with
      respect to the bidirectional algorithm. For inline-level elements,
      implicit reordering works across element boundaries.</dd>
    <dt><strong>embed</strong></dt>
    <dd>If the element is inline-level, this value
      opens an additional level of embedding with respect to the
      bidirectional algorithm. The direction of this embedding level is
      given by the 'direction'
      property. Inside the element, reordering is done implicitly. This
      corresponds to adding a LRE (U+202A; for 'direction: ltr') or RLE
      (U+202B; for 'direction: rtl') at the start of the element and a PDF
      (U+202C) at the end of the element.</dd>
    <dt><strong>bidi-override</strong></dt>
    <dd>For inline-level elements this creates an override.
      For block-level, table-cell, table-caption, or inline-block elements 
      this creates an override for inline-level descendants not within 
      another block-level, table-cell, table-caption, or inline-block 
      element. This means that inside the element, reordering is strictly in sequence
      according to the <span class="propinst-direction">'direction'</span>
      property; the implicit part of the bidirectional algorithm is
      ignored. This corresponds to adding a LRO (U+202D; for 'direction:
      ltr') or RLO (U+202E; for 'direction: rtl') at the start of the
      element and a PDF (U+202C) at the end of the element.</dd>
    <dt><strong>isolate</strong></dt>
    <dd>For the purposes of the Unicode bidirectional algorithm, the
      contents of the element are considered to be inside a separate,
      independent paragraph, and for the purpose of bidi resolution
      in its containing bidi paragraph (if any), the element itself is
      treated as if it were an Object Replacement Character (U+FFFC).
      (If the element is broken across multiple lines, then each box
      of the element is treated as an Object Replacement Character.)</dd>
    <dt><strong>plaintext</strong></dt>
    <dd><p>For the purposes of the Unicode bidirectional algorithm, the
      base directionality of each "paragraph" for which the element
      is the containing block element is determined not by the element's
      computed 'direction' as usual, but by following rules P1, P2,
      and P3 of the Unicode bidirectional algorithm. However, if no
      direction-determining character is found in step P2, then the
      value of the 'direction' property is used instead. Note this value
      has no effect on inline elements.
  </dl>

  <p>The final order of characters in each block-level element is the
    same as if the bidi control codes had been added as described above,
    markup had been stripped, and the resulting character sequence had
    been passed to an implementation of the Unicode bidirectional
    algorithm for plain text that produced the same line-breaks as the
    styled text. In this process, non-textual entities such as images are
    treated as neutral characters, unless their <span
    class="propinst-unicode-bidi">'unicode-bidi'</span> property has a
    value other than 'normal', in which case they are treated as strong
    characters in the <span class="propinst-direction">'direction'</span>
    specified for the element.</p>

  <p>Please note that in order to be able to flow inline boxes in a
    uniform direction (either entirely left-to-right or entirely
    right-to-left), more inline boxes (including anonymous inline boxes)
    may have to be created, and some inline boxes may have to be split up
    and reordered before flowing.</p>

  <p>Because the Unicode algorithm has a limit of 
    <em title="According to unicode 3.0, chapter 3, section 12, definition BD2. 
    Specifically, page 58 here: http://www.unicode.org/unicode/uni2book/ch03.pdf">
    61 levels</em> of embedding, care should be taken not to use <span
    class="propinst-unicode-bidi">'unicode-bidi'</span> with a value other
    than 'normal' unless appropriate. In particular, a value of 'inherit'
    should be used with extreme caution. However, for elements that are,
    in general, intended to be displayed as blocks, a setting of
    'unicode-bidi: isolate' is preferred to keep the element together in
    case display is changed to inline (see example below).</p>

  <p>The following example shows an XML document with bidirectional
    text. It illustrates an important design principle: document language
    designers should take bidi into account both in the language proper
    (elements and attributes) and in any accompanying style sheets. The
    style sheets should be designed so that bidi rules are separate from
    other style rules, and such rules should not be overridden by other
    style sheets so that the document language's bidi behavior is preserved.</p>

<h3 id="bidi-example">Example of Bidirectional Text</h3>

  <div class="example">
    <p>In this example, lowercase letters stand for inherently left-to-right
      characters and uppercase letters represent inherently right-to-left
      characters. The text stream is shown in logical backing store order.</p>

    <pre class="xml-example"><code class="xml">
&lt;HEBREW&gt;
  &lt;PAR&gt;HEBREW1 HEBREW2 english3 HEBREW4 HEBREW5&lt;/PAR&gt;
  &lt;PAR&gt;HEBREW6 &lt;EMPH&gt;HEBREW7&lt;/EMPH&gt; HEBREW8&lt;/PAR&gt;
&lt;/HEBREW&gt;
&lt;ENGLISH&gt;
  &lt;PAR&gt;english9 english10 english11 HEBREW12 HEBREW13&lt;/PAR&gt;
  &lt;PAR&gt;english14 english15 english16&lt;/PAR&gt;
  &lt;PAR&gt;english17 &lt;HE-QUO&gt;HEBREW18 english19 HEBREW20&lt;/HE-QUO&gt;&lt;/PAR&gt;
&lt;/ENGLISH&gt;
    </code></pre>

    <p>Since this is arbitrary XML, the style sheet is responsible for
      setting the writing direction. This is the style sheet:</p>

    <pre>
/* Rules for bidi */
HEBREW, HE-QUO  {direction: rtl; unicode-bidi: embed;}
ENGLISH         {direction: ltr; unicode-bidi: embed;} 

/* Rules for presentation */
HEBREW, ENGLISH, PAR  {display: block;}
EMPH                  {font-weight: bold;}
    </pre>

    <p>The HEBREW element is a block with a right-to-left base direction,
      the ENGLISH element is a block with a left-to-right base
      direction. The PARs are blocks that inherit the base direction from
      their parents. Thus, the first two PARs are read starting at the top
      right, the final three are read starting at the top left.  Please note
      that HEBREW and ENGLISH are chosen as element names for explicitness
      only; in general, element names should convey structure without
      reference to language.</p>

    <p>The EMPH element is inline-level, and since its value for <span
      class="propinst-unicode-bidi">'unicode-bidi'</span> is 'normal' (the
      initial value), it has no effect on the ordering of the text. The
      HE-QUO element, on the other hand, creates an embedding.</p>

    <p>The formatting of this text might look like this if the line length
      is long:</p>

    <pre class="ascii-art">
               5WERBEH 4WERBEH english3 2WERBEH 1WERBEH

                                8WERBEH <b>7WERBEH</b> 6WERBEH

english9 english10 english11 13WERBEH 12WERBEH

english14 english15 english16

english17 20WERBEH english19 18WERBEH
    </pre>

    <p>Note that the HE-QUO embedding causes HEBREW18 to be to the right
      of english19.</p>

    <p>If lines have to be broken, it might be more like this:</p>

    <pre class="ascii-art">
       2WERBEH 1WERBEH
  -EH 4WERBEH english3
                 5WERB

   -EH <b>7WERBEH</b> 6WERBEH
                 8WERB

english9 english10 en-
glish11 12WERBEH
13WERBEH

english14 english15
english16

english17 18WERBEH
20WERBEH english19
    </pre>

    <p>Because HEBREW18 must be read before english19, it is on the line
      above english19. Just breaking the long line from the earlier
      formatting would not have worked. Note also that the first syllable
      from english19 might have fit on the previous line, but hyphenation of
      left-to-right words in a right-to-left context, and vice versa, is
      usually suppressed to avoid having to display a hyphen in the middle
      of a line.</p>

  </div><!-- example -->

<h3 id="bidi-box-model">Box model for inline elements in bidirectional context</h3>
<!-- CSS2.1 8.6 -->
  <p>For each line box, UAs must take the inline boxes generated for each
    element and render the margins, borders and padding in visual order
    (not logical order).

  <p>When the element's 'direction' property is ''ltr'', the left-most
    generated box of the first line box in which the element appears
    has the left margin, left border and left padding, and the right-most
    generated box of the last line box in which the element appears has
    the right padding, right border and right margin.

  <p>When the element's 'direction' property is ''rtl'', the right-most
    generated box of the first line box in which the element appears has
    the right padding, right border and right margin, and the left-most
    generated box of the last line box in which the element appears has
    the left margin, left border and left padding.

<h2 id="writing-mode">Block Flow Direction: the 'writing-mode' property</h2>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>writing-mode</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td>horizontal-tb | vertical-rl | vertical-lr</td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>horizontal-tb</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>All elements except table row groups, table column groups, table rows, and table columns</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>yes</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>N/A</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>specified value</td>
      </tr>
    </tbody>
  </table>

  <p>This property sets the block flow direction. Possible values:</p>

  <dl>
    <dt>horizontal-tb</dt>
    <dd>Top-to-bottom block flow. The writing mode is horizontal.</dd>
    <dt>vertical-rl</dt>
    <dd>Right-to-left block flow. The writing mode is vertical.</dd>
    <dt>vertical-lr</dt>
    <dd>Left-to-right block flow. The writing mode is vertical.</dd>
  </dl>

  <p>SVG1.1 [[!SVG11]] defines some additional values: ''lr'',
    ''lr-tb'', ''rl'', ''rl-tb'', ''tb'', and ''tb-rl''. These values
    are <em>deprecated</em> in any context except SVG1 documents.
    Implementations that wish to support them in the context of CSS
    must treat these values as follows:

  <table class="data">
    <thead>
      <tr><th>SVG1</th> <th>CSS</th></tr>
    </thead>
    <tbody>
      <tr><td>lr</td> <td rowspan=3>horizontal-tb</td></tr>
      <tr><td>lr-tb</td></tr>
      <tr><td>rl</td></tr>
      <tr><td>tb</td> <td rowspan=2>vertical-rl</td></tr>
      <tr><td>tb-rl</td></tr>
    </tbody>
  </table>

  <p class="note">In SVG1.1, these values set the <dfn>inline progression
    direction</dfn>, in other words, the direction the current text position
    advances each time a glyph is added. This is a geometric process that
    happens <em>after</em> bidi reordering, and thus has no effect on the
    interpretation of the 'direction' property (which is independent of
    'writing-mode'). (See <a href="http://www.w3.org/TR/SVG/text.html#RelationshipWithBiDirectionality">Relationship
    with bidirectionality</a>. [[!SVG11]]) There are varying interpretations
    on whether this process causes "writing-mode: rl" to merely shift the
    text string or reverse the order of all glyphs in the text.</p>

  <p class="issue">See <a href="test-writing-mode-direction.svg">this demo</a>
    to check out your implementation's interpretation! (Note that most
    SVG implementations don't support the 'direction' property, and
    thus your results may be skewed on that account. Examine the red
    line of text: if the numbers are not in reverse order, your
    implementation doesn't support "direction: rtl".)</p>

  <p>The 'writing-mode' property determines the direction of block flow.
    This determines the progression of block-level boxes in a block formatting
    context; the progression of line boxes in a block container that contains
    inlines; and the progression of rows in a table.
    As a result it also determines which side of a box is its <dfn>before</dfn>
    edge (i.e. the edge that comes earlier in the progression) and which side
    is its <dfn>after</dfn> edge (i.e. the edge that comes later in the
    progression).

  <p>The 'writing-mode' property, by virtue of determining the stacking
    direction of line boxes, determines whether line boxes and thus the
    writing mode of text are horizontal or vertical. However, it does not
    determine the orientation of the line boxes' contents or the start
    and end sides of the line. See
    <a href="#line-orientation">Line orientation</a>.

  <p>When set on the root element, the 'writing-mode' property together
    with the 'direction' property determines the
    <dfn id="principal-writing-mode">principal writing mode</dfn>
    of the document. This writing mode is used, for example,
    to determine the default page progression direction. See [[CSS3PAGE]]
    The 'writing-mode' value of the root element is also propagated to
    the initial containing block and sets the block flow direction of the
    initial block formatting context.

  <p class="note">Note that the 'direction' property of the HTML BODY
    element is <em>not</em> propagated to the viewport. That special
    behavior only applies to the background and overflow properties.

  <p>If an element has a different block flow direction than its containing
    block:
  <ul>
   <li>If the element has a specified 'display' of ''inline'', its 'display'
     computes to 'inline-block'. [[!CSS21]]
   <li>If the element has a specified 'display' of ''run-in'', its 'display'
     computes to 'block'. [[!CSS21]]
  </ul>
  <p>If such an element is a block container, then it establishes a new
    block formatting context.

  <p>The content of replaced elements do not rotate due to the writing mode:
    images, for example, remain upright. However replaced content
    involving text (such as MathML content or form elements) should match
    the replaced element's writing mode and line orientation if the UA
    supports such a vertical writing mode for the replaced content.

  <h3 id="vertical-layout">Box Layout in Vertical Writing Modes</h3>

  <p>CSS box layout in vertical writing modes is analogous to layout in
    the horizontal writing modes, following the principles outlined below:

  <ul>
    <li>Layout calculation rules applied to the horizontal dimension in
        horizontal writing modes apply to the vertical dimension in vertical
        writing modes. Likewise, layout calculation rules applied to the
        vertical dimension in horizontal writing modes apply to the horizontal
        dimension in vertical writing modes. See <a href="#dimensions">Logical vs
        Physical Dimensions</a> for details.</li>
    <li>Layout calculation rules that refer to the '*-left' and '*-right'
        box properties (border, margin, padding) use '*-top' and '*-bottom'
        instead, and vice versa.
        See <a href="#logical-directions">Logical Directions</a> for a fuller
        discussion of such directional swapping.
    <li>Layout rules that depend on the 'direction' property to choose between
        left and right (e.g. overflow, overconstraint resolution, the initial
        value for 'text-align', table column ordering)
        are abstracted to the <a href="#start">start</a> and
        <a href="#end">end</a> sides and applied appropriately.</li>
  </ul>

  <p>For features such as text alignment, floating, and list marker positioning,
    that primarily reference the left or right sides of the line box or
    its longitudinal parallels and therefore have no top or bottom equivalent,
    the <a href="#line-left">line left</a> and <a href="#line-right">line
    right</a> sides are used as the reference for the left and right sides
    respectively. See <a href="#line-directions">Line-Relative Directions</a>
    for details.

  <p>Likewise for features such as underlining, overlining, and baseline alignment
    (the unfortunately-named 'vertical-align'), that primarily reference the
    top or bottom sides of the linebox or its transversal parallels and
    therefore have no left or right equivalent, the <a href="#over">over</a>
    and <a href="#under">under</a> sides are used as the reference for the
    top and bottom sides respectively.
    (See <a href="#line-directions">Line-Relative Directions</a>.)

<h2 id="line-orientation">Line Orientation</h2>

  <!-- <p>The block flow direction given by 'writing-mode' determines only the
    ordering and placement of the line boxes -->

  <p>Every line box has an orientation. Whether its orientation is horizontal
    or vertical is determined by the 'writing-mode' property. Given that,
    which side is its "top", or <em>over</em> edge, is determined by the
    'text-orientation' property on its containing block, and is independent
    of the block flow direction.

  <p>In addition to its <dfn>over</dfn> (ascender side) and <dfn>under</dfn>
    (descender side) edges, a line box, even a vertically-oriented one, also
    has a "left" and "right" side, which we will call the <dfn>line left</dfn>
    and <dfn>line right</dfn> sides of the box to distinguish from the physical
    left and physical right sides of the box.

    <div class="figure">
      <object data="diagrams/line-orient-up.svg" type="image/svg+xml"
        class="landscape"></object>
      <p class="caption">Line orientation compass</p>
    </div>

  <p>The <dfn>start</dfn> edge of a box is nominally the edge from which
    text of its inline base direction will start. For boxes with
    a used 'direction' value of ''ltr'', this means the <i>line left</i>
    edge. For boxes with a used 'direction' value of ''rtl'', this means
    the <i>line right</i> edge. The edge opposite the start edge is the
    <dfn>end</dfn> edge.

  <p>These directional mappings exist even for boxes that do not contain any
    line boxes: they are calculated by the values of the 'writing-mode',
    'text-orientation', and 'direction' properties only.

  <p class="note">Note that determining the <i>start</i> and <i>end</i>
    edges of a box depends not only on its 'writing-mode' and 'direction'
    properties, but also its 'text-orientation' property.</p>

  <div class="figurepair">
    <div class="figure">
      <object data="diagrams/line-orient-right.svg" type="image/svg+xml"
        class="portrait"></object>
      <p class="caption">Typical orientation in vertical</p>
    </div>

    <div class="figure">
      <object data="diagrams/line-orient-left.svg" type="image/svg+xml"
        class="portrait"></object>
      <p class="caption">Line orientation with ''text-orientation: rotate-left''</p>
    </div>
  </div>

  <p class="note">Note also that while the <i>over</i> and <i>under</i>
    directions often map to the same directions as <a href="#before">before</a>
    and <a href="#after">after</a> respectively, this mapping is reversed
    for some combinations of 'writing-mode' and 'text-orientation'.

  <h3 id="text-orientation">Orienting Text: the 'text-orientation' property</h3>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>text-orientation</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td>vertical-right | upright | rotate-right | rotate-left | rotate-normal | auto</td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>vertical-right</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>all elements except table row groups, rows, column groups, and columns</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>yes</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>N/A</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>specified value</td>
      </tr>
    </tbody>
  </table>

  <p>This property specifies the orientation of characters in a non-native
    'writing-mode' and sets the orientation of the line. Current values only
    have an effect in vertical writing  modes. Values have the following
    meanings:</p>

  <dl>
    <dt><dfn>vertical-right</dfn></dt>
    <dd><p>In vertical writing modes, grapheme clusters from scripts that
      do not have an intrinsic vertical orientation are rotated 90&deg;
      clockwise from their standard orientation in horizontal text.
      When available, vertical glyph variants and vertical font metrics
      are used to set all punctuation and characters from any script
      that is not rotated.
      This value is typical for layout of primarily vertical-script
      text.
    <dt><dfn>upright</dfn></dt>
    <dd><p>In vertical writing modes, grapheme clusters that do not have an
      intrinsic vertical orientation are rendered upright, i.e. in their
      standard horizontal orientation. Shaping characters are shaped in
      their isolated forms. When available, vertical glyph variants and
      vertical font metrics are used to set the text. The UA should
      synthesize vertical font metrics for grapheme clusters that do not
      have any.
      <p>For the purposes of bidi reordering, this value causes all
      characters to be treated as strong LTR.
      This value causes the used value of 'direction' to be ''ltr''.
    <dt><dfn>rotate-right</dfn></dt>
    <dd><p>In vertical writing modes, this causes text to be set as if
      in a horizontal layout (using horizontal glyph variants and metrics),
      but rotated 90&deg; clockwise.
      This value is typical for ''vertical-rl'' text in a primarily
      horizontal-script document.
    <dt><dfn>rotate-left</dfn></dt>
    <dd><p>In vertical writing modes, this causes text to be set as if
      in a horizontal layout (using horizontal glyph variants and metrics),
      but rotated 90&deg; counter-clockwise.
      This value is typical for ''vertical-lr'' text in a primarily
      horizontal-script document.
      <p>If set on a non-replaced inline whose parent is not ''rotate-left'',
      this forces ''isolate'' to be added to the computed value of 'unicode-bidi'.
      Layout of text is exactly as for ''rotate-right'' except that the
      entire text content and baseline table of the element is mirrored:
      each box of the inline is mirrored around a vertical axis such that
      its content box does not move. (However the contents of atomic
      inlines are not mirrored; only their alignment is changed.)
      Similarly, if a child of the element has a 'text-orientation' value
      other than ''rotate-left'', an analogous transformation is applied.
    <dt><dfn>rotate-normal</dfn></dt>
    <dd><p>This value is equivalent to ''rotate-right'' in ''vertical-rl''
      writing mode and equivalent to ''rotate-left'' in ''vertical-lr''
      writing mode.
    <dt><dfn>auto</dfn></dt>
    <dd><p>[[!SVG11]] defines 'glyph-orientation-vertical' and
      'glyph-orientation-horizontal' properties that were intended to control
      text orientation. These properties are <em>deprecated</em> and do not
      apply to non-SVG elements. If an implementation supports these properties,
      the ''auto'' value when set on SVG elements indicates that the SVG
      'glyph-orientation-vertical' and 'glyph-orientation-horizontal' behavior
      control the layout of text. Such UAs must set ''text-orientation: auto''
      on all
      <a href="http://www.w3.org/TR/SVG/intro.html#TermTextContentElement">SVG
      text content elements</a> in their default UA style sheet for SVG.
      <p>In all other contexts, and for implementations that do not support
      the glyph orientation properties, the ''auto'' behavior is the same
      as for ''vertical-right''.
  </dl>


  <p class="issue">Baseline alignment is not yet defined.</p>

  <p class="issue">Add section explaining native script orientations.
    Note that all wide characters are treated the same as ideographic.
    Link to definition of grapheme clusters in [[!UAX29]].</p>

  <p class="issue">Add appendix that describes interaction with OpenType
    features and font layout?</p>

<h2 id="abstract-layout">Abstract Box Layout</h2>

  <p>[[!CSS21]] defines the box layout model of CSS in detail. However,
  it only defines the box model for the ''horizontal-tb'' writing mode.
  CSS box layout in writing modes other than ''horizontal-tb'' is
  analogous to the box layout defined in CSS2.1 if boxes and dimensions
  are abstracted and remapped appropriately. This module defines the
  following abstract directional and dimensional terms and their mappings
  in order to define box layout for other writing modes:

<h3 id="dimensions">Logical vs Physical Dimensions</h3>

  <dl>
    <dt><dfn>block flow dimension</dfn></dt>
      <dd>The dimension perpendicular to the flow of text with in a line,
        the <i>vertical dimension</i> in horizontal writing modes, and
        the <i>horizontal dimension</i> in vertical writing modes.</dd>
    <dt><dfn>inline dimension</dfn></dt>
      <dd>The dimension parallel to the flow of text within a line, i.e.
        the <i>horizontal dimension</i> in horizontal writing modes, and
        the <i>vertical dimension</i> in vertical writing modes.</dd>
    <dt><dfn>inline-axis</dfn></dt>
      <dd>The axis in the block flow dimension, i.e. the <i>vertical
        axis</i> in horizontal writing modes and the <i>horizontal
        axis</i> in vertical writing modes.</dd>
    <dt><dfn>block-axis</dfn></dt>
      <dd>The axis in the inline dimension, i.e. the <i>horizontal
        axis</i> in horizontal writing modes and the <i>vertical axis</i>
        in vertical writing modes.</dd>
    <dt><dfn>length</dfn> or <dfn>logical height</dfn><dt>
      <dd>A measurement in the block flow dimension: refers to the
        physical height (vertical dimension) in horizontal writing
        modes, and to the physical width (horizontal dimension) in
        vertical writing modes.</dd>
    <dt><dfn>measure</dfn> or <dfn>logical width</dfn><dt>
      <dd>A measurement in the inline dimension: refers to the
        physical width (horizontal dimension) in horizontal writing
        modes, and to the physical height (vertical dimension) in
        vertical writing modes. (The term <i>measure</i> derives
        from its <a href="http://en.wikipedia.org/wiki/Measure_%28typography%29">use
        in typography</a>.)</dd>
  </dl>

<!--
  <p>Properties that are named in terms of the x and y axes are
    logical with respect to the block flow direction rather than absolute
    with respect to the page. Specifically:

  <ul>
    <li>The ''repeat-x'' keyword of 'background-repeat' tiles in the
      inline dimension of the element, which is not necessarily the
      horizontal dimension. [[!CSS21]] [[!CSS3BG]]
    <li>The ''repeat-y'' keyword of 'background-repeat' tiles in the
      block flow dimension of the element, whcih is not necessarily
      the vertical dimenion. [[!CSS21]] [[!CSS3BG]]
    <li>The 'overflow-x' property controls overflow in the inline
      dimension of the element. [[!CSS3UI]]
    <li>The 'overflow-y' property controls overflow in the block
      flow dimension of the element. [[!CSS3UI]]
  </ul>
-->

  <p>Certain properties behave logically as follows:
  <ul>
    <li>The first and second values of the 'border-spacing' property
      represent spacing between columns and rows respectively, not
      necessarily the horizontal and vertical spacing respectively.
      [[!CSS21]]
    <li>The 'line-height' property always refers to the logical
      height. [[!CSS21]]
  </ul>

  <p>The height properties ('height', 'min-height', and 'max-height')
    refer to the physical height, and the width properties ('width',
    'min-width', and 'max-width') refer to the physical width. However,
    the rules used to calculate box dimensions and positions are logical.

  <p>For example, the calculation rules in
    <a href="http://www.w3.org/TR/CSS21/visudet.html#Computing_widths_and_margins">CSS2.1 Section 10.3</a>
    are used for the inline dimension measurements: the logical width
   (which could be either the physical width or physical height) and
    the start and end margins, padding, and border.
    Likewise the calculation rules in
        <a href="http://www.w3.org/TR/CSS21/visudet.html#Computing_heights_and_margins">CSS2.1 Section 10.6</a>
    are used for measurements in the block dimension. [[!CSS21]]

  <p>As a corollary, percentages on the margin and padding properties,
    which are calculated with respect to the containing block width
    regardless of their dimension, are calculated with respect to the
    <em>logical width</em> of the containing block.

<h4 id="orthogonal-flows">Orthogonal Flows</h4>

  <p>When an element has a different 'writing-mode' from its
    containing block two cases are possible:
  <ul>
    <li>The two writing modes are parallel to each other. (For example,
      ''vertical-rl'' and ''vertical-lr'').</li>
    <li>The two writing modes are perpendicular to each other. (For
      example, ''horizontal-tb'' and ''vertical-rl'').</li>
  </ul>

  <p>To handle the second case, for the purposes of calculating the
    layout of the box, the dimensions corresponding to the logical
    height and logical width of the containing block are determined
    using the writing mode of the box under consideration, not the
    writing mode of the element associated with the containing block.</p>

  <p class="issue">What's a reasonable way of calculating ''auto''
    logical widths? The fallout of the above statements is not
    reasonable. Three good options are: use the max-content size;
    use 100vh margin-box; use the same logical width that would be
    calculated if the block flows were parallel.</p>

<h3 id="directions">Logical vs Physical Directions</h3>

<p>The terms "left", "right", "top", and "bottom" are always
  interpreted physically, i.e. with respect to the page
  independent of writing mode. Two abstract mappings are
  possible for these directions: logical and line-relative.
  Which one is chosen depends on whether the usage is primarily
  with respect to the block, or primarily with respect to the
  line box.

<h4 id="block-directions">Logical Directions</h4>

  <p>The <dfn>logical directions</dfn> are
    <a href="#before">before</a>,
    <a href="#after">after</a>,
    <a href="#start">start</a>, and
    <a href="#end">end</a>. In an <abbr title="left-to-right">LTR</abbr>
    ''horizontal-tb'' writing mode, they correspond to the
    top, bottom, left, and right directions, respectively.

  <div class="example">
    <p>An English (LTR-TB) block:</p>
    <pre class="ascii-art">
                  &lt;---- width / logical width ---&gt;

                             top side/
                            before side
                  +------------------------------+                  A
      left side/  |   ---inline direction --->   |  right side/     |
      start side  |  |                           |  end side        |
                  |  | block      * horizontal * |                height/
                  |  | direction  *writing mode* |            logical height
                  |  V                           |                  |
                  +------------------------------+                  V
                             bottom side/
                              after side
    </pre>
  </div>
  <div class="example">
    <p>A vertical Japanese block (TTB-RL):</p>
    <pre class="ascii-art">
                  &lt;--- width / logical height ---&gt;

                             top side/
                            start side
                  +------------------------------+                  A
      left side/  |    &lt;---block direction---    |  right side/     |
      after side  |                           |  |  before side     |
                  |  *  vertical  *     inline|  |                height/
                  |  *writing mode*  direction|  |             logical width
                  |                           V  |                  |
                  +------------------------------+                  V
                            bottom side/
                             end side
    </pre>
  </div>

  <p>Logical directions are calculated with respect to
    the writing mode of the element and used to abstract layout
    related to padding and border properties. For example, if
    an element had computed values of ''direction: ltr;
    writing-mode: vertical-lr; text-orientation: vertical-right'',
    'padding-top' would give its start padding, and 'padding-left'
    would give its before padding.

  <p>Logical directions are calculated with respect to
    the writing mode of the <em>parent</em> of the element
    and used to abstract layout related to the margin properties
    and the 'top', 'bottom', 'left', and 'right' properties.
    (For the root element, which has no parent, the values of
    the writing mode of the element is used instead.)

  <p>The <a href="http://www.w3.org/TR/CSS21/box.html#collapsing-margins">margin
    collapsing rules</a> apply exactly with the <em>before
    margin</em> substituted for the top margin and the
    <em>after margin</em> substituted for the bottom margin.
    Similarly the padding and border on the same side as the
    before margin is substituted for the top padding and
    border, and the padding and border on the same side as
    the after margin for the bottom padding and border.
    Note this means only before and after margins ever collapse.

  <p class="note">The parent element is used instead of the
    containing block, because the benefit of using the containing
    block is very rare, but the cost to implement it is rather
    high for implementations that do logical-physical mapping
    at cascade time.</p>

  <p>The start and end directions are also used for inline
    layout as follows:
  <ul>
    <li>The initial value of the 'text-align' property
      aligns to the start edge of the line box.
    <li>The 'text-indent' property indents from the start
      edge of the line box.
  </ul>

<h4 id="line-directions">Line-Relative Directions</h4>

  <p>The <dfn>line-relative directions</dfn> are
    <a href="#over">over</a>,
    <a href="#under">under</a>,
    <a href="#line-left">line-left</a>, and
    <a href="#line-right">line-right</a>. In an
    <abbr title="left-to-right">LTR</abbr>
    ''horizontal-tb'' writing mode, they correspond to the
    top, bottom, left, and right directions, respectively.

  <p>The line right and line left directions are calculated
    with respect to the writing mode of the element and used
    to interpret the ''left'' and ''right'' values of the
    following properties:
  <ul>
    <li>the 'text-align' property [[!CSS21]]
  </ul>

  <p>The line right and line left directions are calculated
    with respect to the writing mode of the <em>containing
    block</em> of the element and used to interpret the ''left''
    and ''right'' values of the following properties:
  <ul>
    <li>the 'float' property [[!CSS21]]
    <li>the 'clear' property [[!CSS21]]
  </ul>

  <p>The over and under directions are calculated with respect to
    the writing mode of the element and used to define the
    interpretation of the "top" (over edge) and "bottom" (under
    edge) of the line box as follows:

  <ul>
    <li>For the 'vertical-align' property, the "top" of the
      line box is the over edge; the "bottom" of the line box
      is the under edge. Positive length and percentage values
      shift the baseline towards the over edge. [[!CSS21]]
    <li>For the 'text-decoration' property, the underline is
      drawn on the under side of the text; the overline is
      drawn on the over side of the text. [[!CSS21]]
      <span class="note">Note that the CSS Text Module defines
      this in more detail and provides additional controls for
      controlling the position of underlines and overlines.
      [[CSS3TEXT]]</span>
  </ul>

<h4 id="logical-to-physical">Abstract-to-Physical Mappings</h4>

  <p>The following table summarizes the abstract-to-physical mappings:</p>

  <table class="data">
    <caption>Abstract-Physical Mapping</caption>
    <thead>
      <tr>
        <th scope="row">'writing-mode'</th>
        <th colspan="2">''horizontal-tb''</th>
        <th colspan="4">''vertical-rl''</th>
        <th colspan="4">''vertical-lr''</th>
      </tr>
      <tr>
        <th scope="row">'text-orientation'</th>
        <th colspan="2">&mdash;</th>
        <th colspan="2">''rotate-left''</th>
        <th colspan="2"><abbr title="vertical-right, upright, rotate-right">*right</abbr></th>
        <th colspan="2">''rotate-left''</th>
        <th colspan="2"><abbr title="vertical-right, upright, rotate-right">*right</abbr></th>
      </tr>
      <tr>
        <th scope="row">'direction'</th>
        <th>''ltr''</th>
        <th>''rtl''</th>
        <th>''ltr''</th>
        <th>''rtl''</th>
        <th>''ltr''</th>
        <th>''rtl''</th>
        <th>''ltr''</th>
        <th>''rtl''</th>
        <th>''ltr''</th>
        <th>''rtl''</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th scope="row">length</th>
        <td colspan="2">height</td>
        <td colspan="8">width</td>
      </tr>
      <tr>
        <th scope="row">measure</th>
        <td colspan="2">width</td>
        <td colspan="8">height</td>
      </tr>
      <tr>
        <th scope="row">before</th>
        <td colspan="2">top</td>
        <td colspan="4">right</td>
        <td colspan="4">left</td>
      </tr>
      <tr>
        <th scope="row">after</th>
        <td colspan="2">bottom</td>
        <td colspan="4">left</td>
        <td colspan="4">right</td>
      </tr>
      <tr>
        <th scope="row">start</th>
        <td>left</td>
        <td>right</td>
        <td>bottom</td>
        <td>top</td>
        <td>top</td>
        <td>bottom</td>
        <td>bottom</td>
        <td>top</td>
        <td>top</td>
        <td>bottom</td>
      </tr>
      <tr>
        <th scope="row">end</th>
        <td>right</td>
        <td>left</td>
        <td>top</td>
        <td>bottom</td>
        <td>bottom</td>
        <td>top</td>
        <td>top</td>
        <td>bottom</td>
        <td>bottom</td>
        <td>top</td>
      </tr>
    </tbody>
    <tbody>
      <tr>
        <th scope="row">over</th>
        <td colspan="2">top</td>
        <td colspan="2">left</td>
        <td colspan="2">right</td>
        <td colspan="2">left</td>
        <td colspan="2">right</td>
      </tr>
      <tr>
        <th scope="row">under</th>
        <td colspan="2">bottom</td>
        <td colspan="2">right</td>
        <td colspan="2">left</td>
        <td colspan="2">right</td>
        <td colspan="2">left</td>
      </tr>
      <tr>
        <th scope="row">line-left</th>
        <td colspan="2">left</td>
        <td colspan="2">bottom</td>
        <td colspan="2">top</td>
        <td colspan="2">bottom</td>
        <td colspan="2">top</td>
      </tr>
      <tr>
        <th scope="row">line-right</th>
        <td colspan="2">right</td>
        <td colspan="2">top</td>
        <td colspan="2">bottom</td>
        <td colspan="2">top</td>
        <td colspan="2">bottom</td>
      </tr>
    </tbody>
  </table>

<h4 id="physical-only">Purely Physical Properties</h4>

  <p>The following values are purely physical in their definitions
    and do not respond to changes in writing mode:

  <ul>
    <li>all values of 'background-repeat' other than ''repeat-y'' and
      ''repeat-x'' (described above)
    <li>the ''rect()'' notation of the 'clip' property [[!CSS21]]
    <li>the offsets of the 'box-shadow' and 'text-shadow' properties
  </ul>

<h4 id="caption-side">The 'caption-side' property</h4>

  <p>This module introduces two new values to the 'caption-side' property:
    ''before'' and ''after'', which position the caption before and
    after the table box, respectively. For tables with ''horizontal-tb''
    writing mode, they are equivalent to the existing ''top'' and
    ''bottom'' values, respectively. [[!CSS21]]

  <p>Implementations that only support the ''top'' and ''bottom'' values
    of the 'caption-side' property must treat them as ''before'', when
    the table is in a vertical writing mode.

  <p>For implementations that support side captions (i.e. the ''left''
    and ''right'' values), this module also introduces the ''start''
    and ''end'' values, which behave similarly and which position the
    caption on the start and end sides of the table box, calculated
    with respect to the writing mode of the table element. For such
    implementations, the ''top'' and ''bottom'' values must place the
    caption on the top and bottom sides of the table box, respectively.
<!--
<h3 id="html-attributes">HTML Attributes</h3>

  <p>This section defines the mapping of HTML presentational attributes
    in CSS. This section is normative for user agents supporting HTML
    in addition to the 'writing-mode' property. [[!HTML40]] [[!HTML5]]

  <h4 id="width-height-attributes">The <code>width</code> and <code>height</code> attributes</h4>

  <p>The HTML <code>width</code> and <code>height</code> attributes refer
    to the physical width and height for elements that that are replaced,
    i.e.
    <code>&lt;applet&gt;</code>,
    <code>&lt;embed&gt;</code>,
    <code>&lt;iframe&gt;</code>,
    <code>&lt;img&gt;</code>,
    <code>&lt;object&gt;</code>,
    <code>&lt;canvas&gt;</code>,
    and
    <code>&lt;video&gt;</code>

  <p>Form elements elements contain text, therefore their contents should be
    affected by writing mode, in which case these attributes refer to the
    <em>logical</em> width and height. The UA may, however, choose not
    to rotate nor flip these elements in vertical writing modes if it is not
    capable, and in that case, these attributes remain physical.</p>
    <p class="issue">when not to rotate form elements/MathML,
      should treat them as images (always upright)
      or to force writing-mode to always calculate to horizontal-tb?</p>

  <p>On table-related elements (<code>&lt;table&gt;</code>, <code>&lt;colgroup&gt;</code>,
    <code>&lt;col&gt;</code>, <code>&lt;tr&gt;</code>, <code>&lt;th&gt;</code>,
    <code>&lt;td&gt;</code>) the <code>width</code> and <code>height</code>
    attributes are always logical.

  <p>The <code>size</code> attribute of the <code>&lt;hr&gt;</code> element
    is also logical (refers to the logical height).

  <h4 id="alignment-attributes">Alignment, Float and Clear Attributes</h4>

  <p>The following attributes behave the same way as their corresponding
    CSS properties:</p>

  <ul>
    <li><code>align</code> as 'float' or 'text-align'</li>
    <li><code>clear</code> as 'clear'</li>
    <li><code>valign</code> as 'vertical-align'</li>
  </ul>

  <h4 id="spacing-attributes">Spacing Attributes</h4>

  <p>The following attributes are logical and, as margins, are logical
    with respect to the writing mode of the <em>parent</em> element.</p>

  <ul>
    <li><code>hspace</code> as start and end margins</li>
    <li><code>vspace</code> as before and after margins</li>
    <li>marginwidth</li>
    <li>marginheight</li>
  </ul>
-->

<h2 id="text-combine">Glyph Composition: the 'text-combine' property</h2>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>text-combine</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td>none | [ horizontal &lt;number&gt;? ]</td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>none</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>non-replaced inline elements</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>no</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>N/A</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>specified value</td>
      </tr>
    </tbody>
  </table>

  <p>This property allows the combination of multiple characters into the
    space of a single character. For text layout purposes, e.g. bidi
    ordering, line-breaking, emphasis marks, text-decoration, etc. the
    resulting composition is treated as a single glyph representing the
    Object Replacement Character U+FFFC. Values have the following
    meanings:</p>

  <dl>
    <dt><dfn title="text-combine:none">none</dfn>
    <dd>No special processing.</dd>
    <dt><dfn title="text-combine:horizontal">horizontal</dfn>
    <dd><p>In vertical writing mode, attempt to display the text contents
      of the element horizontally within the vertical line box, ideally
      within the space of one ideographic character (1em square), as follows:
    <p>If the UA has compressed glyphs available for the contents of the
      element, then it should use those glyphs to attempt sizing the
      contents to 1em square. For example, a two digit number should use
      halfwidth or proportional glyphs, a three-digit number use 1/3-em glyphs
      (if available, else halfwidth glyphs), etc. The glyphs are stacked
      horizontally (similar to the contents of an inline-box with a
      horizontal writing mode and a line-height of 1em) and the baseline
      of the resulting composition chosen such that it is centered between
      the content edges of its parent inline box.
    <p>If the size of the composed glyph exceeds the element's used
      line-height, then <span class="issue">
        <b>{</b> the UA may scale the contents to fit (else overflow the line) <b>|</b>
            the contents are instead rendered as if 'text-combine' were 'none' <b>}</b>
      </span>
    <p>In horizontal mode, or if the number of grapheme clusters in the
      element exceeds the number specified (if any), this value is
      equivalent to ''none''.
    </dd>
  </dl>

  <div class="example">
    <p>In East Asian documents, the ''text-combine: upright'' effect is often
      used to display Latin-based strings such as components of a date or
      letters of an initialism, always in a horizontal writing mode
      regardless of the writing mode of the line:</p>

    <div class="figure">
      <p><img alt="Diagram of tate-chu-yoko, showing the two digits of a date
                   set halfwidth side-by-side in a vertical column of text"
              class="example" src="tate-chu-yoko.png">
      <p>Example of horizontal-in-vertical <i lang="ja">tate-chu-yoko</i></p>
    </div>

    <p>In Japanese, this effect is known as <i lang="ja">tate-chu-yoko</i>.
  </div>

  <p class="issue">Some people have requested a way to have numbers
    automatically text-combine'd. Maybe a text-auto-combine property?
    Note that whether a number should be tate-chu-yoko'd is often
    context-sensitive: this would give very weird results when applied
    to an arbitrary paragraph.</p>

<h2 class="no-num" id="acknowledgements">Acknowledgements</h2>

<p>Martin Heijdra, Paul Nelson, Michel Suignard, Steve Zilles</p>

<h2 id="bidi-html" class=no-num>Appendix B: Bidi Rules for HTML</h2>

<p>The style sheet rules that would achieve the bidi behaviors specified
in [[HTML401]] for the HTML Strict doctype are given below:
  <pre>
/* HTML dir attribute creates an embedding */
*[dir="ltr"]    { direction: ltr; unicode-bidi: embed; }
*[dir="rtl"]    { direction: rtl; unicode-bidi: embed; }

/* BDO element creates an override */
bdo[dir="ltr"]  { direction: ltr; unicode-bidi: bidi-override; }
bdo[dir="rtl"]  { direction: rtl; unicode-bidi: bidi-override; }

/* HTML4.01:8.2.6 - preserve bidi behavior if 'display' is changed */
html, body,
div, address, blockquote, p,
ul, ol, li, dl, dt, dd,
fieldset, form,
h1, h2, h3, h4, h5, h6,
{ unicode-bidi: isolate; }
  </pre>

<h2 class="no-num">References</h2>

<h3 class="no-num">Normative references</h3>
<!--normative-->

<h3 class="no-num">Other references</h3>
<!--informative-->

<!-- Add property index and alphabetic index? -->
</body>
</html>
