<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">

<html lang=en-US>
 <head>
  <title>CSSOM View Module</title>

  <style type="text/css">
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   dfn { font-weight:bold; font-style:normal }
   div.example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   p.note {  margin-left:2em; color:green; font-style:italic; font-weight:bold }
   p.note::before { content:"Note: " }
   .issue { padding:.5em; border:solid red }
   .issue::before { content:"Issue: " }
   xem.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
   em.ct { font-weight:bold; font-style:normal }
   code { color:orangered }
   code :link, code :visited { color:inherit }
  </style>
  <link href="http://www.w3.org/StyleSheets/TR/W3C-ED" rel=stylesheet>

 <body class=draft>
  <div class=head>
   <h1 id=cssom-view-module>CSSOM View Module</h1>

   <h2 class="no-num no-toc" id=w3c-doctype>Editor's Draft 21 December 2007</h2>

   <dl>
    <dt>This version:

    <dd><a
     href="http://www.w3.org/TR/2007/ED-cssom-view-20071221/">http://www.w3.org/TR/2007/ED-cssom-view-20071221/</a>

    <dt>Latest version:

    <dd><a
     href="http://www.w3.org/TR/cssom-view/">http://www.w3.org/TR/cssom-view/</a>

    <dt>Editor:

    <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a> (<a
     href="http://www.opera.com/">Opera Software ASA</a>) &lt;<a
     href="mailto:annevk@opera.com">annevk@opera.com</a>&gt;
   </dl>
  </div>

  <h2 class="no-num no-toc" id=abstract>Abstract</h2>

  <p>The APIs introduced by this specification provide authors with a way to
   inspect and manipulate the view information of a document. This includes
   getting the position of element layout boxes, obtaining the width of the
   viewport through script, and also scrolling an element.

  <h2 class="no-num no-toc" id=sotd>Status of this Document</h2>
  <!--begin-status-->

  <p>This is a public copy of the editors' draft. It is provided for
   discussion only and may change at any moment. It probably contains errors.
   Its publication here does not imply endorsement of its contents by W3C.
   <!--end-status-->

  <h2 class="no-num no-toc" id=toc>Table of Contents</h2>
  <!--begin-toc-->

  <ul class=toc>
   <li><a href="#conformance"><span class=secno>1. </span>Conformance
    Criteria</a>
    <ul class=toc>
     <li><a href="#dependencies"><span class=secno>1.1.
      </span>Dependencies</a>

     <li><a href="#terminology"><span class=secno>1.2. </span>Terminology</a>
      
    </ul>

   <li><a href="#the-windowview-interface"><span class=secno>2. </span>The
    <code title="">WindowView</code> Interface</a>
    <ul class=toc>
     <li><a href="#the-screen-interface"><span class=secno>2.1. </span>The
      <code title="">Screen</code> Interface</a>

     <li><a href="#the-media-interface"><span class=secno>2.2. </span>The
      <code title="">Media</code> Interface</a>
    </ul>

   <li><a href="#the-documentview-interface"><span class=secno>3. </span>The
    <code title="">DocumentView</code> Interface</a>

   <li><a href="#the-elementview"><span class=secno>4. </span>The <code
    title="">ElementView</code> Interface</a>
    <ul class=toc>
     <li><a href="#the-getclientrects"><span class=secno>4.1. </span>The
      <code title="">getClientRects()</code> and <code
      title="">getBoundingClientRect()</code> methods</a>

     <li><a href="#offset-attributes"><span class=secno>4.2. </span>The <code
      title="">offsetParent</code>, <code title="">offsetTop</code>, <code
      title="">offsetLeft</code>, <code title="">offsetWidth</code>, and
      <code title="">offsetHeight</code> attributes</a>

     <li><a href="#scroll-attributes"><span class=secno>4.3. </span>The <code
      title="">scrollTop</code>, <code title="">scrollLeft</code>, <code
      title="">scrollWidth</code>, and <code title="">scrollHeight</code>
      attributes</a>

     <li><a href="#client-attributes"><span class=secno>4.4. </span>The <code
      title="">clientTop</code>, <code title="">clientLeft</code>, <code
      title="">clientWidth</code>, and <code title="">clientHeight</code>
      attributes</a>
    </ul>

   <li><a href="#the-rangeview-interface"><span class=secno>5. </span>The
    <code title="">RangeView</code> Interface</a>

   <li><a href="#the-mouseeventview-interface"><span class=secno>6.
    </span>The <code title="">MouseEventView</code> Interface</a>

   <li><a href="#rectangles"><span class=secno>7. </span>Rectangles</a>
    <ul class=toc>
     <li><a href="#the-textrectanglelist-interface"><span class=secno>7.1.
      </span>The <code title="">TextRectangleList</code> Interface</a>

     <li><a href="#the-textrectangle-interface"><span class=secno>7.2.
      </span>The <code title="">TextRectangle</code> Interface</a>
    </ul>

   <li class=no-num><a href="#references">References</a>

   <li class=no-num><a href="#acknowledgments">Acknowledgments</a>
  </ul>
  <!--end-toc-->

  <h2 id=conformance><span class=secno>1. </span>Conformance Criteria</h2>

  <p>Everything in this specification is normative except for diagrams,
   examples, notes and sections marked non-normative.

  <p>The key word <em class=ct>must</em>, <em class=ct>must not</em>, <em
   class=ct>should</em> and <em class=ct>may</em> in this document are to be
   interpreted as described in RFC 2119. [<cite><a
   href="#ref-rfc2119">RFC2119</a></cite>]

  <p>A conforming user agent implements all the requirements made by this
   specification.

  <h3 id=dependencies><span class=secno>1.1. </span>Dependencies</h3>

  <p>This specification depends on several definitions and features defined
   in the HTML&nbsp;5 specification. [<cite><a
   href="#ref-html5">HTML5</a></cite>]

  <p>This specification also depends on several features defined in the DOM
   Level 2 Events and DOM Level 3 Core specifications. [<cite><a
   href="#ref-dom2events">DOM2Events</a></cite>] [<cite><a
   href="#ref-dom3core">DOM3Core</a></cite>]

  <h3 id=terminology><span class=secno>1.2. </span>Terminology</h3>

  <p>The term <dfn id=html-element>HTML element</dfn> is defined by the
   HTML&nbsp;5 specification. [<cite><a href="#ref-html5">HTML5</a></cite>]

  <p><dfn id=the-html>The HTML <code>body</code> element</dfn> is the first
   <code>body</code> <a href="#html-element">HTML element</a> child of the
   root <a href="#html-element">HTML element</a> <code>html</code>.

  <h2 id=the-windowview-interface><span class=secno>2. </span>The <code
   title="">WindowView</code> Interface</h2>

  <p>Objects implementing the <code>Window</code> interface <em
   class=ct>must</em> also implement the <code><a
   href="#windowview">WindowView</a></code> interface. [<cite><a
   href="#ref-html5">HTML5</a></cite>]

  <pre class=idl>interface <dfn id=windowview>WindowView</dfn> {
  readonly attribute float <a href="#windowview-innerwidth">innerWidth</a>;
  readonly attribute float <a href="#windowview-innerheight">innerHeight</a>;
  readonly attribute float <a href="#windowview-outerwidth">outerWidth</a>;
  readonly attribute float <a href="#windowview-outerheight">outerHeight</a>;
  readonly attribute float <a href="#windowview-pagexoffset">pageXOffset</a>;
  readonly attribute float <a href="#windowview-pageyoffset">pageYOffset</a>;
  readonly attribute float <a href="#windowview-screenx">screenX</a>;
  readonly attribute float <a href="#windowview-screeny">screenY</a>;
  readonly attribute <a href="#media">Media</a> <a href="#windowview-media" title=windowview-media>media</a>;
  readonly attribute <a href="#screen">Screen</a> <a href="#windowview-screen" title=windowview-screen>screen</a>;
};</pre>

  <p>The <dfn id=windowview-innerwidth><code>innerWidth</code></dfn>
   attribute, on getting, <em class=ct>must</em> return the viewport width as
   number of CSS pixels. <span class=note>This is including, if rendered, the
   vertical scrollbar.</span>

  <p>The <dfn id=windowview-innerheight><code>innerHeight</code></dfn>
   attribute, on getting, <em class=ct>must</em> return the viewport height
   as number of CSS pixels. <span class=note>This is including, if rendered,
   the horizontal scrollbar.</span>

  <p>The <dfn id=windowview-outerwidth><code>outerWidth</code></dfn>
   attribute, on getting, <em class=ct>must</em> return the width of the
   browser window as number of CSS pixels. If there is no browser window this
   attribute <em class=ct>must</em> return zero.

  <p>The <dfn id=windowview-outerheight><code>outerHeight</code></dfn>
   attribute, on getting, <em class=ct>must</em> return the height of the
   browser window as number of CSS pixels. If there is no browser windows
   this attribute <em class=ct>must</em> return zero.

  <p>The <dfn id=windowview-pagexoffset><code>pageXOffset</code></dfn>
   attribute, on getting, <em class=ct>must</em> return the number of CSS
   pixels the user has scrolled towards the right within the viewport.</p>
  <!-- XXX viewport - initial containing block -->

  <p>The <dfn id=windowview-pageyoffset><code>pageYOffset</code></dfn>
   attribute, on getting, <em class=ct>must</em> return the number of CSS
   pixels the user has scrolled towards the bottom within the viewport.

  <p>The <dfn id=windowview-screenx><code>screenX</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the amount of CSS pixels between
   the left of the browser window and the left of the screen of the output
   device. If there is no browser window this attribute <em
   class=ct>must</em> return zero.

  <p>The <dfn id=windowview-screeny><code>screenY</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the amount of CSS pixels between
   the top of the browser window and the top of the screen of the output
   device. If there is no browser window this attribute <em
   class=ct>must</em> return zero.

  <p>The <dfn id=windowview-media
   title=windowview-media><code>media</code></dfn> attribute, on getting, <em
   class=ct>must</em> return an object implementing the <code><a
   href="#media">Media</a></code> interface.

  <p>The <dfn id=windowview-screen
   title=windowview-screen><code>screen</code></dfn> attribute, on getting,
   <em class=ct>must</em> return an object implementing the <code><a
   href="#screen">Screen</a></code> interface.

  <h3 id=the-screen-interface><span class=secno>2.1. </span>The <code
   title="">Screen</code> Interface</h3>

  <p>As its name suggests, the <code><a href="#screen">Screen</a></code>
   interface represents information about the screen of the output device.

  <pre class=idl>interface <dfn id=screen>Screen</dfn> {
  readonly attribute float <a href="#screen-availwidth">availWidth</a>;
  readonly attribute float <a href="#screen-availheight">availHeight</a>;
  readonly attribute float <a href="#screen-width">width</a>;
  readonly attribute float <a href="#screen-height">height</a>;
  readonly attribute float <a href="#screen-colordepth">colorDepth</a>;
  readonly attribute float <a href="#screen-pixeldepth">pixelDepth</a>;
};</pre>

  <p>The <dfn id=screen-availwidth><code>availWidth</code></dfn> attribute,
   on getting, <em class=ct>must</em> return the available width of the
   rendering surface of the output device as number of CSS pixels.

  <p>The <dfn id=screen-availheight><code>availHeight</code></dfn> attribute,
   on getting, <em class=ct>must</em> return the available height of the
   rendering surface of the output device as number of CSS pixels.

  <p>The <dfn id=screen-width><code>width</code></dfn> attribute, on getting,
   <em class=ct>must</em> return the width of the output device as number of
   CSS pixels.

  <p>The <dfn id=screen-height><code>height</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the height of the output device as
   number of CSS pixels.

  <p>The <dfn id=screen-colordepth><code>colorDepth</code></dfn> and <dfn
   id=screen-pixeldepth><code>pixelDepth</code></dfn> attributes <em
   class=ct>must</em> both return the lowest number of bits from the color
   components of the output device. If the device is not a color device these
   attributes <em class=ct>must</em> return zero.</p>
  <!-- pixelDepth is not supported by Internet Explorer 7 -->

  <h3 id=the-media-interface><span class=secno>2.2. </span>The <code
   title="">Media</code> Interface</h3>

  <pre class=idl>interface <dfn id=media>Media</dfn> {
  readonly attribute DOMString <a href="#media-type">type</a>;
  boolean <a href="#media-query">query</a>(in DOMString <var title="">mediaquery</var>);
};</pre>

  <p>The <dfn id=media-type><code>type</code></dfn> attribute, on getting,
   <em class=ct>must</em> return the string that represents the canvas'
   current rendering mode in canonical form. That is, identical to how it is
   defined by the CSS specification. [<cite><span>CSS21</span></cite>]

  <p>The <dfn id=media-query
   title=query><code>query(<var>mediaquery</var>)</code></dfn> method, when
   invoked, <em class=ct>must</em> return the result of the following
   algorithm:

  <ol>
   <li>If <var title="">mediaquery</var> can not be parsed according to the
    rules given in the Media Queries specification return <code>false</code>
    and terminate this algorithm.

   <li>If <var title="">mediaquery</var> matches the state of the current
    view return <code>true</code> and terminate this algorithm.

   <li>Return <code>false</code>.
  </ol>

  <h2 id=the-documentview-interface><span class=secno>3. </span>The <code
   title="">DocumentView</code> Interface</h2>

  <p class=issue>This conflicts with an interface in DOM Level 2 Views. Maybe
   this specification combined with HTML 5 (for AbstractView) can obsolete
   that one as it is completely useless in practice.

  <p>Objects implementing the <code>Document</code> interface <em
   class=ct>must</em> also implement the <code><a
   href="#documentview">DocumentView</a></code> interface. [<cite><a
   href="#ref-dom3core">DOM3Core</a></cite>]

  <pre class=idl>interface <dfn id=documentview>DocumentView</dfn> {
  Element <a href="#documentview-elementfrompoint">elementFromPoint</a>(in unsigned long <var title="">x</var>, in unsigned long <var title="">y</var>);
};</pre>

  <p>The <dfn id=documentview-elementfrompoint
   title=elementfrompoint><code>elementFromPoint(<var title="">x</var>, <var
   title="">y</var>)</code></dfn> method, when invoked, <em
   class=ct>must</em> return the element at <var>x</var>,<var>y</var> in the
   viewport. The element to be returned is determined through hit testing. If
   either argument is negative or if there is no element at the given
   position the method, when invoked, <em class=ct>must</em> return
   <code>null</code>.

  <p class=issue>Hit testing is currently defined exactly nowhere.

  <h2 id=the-elementview><span class=secno>4. </span>The <code
   title="">ElementView</code> Interface</h2>
  <!-- http://lists.w3.org/Archives/Public/www-archive/2007Aug/att-0003/offset-mess.htm -->

  <p>Objects implementing the <code>Element</code> interface <em
   class=ct>must</em> also implement the <code><a
   href="#elementview">ElementView</a></code> interface. [<cite><a
   href="#ref-dom3core">DOM3Core</a></cite>]

  <pre class=idl>interface <dfn id=elementview>ElementView</dfn> {
  <a href="#textrectanglelist">TextRectangleList</a> <a href="#elementview-getclientrects">getClientRects</a>();
  <a href="#textrectangle">TextRectangle</a> <a href="#elementview-getboundingclientrect">getBoundingClientRect</a>();

  readonly attribute Element <a href="#elementview-offsetparent">offsetParent</a>;
  readonly attribute float <a href="#elementview-offsettop">offsetTop</a>;
  readonly attribute float <a href="#elementview-offsetleft">offsetLeft</a>;
  readonly attribute float <a href="#elementview-offsetwidth">offsetWidth</a>;
  readonly attribute float <a href="#elementview-offsetheight">offsetHeight</a>;

           attribute float <a href="#elementview-scrolltop">scrollTop</a>;   // scroll on setting
           attribute float <a href="#elementview-scrollleft">scrollLeft</a>;  // scroll on setting
  readonly attribute float <a href="#elementview-scrollwidth">scrollWidth</a>;
  readonly attribute float <a href="#elementview-scrollheight">scrollHeight</a>;

  readonly attribute float <a href="#elementview-clienttop">clientTop</a>;
  readonly attribute float <a href="#elementview-clientleft">clientLeft</a>;
  readonly attribute float <a href="#elementview-clientwidth">clientWidth</a>;
  readonly attribute float <a href="#elementview-clientheight">clientHeight</a>;
};</pre>

  <h3 id=the-getclientrects><span class=secno>4.1. </span>The <code
   title="">getClientRects()</code> and <code
   title="">getBoundingClientRect()</code> methods</h3>

  <p>The <code><a
   href="#elementview-getclientrects">getClientRects()</a></code> and
   <code><a
   href="#elementview-getboundingclientrect">getBoundingClientRect</a></code>
   methods provide information about the position of the border box edges of
   an element relative to the viewport.

  <p>The <dfn
   id=elementview-getclientrects><code>getClientRects()</code></dfn> method,
   when invoked, <em class=ct>must</em> return the result of the following
   algorithm:

  <ol>
   <li>
    <p>If the element on which it was invoked does not have an associated CSS
     layout box return an empty (static) <code><a
     href="#textrectanglelist">TextRectangleList</a></code> object and stop
     this algorithm.

   <li>
    <p>Return a (static) <code><a
     href="#textrectanglelist">TextRectangleList</a></code> object containing
     a list of (static) <code><a
     href="#textrectangle">TextRectangle</a></code> objects in content order
     describing the border boxes, even if they are empty, for the element on
     which it was invoked.
  </ol>

  <p>The <dfn
   id=elementview-getboundingclientrect><code>getBoundingClientRect()</code></dfn>
   method, when invoked, <em class=ct>must</em> return the result of the
   following algorithm:

  <ol>
   <li>
    <p>If the element on which it was invoked does not have an associated CSS
     layout box return a (static) <code><a
     href="#textrectangle">TextRectangle</a></code> object whose <code
     title=textrectangle-top><a href="#textrectangle-top">top</a></code>,
     <code title=textrectangle-right><a
     href="#textrectangle-right">right</a></code>, <code
     title=textrectangle-bottom><a
     href="#textrectangle-bottom">bottom</a></code> and <code
     title=textrectangle-left><a href="#textrectangle-left">left</a></code>
     members are zero.

   <li>
    <p>Let <var>list</var> be the result of invoking <code><a
     href="#elementview-getclientrects">getClientRects()</a></code> on the
     same element this method was invoked on.

   <li>
    <p>If <var>list</var> is empty return a (static) <code><a
     href="#textrectangle">TextRectangle</a></code> object whose <code
     title=textrectangle-top><a href="#textrectangle-top">top</a></code>,
     <code title=textrectangle-right><a
     href="#textrectangle-right">right</a></code>, <code
     title=textrectangle-bottom><a
     href="#textrectangle-bottom">bottom</a></code> and <code
     title=textrectangle-left><a href="#textrectangle-left">left</a></code>
     members are zero.

   <li>
    <p>Otherwise, return a union of the border boxes in <var>list</var>,
     excluding border boxes that are empty, as a single <code><a
     href="#textrectangle">TextRectangle</a></code> object. If all border
     boxes are empty let the <code title=textrectangle-top><a
     href="#textrectangle-top">top</a></code> attribute of the new <code><a
     href="#textrectangle">TextRectangle</a></code> object be the value of
     the <code title=textrectangle-top><a
     href="#textrectangle-top">top</a></code> attribute of the first border
     box in the list returned. Do likewise for <code
     title=textrectangle-left><a href="#textrectangle-left">left</a></code>
     and then let <code title=textrectangle-bottom><a
     href="#textrectangle-bottom">bottom</a></code> be equal to <code
     title=textrectangle-bottom><a
     href="#textrectangle-bottom">top</a></code> and <code
     title=textrectangle-right><a
     href="#textrectangle-right">right</a></code> to <code
     title=textrectangle-left><a href="#textrectangle-left">left</a></code>.
  </ol>

  <h3 id=offset-attributes><span class=secno>4.2. </span>The <code
   title="">offsetParent</code>, <code title="">offsetTop</code>, <code
   title="">offsetLeft</code>, <code title="">offsetWidth</code>, and <code
   title="">offsetHeight</code> attributes</h3>

  <p>The <dfn id=elementview-offsetparent><code>offsetParent</code></dfn>
   attribute, when called on element <var>A</var>, <em class=ct>must</em>
   return the element determined by the following algorithm:

  <ol>
   <li>
    <p>If any of the following holds true return <code>null</code> and stop
     this algorithm:</p>

    <ul>
     <li><var>A</var> is the root element.

     <li><var>A</var> is <a href="#the-html">the HTML <code>body</code>
      element</a>.

     <li>The computed value of the <code>position</code> property for element
      <var>A</var> is <code>fixed</code>.
    </ul>

   <li>
    <p>If <var>A</var> is an <code>area</code> <a href="#html-element">HTML
     element</a> which has a <code>map</code> <a href="#html-element">HTML
     element</a> somewhere in the ancestor chain return the nearest ancestor
     <code>map</code> <a href="#html-element">HTML element</a> and stop this
     algorithm.

   <li>
    <p>Return the nearest ancestor element of <var>A</var> for which at least
     one of the following is true and stop this algorithm if such an ancestor
     is found:</p>

    <ul>
     <li>The computed value of the <code>position</code> property is not
      <code>static</code>.

     <li>It is <a href="#the-html">the HTML <code>body</code> element</a>.

     <li>The computed value of the <code>position</code> property of
      <var>A</var> is <code>static</code> and the ancestor is one of the
      following <a href="#html-element" title="HTML element">HTML
      elements</a>: <code>td</code>, <code>th</code>, or <code>table</code>.
    </ul>

   <li>
    <p>Return <code>null</code>.
  </ol>

  <p>The <dfn id=elementview-offsettop><code>offsetTop</code></dfn>
   attribute, when called on element <var>A</var>, <em class=ct>must</em>
   return the value that is the result of the following algorithm:

  <ol>
   <li>
    <p>If element <var>A</var> is <a href="#the-html">the HTML
     <code>body</code> element</a>, has a computed value of the
     <code>display</code> property of <code>none</code>, or does not have an
     associated CSS layout box return zero and stop this algorithm.

   <li>
    <p>If the <code><a
     href="#elementview-offsetparent">offsetParent</a></code> of element
     <var>A</var> is <code>null</code> or <a href="#the-html">the HTML
     <code>body</code> element</a> return the distance, as number of CSS
     pixels, between the top border edge of element <var>A</var> and the
     canvas origin and stop this algorithm.

   <li>
    <p>Return the distance as number of CSS pixels between the top border
     edge of the <code><a
     href="#elementview-offsetparent">offsetParent</a></code> of element
     <var>A</var> and the top border edge of element <var>A</var>.
  </ol>

  <p>The <dfn id=elementview-offsetleft><code>offsetLeft</code></dfn>
   attribute, when called on element <var>A</var>, <em class=ct>must</em>
   return the value that is the result of the following algorithm:

  <ol>
   <li>
    <p>If element <var>A</var> is <a href="#the-html">the HTML
     <code>body</code> element</a>, has a computed value of the
     <code>display</code> propery that is <code>none</code>, or does not have
     an associated CSS layout box return zero and stop this algorithm.

   <li>
    <p>If the <code><a
     href="#elementview-offsetparent">offsetParent</a></code> of element
     <var>A</var> is <code>null</code> or <a href="#the-html">the HTML
     <code>body</code> element</a> return the distance, as number of CSS
     pixels, between the left border edge of element <var>A</var> and the
     left of the canvas origin and stop this algorithm.

   <li>
    <p>Return the distance, as number of CSS pixels, between the left border
     edge of the <code><a
     href="#elementview-offsetparent">offsetParent</a></code> of element
     <var>A</var> and the left border edge of element <var>A</var>.
  </ol>
  <!--
   When html:area has an html:map and that has an associated html:img

   The shape attribute is set to default
     offsetLeft and offsetTop are 0.
   The shape attribute is set to circle
     offsetLeft is the center-x value minus the radius and offsetTop is the center-y value minus the radius.
   The shape attribute is set to rect
   The shape attribute is set to poly
     offsetLeft is the minimum of all x values and offsetTop is the minimum of all y values.
   -->

  <p>The <dfn id=elementview-offsetwidth><code>offsetWidth</code></dfn>
   attribute, when called on element <var>A</var>, <em class=ct>must</em>
   return value that is the result of the following algorithm:

  <ol>
   <li>
    <p>If element <var>A</var> does not have an associated CSS layout box
     return zero and stop this algorithm.

   <li>
    <p>Return the number of CSS pixels of the border box width of element
     <var>A</var>.
  </ol>

  <p>The <dfn id=elementview-offsetheight><code>offsetHeight</code></dfn>
   attribute, when called on element <var>A</var>, <em class=ct>must</em>
   return value that is the result of the following algorithm:

  <ol>
   <li>
    <p>If element <var>A</var> does not have an associated CSS layout box
     return zero and stop this algorithm.

   <li>
    <p>Return the number of CSS pixels of the border box height of element
     <var>A</var>.</p>
  </ol>

  <h3 id=scroll-attributes><span class=secno>4.3. </span>The <code
   title="">scrollTop</code>, <code title="">scrollLeft</code>, <code
   title="">scrollWidth</code>, and <code title="">scrollHeight</code>
   attributes</h3>

  <p>The <dfn id=elementview-scrolltop><code>scrollTop</code></dfn>
   attribute, when called on element <var>A</var>, <em class=ct>must</em>
   return the value that is the result of running the following algorithm:

  <ol>
   <li>
    <p>If element <var>A</var> does not have an associated CSS layout box
     return zero and stop this algorithm.

   <li>
    <p class=issue>...
  </ol>

  <p>When setting the <code><a
   href="#elementview-scrolltop">scrollTop</a></code> attribute to <var
   title="">y</var> on element <var>A</var> user agents <em
   class=ct>must</em> run the following algorithm:

  <ol>
   <li>
    <p>If element <var>A</var> does not have vertical overflow stop this
     algorithm.

   <li>
    <p>If <var title="">y</var> is negative act as if it was zero.

   <li>
    <p class=issue>...
  </ol>
  <!-- XXX need to figure out right terminology -->

  <p>The <dfn id=elementview-scrollleft><code>scrollLeft</code></dfn>
   attribute, when called on element <var>A</var>, <em class=ct>must</em>
   return the value that is the result of running the following algorithm:

  <ol>
   <li>
    <p>If element <var>A</var> does not have an associated CSS layout box
     return zero and stop this algorithm.

   <li>
    <p class=issue>...
  </ol>

  <p>When setting the <code><a
   href="#elementview-scrollleft">scrollLeft</a></code> attribute to <var
   title="">x</var> on element <var>A</var> user agents <em
   class=ct>must</em> run the following algorithm:

  <ol>
   <li>
    <p>If element <var>A</var> does not have horizontal overflow stop this
     algorithm.

   <li>
    <p>If <var title="">y</var> is negative act as if it was zero.

   <li>
    <p class=issue>...
  </ol>
  <!-- XXX need to figure out right terminology -->

  <p>The <dfn id=elementview-scrollwidth><code>scrollWidth</code></dfn>
   attribute, when called on element <var>A</var>, <em class=ct>must</em>
   return value that is the result of the following algorithm:

  <ol>
   <li>
    <p>If element <var>A</var> does not have an associated CSS layout box
     return zero and stop this algorithm.

   <li>
    <p>Return the computed value of the <code>padding-left</code> property of
     element <var>A</var>, plus the computed value of the
     <code>padding-right</code> property of element <var>A</var>, plus the
     combined width of the margin box children of element <var>A</var>
     subtracting all the collapsed margins of those children, as number of
     CSS pixels.
  </ol>

  <p>The <dfn id=elementview-scrollheight><code>scrollHeight</code></dfn>
   attribute, when called on element <var>A</var>, <em class=ct>must</em>
   return value that is the result of the following algorithm:

  <ol>
   <li>
    <p>If element <var>A</var> does not have an associated CSS layout box
     return zero and stop this algorithm.

   <li>
    <p>Return the computed value of the <code>padding-top</code> property of
     element <var>A</var>, plus the computed value of the
     <code>padding-bottom</code> property of element <var>A</var>, plus the
     combined height of the margin box children of element <var>A</var>
     subtracting all the collapsed margins of those children, as number of
     CSS pixels.
  </ol>
  <!-- for inline boxes offsetWidth and offsetHeight are identical to offset* -->

  <h3 id=client-attributes><span class=secno>4.4. </span>The <code
   title="">clientTop</code>, <code title="">clientLeft</code>, <code
   title="">clientWidth</code>, and <code title="">clientHeight</code>
   attributes</h3>

  <p>The <dfn id=elementview-clienttop><code>clientTop</code></dfn>
   attribute, when called on element <var>A</var>, <em class=ct>must</em>
   return the result of the following algorithm:

  <ol>
   <li>
    <p>If element <var>A</var> does not have an associated CSS layout box or
     if it is an inline box return zero and stop this algorithm.

   <li>
    <p>Return the computed value of the <code>border-top-width</code>
     property as number of CSS pixels plus the width of any scrollbar
     rendered between the top padding box and top border box as number of CSS
     pixels.
  </ol>

  <p>The <dfn id=elementview-clientleft><code>clientLeft</code></dfn>
   attribute, when called on element <var>A</var>, <em class=ct>must</em>
   return the result of the following algorithm:

  <ol>
   <li>
    <p>If element <var>A</var> does not have an associated CSS layout box or
     if it is an inline box return zero and stop this algorithm.

   <li>
    <p>Return the computed value of the <code>border-left-width</code>
     property as number CSS pixels plus the width of any scrollbar rendered
     between the left padding box and left border box as number of CSS
     pixels.
  </ol>

  <p>The <dfn id=elementview-clientwidth><code>clientWidth</code></dfn>
   attribute, when called on element <var>A</var>, <em class=ct>must</em>
   return the result of the following algorithm:

  <ol>
   <li>
    <p>If element <var>A</var> does not have an associated CSS layout box or
     if it is an inline box return zero and stop this algorithm.

   <li>
    <p>If element <var>A</var> is the root element return the width of the
     viewport as number of CSS pixels and stop this algorithm.

   <li>
    <p>Return the width of the padding box of element <var>A</var> (excluding
     the width of any rendered scrollbar between the padding and border box)
     as number of CSS pixels.
  </ol>

  <p>The <dfn id=elementview-clientheight><code>clientHeight</code></dfn>
   attribute, when called on element <var>A</var>, <em class=ct>must</em>
   return the result of the following algorithm:

  <ol>
   <li>
    <p>If element <var>A</var> does not have an associated CSS layout box or
     if it is an inline box return zero and stop this algorithm.

   <li>
    <p>If element <var>A</var> is the root element return the height of the
     viewport as number of CSS pixels and stop this algorithm.

   <li>
    <p>Return the height of the padding box of element <var>A</var>
     (excluding the width of any rendered scrollbar between the padding and
     border box) as number of CSS pixels.
  </ol>

  <h2 id=the-rangeview-interface><span class=secno>5. </span>The <code
   title="">RangeView</code> Interface</h2>

  <p>Objects implementing the <code>Range</code> interface <em
   class=ct>must</em> also implement the <code><a
   href="#rangeview">RangeView</a></code> interface. [<cite><a
   href="#ref-dom2tr">DOM2TR</a></cite>]

  <pre class=idl>interface <dfn id=rangeview>RangeView</dfn> {
  <a href="#textrectanglelist">TextRectangleList</a> <a href="#rangeview-getclientrects" title=rangeview-getclientrects>getClientRects</a>();
  <a href="#textrectangle">TextRectangle</a> <a href="#rangeview-getboundingclientrect" title=rangeview-getboundingclientrect>getBoundingClientRect</a>();
};</pre>

  <p>The <dfn id=rangeview-getclientrects
   title=rangeview-getclientrects><code>getClientRects()</code></dfn> method,
   when invoked, <em class=ct>must</em> return an empty (static) <code><a
   href="#textrectanglelist">TextRectangleList</a></code> object if the range
   is empty (if the boundary-points are identical) and otherwise a (static)
   <code><a href="#textrectanglelist">TextRectangleList</a></code> object
   based on the following conditions:

  <ul>
   <li>For each element selected by the range, whose parent is not selected
    by the range, include the border boxes returned by invoking <code><a
    href="#elementview-getclientrects">getClientRects()</a></code> on the
    element.

   <li>For each <code>Text</code> node selected or partially selected by the
    range, include a <code><a href="#textrectangle">TextRectangle</a></code>
    object for each CSS box associated with the text in the range (the part
    that is selected, not the whole line box). The bounds of these <code><a
    href="#textrectangle">TextRectangle</a></code> objects are computed using
    font metrics; thus, for horizontal writing, the vertical dimension of
    each box is determined by the font ascent and descent, and the horizontal
    dimension by the text advance width.

   <li>The <code><a href="#textrectangle">TextRectangle</a></code> objects
    are in content order.
  </ul>

  <p>The <dfn id=rangeview-getboundingclientrect
   title=rangeview-getboundingclientrect><code>getBoundingClientRect()</code></dfn>
   method, when invoked, <em class=ct>must</em> return the result of the
   following algorithm:

  <ol>
   <li>
    <p>Let <var>list</var> be the result of invoking <code
     title=rangeview-getclientrects><a
     href="#rangeview-getclientrects">getClientRects()</a></code> on the same
     range this method was invoked on.

   <li>
    <p>If <var>list</var> is empty return a (static) <code><a
     href="#textrectangle">TextRectangle</a></code> object whose <code
     title=textrectangle-top><a href="#textrectangle-top">top</a></code>,
     <code title=textrectangle-right><a
     href="#textrectangle-right">right</a></code>, <code
     title=textrectangle-bottom><a
     href="#textrectangle-bottom">bottom</a></code> and <code
     title=textrectangle-left><a href="#textrectangle-left">left</a></code>
     members are zero.

   <li>
    <p>Otherwise, return a union of the boxes in <var>list</var>, excluding
     boxes that are empty, as a single <code><a
     href="#textrectangle">TextRectangle</a></code> object. If all boxes are
     empty let the <code title=textrectangle-top><a
     href="#textrectangle-top">top</a></code> attribute of the new <code><a
     href="#textrectangle">TextRectangle</a></code> object be the value of
     the <code title=textrectangle-top><a
     href="#textrectangle-top">top</a></code> attribute of the first border
     box in the list returned. Do likewise for <code
     title=textrectangle-left><a href="#textrectangle-left">left</a></code>
     and then let <code title=textrectangle-bottom><a
     href="#textrectangle-bottom">bottom</a></code> be equal to <code
     title=textrectangle-bottom><a
     href="#textrectangle-bottom">top</a></code> and <code
     title=textrectangle-right><a
     href="#textrectangle-right">right</a></code> to <code
     title=textrectangle-left><a href="#textrectangle-left">left</a></code>.
  </ol>

  <h2 id=the-mouseeventview-interface><span class=secno>6. </span>The <code
   title="">MouseEventView</code> Interface</h2>

  <p>Objects implementing the <code>MouseEvent</code> interface <em
   class=ct>must</em> also implement the <code><a
   href="#mouseeventview">MouseEventView</a></code> interface. [<cite><a
   href="#ref-dom2events">DOM2Events</a></cite>]

  <pre class=idl>interface <dfn id=mouseeventview>MouseEventView</dfn> {
  readonly attribute long <a href="#mouseeventview-screenx" title=mouseeventview-screenx>screenX</a>;
  readonly attribute long <a href="#mouseeventview-screeny" title=mouseeventview-screeny>screenY</a>;

  readonly attribute long <a href="#mouseeventview-pagex">pageX</a>;
  readonly attribute long <a href="#mouseeventview-pagey">pageY</a>;

  readonly attribute long <a href="#mouseeventview-clientx">clientX</a>;
  readonly attribute long <a href="#mouseeventview-clienty">clientY</a>;

  readonly attribute long <a href="#mouseeventview-offsetx">offsetX</a>;
  readonly attribute long <a href="#mouseeventview-offsety">offsetY</a>;

  readonly attribute long <a href="#mouseeventview-x" title=mouseeventview-x>x</a>;
  readonly attribute long <a href="#mouseeventview-y" title=mouseeventview-y>y</a>;
};</pre>

  <p>The <dfn id=mouseeventview-screenx
   title=mouseeventview-screenx><code>screenX</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the horizontal coordinate, as
   number of CSS pixels, of the position where the event occurred relative to
   the origin of the screen.

  <p>The <dfn id=mouseeventview-screeny
   title=mouseeventview-screeny><code>screenY</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the vertical coordinate, as number
   of CSS pixels, of the position where the event occurred relative to the
   origin of the screen.

  <p>The <dfn id=mouseeventview-pagex><code>pageX</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the horizontal coordinate, as
   number of CSS pixels, of the position where the event occurred relative to
   the origin of the canvas.

  <p>The <dfn id=mouseeventview-pagey><code>pageY</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the vertical coordinate, as number
   of CSS pixels, of the position where the event occurred relative to the
   origin of the canvas.

  <p>The <dfn id=mouseeventview-clientx><code>clientX</code></dfn> attribute,
   on getting, <em class=ct>must</em> return the horizontal coordinate, as
   number of CSS pixels, of the position where the event occurred relative to
   the origin of the viewport.

  <p>The <dfn id=mouseeventview-clienty><code>clientY</code></dfn> attribute,
   on getting, <em class=ct>must</em> return the vertical coordinate, as
   number of CSS pixels, of the position where the event occurred relative to
   the origin of the viewport.

  <p>The <dfn id=mouseeventview-offsetx><code>offsetX</code></dfn> attribute,
   on getting, <em class=ct>must</em> return the horizontal coordinate, as
   number of CSS pixels, of the position where the event occurred relative to
   the origin of the padding box of the target node.</p>
  <!-- this can cause negative values -->

  <p>The <dfn id=mouseeventview-offsety><code>offsetY</code></dfn> attribute,
   on getting, <em class=ct>must</em> return the vertical coordinate, as
   number of CSS pixels, of the position where the event occurred relative to
   the origin of the padding box of the target node.</p>
  <!-- this can cause negative values -->

  <p>The <dfn id=mouseeventview-x title=mouseeventview-x><code>x</code></dfn>
   attribute, on getting, <em class=ct>must</em> return the value of <code><a
   href="#mouseeventview-pagex">pageX</a></code>.

  <p>The <dfn id=mouseeventview-y title=mouseeventview-y><code>y</code></dfn>
   attribute, on getting, <em class=ct>must</em> return the value of <code><a
   href="#mouseeventview-pagey">pageY</a></code>.

  <p class=issue>Need to more carefully check the <code title="">x</code> and
   <code title="">y</code> members and likely the others too.

  <h2 id=rectangles><span class=secno>7. </span>Rectangles</h2>

  <h3 id=the-textrectanglelist-interface><span class=secno>7.1. </span>The
   <code title="">TextRectangleList</code> Interface</h3>

  <p>The <code><a href="#textrectanglelist">TextRectangleList</a></code>
   object consists of an ordered list of <code><a
   href="#textrectangle">TextRectangle</a></code> objects.

  <pre
   class=idl>interface <dfn id=textrectanglelist>TextRectangleList</dfn> {
  readonly attribute unsigned long <a href="#textrectanglelist-length" title=textrectanglelist-length>length</a>;
  <a href="#textrectangle">TextRectangle</a> <a href="#textrectanglelist-item" title=textrectanglelist-item>item</a>(in unsigned long <var title="">index</var>);
};</pre>

  <p>The <dfn id=textrectanglelist-length
   title=textrectanglelist-length><code>length</code></dfn> attribute <em
   class=ct>must</em> return the total number of <code><a
   href="#textrectangle">TextRectangle</a></code> objects associated with the
   object.

  <p>The <dfn id=textrectanglelist-item
   title=textrectanglelist-item><code>item(<var
   title="">index</var>)</code></dfn> method, when invoked, <em
   class=ct>must</em> raise an <code>INDEX_SIZE_ERR</code> exception when
   <var title="">index</var> is negative or greater than the number of
   <code><a href="#textrectangle">TextRectangle</a></code> objects associated
   with the object. Otherwise, the <code><a
   href="#textrectangle">TextRectangle</a></code> object at <var
   title="">index</var> <em class=ct>must</em> be returned.

  <p>In ECMAScript implementations, objects that implement the <code><a
   href="#textrectanglelist">TextRectangleList</a></code> interface <em
   class=ct>must</em> also have a <code>[[Get]]</code> method that, when
   invoked with a number, acts like the <code title=textrectanglelist-item><a
   href="#textrectanglelist-item">item()</a></code> method would when invoked
   with that argument.

  <h3 id=the-textrectangle-interface><span class=secno>7.2. </span>The <code
   title="">TextRectangle</code> Interface</h3>

  <p>Objects implementing the <code><a
   href="#textrectangle">TextRectangle</a></code> interface represent a
   rectangular box. The type of box is specified by the method that returns a
   <code><a href="#textrectangle">TextRectangle</a></code> object.

  <pre class=idl>interface <dfn id=textrectangle>TextRectangle</dfn> {
  readonly attribute float <a href="#textrectangle-top" title=textrectangle-top>top</a>;
  readonly attribute float <a href="#textrectangle-right" title=textrectangle-right>right</a>;
  readonly attribute float <a href="#textrectangle-bottom" title=textrectangle-bottom>bottom</a>;
  readonly attribute float <a href="#textrectangle-left" title=textrectangle-left>left</a>;
};</pre>

  <p>The <dfn id=textrectangle-top
   title=textrectangle-top><code>top</code></dfn> attribute, on getting, <em
   class=ct>must</em> return the distance between the top of the viewport and
   the top of the rectangle box as number of CSS pixels.

  <p>The <dfn id=textrectangle-right
   title=textrectangle-right><code>right</code></dfn> attribute, on getting,
   <em class=ct>must</em> return the distance between the left of the
   viewport and the right of the rectangle box as number of CSS pixels.

  <p>The <dfn id=textrectangle-bottom
   title=textrectangle-bottom><code>bottom</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the distance between the top of the
   viewport and the bottom of the rectangle box as number of CSS pixels.

  <p>The <dfn id=textrectangle-left
   title=textrectangle-left><code>left</code></dfn> attribute, on getting,
   <em class=ct>must</em> return the distance between the left of the
   viewport and the left of the rectangle box as number of CSS pixels.</p>
  <!-- XXX svg:foreignObject is not defined anywhere for practical purpose
  <p class="note">The <code>svg:foreignObject</code> element represents an
  initial containing block for its descendents.</p>
  -->

  <h2 class=no-num id=references>References</h2>

  <dl>
   <dt>[<dfn id=ref-dom2events>DOM2Events</dfn>]

   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-2-Events/">Document
    Object Model (DOM) Level 2 Events Specification</a></cite>, T. Pixley,
    editor. W3C, November 2000.

   <dt>[<dfn id=ref-dom2tr>DOM2TR</dfn>]

   <dd><cite><a
    href="http://www.w3.org/TR/DOM-Level-2-Traversal-Range/">Document Object
    Model (DOM) Level 2 Traversal and Range Specification</a></cite>, J.
    Kesselman, J. Robie, M. Champion, P. Sharpe, V. Apparao, L. Wood,
    editors. W3C, November 2000.

   <dt>[<dfn id=ref-dom3core>DOM3Core</dfn>]

   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-3-Core">Document Object
    Model (DOM) Level 3 Core Specification</a></cite>, A. Le Hors, P. Le
    H&eacute;garet, L. Wood, G. Nicol, J. Robie, M. Champion, S. Byrne,
    editors. W3C, April 2004.

   <dt>[<dfn id=ref-html5>HTML5</dfn>]

   <dd><cite><a
    href="http://www.whatwg.org/specs/web-apps/current-work/">HTML&nbsp;5</a></cite>
    (work in progress), I. Hickson, editor. WHATWG, 2007.

   <dt>[<dfn id=ref-rfc2119>RFC2119</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc2119">Key words for use in RFCs
    to Indicate Requirement Levels</a></cite>, S. Bradner. IETF, March 1997.
  </dl>

  <h2 class=no-num id=acknowledgments>Acknowledgments</h2>

  <p>The editor would like to thank Alexey Feldgendler, David Vest, Hallvord
   R. M. Steen, Morten Stenshorne, Robert O'Callahan, Simon Pieters, and
   Tarquin Wilton-Jones for their contributions to this document.

  <p>Special thanks to the Microsoft employees who first implemented many of
   the features specified in this draft, which were first widely deployed by
   the Windows Internet Explorer browser.
