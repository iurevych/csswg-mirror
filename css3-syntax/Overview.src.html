<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
    "http://www.w3.org/TR/html4/loose.dtd">

<html lang=en>
<head>
  <title>CSS3 module: Syntax and Grammar</title>
  <link rel="stylesheet" type="text/css" href="http://www.w3.org/Style/Group/css3-src/default.css">
  <link rel="stylesheet" type="text/css"
  href="http://www.w3.org/StyleSheets/TR/W3C-MO">
</head>

<body>

<div class="head">
<p><a class="logo" rel="home" href="http://www.w3.org/"><img height="48"
width="72" alt="W3C " src="http://www.w3.org/Icons/w3c_home"></a><a
class="logo" rel="in-activity" href="../"><img
src="../../../Woolly/woolly-icon.png" height="48" width="72"
alt="CSS WG "></a></p>

<h1>CSS3 module: Syntax and Grammar</h1>

<h2 class="no-num no-toc">W3C Working Draft, [DATE:16 Jul 2001]</h2>
<dl>
  <dt>This version:</dt>
    <dd><a
      href="http://www.w3.org/TR/[YEAR]/WD-css3-syntax-[ISODATE]">http://www.w3.org/TR/[YEAR]/WD-css3-syntax-[ISODATE]</a></dd>
  <dt>Latest version:</dt>
    <dd><a
      href="http://www.w3.org/TR/css3-syntax">http://www.w3.org/TR/css3-syntax</a></dd>
  <dt>Previous version:</dt>
    <dd><a
      href="[http://www.w3.org/PreviousVersionURI]">[http://www.w3.org/PreviousVersionURI]</a></dd>
  <dt>Editor:</dt>
    <dd>L. David Baron, &lt;<a href="mailto:dbaron@fas.harvard.edu">dbaron@fas.harvard.edu</a>&gt;</dd>
</dl>
<!--begin-include "../copyright.inc"-->

<p>[Here will be included the file "../copyright.inc"]</p>
<!--end-include-->
<hr title="Separator for header">
</div>

<h2 class="no-num no-toc"><a name="abstract">Abstract</a></h2>

<p>This CSS3 module describes the basic structure of CSS stylesheets, some of
the details of the syntax, and the rules for parsing CSS stylesheets.
Additional details of the syntax of some parts of CSS described in other
modules will be described in those modules.  (For example, the selectors module
has a grammar for selectors.)</p>

<h2 class="no-num no-toc"><a name="status">Status of this document</a></h2>

<p>
This document is a draft of one of the "modules" for the upcoming CSS3
specification.
</p>
<p>This document is a working draft of the CSS &amp; FP working group
which is part of the <a href="http://www.w3.org/Style/">style
activity</a>.
</p>
<p>The working group would like to receive feedback: comments on this draft may 
  be sent to one of the editors, discussion takes place on the (<a href="http://lists.w3.org/Archives/Public/www-style/">archived</a>) 
  public mailing list <a href="http://www.w3.org/Mail/Lists.html#www-style">www-style@w3.org</a> (see <a href="http://www.w3.org/Mail/Request">instructions</a>). W3C Members 
  can also send comments directly to the CSS &amp; FP working group. </p>
<p>This working draft may be updated, replaced or rendered obsolete by
other W3C documents at any time. It is inappropriate to use W3C
Working Drafts as reference material or to cite them as other than
"work in progress". Its publication does not imply endorsement by the
W3C membership or the <a href="http://www.w3.org/Style/Group">CSS &amp FP Working Group</a> (<a href="http://cgi.w3.org/MemberAccess/AccessRequest">members only</a>).
</p>

<p>A list of current W3C Recommendations and other technical documents
including Working Drafts and Notes can be found at <a
href="http://www.w3.org/TR">http://www.w3.org/TR</a>.</p>

<h2 class="no-num no-toc"><a name="contents">Table of contents</a></h2>
<!--toc-->
<hr>


<h2>Dependencies on other modules</h2>

<p>This CSS3 module
depends on the following other CSS3 modules:</p>
<ul>
  <li>W3C Selectors (Module 4)</li>
</ul>

<p>It
has non-normative (informative) references to the following other CSS3
modules:</p>
<ul>
  <li>Values &amp; Units (???)</li>
</ul>

<p class="issue">Are these right?</p>

<h2>Introduction</h2>

<p>[document here]</p>

<h2><a name="syntax">Syntax</a></h2>

<P>This section describes a grammar (and <span class="index-def"
title="forward-compatible parsing"><dfn>forward-compatible
parsing</dfn></span> rules) common to any version of CSS (including
CSS3). Future versions of CSS will adhere to this core syntax,
although they may add additional syntactic constraints.

<P>These descriptions are normative.

<p class="issue">Note:  The grammar given in <a
href="http://www.w3.org/TR/1998/REC-CSS2-19980512/grammar.html">Appendix D</a>
of CSS2 still needs to be incorporated into this specification.  The editor
hopes that it can be done by unifying it with the forward-compatible grammar
into a single grammar that describes both the rules for forward-compatible
parsing and the syntax of what is currently possible in CSS, but that may not
be possible.</p>

<h3><a name="tokenization">Tokenization</a></h3>

<P>All levels of CSS -- level 1, level 2, level 3, and any future
levels -- use
the same core syntax. This allows UAs to parse (though not completely
understand) style sheets written in levels of CSS that didn't exist at
the time the UAs were created. Designers can use this feature to
create style sheets that work with older user agents, while also
exercising the possibilities of the latest levels of CSS.

<P>At the lexical level, CSS style sheets consist of a sequence of tokens.
The list of tokens for CSS3 is as follows. The definitions use Lex-style
regular expressions. Octal codes refer to ISO 10646 ([[ISO10646]]). As in
Lex, in case of multiple matches, the longest match determines the token.

<TABLE>
<THEAD>
<TR><TH>Token		<TH>Definition
</THEAD>
<TR><TD colspan=2><HR>
<TR><TD>IDENT		<TD><code><var>{ident}</var></code>
<TR><TD>ATKEYWORD	<TD><code>@<var>{ident}</var></code>
<TR><TD>STRING		<TD><code><var>{string}</var></code>
<TR><TD>HASH		<TD><code>#<var>{name}</var></code>
<TR><TD>NUMBER		<TD><code><var>{num}</var></code>
<TR><TD>PERCENTAGE	<TD><code><var>{num}</var>%</code>
<TR><TD>DIMENSION	<TD><code><var>{num}{ident}</var></code>
<TR><TD>URI		<TD><code>url\(<var>{w}{string}{w}</var>\)<br>
		|url\(<var>{w}</var>([!#$%&amp;*-~]|<var>{nonascii}</var>|<var>{escape}</var>)*<var>{w}</var>\)</code>
<TR><TD>UNICODE-RANGE	<TD><code>U\+[0-9A-F?]{1,6}(-[0-9A-F]{1,6})?</code>
<TR><TD>CDO		<TD><code>&lt;!--</code>
<TR><TD>CDC		<TD><code>--&gt;</code>
<TR><TD>S		<TD><code>[ \t\r\n\f]+</code>
<TR><TD>COMMENT		<TD><code>\/\*[^*]*\*+([^/][^*]*\*+)*\/</code>
<TR><TD>FUNCTION	<TD><code><var>{ident}</var>\(</code>
<TR><TD>INCLUDES	<TD><code>~=</code>
<TR><TD>DASHMATCH	<TD><code>|=</code>
<TR><TD>CHAR		<TD><var>any other character not matched by the above rules, except for <code>"</code> or <code>'</code></var>
</TABLE>

<P>The macros in curly braces ({}) above are defined as follows:

<TABLE>
<THEAD>
<TR><TH>Macro	<TH>Definition
</THEAD>
<TR><TD colspan=2><HR>
<TR><TD>ident	<TD><code><var>{nmstart}{nmchar}*</var></code>
<TR><TD>name	<TD><code><var>{nmchar}+</var></code>
<TR><TD>nmstart	<TD><code>[a-zA-Z-_]|<var>{nonascii}</var>|<var>{escape}</var></code>
<TR><TD>nonascii<TD><code>[^\0-\177]</code>
<TR><TD>unicode	<TD><code>\\[0-9a-fA-F]{1,6}[ \n\r\t\f]?</code>
<TR><TD>escape	<TD><code><var>{unicode}</var>|\\[ -~\200-\4177777]</code>
<TR><TD>nmchar	<TD><code>[a-zA-Z0-9-_]|<var>{nonascii}</var>|<var>{escape}</var></code>
<TR><TD>num	<TD><code>[0-9]+|[0-9]*\.[0-9]+</code>
<TR><TD>string	<TD><code><var>{string1}</var>|<var>{string2}</var></code>
<TR><TD>string1	<TD><code>\"([\t !#$%&amp;(-~]|\\{nl}|\'|<var>{nonascii}</var>|<var>{escape}</var>)*\"</code>
<TR><TD>string2	<TD><code>\'([\t !#$%&amp;(-~]|\\{nl}|\"|<var>{nonascii}</var>|<var>{escape}</var>)*\'</code>
<TR><TD>nl	<TD><code>\n|\r\n|\r|\f</code>
<TR><TD>w	<TD><code>[ \t\r\n\f]*</code>
</TABLE>

<p>

  Since any single character other than ' or " that cannot be part of a larger
  token is a single character token, there cannot be errors in tokenization
  other than the inability to tokenize an unmatched quotation mark.  If at some
  point it is not possible to continue tokenizing an incoming stylesheet, the
  remainder of the stylesheet should be ignored and only the largest initial
  segment of the stylesheet that can be tokenized according to the above rules
  should be used.

</p>

<h3>Grammar</h3>

<P>Below is the core syntax for CSS.  Lowercase identifiers represent
productions in this grammar, uppercase identifiers represent tokens (see
above), and characters in single quotes (') represent CHAR tokens (see
above).  The sections that follow describe
how to use it.

<PRE>
stylesheet  : [ CDO | CDC | S | statement ]*;
statement   : ruleset | at-rule;
at-rule     : ATKEYWORD S* any* [ block | ';' S* ];
block       : '{' S* [ any | block | ATKEYWORD S* | ';' ]* '}' S*;
ruleset     : selector? '{' S* declaration? [ ';' S* declaration? ]* '}' S*;
selector    : any+;
declaration : property ':' S* value;
property    : IDENT S*;
value       : [ any | block | ATKEYWORD S* ]+;
any         : [ IDENT | NUMBER | PERCENTAGE | DIMENSION | STRING
              | DELIM | URI | HASH | UNICODE-RANGE | INCLUDES
              | FUNCTION any* ')' | DASHMATCH | '(' any* ')' | '[' any* ']' ] S*;
</PRE>

<P><a name="comment">COMMENT</a> tokens do not occur
in the grammar (to keep it readable), but any number of these tokens
may appear anywhere between other tokens.

<p>The token S in the grammar above stands for <A
name="whitespace">whitespace</a>. Only the characters "space" (Unicode
code 32), "tab" (9), "line feed" (10), "carriage return" (13), and
"form feed" (12) can occur in whitespace. Other space-like characters,
such as "em-space" (8195) and "ideographic space" (12288), are never
part of whitespace.

<h3><a name="keywords">Keywords</a></h3>

<!-- provide better explanation of where keywords appear:
media types, at-rules, etc. -IJ -->

<P>Keywords have the form of identifiers. Keywords must not be placed
between quotes ("..." or '...'). Thus,

<pre>
red
</pre>

<p>is a keyword, but

<pre>
"red"
</pre>

is not. (It is a <a href="#strings">string</a>.) Other illegal examples:

<div class="illegal-example"><P>
<pre>
width: "auto";
border: "none";
font-family: "serif";
background: "red";
</pre>
</div>


<h3><a name="characters">Characters and case</a></h3>
<P>  The following rules always hold:</p>

<UL>
    <LI> All CSS style sheets are <span class="index-inst" title="case
    sensitivity">case-insensitive</span>, except for parts that are
    not under the control of CSS. For example, the case-sensitivity of
    values of the HTML attributes "id" and "class", of font names, and
    of URIs lies outside the scope of this specification. Note in
    particular that element names are case-insensitive in HTML, but
    case-sensitive in XML.

    <LI> In CSS3, <span class="index-def"
    title="identifier|identifier, definition of"><a
    name="value-def-identifier"><dfn>identifiers</dfn></a></span>
    (including element names, classes, and IDs in <a
    href="selector.html">selectors</a>) can contain only the
    characters [A-Za-z0-9] and ISO 10646 characters 161 and higher,
    plus the hyphen (-); they cannot start with a hyphen or a
    digit. They can also contain escaped characters and any ISO 10646
    character as a numeric code (see next item).
    <span class="example">For instance, the identifier "B&amp;W?" may
    be written as "B\&amp;W\?" or "B\26 W\3F".</span>
    <P>Note that Unicode is code-by-code equivalent to ISO 10646 (see
    [[UNICODE]] and [[ISO10646]]).

    <LI> In CSS3, a backslash (\) character indicates three types of
    <span class="index-def" title="backslash escapes">
    <a name="escaped-characters">character escapes</a></span>.

    <P>First, inside a <a href="#strings">string</a>, a backslash
    followed by a newline is ignored (i.e., the string is deemed not
    to contain either the backslash or the newline).

    <P>Second, it cancels the meaning of special CSS characters.
        Any character (except a hexadecimal digit) can be escaped
        with a backslash to remove its special meaning.
        For example, <samp>"\""</samp> is a string consisting of one
        double quote. Style sheet preprocessors must not remove
       these backslashes from a style sheet since that would
       change the style sheet's meaning.

    <P>Third, backslash escapes allow authors to refer to characters
    they can't easily put in a document. In this case, the backslash
    is followed by at most six hexadecimal digits (0..9A..F), which
    stand for the ISO 10646 ([[ISO10646]]) character with
    that number. If a digit or letter follows the hexadecimal number,
    the end of the number needs to be made clear. There are two ways
    to do that:

    <ol>
    <li>with a space (or other whitespace character): "\26 B" ("&amp;B").
        In this case, user agents should treat a "CR/LF" pair 
        (13/10) as a single
        whitespace character.
    <li>by providing exactly 6 hexadecimal digits: "\000026B" ("&amp;B")
    </ol>

    <p>In fact, these two methods may be combined. Only one whitespace
    character is ignored after a hexadecimal escape. Note that this means
    that a "real" space after the escape sequence must itself either be
    escaped or doubled.

    <LI>Backslash escapes are always considered to be part of an <a
    href="#value-def-identifier">identifier</a> or a string (i.e.,
    "\7B" is not punctuation, even though "{" is, and "\32" is allowed
    at the start of a class name, even though "2" is not).
  </UL>

<h3>Statements</h3>

<P> A CSS style sheet, for any version of CSS, consists of a list of
<span class="index-inst" title="statements"><em>statements</em></span>
(see the grammar above).  There are two kinds of statements: <span
class="index-inst" title="at-rules"><em>at-rules</em></span>
and <span class="index-inst" title="rule sets"><em>rule
sets.</em></span> There may be <a href="#whitespace">whitespace</a>
around the statements.

<P>In this specification, the expressions "immediately before" or
"immediately after" mean with no intervening whitespace or comments.

<!-- Should comments be defined as whitespace? -->

<h3><span class="index-def" title="at-rules">At-rules</span></h3>

<P> At-rules start with an <DFN>at-keyword</DFN>, an '@' character
followed immediately by an <a
href="#value-def-identifier">identifier</a> (for example, '@import',
'@page').

<P> An at-rule consists of everything up to and including the next
semicolon (;) or the next <a href="#block">block,</a> whichever comes
first. A CSS user agent that encounters an unrecognized at-rule must
<span class="index-inst" title="ignore"><a href="#ignore">ignore</a></span>
the whole of the at-rule and continue parsing after it.

<P>CSS3 user agents must <span class="index-inst" title="ignore"><a
href="#ignore">ignore</a></span> any <a
href="cascade.html#at-import">'@import'</a> rule that occurs inside a <a
href="#block">block</a> or that doesn't precede all rule sets.

<div class="illegal-example"><P>
Assume, for example, that a CSS3 parser encounters this style sheet:

<PRE>
@import "subs.css";
H1 { color: blue }
@import "list.css";
</PRE>

<P> The second '@import' is illegal according to CSS3. The CSS3 parser
<span class="index-inst" title="ignore"><a href="#ignore">ignores</a></span>
the whole at-rule, effectively reducing the style sheet to:

<PRE>
@import "subs.css";
H1 { color: blue }
</PRE>
</div>

<div class="illegal-example"><P>
In the following example, the second '@import' rule is invalid,
since it occurs inside a '@media' <a href="#block">block</a>.

<PRE>
@import "subs.css";
@media print {
  @import "print-main.css";
  BODY { font-size: 10pt }
}
H1 {color: blue }
</PRE>
</div>

<h3><span class="index-def" title="block">Blocks</span></h3>

<P> A <span class="index-inst" title="block"><em>block</em></span>
starts with a left curly brace ({) and ends with the matching right
curly brace (}). In between there may be any characters, except that
parentheses ((&nbsp;)), brackets ([&nbsp;]) and braces ({&nbsp;}) must
always occur in
matching pairs and may be nested. Single (') and double quotes (")
<!-- " --> must also occur in matching pairs, and characters between them
are parsed as a <span class="index-inst" title="string">string</span>.
See <a href="#tokenization">Tokenization</a> above for the definition
of a string.


<div class="illegal-example">
<P> Here is an example of a block. Note that the right brace between
the double quotes does not match the opening brace of the block, and that the
second single quote is an <a href="#escaped-characters">escaped
character</a>, and thus doesn't match the first single quote:

<PRE>
{ causta: "}" + ({7} * '\'') }
</PRE>

<P>Note that the above rule is not valid CSS3, but it is still
a block as defined above.
</div>

<h3>Rule sets, declaration blocks, and selectors</h3>

<P> A rule set (also called "rule") consists of a selector followed by
a declaration block.

<P> A <span class="index-def"
title="declaration-block"><dfn>declaration-block</dfn></span> (also
called a {}-block in the following text) starts with a left curly
brace ({) and ends with the matching right curly brace (}). In between
there must be a list of zero or more semicolon-separated (;)
declarations.

<P>The <span class="index-def"
title="selector"><em>selector</em></span> (see also the section on <a
href="selector.html">selectors</a>) consists of everything up to (but
not including) the first left curly brace ({).  A selector always goes
together with a {}-block. When a user agent can't parse the selector (i.e., it
is not valid CSS3), it must <span class="index-inst" title="ignore"><a
href="#ignore">ignore</a></span> the {}-block as well.

<P>CSS3 gives a special meaning to the comma (,) in
selectors. However, since it is not known if the comma may acquire
other meanings in future versions of CSS, the whole statement should
be <span class="index-inst" title="ignore"><a
href="#ignore">ignored</a></span> if there is an error anywhere in the
selector, even though the rest of the selector may look reasonable in
CSS3.

<DIV class=illegal-example>
<P>For example, since the "&amp;" is not a valid token in a CSS3
selector, a CSS3 user agent must
<span class="index-inst" title="ignore"><a href="#ignore">ignore</a></span>
the whole second line, and not set the color of H3 to red:
<PRE>
H1, H2 {color: green }
H3, H4 &amp; H5 {color: red }
H6 {color: black }
</PRE>
</DIV>

<div class="example"><P>
<P>Here is a more complex example. The first two pairs of curly braces
are inside a string, and do not mark the end of the selector. This is
a valid CSS3 statement.
<PRE>
P[example="public class foo\
{\
    private int x;\
\
    foo(int x) {\
        this.x = x;\
    }\
\
}"] { color: red }
</PRE>

<div class="note"><P>
<em><strong>Note.</strong>
The <span class="css">\</span> characters in the above example cause the
newlines to be ignored.  Newlines can be placed in strings only using the
correct numeric character escape.  See <a href="#characters">characters
and case</a> above.
</em></p></div>
</div>

<h3><span class="index-def" title="declaration">Declarations</span> and <span class="index-def" title="properties">properties</span></h3>

<P> A <span class="index-def"
title="declaration"><dfn>declaration</dfn></span> is either empty or
consists of a <span class="index-inst"
title="property">property</span>, followed by a colon (:), followed by
a value. Around each of these there may be <a
href="#whitespace">whitespace</a>.

<p>Because of the way selectors work, multiple declarations for the
same selector may be organized into semicolon (;) separated
groups.</p>

<div class="example"><p>
Thus, the following rules:</p>
<pre>
H1 { font-weight: bold }
H1 { font-size: 12pt }
H1 { line-height: 14pt }
H1 { font-family: Helvetica }
H1 { font-variant: normal }
H1 { font-style: normal }
</pre>

<p>are equivalent to:</p>

<pre>
H1 {
  font-weight: bold;
  font-size: 12pt;
  line-height: 14pt;
  font-family: Helvetica;
  font-variant: normal;
  font-style: normal
}
</pre>
</div>

<P>A property is an <a
href="#value-def-identifier">identifier</a>. Any character may occur
in the value, but parentheses ("(&nbsp;)"), brackets ("[&nbsp;]"),
braces ("{&nbsp;}"), single
quotes (') and double quotes (") <!-- " --> must come in matching
pairs, and semicolons not in strings must be <a
href="#escaped-characters">escaped</a>. Parentheses, brackets, and
braces may be nested. Inside the quotes, characters are parsed as a
string.

<P>The syntax of <span class="index-def" title="value">values</span>
is specified separately for each property, but in any case, values are
built from identifiers, strings, numbers, lengths, percentages, URIs,
colors, angles, times, and frequencies.

<P>A user agent must <span class="index-inst" title="ignore"><a
href="#ignore">ignore</a></span> a declaration with an invalid property
name or an invalid value. Every CSS3 property has its own syntactic
and semantic restrictions on the values it accepts.

<div class="illegal-example"><P>
For example, assume a CSS3 parser encounters this style sheet:

<PRE>
H1 { color: red; font-style: 12pt }  /* Invalid value: 12pt */
P { color: blue;  font-vendor: any;  /* Invalid prop.: font-vendor */
    font-variant: small-caps }
EM EM { font-style: normal }
</PRE>

<P> The second declaration on the first line has an invalid value
'12pt'. The second declaration on the second line contains an
undefined property 'font-vendor'. The CSS3 parser will <span
class="index-inst" title="ignore"><a href="#ignore">ignore</a></span> these
declarations, effectively reducing the style sheet to:

<PRE class="example">
H1 { color: red; }
P { color: blue;  font-variant: small-caps }
EM EM { font-style: normal }
</PRE>
</div>

<h3><span class="index-def" title="comments">Comments</span></h3>

<P><span class="index-inst" title="comments">Comments </span> begin
with the characters "/*" and end with the characters "*/". They may
occur anywhere between tokens,
and their contents have no influence on the rendering.  Comments may
not be nested.

<P>CSS also allows the SGML comment delimiters ("&lt;!--" and
"--&gt;") in certain places, but they do not delimit CSS
comments. They are permitted so that style rules appearing in an HTML
source document (in the STYLE element) may be hidden from pre-HTML 3.2
user agents. See the HTML 4.0 specification ([[-HTML40]]) for more information.

<h2>Vendor-specific extensions</h2>

<p>
  CSS3, unlike CSS1 or CSS2, allows identifiers to begin with <span
  class="css">'-'</span>.  <span class="issue">[Should the grammar allow
  '-' as part of identifiers or should it require that vendors who use '-' to
  begin identifiers extend the grammar in their tokenizer?]</span> Property
  names and keywords beginning with <span class="css">'-'</span> are reserved
  for vendor-specific extensions.  Property names and keywords in
  vendor-specific extensions should have the format
</p>

<pre>
'-' + vendor identifier + '-' + meaningful name
</pre>

<p>

  For example, if XYZ Corp. added a property to describe the color
  of the border on the East side of the display, they might
  call it <span class="css">-xyz-border-east-color</span>.  Other
  CSS implementations will not recognize the property and will
  ignore it according to the <a href="#parsing-errors">rules
  for handling parsing errors</a>.

</p>

<p class="issue">This needs to be reconciled with <a
href="../css3-naming/">Bert's document</a> describing the same thing.</p>


<h2>Rules for handling parsing errors or unsupported features</h2>

<p>In some cases, user agents must ignore part of an illegal style
sheet. This specification defines <span class="index-def"
title="ignore"><a name="ignore"><dfn>ignore</dfn></a></span> to mean
that the user agent parses the illegal part according to the grammar
above (in order to find its
beginning and end), but otherwise acts as if it had not been there.</p>

<p>If a stylesheet cannot be parsed according to the grammar above, the
user agent must behave the same as it would if the stylesheet had the
smallest sequence of characters removed from its end that would allow
it to be parsed according to the grammar.</p>

<p>To ensure that new properties and new values for existing
properties can be added in the future, user agents are required to
obey the following rules when they encounter the following
scenarios:</p>

<UL>
<LI><strong>Unknown properties.</strong> User agents must <span
class="index-inst" title="ignore"><a href="#ignore">ignore</a></span> a <a
href="syndata.html#declaration">declaration</a> with an unknown
property. For example, if the style sheet is:

<PRE class="illegal-example">
H1 { color: red; rotation: 70minutes }
</PRE>

<P> the user agent will treat this as if the style sheet had been

<PRE class="example">
H1 { color: red }
</PRE>

<LI><strong>Illegal values.</strong> User agents must ignore a
declaration with an illegal value. For example:

<PRE class="illegal-example">
IMG { float: left }       /* correct CSS3 */
IMG { float: left here }  /* "here" is not a value of 'float' */
IMG { background: "red" } /* keywords cannot be quoted in CSS3 */
IMG { border-width: 3 }   /* a unit must be specified for length values */
</PRE>

A CSS3 parser would honor the first rule and
<span class="index-inst" title="ignore"><a href="#ignore">ignore</a></span>
the rest, as if the style sheet had been:

<PRE class="example">
IMG { float: left }
IMG { }
IMG { }
IMG { }
</PRE>

<P>A user agent conforming to a future CSS specification may accept one or
more of the other rules as well.</P>

<LI><strong>Invalid at-keywords.</strong> User agents must <span
class="index-inst" title="ignore"><a href="#ignore">ignore</a></span> an
invalid at-keyword together with everything following it, up to and
including the next semicolon (;) or block ({...}), whichever
comes first. For example, consider the following:

<PRE class="illegal-example">
@three-dee {
  @background-lighting {
    azimuth: 30deg;
    elevation: 190deg;
  }
  H1 { color: red }
}
H1 { color: blue }
</PRE>

<P> The '@three-dee' at-rule is not part of CSS3. Therefore, the whole
at-rule (up to, and including, the third right curly brace) is <span
class="index-inst" title="ignore"><a href="#ignore">ignored.</a></span> A
CSS3 user agent <span class="index-inst" title="ignore"><a
href="#ignore">ignores</a></span> it, effectively reducing the style sheet
to:</P>

<PRE class="example">
H1 { color: blue }
</PRE>

</UL>

<h3>Partial implementations</h3>

<p>CSS3, unlike CSS1 and CSS2, is modular and thus allows for partial
implementations.  The conformance requirements of some modules may also allow
for conformant implementations to implement only part of a module.</p>

<p>Implementations that do not implement a feature of any CSS3 module
(whether a property, an at-rule, or a property value) should behave as
they would according to the forward-compatible parsing rules had that
feature not been part of a known CSS specification.</p>


<h2>CSS document representation</h2>

<P>A CSS style sheet is a sequence of characters from the Universal Character
Set (see [[ISO10646]]). For transmission and storage, these characters must be
<span class="index-def" title="character encoding">encoded</span> by a
character encoding that supports the set of characters available in US-ASCII
(e.g., ISO 8859-x, SHIFT JIS, etc.).  A byte order mark (BOM) that begins the
sequence of characters should not be considered, for purposes of applying the
grammar above, as a part of the stylesheet <span class="issue">[need
reference]</span>.  For a good introduction to character sets and character
encodings, please consult the HTML 4.0 specification ([[-HTML40]], chapter 5),
See also the XML 1.0 specification ([[-XML10]], sections 2.2 and 4.3.3, and
<span class="issue">[where is the property index going to be?]</span>.

<P>When a style sheet is embedded in another document, such as in the
STYLE element or "style" attribute of HTML, the style sheet shares the
character encoding of the whole document.

<P>When a style sheet resides in a separate file, user agents must
observe the following <span class="index-inst" title="character
encoding::user agent's determination of">priorities</span> when
determining a document's <span class="index-inst" title="character
encoding::default|default::character encoding">character
encoding</span> (from highest priority to lowest):</p>

<ol>
<li>An HTTP "charset" parameter in a "Content-Type" field.
<li>The <span class="index-def" title="@charset">@charset</span>
at-rule.
<li>Mechanisms of the language of the
referencing document (e.g., in HTML, the "charset"
attribute of the LINK element).
</ol>

<P>At most one @charset rule may appear in an external
style sheet -- it must <em>not</em> appear in an embedded style sheet
-- and it must appear at the very start of the document, not preceded
by any characters. After "@charset", authors specify the name of a
character encoding. The name must be a charset name as described in
the IANA registry (See [[IANA]]. Also, see [[-CHARSETS]] for a complete
list of charsets). For example:</p>

<div class="example"><P>
@charset "ISO-8859-1";
</div>

<P>This specification does not mandate which character encodings
a user agent must support.

<P>Note that reliance on the @charset construct theoretically poses a
problem since there is no <em>a priori</em> information on how it is
encoded. In practice, however, the encodings in wide use on the
Internet are either based on ASCII, UTF-16, UCS-4, or (rarely) on
EBCDIC.  This means that in general, the initial byte values of a
document enable a user agent to detect the encoding family reliably,
which provides enough information to decode the @charset rule, which
in turn determines the exact character encoding.

<!-- More examples of good encodings to use? -IJ -->

<!-- Encodings not to use? (cf. HTML 4.0) -IJ -->

<h3>Referring to characters not represented in a character encoding</h3>

<P>A style sheet may have to refer to characters that cannot be
represented in the current character encoding.  These characters must
be written as <a href="#escaped-characters">escaped</a> references to
ISO 10646 characters. These escapes serve the same purpose as numeric
character references in HTML or XML documents (see [[HTML40]],
chapters 5 and 25).

<P>The character escape mechanism should be used when only a few
characters must be represented this way. If most of a document
requires escaping, authors should encode it with a more appropriate
encoding (e.g., if the document contains a lot of Greek characters,
authors might use "ISO-8859-7" or "UTF-8").

<P>Intermediate processors using a different character encoding may
translate these escaped sequences into byte sequences of that
encoding. Intermediate processors must not, on
the other hand, alter escape sequences that cancel the special meaning
of an ASCII character.

<P><a href="conform.html#conformance">Conforming user agents</a> must
correctly map to Unicode all characters in any character encodings
that they recognize (or they must behave as if they did).

<P>For example, a document transmitted as ISO-8859-1
(Latin-1) cannot contain Greek letters directly:
"&#954;&#959;&#965;&#961;&#959;&#962;" (Greek: "kouros") has to be
written as "\3BA\3BF\3C5\3C1\3BF\3C2".

<div class="note"><P>
<em><strong>Note.</strong>
In HTML 4.0,
numeric character references are interpreted in "style" attribute
values but not in the content of the STYLE element. Because of this
asymmetry, we recommend that authors use the CSS character
escape mechanism rather than numeric character references
for both the "style" attribute and the STYLE element.
For example, we recommend:</em></p>

<pre class="html-example">
&lt;SPAN style="voice-family: D\FC rst"&gt;...&lt;/SPAN&gt;
</pre>

<P><em>rather than:</em></p>

<pre class="html-example">
&lt;SPAN style="voice-family: D&amp;#252;rst"&gt;...&lt;/SPAN&gt;
</pre>
</div>

<h2 class="no-num">Changes from CSS2</h2>

<ul>
  <li>added the section on vendor extensions and added the
  <span class="css">'-'</span> character to the
  nmstart macro so that identifiers can begin with it</li>

  <li>modified the rules for handling parsing errors
  to allow implementations that support only parts of CSS3</li>

  <li>described how stylesheets that cannot be parsed according to the
  grammar should be handled</li>

  <li>described handling of unmatched quotation marks</li>

  <li>combined DELIM and other single character tokens into CHAR</li>

  <li>explicitly stated that the byte order mark should be ignored for
  purposes of the grammar</li>

</ul>

<h2 class="no-num">Acknowledgments</h2>

<p>Since most of this draft is taken from CSS2, it would not have been possible
to write it so easily without the work of the editors and authors of CSS1 and
CSS2.  Many current and former members of the working group have contributed to
this document.  Discussions on www-style@w3.org and in other places have also
contributed ideas to this specification.  Comments from Glenn Adams have been
particularly helpful.  <span class="issue">[more here]</span></p>

<h2 class="no-num"><a name="references">References</a></h2>
<!--include "../biblio.inc"-->

<h2 class="no-num">Index</h2>
<!--index-->
</body>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-declaration:"~/SGML/HTML4.decl"
sgml-default-doctype-name:"html"
sgml-minimize-attributes:t
sgml-nofill-elements:("pre" "style" "br")
sgml-live-element-indicator:t
End:
-->
</html>
