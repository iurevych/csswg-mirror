<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>CSS Flexible Box Layout Module</title>
	<link rel="stylesheet" type="text/css" href="http://dev.w3.org/csswg/css-module/default.css">
	<link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/TR/W3C-ED">
</head><body>

<div class="head">
	<!--logo-->

	<h1 id="head-box-flexible">CSS Flexible Box Layout Module</h1>
	<h2 class="no-num no-toc" id="w3c-working">[LONGSTATUS], [DATE]</h2>

	<dl>
		<dt>This version:
		<dd><!-- <a href="http://www.w3.org/TR/[YEAR]/WD-[SHORTNAME]-[CDATE]/">http://www.w3.org/TR/[YEAR]/WD-[SHORTNAME]-[CDATE]/</a></dd> -->
		<a href="http://dev.w3.org/csswg/[SHORTNAME]/">http://dev.w3.org/csswg/[SHORTNAME]/</a>

		<dt>Latest version:
		<dd><a href="http://www.w3.org/TR/css3-flexbox/">http://www.w3.org/TR/css3-flexbox/</a>

		<dt>Previous version:
		<dd><a href="http://www.w3.org/TR/2009/WD-css3-flexbox-20090723/">http://www.w3.org/TR/2009/WD-css3-flexbox-20090723/</a>

		<dt>Editors:
		<dd><a href="http://www.xanthir.com/contact">Tab Atkins Jr.</a>, Google Inc.</dd>
		<dd>Alex Mogilevsky, Microsoft Corporation, <a href="mailto:alexmog@microsoft.com">alexmog@microsoft.com</a>
		<dd>L. David Baron, Mozilla Corporation, <a href="mailto:dbaron@dbaron.org">dbaron@dbaron.org</a>

		<dt>Authors and former editors:
		<dd>Neil Deakin, Mozilla Corporation, <a href="mailto:enndeakin@gmail.com">enndeakin@gmail.com</a>
		<dd>Ian Hickson, formerly of Opera Software, <a href="mailto:ian@hixie.ch">ian@hixie.ch</a>
		<dd>David Hyatt, formerly of Netscape Corporation, <a href="mailto:hyatt@apple.com">hyatt@apple.com</a>
	</dl>
	<!--copyright-->

	<hr title="Separator for header">
</div>

<h2 class="no-num no-toc" id="abstract">
Abstract</h2>

	<p>The specification describes a CSS box model optimized for user interface design. In flexbox layout model, the children of a box are laid out either horizontally or vertically, and unused space can be assigned to a particular child or distributed among the children by assignment of "flex" to the children that should expand. Nesting of these boxes (horizontal inside vertical, or vertical inside horizontal) can be used to build layouts in two dimensions.</p>

<h2 class="no-num no-toc" id="status">Status of this document</h2>
<!--status-->

<h2 class="no-num no-toc" id="table">Table of contents</h2>
<!--toc-->


<h2 id="intro">
Introduction</h2>

	<p>CSS 2.1 defined four layout modes &mdash; algorithms which determine the size and position of boxes based on their relationships with their sibling and ancestor boxes: block layout, designed for laying out documents and simple applications; inline layout, designed for laying out text; table layout, designed for laying out information in a tabular format; and positioned layout, designed for very explicit positioning without much regard for other elements in the document. This module introduces a new layout mode, flexbox layout, which is designed for laying out more complex applications and webpages.</p>

	<p>Flexbox layout is superficially similar to block layout.  It lacks many of the more complex text or document-formatting properties that can be used in block layout, such as 'float' and 'columns', but in return it gains more simple and powerful tools for aligning its contents in ways that webapps and complex web pages often need.  </p>

    <p>The contents of a flexbox can be laid out in any direction, can have their order swapped around dynamically, and can "flex" their sizes and positions to respond to the available space.  If a flexbox is <i>multi-line</i>, the flexbox items flow in two dimensions, wrapping into separate lines in a fashion similar to how text is wrapped into multiple lines.  The direction that these lines are stacked in can also be controlled explicitly, relative either to the current writing mode (logical directions) or explicit physical directions.</p>

<h2 id='box-model'>
The Flexbox Box Model</h2>

	<p>An element with ''display:flexbox'' or ''display:inline-flexbox'' is a <dfn>flexbox</dfn>.  Block-level children of a flexbox, and some other types of children, are called <dfn title="flexbox item|flexbox items|flexbox item's" id="flexbox-item">flexbox items</dfn> and are laid out using the flexbox box model. <span class='note'>(See the <a href="#flex-items">Flexbox Items</a> chapter, below, for specifics on which children are <i>flexbox items</i> directly and which children are instead wrapped in anonymous boxes which are then <i>flexbox items</i>)</span></p>

	<p>The flexbox layout algorithm works is agnostic as to the physical direction the flexbox happens to be laid out in, so we will define several direction-agnostic terms here to make the rest of the spec easier to read and understand.  The <dfn>main axis</dfn> of a flexbox is the axis on which <i>flexbox items</i> are laid out along.  The <i>flexbox items</i> are ordered such that they start on the <dfn>main-start</dfn> side of the flexbox, and go toward the <dfn>main-end</dfn> side.  A <i>flexbox item's</i> width or height, whichever is in the <i>main axis</i>, is the item's <dfn>main size</dfn>.  These terms are mapped to physical directions based on the first keyword in the 'flex-flow' property.</p>

	<p>The axis perpendicular to the <i>main axis</i> is called the <dfn>cross axis</dfn>, and similarly has <dfn>cross-start</dfn> and <dfn>cross-end</dfn> directions and sides defined.  The width or height of a <i>flexbox item</i>, whichever is in the <i>cross axis</i>, is the item's <dfn>cross size</dfn>.  These terms are mapped to physical directions based on the orientation of the <i>main axis</i> and the second keyword in the 'flex-flow' property.</p>

	<p>The contents of a flexbox can be easily and powerfully manipulated with a handful of properties.  Most significantly, <i>flexbox items</i> can "flex" their <i>main size</i> by using the ''flex()'' function in the 'width' or 'height' property.  This "flexing" allows the items to get bigger or smaller based on the available space in the page.  If there is leftover space in the flexbox after all of the <i>flexbox items</i> have finished flexing, the items can be aligned, centered, or distributed with the 'flex-pack' property.  <i>Flexbox items</i> can also be completely rearranged within the flexbox with the 'flex-order' property.</p>

	<p>In the <i>cross axis</i>, <i>flexbox items</i> can either "flex" to fill the available space or be aligned within the space with the 'flex-align' property.  If a flexbox is <i>multi-line</i>, new lines are added in the <i>cross-end</i> direction, and can similarly be aligned, centered, or distributed within the flexbox with the 'flex-line-pack' property.</p>

	<p>Similar to other layout modes such as table layout, a flexbox acts like a block when placed into elements using other layout modes.  Inline flexboxes act like inline-blocks.</p>

	<div class="example">
		<p>For example, the following HTML snippet declares a flexbox with a few children.  The flexbox is horizontal, and the children's widths don't fill the flexbox's width, so the additional space is distributed between the children.  The flexbox's height isn't explicitly specified, so it shrinks to the height of its tallest child and centers the other children within it:</p>

		<pre>
&lt;p style="width: 500px; padding: 5px; display: flexbox; flex-pack: distribute; flex-align: middle;">
	&lt;button style="width: 200px;">Child 1&lt;br>Another Line&lt;/button>
	&lt;button style="width: 100px;">Child 2&lt;/button>
	&lt;button style="width: 100px;">Child 3&lt;/button>
&lt;/p></pre>

		<p>This will render approximately like the following:</p>

		<p style="border: thin solid black; background: white; width: 500px; padding: 5px; overflow: hidden;">
			<button style="float: left; width: 200px; height: 40px; margin-right: 50px;">Child 1<br>Another Line</button>
			<button style="float: left; width: 100px; height: 22px; margin-top: 9px;">Child 2</button>
			<button style="float: right; width: 100px; height: 22px; margin-top: 9px;">Child 3</button>
		</p>
	</div>


<h3 id='display-flexbox'>
New values for 'display' property</h3>

	<table class="propdef">
		<tr>
			<th>Name:
			<td>display
		<tr>
			<th>New value:
			<td>flexbox | inline-flexbox
	</table>

	<p>You can declare that an element is a flexbox, and thus should use flexbox layout for its contents, by setting the 'display' property on the element to the value 'flexbox' or 'inline-flexbox'.</p>

	<p>The ''flexbox'' value makes the flexbox act like a block in other layout modes.  The ''inline-flexbox'' value makes the flexbox act like an inline-block in other layout modes.</p>

	<p>Setting ''display:flexbox'' on an element forces it to use a new layout algorithm, and so some properties that were designed with the assumption of block layout don't make sense in a flexbox context.  In particular:</p>

	<ul>
		<li>all of the 'column-*' properties in the Multicol module compute to their initial values on a flexbox ('break-before', 'break-inside', and 'break-after' are still valid on a flexbox).</li>

		<li>'float' and 'clear' compute to their initial values on a flexbox item</li>

		<li>'vertical-align' has no effect on a flexbox item</li>
	</ul>

	<p>A flexbox item creates a new flexbox formatting context for its contents.  This is similar to a block formatting context: floats must not intrude into the flexbox, and the flexbox's margins do not collapse with any other margin.  Additionally, all of the <i>flexbox items</i> establish new block formatting contexts for their contents.</p>

	<p class='issue'>Figure out the right terms to use here.</p>



<h3 id='flex-items'>
Flexbox Items</h3>

	<p>Flexbox layout algorithm operates on <i>flexbox items</i>, which are boxes that satisfy at least one of the following criteria:</p>

	<ol>
		<li>Immediate block-level children of flexbox</li>

		<li>Atomic inline-level children of flexbox</li>

		<li>Contiguous run of non-replaced inline children, wrapped into an anonymous block</li>
	</ol>

	<div class="example">
		<p>Examples of flexbox items:</p>
		<pre>
&lt;div style="display:flexbox">

    &lt;!-- flexbox item: block-level child -->
    &lt;div id="item1">block&lt;/div>

    &lt;!-- not a flexbox item, because it's out-of-flow -->
    &lt;div id="not-an-item1.5" style="position: absolute;">block&lt;/div>
    
    &lt;!-- flexbox item: block-level child -->
    &lt;div id="item2" style="display:table">table&lt;/div>
    
    &lt;!-- flexbox item: anonymous table wrapped around table-cell -->
    &lt;div id="item3" style="display:table-cell">table-cell&lt;/div> 

    &lt;!-- flexbox item: anonymous block around inline content -->
    anonymous item 4

    &lt;!-- flexbox item: block-level child -->
    &lt;div id="item5">block&lt;/div>

    &lt;!-- flexbox item: anonymous block around inline content -->
    anonymous item 6.1
    &lt;span id="item6.1">
        text 6.2
        &lt;div id="not-an-item6.3">block&lt;/div>
        text 6.4
    &lt;/span>

    &lt;!-- flexbox item: block-level replaced element -->
    &lt;iframe id="item7"></iframe>

    &lt;!-- flexbox item: inline-level replaced element -->
    &lt;img id="item7" style="display:inline">

    &lt;!-- flexbox item: inline-level replaced element -->
    &lt;button id="item8">button&lt;/button>

    &lt;!-- flexbox item: inline-table -->
    &lt;div id="item9" style="display:inline-table">table&lt;/div>
&lt;/div></pre>

		<p>Notice that block element "not-an-item6.3" is not a separate flexbox item, because it is contained inside an inline element which is being wrapped into an anonymous flex item.  Similarly, the block element "not-an-item1.5" is not a flexbox item, because it's absolutely positioned and thus out of flow.</p>
	</div>

	<p>Absolutely positioned children of a flexbox are not <i>flexbox items</i>, but their "static position" (their position when the 'top'/'right'/'bottom'/'left' properties are ''auto'') responds somewhat to the flexbox's various properties.  The element's static position in the flexbox's <i>cross axis</i> is on the <i>cross-start</i> edge of the flexbox's content box.  The static position in the flexbox's <i>main axis</i> is slightly more complex to compute:</p>

	<p>First, find the element's <dfn>hypothetical neighbors</dfn> by assuming that the element is a normal <i>flexbox item</i> with ''flex-order:1'', and reorder the flexbox's contents as mandated by 'flex-order'.  The <i>flexbox items</i> immediately preceding and following (in the flexbox's direction) the element (if any) are the element's <i>hypothetical neighbors</i>.</p>

	<p>If the element has two neighbors, its static position in the <i>main axis</i> is exactly in the center of the packing space between them when the flexbox is actually laid out.  If the element has only a preceding neighbor, its static position in the <i>main axis</i> is flush with the <i>main-end</i> edge of the margin box of the neighbor.  If the element has only a following neighbor, its static position in the <i>main axis</i> is flush with the <i>main-start</i> edge of the margin box of the neighbor.  Finally, if the element has no neighbors (the flexbox has no in-flow children at all), the static position in the <i>main axis</i> is based on the value of 'flex-pack': if the value is ''start'' or ''distribute'', it's flush with the <i>main-start</i> edge of the flexbox's content box; if the value is ''end'', it's flush with the <i>main-end</i> edge of the flexbox's content box; if the value is ''center'', it's centered within the flexbox's content box.</p>

<h2 id='ordering-orientation'>
Ordering and Orientation</h2>

	<p>The first level of flexbox functionality is the ability to lay out a flexbox's contents in any direction and in any order.  This allows an author to trivially achieve effects that would previously have required complex or fragile methods, such as using the 'float' property to lay out a horizontal navigation bar (which then requires further effort with the 'clear' property or others to make the elements interact nicely with the rest of the page).  This functionality is exposed through the 'flex-flow' and 'flex-order' properties.</p>

<h3 id='flex-flow'>
Flexbox Flow Direction: the 'flex-flow' property</h3>

	<table class=propdef>
		<tbody>
			<tr>
				<th>Name:</th>
				<td><dfn>flex-flow</dfn></td>
			<tr>
				<th>Values:
				<td><pre>  [ row | row-reverse | column | column-reverse ]
  [ wrap | wrap-reverse ]?
|
  [ horizontal | horizontal-reverse | horizontal-ltr | horizontal-rtl ] 
  [ wrap | wrap-reverse | wrap-down | wrap-up ]?
|
  [ vertical | vertical-reverse | vertical-ttb | vertical-btt ] 
  [ wrap | wrap-reverse | wrap-left | wrap-right ]?</pre></td>
			<tr>
				<th>Initial:
				<td>row</td>
	        </tr>
			<tr>
				<th>Applies To:
				<td>flexboxes</td>
	        </tr>
			<tr>
				<th>Inherited:
				<td>no</td>
	        </tr>
			<tr>
				<th>Computed Value:
				<td>specified value</td>
	        </tr>
			<tr>
				<th>Media:
				<td>visual</td>
	        </tr>
		</tbody>
	</table>

	<p>The 'flexbox-flow' property specifies how <i>flexbox items</i> are placed in the flexbox. The value consists of one or two keywords: the first sets the orientation and direction of the flexbox's <i>main axis</i>, while the second, if specified, marks the flexbox as being multiline and sets the direction in which new lines are stacked.</p>

	<p>The main directions affect how <i>flexbox items</i> are arranged, and how they respond to the 'flex-pack' property.  They can be set with either logical directions (relative to the writing mode) or physical directions:</p>

	<dl>
		<dt>Logical Directions</dt>
		<dd>
			<dl>
				<dt><dfn id='flex-flow-row'>row</dfn></dt>
				<dd>The flexbox's <i>main axis</i> has the same orientation as the inline axis of the current writing mode (the direction that text is laid out in).  The <i>main-start</i> and <i>main-end</i> directions are equivalent to the "start" and "end" directions, respectively, of the current writing mode.</dd>

				<dt><dfn id='flex-flow-row-reverse'>row-reverse</dfn></dt>
				<dd>Same as <i>row</i>, except the <i>main-start</i> and <i>main-end</i> directions are swapped.</dd>

				<dt><dfn id='flex-flow-column'>column</dfn></dt>
				<dd>The flexbox's <i>main axis</i> has the same orientation as the block axis of the current writing mode (the direction that blocks are laid out in).  The <i>main-start</i> and <i>main-end</i> directions are equivalent to the "before" and "after" directions, respectively, of the current writing mode.</dd>

				<dt><dfn id='flex-flow-column-reverse'>column-reverse</dfn></dt>
				<dd>Same as <i>column</i>, except the <i>main-start</i> and <i>main-end</i> directions are swapped.</dd>
			</dl>
		</dd>

		<dt>Physical Directions</dt>
		<dd>
			<dl>
				<dt><dfn id='flex-flow-horizontal'>horizontal</dfn></dt>
				<dd>The flexbox's <i>main axis</i> is horizontal.  The <i>main-start</i> direction is equivalent to either the "start" or "before" direction of the current writing mode, whichever is vertical, and the <i>main-end</i> direction is the opposite direction of <i>main-start</i>.</dd>

				<dt><dfn id='flex-flow-horizontal-reverse'>horizontal-reverse</dfn></dt>
				<dd>Same as <i>horizontal</i>, except the <i>main-start</i> and <i>main-end</i> directions are swapped.</dd>

				<dt><dfn id='flex-flow-horizontal-ltr'>horizontal-ltr</dfn></dt>
				<dd>Same as <i>horizontal</i>, except the <i>main-start</i> direction is to the left and the <i>main-end</i> direction is to the right.</dd>

				<dt><dfn id='flex-flow-horizontal-rtl'>horizontal-rtl</dfn></dt>
				<dd>Same as <i>horizontal</i>, except the <i>main-start</i> direction is to the right and the <i>main-end</i> direction is to the left.</dd>

				<dt><dfn id='flex-flow-vertical'>vertical</dfn></dt>
				<dd>The flexbox's <i>main axis</i> is vertical.  The <i>main-start</i> direction is equivalent to either the "start" or "before" direction of the current writing mode, whichever is horizontal, and the <i>main-end</i> direction is the opposite direction of <i>main-start</i>.</dd>

				<dt><dfn id='flex-flow-vertical-reverse'>vertical-reverse</dfn></dt>
				<dd>Same as <i>vertical</i>, except the <i>main-start</i> and <i>main-end</i> directions are swapped.</dd>

				<dt><dfn id='flex-flow-vertical-ttb'>vertical-ttb</dfn></dt>
				<dd>Same as <i>vertical</i>, except the <i>main-start</i> direction is upwards and the <i>main-end</i> direction is downwards.</dd>

				<dt><dfn id='flex-flow-row-vertical-btt'>vertical-btt</dfn></dt>
				<dd>Same as <i>vertical</i>, except the <i>main-start</i> direction is downwards and the <i>main-end</i> direction is upwards.</dd>
			</dl>
		</dd>
	</dl>

	<p class='note'>Usually, the logical keywords are sufficient, which is why their names are purposely short.  For example, if the page's writing mode is lr-tb, like it is when the primary language is English, the ''row'' value makes the flexbox horizontal and going from left to right, while the ''column'' value makes the flexbox vertical and going from top to bottom.  If this were specified as part of a page template, and the page as a whole was switched to a tb-rl writing-mode like what Japanese uses, the flexboxes would automatically shift to vertical and horizontal, respectively, which is often what is desired.</p>

	<p>The <i>cross axis</i> is always perpendicular to the <i>main axis</i>.  The second keyword, or the lack of it, sets the cross directions (<i>cross-start</i> and <i>cross-end</i>), and dictates whether the flexbox is single-line or multi-line.  The cross directions affect how individual <i>flexbox items</i> respond to the 'flex-align' property, and the direction in which multiple lines are stacked and aligned by the 'flex-line-pack' property.</p>

	<p>If the second keyword is omitted, the flexbox is single-line, the <i>cross-start</i> direction is equivalent to either the "start" or "before" direction of the current writing mode, whichever is in the <i>cross-axis</i>, and the <i>cross-end</i> direction is the opposite direction of <i>cross-start</i>.</p>

	<p>If the second keyword is provided, the flexbox is <a href="#multiline">multi-line</a>.  The <i>cross-start</i> and <i>cross-end</i> directions are set as follows:</p>

	<dl>
		<dt><dfn id='flex-flow-wrap'>wrap</dfn></dt>
		<dd>The <i>cross-start</i> direction is equivalent to either the "start" or "before" direction of the current writing mode, whichever is in the <i>cross-axis</i>, and the <i>cross-end</i> direction is the opposite direction of <i>cross-start</i>.</dd>

		<dt><dfn id='flex-flow-wrap-reverse'>wrap-reverse</dfn></dt>
		<dd>Same as <i>wrap</i>, except the <i>cross-start</i> and <i>cross-end</i> directions are swapped.</dd>

		<dt><dfn id='flex-flow-wrap-up'>wrap-up</dfn></dt>
		<dd>The <i>cross-start</i> direction is downwards and the <i>cross-end</i> direction is upwards.</dd>

		<dt><dfn id='flex-flow-wrap-right'>wrap-right</dfn></dt>
		<dd>The <i>cross-start</i> direction is to the left and the <i>cross-end</i> direction is to the right.</dd>

		<dt><dfn id='flex-flow-wrap-down'>wrap-down</dfn></dt>
		<dd>The <i>cross-start</i> direction is upwards and the <i>cross-end</i> direction is downwards.</dd>

		<dt><dfn id='flex-flow-wrap-left'>wrap-left</dfn></dt>
		<dd>The <i>cross-start</i> direction is to the right and the <i>cross-end</i> direction is to the left.</dd>
	</dl>

	<p class='note'>Note that not all combinations of first and second keyword are allowed by the property's syntax, as they don't all make sense.  For example, ''flex-flow: horizontal wrap-right'' is an invalid declaration.</p>

	<div class="example">
		<p>Some examples of valid flows:</p>

		<pre>
div { flex-flow:row }                      /* initial value. Main axis is inline,
                                              no wrap. */
div { flex-flow:horizontal-ltr wrap-down } /* main axis is horizontal, flow left-to-right, 
                                              wrap down */
div { writing-mode:tb-rl;                  /* main axis is vertical top-to-bottom (as line direction),
      flex-flow:vertical wrap-reverse }    /* cross axis is left-to-right (opposite to block direction) */</pre>
	</div>


<h3 id='flex-order'>
Display Order: the 'flex-order' property</h3>

	<p><i>Flexbox items</i> are, by default, displayed and laid out in the same order as they appear in the source document.  The 'flex-order' property may be used to change this ordering.</p>

	<table class=propdef>
		<tr>
			<th>Name:
			<td><dfn>flex-order</dfn>
		<tr>
			<th>Value:
			<td>&lt;integer>
		<tr>
			<th>Initial:
			<td>1
		<tr>
			<th>Applies to:
			<td><i>flexbox items</i></td>
		<tr>
			<th>Inherited:
			<td>no
		<tr>
			<th>Computed value:
			<td>specified value
		<tr>
			<th>Media:
			<td>visual
	</table>

	<p>The 'flex-order' property assigns <i>flexbox items</i> to ordinal groups.</p>

	<p>Ordinal groups control the order in which <i>flexbox items</i> appear.  A flexbox will lay out its content starting from the lowest numbered ordinal group and going up.  Items with the same ordinal group are laid out in the order they appear in the source document.

	<div class=example>
		<p>This example shows how ordinal groups might be used.</p>
		<pre><code>	div { display: flexbox; }
#item1 { flex-order: 2; }
#item3 { flex-order: 2; }
#item4 { flex-order: 1; }

&lt;div>
	&lt;div id="item1">item1&lt;/div>
	&lt;div id="item2">item2&lt;/div>
	&lt;div id="item3">item3&lt;/div>
	&lt;div id="item4">item4&lt;/div>
&lt;/div></code></pre>

		<p>The first ordinal group, 1, contains item2 and item4. As item2 does not specify an ordinal group, it will default to 1. The elements will be displayed in document order, so item2 will be displayed before item4. The second ordinal group, 2, contains the remaining two items. The resulting display order will be:</p>

		<pre><code>item2 item4 item1 item3</code></pre>
	</div>

	<p class='issue'>Add a realistic example of tab reordering.</p>

	<p class='issue'>Add an example of reordering columns in a page.</p>


<h2 id='flexibility'>
Flexibility</h2>

	<p>The defining aspect of flexbox layout is the ability to make the <i>flexbox items</i> "flex", altering their width or height to fill the available space.  This is done by declaring a <dfn>flexible length</dfn> with the ''flex()'' function, defined below.</p>

	<p>Flexible lengths are composed of a (non-flexible) preferred size and a positive and negative flexibility.  If there's free space left over in the flexbox after subtracting the preferred sizes of all the <i>flexbox items</i>, it is divided up among the <i>flexbox items</i> proportionally to their positive flexibility, making their width larger so they fill the space.  Conversely, if the flexbox's size is <em>less</em> than the sum of the preferred sizes, so that the items would overflow normally, the <i>flexbox items</i> are shrunk proportionally to their negative flexibility, again so they exactly fit in the space.</p>

	<div class=example>
		<p class=issue>TODO: Examples!</p>
	</div>


<h3 id='flex-function'>
The ''flex()'' function</h3>
 
	<p>The ''flex()'' function is used to specify the parameters of a <dfn title="flexible length|flexible lengths|flexible length's">flexible length</dfn>: the <dfn id="positive-flexibility" title="positive flexibility">positive</dfn> and <dfn>negative flexibility</dfn>, and the <dfn>preferred size</dfn>.  The syntax of the ''flex()'' function is:</p>

	<pre class=prod>flex( [ &lt;pos-flex> &lt;neg-flex>? ]? || &lt;preferred-size>? )</pre>

	<p><code>&lt;pos-flex></code> and <code>&lt;neg-flex></code> are non-negative <code>&lt;numbers>s</code>, while <code>&lt;preferred-size></code> is any value (other than another ''flex()'' function) that would be valid in the 'width' or 'height' property in which the function is used, except that zero lengths must not omit their unit.</p>

	<p>The <code>&lt;pos-flex></code> component sets the length's <i>positive flexibility</i>; if omitted, the <i>positive flexibility</i> defaults to ''1''.  The <code>&lt;neg-flex></code> component sets the length's <i>negative flexibility</i>; if omitted, it defaults to ''0''.  The <code>&lt;preferred-size></code> component sets the length's <i>preferred size</i>; if omitted, it defaults to ''0px''.</p>

	<p class='issue'>Examples!</p>


<h3 id='resolving-flexible-lengths'>
Resolving Flexible Lengths</h3>

	<p><i>Flexible lengths</i> are resolved into normal, inflexible lengths by figuring out how large all of the <i>flexible lengths</i> in the flexbox <em>want</em> to be, then either adding or subtracting space from that preferred size.  The following algorithm normatively describes how to do this conversion:</p>

	<p>First, determine the width and height of the flexbox itself, as described by the <a href="#layout-interface">Box Properties</a> chapter.  The <i>main size</i> of the flexbox's content box is the <i>available space</i>.</p>

	<p>Second, if the flexbox is <i>multi-line</i>, break the contents across multiple lines, as described by the <a href="multiline">Multiline</a> chapter.</p>

	<p>Then, for each line in the flexbox, do the following:</p>

	<ol>
		<li>Subtract the sum of the <i>pre-flex sizes</i> of the <i>flexbox items</i> on the line from the <i>available space</i>.  This is the <dfn>free space</dfn>.  This number may be negative, if the flexbox is single-line or a single <i>flexbox item</i> is larger than the entire flexbox.</li>

		<li>
			<dl>
				<dt>If the <i>free space</i> is zero:</dt>
				<dd>All <i>flexible lengths</i> resolve to their <i>preferred size</i>.</dd>

				<dt>If the <i>free space</i> is positive:</dt>
				<dd>
					<p>Sum the <i>positive flexibility</i> of every <i>flexible length</i> on the line.  This is the <dfn>total positive flexibility</dfn>.</p>
					
					<p>For each <i>flexible length</i>, increment its <i>preferred size</i> by <code><i>free space</i> * &lt;pos-flex> / <i>total positive flexibility</i></code>.</p>
				</dd>

				<dt>If the <i>free space</i> is negative:</dt>
				<dd>
					<p>Sum the <i>negative flexibility</i> of every <i>flexible length</i> on the line.  This is the <dfn>total negative flexibility</dfn>.</p>
					
					<p>For each <i>flexible length</i>, increment its <i>preferred size</i> by <code><i>free space</i> * &lt;neg-flex> / <i>total negative flexibility</i></code>.  <span class='note'>Note: since the free space is negative, incrementing the preferred size by this number makes the preferred size smaller.</span></p>
				</dd>
			</dl>
		</li>

		<li>
			<p>Verify that min/max constraints aren't violated: for each <i>flexbox item</i> on the line with 'width'/'height' specified as a <i>flexible length</i>, if instead specifying the 'width'/'height' as the <i>preferred size</i> would cause the item to be in violation of its 'min/max-width/height' properties, resolve the <i>flexible length</i> to the smallest/largest length that would make it no longer in violation of those properties, as defined by <a href="http://www.w3.org/TR/CSS2/visudet.html#propdef-min-width">the algorithm in CSS2.1</a>.</p>

			<p>If any <i>flexbox item</i> was found to be in violation by this step and resolved into an inflexible length, reset the <i>preferred size</i> of any remaining <i>flexible lengths</i> to their original values and restart this sub-algorithm.</p>
		</li>

		<li>Any remaining <i>flexible lengths</i> resolve to their <i>preferred size</i>.</li>
	</ol>

	<p>Once all <i>flexible lengths</i> have been resolved, the 'flex-pack', 'flex-align', and 'flex-line-pack' properties align the <i>flexbox items</i> and the flexbox's lines within the flexbox.</p>


<h2 id='alignment'>
Alignment</h2>

	<p>After a flexbox's contents have finished their flexing, they can be aligned in both the <i>main axis</i> with 'flex-pack' and the <i>cross axis</i> with 'flex-align'.  These properties make many common types of alignment trivial, including some things that were very difficult in CSS 2.1, like horizontal and vertical centering.</p>


<h3 id='flex-pack'>
Main Axis Alignment: the 'flex-pack' property</h3>

	<table class=propdef>
		<tr>
			<th>Name:
			<td><dfn>flex-pack</dfn>
		<tr>
			<th>Value:
			<td>start | end | center | justify
		<tr>
			<th>Initial:
			<td>start
		<tr>
			<th>Applies to:
			<td>flexboxes
		<tr>
			<th>Inherited:
			<td>no
		<tr>
			<th>Computed Value:
			<td>specified value
		<tr>
			<th>Media:
			<td>visual
	</table>

	<p>Between and around the margins of <i>flexbox items</i> there are additional 
	flexible lengths, called <dfn>packing space</dfn>.  Packing space can absorb 
	leftover free space in a flexbox if there aren't any other <i>flexible length</i>s, 
	or if all the <i>flexible length</i>s have reached their maximum size.  The 
	'flex-pack' property defines the flexibility of these packing spaces:

	<dl>
		<dt><dfn id='flex-pack-start'>start</dfn></dt>
		<dd><i>flexbox items</i> are packed toward the start of the flexbox.  The last packing space (between the margin of the last flexbox item and the edge of the flexbox) must absorb all leftover free space; all other packing spaces must have a length of ''0''.</dd>

		<dt><dfn id='flex-pack-end'>end</dfn></dt>
		<dd><i>flexbox items</i> are packed toward the end of the flexbox.  The first packing space (between the edge of the flexbox and the margin of the first flexbox item) must absorb all leftover free space; all other packing spaces must have a length of ''0''.</dd>

		<dt><dfn id='flex-pack-center'>center</dfn></dt>
		<dd><i>flexbox items</i> are packed toward the center of the flexbox.  The first and last packing spaces must equally split all leftover free space; all other packing spaces must have a length of ''0''.</dd>

		<dt><dfn id='flex-pack-justify'>justify</dfn></dt>
		<dd><i>flexbox items</i> are evenly distributed through the flexbox.  The first and last packing spaces must have a length of ''0''; all other packing spaces must equally split all leftover free space.</dd>
	</dl>

	<div class=figure>
		<p class=caption><span class=issue>TODO: Provide a diagram showing packing
	spaces.</span></p>
	</div>

	<div class=example>
		<p class=issue>TODO: Examples showing the four values.</p>
	</div>


<h3 id='flex-align'>
Cross Axis Alignment: the 'flex-align' property</h3>

	<p>Sizing and positioning of <i>flexbox items</i> along the <i>cross axis</i> of flexbox is controlled by the 'flex-align' property.</p>

	<table class=propdef>
		<tr>
			<th>Name:
			<td><dfn>flex-align</dfn>
		<tr>
			<th>Value:
			<td>before | after | middle | stretch | baseline
		<tr>
			<th>Initial:
			<td>stretch
		<tr>
			<th>Applies to:
			<td>flexbox items
		<tr>
			<th>Inherited:
			<td>no
		<tr>
			<th>Computed Value:
			<td>specified value
		<tr>
			<th>Media:
			<td>visual
	</table>

	<p>When the size of the containing box along <i>cross axis</i> is larger than the size of a child, extra space will be available. The 'flex-align' property specifies how flexbox item is placed along the <i>cross axis</i>, and where the extra space, if any, is positioned. </p>

	<p>The values of this property have the following meanings. See text for more specifics as to how children are positioned. </p>

	<dl>
		<dt><dfn id="flex-align-before">before</dfn></dt>
		<dd>The 'before' edge of the child box along <i>cross axis</i >is aligned with 'before' edge of the flexbox content box. See text for explanation of how direction of <i>cross axis</i> is determined.</dd>

		<dt><dfn id="flex-align-after">after</dfn></dt>
		<dd>The 'after' edge of the child box along <i>cross axis</i>is aligned with 'after' edge of the flexbox content box. See text for explanation of how direction of <i>cross axis</i> is determined.</dd>

		<dt><dfn id="flex-align-middle">middle</dfn></dt>
		<dd>Any extra space along the <i>cross axis</i> is divided evenly, with half placed before the child and the other half placed after the child.</dd>

		<dt><dfn id="flex-align-baseline">baseline</dfn></dt>
		<dd>
			<p>If this child's inline axis is parallel to <i>main axis</i> of the flexbox, the baseline of the child box is aligned with baselined of all other child boxes that meet the same criteria. Baseline of each child box is determined in the same way as when it is placed inline (as inline-block, inline-table, etc.).</p>

			<p>The children participating in baseline alignment, once aligned on their baselines, should then be placed into the box so that the child with the earliest extent margin has its 'before' margin edge flush with the 'before' edge of flexbox's content area. If the flexbox does not have an ''auto'' height, overflow will always be on the 'after' edge.

			<p>If the child box <i>inline axis</i> is orthogonal to flexbox <i>main axis</i>, then ''baseline'' acts identically to ''center''.</p>
		</dd>
			  
		<dt><dfn id="flex-align-stretch">stretch</dfn></dt>
		<dd>The height of each child is adjusted to that of the containing block. However, note the text below.
	</dl>

	<p>Direction of the <i>cross axis</i> is determined as follows:</p>

	<p>In multi-line flexbox, <i>cross axis</i> points in the direction of wrapping (the side where lines are added)</p>

	<p>In single-line flexbox, the direction of <i>cross axis</i> is determined by the computed value of writing mode of the flexbox element.</p>

	<ul>
		<li> If flexbox's <i>main axis</i> is parallel to inline axis of the writing mode, <i>cross axis</i> points in the direction of block flow.</li>

		<li> If flexbox's <i>main axis</i> is parallel to block flow axis of the writing mode, <i>cross axis</i> points in the direction of inline flow</li>
	</ul>
	
	<p>The following rules should be applied when determining the size of child boxes along the <i> cross axis</i>. Exceptions to these rules are noted under each of the possible values of 'flex-align' below.</p>

	<p>First, the <i>cross axis</i> size of content box of the flexbox has to be calculated. If computed value of flexbox's width or height (whichever is along the <i>cross axis</i>), that value is used. If it is 'auto', the size is determined by flexbox items, as follows:</p>

	<ol>
		<li><i>Cross-axis</i> sizes of margin boxes of all children in are checked and the biggest is selected.</li>

		<li>If there are any children with baseline alignemnt, biggest ascent (including its margin-before) and biggest descent (including its margin-after) are found.</li>

		<li>Flexbox's content box size is the size its biggest child or the sum of the biggest ascent and biggest descent, whichever is larger.</li>
	</ol>

	<p>All normal flow children of boxes will attempt to satisfy the following sizing equation when placed inside vertical boxes if and only if at least one of the specified values is auto:</p>

	<p>'margin-left' + 'border-left-width' + 'padding-left' + 'width' + 'padding-right' + 'border-right-width' + 'margin-right' = width of containing box

	<p>and a similar equation for height when placed inside horizontal boxes:

	<p>'margin-top' + 'border-top-width' + 'padding-top' + 'height' + 'padding-bottom' + 'border-bottom-width' + 'margin-bottom' = height of containing box

	<p>If all the values in the equation are specified (i.e., if there are no auto values), then the equation above does not apply, and the specified values should be used. If applying the equation results in a negative value for width/height, then that value is set to 0, and those values should be used.

	<p>If the value of 'flex-align' is ''stretch'', then elements obey the sizing rules specified above. This is the default value. If both width/height and one or both margin values are 'auto', the 'auto' margins are set to 0 and the equation is used to find a value for width/height. Otherwise, if both margins are 'auto', then the equation is solved under the additional constraint that the two margins must get the same value. If neither the width/height or either margin is auto, then the extra space is positioned as if flex-align was 'before'.

	<p>If the value of 'flex-align' is ''before'', ''after'', ''middle'', or ''baseline'', and a value of ''auto'' is specified for width/height, then the intrinsic size (or shrink to fit size) of the element should be used. If one margin has the value of auto, then the equations above should be used. If both margins have a value of auto then the above equations should be used, with the space being divided evenly between the two margins. These rules are similar to the rules for replaced elements inside blocks.

	<p>If the above would cause the width or height to greater than the computed maximum width or height, then the width or height is set to the maximum width or height, and the auto margins increased by the extra amount left over. If both margins are auto, they should both be increased by the same amount. If neither margin is auto, the extra space is placed as necessary depending on the flex-align value.

	<p>Once the sizes are computed, the margin boxes of the elements should be aligned at the before, middle, baseline or after edge of the box.

	<div class=example>   
		<p>A vertical flexbox can be used to emulate the functionality of HTML's <code>&lt;center></code> element:</p>

		<pre>&lt;div>
	&lt;span>foo foo foo foo&lt;/span>
	&lt;span>bar bar&lt;br>bar bar&lt;/span>
	&lt;span>foo foo foo foo foo foo foo foo foo foo foo foo&lt;/span>
&lt;/div>
&lt;style>
	div {
		display: flexbox;
		flex-direction: tb;
		width: 200px;
	}
	span {/* /*  */ */
		margin: 0 auto;
	}
&lt;/style></pre>

		<p><img alt="" src="images/basic-vertical-flexbox.png"></p>
	</div>

	<p class="issue">TODO: examples, with pictures</p>

	<p class="issue">TODO: alignment rules should be compatible with css3-grid-layout, if possible</p>


<h2 id='multiline'>
Multi-line flexbox</h2>

	<p>If no 'wrap-' keyword is included in 'flex-flow', flexbox lays out its items in a single row or column; any items that don't fit will simply be considered overflow.</p>

	<p>Adding any of the 'wrap-' keywords to 'flex-flow' enables multi-line mode. Then flexbox is allowed to expand to multiple lines (that is, multiple rows or columns) in order to accommodate all of its items. Flexbox must attempt to fit its items on as few lines as possible by shrinking all items down to their minimum widths or heights if necessary.</p>

	<p>If the items still do not fit on a line after being reduced to their minimum widths or heights, then items are moved one by one onto a new line, until the items remaining on the previous line fit. This process can repeat to an arbitrary number of lines. If a line contains only a single item that doesn't fit, then the item should stay on that line and overflow out of the box. The later lines are placed according to wrap direction specified in 'flex-flow'.</p>

	<p>The cross-axis size of a line is the cross-axis size of the largest item in that line. No additional space appears between the lines apart from the margins on the largest items in each line. For calculating the cross-axis size of a line, margins with a computed value of auto should be treated as having a value of 0.</p>

	<p>Once the number of lines has been determined, items with non-zero flexibility stretch as necessary in an attempt to fill the remaining space on the lines. Each line computes flexes independently, so only elements on that line are considered when evaluating flex. The packing of elements in a line, as specified by the flex-pack property, is also computed independently for each line.</p>

	<div class=example>
		<p>This example shows four buttons that do not fit horizontally.</p>

		<pre>&lt;style>
#div1 {
	display: flexbox;
	flex-flow: wrap;
	width: 300px;
}
button {
	width: flex(80px 1.0);
}
&lt;style>

&lt;div id="div1">
	&lt;button id="button1">Elephant&lt;/button>
	&lt;button id="button2">Tiger&lt;/button>
	&lt;button id="button3">Antelope&lt;/button>
	&lt;button id="button4">Wildebeest&lt;/button>
&lt;/div></pre>

		<p>The buttons are shrunk to their minimum widths, in this case 80 pixels. This will allow the first three buttons to fit in 240 pixels with 60 pixels left over of remaining space. Because the box-lines property has a specified value of multiple, the fourth button may be moved onto a second line.</p>

		<p>Flexibility is applied to each element, separately for each line. The first line has 60 pixels of remaining space, so each of the three buttons on that line will receive 20 pixels of extra width. The remaining button on a line of its own will stretch to the entire width of the containing box, or 300 pixels.</p>

		<div style="width:300px; border:medium solid green">
			<button style="width:100px">Elephant</button
			><button style="width:100px">Tiger</button
			><button style="width:100px">Antelope</button
			><button style="width:300px">Wildebeest</button>
		</div>

		<p>If the box was resized, the buttons may rearrange onto different lines as necessary. If the style rules in the example above were changed to the following:</p>

		<pre>
#div1 {
	display: flexbox;
	flex-flow: wrap;
	flex-pack: center;
	width: 300px;
}
button {
	width: flex(80px 1.0);
	max-width: 90px;
}</pre>
		<p>Now, each of the buttons will only stretch to include an additional 10 pixels of width, as the maximum width of 90 pixels is only 10 pixels larger than the minimum intrinsic width of the buttons. The remaining 30 pixels of space left over is divided up and placed inside the box outside of the buttons, as the value of box-pack is center. The fourth button will also appear at 90 pixels wide, centered within the box.</p>

		<div style="width:300px; border:medium solid green; text-align:center;">
			<button style="width:90px">Elephant</button
			><button style="width:90px">Tiger</button
			><button style="width:90px">Antelope</button
			><button style="width:90px">Wildebeest</button>
		</div>
	</div>


<h3 id='flex-line-pack'>
'flex-line-pack' property</h3>

	<table class=propdef>
		<tr>
			<th>Name:
			<td><dfn id="propdef-flex-line-pack">flex-line-pack</dfn>
		<tr>
			<th>Value:
			<td>before | after | middle | distribute
		<tr>
			<th>Initial:
			<td>before
		<tr>
			<th>Applies to:
			<td>flexboxes
		<tr>
			<th>Inherited:
			<td>no
		<tr>
			<th>Computed Value:
			<td>specified value
		<tr>
			<th>Media:
			<td>visual
	</table>

	<p>The flex-line-pack property may be used to control the alignment of lines in multi-line flexboxes. The values of this property have the following meanings:</p>

	<dl>
		<dt><dfn id='flex-line-pack-before'>before</dfn></dt>
		<dd>The first line of child boxes is placed along the 'before' edge of the content box (as determined by direction of <i>cross axis</i>), and additional lines are placed afterward with no extra spacing between them.</dd>

		<dt><dfn id='flex-line-pack-after'>after</dfn></dt>
		<dd>Lines of child boxes are placed with no extra spacing between and 'after' edge of the last line is aligned with 'after' edge of the content box.</dd>

		<dt><dfn id='flex-line-pack-middle'>middle</dfn></dt>
		<dd>Lines of child boxes are placed with no space between them and equal amount of extra space left before first line and after last line.</dd>
		
		<dt><dfn id='flex-line-pack-distribute'>distribute</dfn></dt>
		<dd>The first line of child boxes is aligned with 'before' edge of containing box. Lines of child boxes are spread with equal amout of empty spaces between each two lines, and so that 'after' edge of last line of child boxes is aligned with 'after' edge of conaining box.</dd>
	</dl>
			
	<p class="issue">TODO: examples</p>


<h2 id='free-space-algorithm'>
Free Space Calculation and Distribution</h2>

	<p class="issue">IS THIS SECTION NECESSARY? It may be useful for implementors as guidance, but it is not normative. The spec describes the result, this describes the process - one should be enough, and the description of the result is not specific enough, it needs to be fixed.</p>

	<p>The following algorithms detail precisely how to determine the dimensions and positions of a flexbox and its contents, and how to resolve flexible lengths used on <i>flexbox items</i> into definite lengths.</p>

	<p>The algorithm described here is designed to be clear, but not necessarily efficient.  Implementations may use different algorithms, but they must generate the same results as this algorithm.</p>

	<p>This section defines several terms to clarify the operation of the algorithms described within:</p>

	<dl>
		<dt><dfn>relevant length</dfn></dt>
		<dd>The width, height, margin, border, or padding of a flexbox item.  Also, the <i>packing space</i>s of a flexbox.</dd>

		<dt><dfn>flex tuple</dfn></dt>
		<dd>A 5-tuple of information about a flexible length, containing a minimum size, a maximum size, a preferred size, a positive flexibility, and a negative flexibility.</dd>

		<dt><dfn>total free space</dfn></dt>
		<dd>The inner width or height of the flexbox (depending on the distribution round), which will be used to calculate the sizes of the <i>flexbox items</i>.</dd>

		<dt><dfn>available free space</dfn></dt>
		<dd>The <i>total free space</i> minus the sum of the preferred sizes of all the relevant lengths, which is used to resolve <i>flex tuple</i>s into inflexible lengths.</dd>
	</dl>

	<p>Similarly, the <dfn>inner measure</dfn> is the width of the flexbox item in a horizontal flexbox, or the height in a vertical flexbox.  The <dfn>inner length</dfn> is the height of the flexbox item in a horizontal flexbox, or the width in a vertical flexbox.</p>

	<div class="issue">
		<p>Definition of "inner measure" and "inner length" is not used anywhere, or is it? Promote to general-use vocabulary or replace with existing terms.</p>

		<p class="issue">Suggestion: "inner measure" == "extent along main axis", "inner length" == "extent along cross axis"</p>
	</div>


<h3 id='free-space-algorithm-initial'>
Initial Computation</h3>
	
	<p>This step computes necessary information required to run the free-space distribution algorithms.</p>

	<ol>
		<li>Determine the measure of the flexbox.  Flexboxes are sized like shrinkwrapped blocks (if ''display:flexbox'' is used) or inline-blocks (if ''display:inline-flexbox'' is used).  A horizontal flexbox's measure is its width, while a vertical flexbox's measure is its height.  <span class=issue>This is wrong. In vertical flexbox with auto sizing, height can't be calculated before width (assuming horizontal flow). Calculation has to be width-then-height, not measure-then-length.</span></li>

		<li>
			<p>Resolve all <i>relevant length</i>s on the flexbox and its <i>flexbox items</i> into <dfn>flex tuples</dfn> of [minimum size, maximum size, preferred size, positive flex, negative flex].</p>

			<dl>
				<dt>For margins and padding:</dt>
				<dd>
					<p>Set the minimum size to 0 and the maximum size to infinity.</p>

					<p>If the length is inflexible, set the preferred size to the length itself and both positive and negative flexibility to 0.</p>

					<p>If the length is a margin with the value ''auto'', set the preferred size to 0, the positive flexibility to 1, and the negative flexibility to 0.</p>
				</dd>

				<dt>For borders:</dt>
				<dd>Borders are always inflexible.  Set the minimum size to 0, the maximum size to infinity, the preferred size to the border-width, and the positive and negative flexibility to 0.</dd>

				<dt>For width and height:</dt>
				<dd>
					<p>Set the minimum size to the value of the 'min-width' or 'min-height', as appropriate.  Set the maximum size to the value of the 'max-width' or 'max-height' property, as appropriate, unless the value is ''none'', in which case set the maximum size to infinity.</p>

					<p>If the length is inflexible, set the preferred size to the length itself and both positive and negative flexibility to 0.</p>

					<p>Otherwise, if the length was specified with the ''flex()'' function, set the positive and negative flexibility to the values specified in the function.  If the preferred size argument specified in the function is a &lt;length>, set the preferred size to that length. If the argment is a &lt;percentage>, resolve it relative to the width or height of the flexbox, as appropriate, and set the preferred size to the resultant length.  If the argument is ''auto'', set the preferred size to the item's intrinsic dimension in the appropriate axis.</p>

					<p>Otherwise, if the length was ''auto'', set the preferred size to the item's intrinsic dimension in the appropriate axis, the positive flexibility to 1, and the negative flexibility to 0.</p>

					<p>If the preferred size is now less than the minimum size, set it equal to the minimum size.  If the preferred size is now greater than the maximum size, set it equal to the maximum size.</p>
				</dd>

				<dt>For <i>packing space</i>s:</dt>
				<dd>
					<p>If the flexbox's 'flex-pack' is <i title=flex-pack-start>start</i>,the last <i>packing space</i> (between the final <i>flexbox item</i>, after reordering by 'flex-order', and the end of the flexbox) has a minimum size of 0, a maximum size of infinity, a preferred size of 0, a positive flexibility of 1, and a negative flexibility of 0.  All other <i>packing space</i>s have minimum size, maximum size, preferred size, positive flexibility, and negative flexibility of 0.</p>

					<p>If the flexbox's 'flex-pack' is <i title=flex-pack-end>end</i>, the first <i>packing space</i> (between the first <i>flexbox item</i>, after reordering by 'flex-order', and the start of the flexbox) has a minimum size of 0, a maximum size of infinity, a preferred size of 0, a positive flexibility of 1, and a negative flexibility of 0.  All other <i>packing space</i>s have minimum size, maximum size, preferred size, positive flexibility, and negative flexibility of 0.</p>

					<p>If the flexbox's 'flex-pack' is <i title=flex-pack-center>center</i>, the first and last <i>packing space</i>s (as defined above) have a minimum size of 0, a maximum size of infinity, a preferred size of 0, a positive flexibility of 1, and a negative flexibility of 0.  All other <i>packing space</i>s have minimum size, maximum size, preferred size, positive flexibility, and negative flexibility of 0.</p>

					<p>If the flexbox's 'flex-pack' is <i title=flex-pack-justify>justify</i>, the first and last <i>packing space</i>s (as defined above) have a minimum size, maximum size, preferred size, positive flexibility, and negative flexibility of 0.  All other <i>packing space</i>s have a minimum size of 0, a maximum size of infinity, a preferred size of 0, a positive flexibility of 1, and a negative flexibility of 0.</p>
				</dd>
			</dl>
		</li>
	</ol>


<h3 id='first-distribution-round'>
First Distribution Round</h3>

	<p>This step distributes free space to the flexible lengths of the flexbox in the <i>measure axis</i>.</p>

	<p>Collect the set of <i>flex tuple</i>s that can participate in this step:</p>

	<ol>
		<li>If the flexbox is horizontal, collect the widths of every <i>flexbox item</i>. If the flexbox is vertical, instead collect the heights of every <i>flexbox item</i>.</li>

		<li>Collect the margins of every <i>flexbox item</i> that are in the flexbox's measure axis.</li>

		<li>Collect the borders of every <i>flexbox item</i> that are in the flexbox's measure axis, if the <i>flexbox item</i> has a 'box-sizing' value of ''content-box'' or ''padding-box''.</li>

		<li>Collect the paddings of every <i>flexbox item</i> that are in the flexbox's measure axis, if the <i>flexbox item</i> has a 'box-sizing' value of ''content-box''.</li>
	</ol>

	<p>Invoke the <i>free space allocation algorithm</i> with the set of <i>flex tuple</i>s collected above, and an <i>available free space</i> equal to the flexbox's inner measure.</p>


<h3 id='second-distribution-round'>
Second Distribution Round</h3>

	<p>This step distributes any leftover available space to the <i>packing space</i>, so that the flexbox items are arranged within the flexbox as desired.</p>

	<p>Collect the same set of <i>flex tuple</i>s as in the first distribution round (now inflexible lengths), and additionally collect the flexbox's <i>packing space</i>s.</p>

	<p>Invoke the <i>free space allocation algorithm</i> with the set of <i>flex tuple</i>s collected above, and an <i>available free space</i> equal to the flexbox's inner measure.</p>


<h3 id='intermediate-computation'>
Intermediate Computation</h3>

	<p>Determine the length of the flexbox, given the sizes that have already been determined.</p>


<h3 id='third-distribution-round'>
Third Distribution Round</h3>

	<p>This step distributes free space to the flexible lengths of each flexbox item in the <i>length axis</i>.  <strong>It is run for each <i>flexbox item</i> independently.</strong></p>

	<p class=issue>ISSUE: This step doesn't yet take 'flex-align' into account. I need to decide whether to always default to stretching or shrinking when doing baseline-alignment, or coming up with some heuristic for it.  Perhaps specify the behavior in the 'flex-align' values instead?  Once this decision is made, the behavior is relatively simple - either adjust margin (if shrunk) or padding (if stretched)</p>

	<p>Collect the set of <i>flex tuple</i>s from the current <i>flexbox item</i> that can participate in this step:</p>

	<ol>
		<li>If the flexbox is horizontal, collect the height of the <i>flexbox item</i>. If the flexbox is vertical, instead collect the width of the <i>flexbox item</i>.</li>

		<li>Collect the margins of the <i>flexbox item</i> that are in the flexbox's length axis.</li>

		<li>Collect the borders of the <i>flexbox item</i> that are in the flexbox's length axis, if the <i>flexbox item</i> has a 'box-sizing' value of ''content-box'' or ''padding-box''.</li>

		<li>Collect the padding lengths of the <i>flexbox item</i> that are in the flexbox's length axis, if the <i>flexbox item</i> has a 'box-sizing' value of ''content-box''.</li>
	</ol>

	<p>Invoke the <i>free space allocation algorithm</i> with the set of <i>flex tuple</i>s collected above, and an <i>available free space</i> equal to the flexbox's inner length.</p>


<h3 id='free-space-allocation-algorithm'>
Free Space Allocation Algorithm</h3>

	<p>This section describes the algorithm used to allocate free space to a set of flexible lengths.  The inputs to this algorithm are a set of <i>flex tuple</i>s and a length representing the <i>total free space</i>.  The output is a set of inflexible lengths.</p>

	<p>Calculate the <i>available free space</i> by summing the preferred size of all the <i>flex tuple</i>s and subtracting that value from the <i>total free space</i>.</p>

	<p>If the <i>available free space</i> is 0, transform all the <i>flex tuple</i>s into inflexible lengths equal to their preferred size and return them.</p>

	<p>If the <i>available free space</i> is a positive length, it will be distributed between all the <i>flex tuple</i>s with positive flexibility:</p>

	<ol>
		<li>Sum the <i>positive flexibility</i> of all the <i>flex tuple</i>s.  This is the <i>total flexibility</i>.</li>

		<li>If the <i>total flexibility</i> is 0, transform all the <i>flex tuple</i>s into inflexible lengths equal to their preferred size and return them.</li>

		<li>
			<p>For each <i>flex tuple</i> with non-zero <i>positive flexibility</i>, set its preferred size to:</p>

			<pre><code>[preferred size] + ( [available free space] * [positive flexibility] / [total flexibility] )</code></pre>
		</li>

		<li>If any <i>flex tuple</i>s now have a preferred size greater than their maximum size, set their preferred size to their maximum size, set their positive flexibility to 0, and restart this algorithm.</li>

		<li>Transform all the <i>flex tuple</i>s into inflexible lengths equal to their preferred size, and return them.</li>
	</ol>

	<p>If the <i>available free space</i> is a negative length, all the <i>flex tuple</i>s with negative flexibility will shrink to attemp to fit the set of <i>flex tuple</i>s into the available space:</p>

	<ol>
		<li>Sum the <i>negative flexibility</i> of all the <i>flex tuple</i>s.  This is the <i>total flexibility</i>.</li>

		<li>If the <i>total flexibility</i> is 0, transform all the <i>flex tuple</i>s into inflexible lengths equal to their preferred size and return them.</li>

		<li>
			<p>For each <i>flex tuple</i> with non-zero <i>negative flexibility</i>, set its preferred size to:</p>

			<pre><code>[preferred size] + ( [available free space] * [negative flexibility] / [total flexibility] )</code></pre>

			<p class=note>Note that the <i>available free space</i> is a negative
			length here, so the sum will result in a smaller length.</p>
		</li>

		<li>If any <i>flex tuple</i>s now have a preferred size lesser than their minimum size, set their preferred size to their minimum size, set their negative flexibility to 0, and restart this algorithm.</li>

		<li>Transform all the <i>flex tuple</i>s into inflexible lengths equal to their preferred size, and return them.</li>
	</ol>


<h2 id="pagination">
Page breaks in flexbox</h2>

	<p class="issue">TODO: define how flexbox should break on pages, columns, etc. This may or may not be normative until there is more than one implementation.</p>

	<p>Very roughly:</p>

	<ul>
		<li>Flexboxes can beak across pages between items, between rows of items (in multi-line mode) and inside items, as long as 'break-' property allow that. All 'break-' properties are supported on flexbox, on flexbox items and inside flexbox items.</li>

		<li>Breaking behavior of a single-line vertical flexbox should be identical to a block in normal flow where children have same sizes and positions (e.g. explicitly set to match computed values in flexbox), same content and same breaking properties. <span class="issue">This is good goal or guidance, but not necessarily good normative definition. Get specific.</span> </li>

		<li>Breaking behavior of a horizontal single-line flexbox should be similar (not necessarily identical) to that of a single-row table with same sizing.</li>

		<li>In horizontal flexbox, a forced break within an items causes subsequent content of that item to go to next container, but it doesn't affect sibling items or their content.</li>

		<li>In horizontal multi-line flexbox, values of 'break-before' and 'break-after' for each line are computed from combinatoin of properties on children that fit in that line (or would have fit, given available width and infinite height)</li>
	</ul>

	<p class="issue">TODO: define breaking of vertical multi-line flexbox</p>

	<p class="issue">TODO: add more detail: how breaking affect sizing (for broken boxes and boxes after the break) and alignment</p>


<h2 id="layout-interface">
Box Properties and Sizing</h2>

	<p class='issue'>Define how flexboxes are sized, paying attention to width/height keywords on both the flexbox and flexbox items, the writing modes of both the flexbox and flexbox items, and the flexbox direction.</p>


<hr title="Separator from footer">
			
<h2>Changes</h2>

<h3>Changes from ED 16-June-2011</h3>

	<ul>
		<li>Intro
			<ul>
				<li>Added definitions for main axis and cross axis</li>

				<li>Added a pargraph on multiline</li>
			</ul>
		</li>
		
		<li>'display' property
			<ul>
				<li>Removed issue for "display-inside" (now ACTION-342)</li>
			</ul>
		</li>
		
		<li>Flex-item
			<ul>
				<li>New section, adds detail for flex item fixup</li>
				
				<li>Removed issue for "other ignored properties"</li>
				
				<li>Added issue on applicability of 'vertical-align'</li>
			</ul>
		</li>
		
		<li>'flex-flow' property
			<ul>
				<li>Renamed (was 'flex-direction')</li>
		
				<li>Values as in "option 8" <a href="http://wiki.csswg.org/spec/css3-flexbox#issue-2">http://wiki.csswg.org/spec/css3-flexbox#issue-2</a></li>

				<li>Computed value: specified value (was lr/rl/tb/bt)</li>

				<li>Prose describing how the pair of values work</li>
			</ul>
		</li>
	
		<li>'flex-order'
			<ul>
				<li>Removed "flex-order vs. flex-index" issue. There is an issue at Wiki to finalize that, proposal to not change: <a href="http://wiki.csswg.org/spec/css3-flexbox#issue-8">http://wiki.csswg.org/spec/css3-flexbox#issue-8</a></li>
			</ul>
		</li>
		
		<li>Flexibility
			<ul>
				<li>Removed 'fr' unit</li>
				
				<li>Changed default/unspecified values to ''initial'', removed references to specifically 'width' and 'height'. No changes to what it applies to, but this way it is more general, in case it does need to apply to something else (for example to be part of grid rows/columns declarations)</li>

				<li>Added a paragraph allowing (but not requiring) accepting unitless non-zero length in quirks mode, only when three values are specified.</li>
			</ul>
		</li>
		
		<li>Flexible margins
			<ul>
				<li>Added issue 15: ''margin:auto'' as flex of 1 is not as powerful as ''margin:flex(2, 20, 5)''. Is it enough? A good use case would help (issue 16)</li>
			</ul>
		</li>
		
		<li>'flex-align' property
			<ul>
				<li>Adapted most of the definition of 'flex-align' from 2009 spec</li>

				<li>Note difference from 2009 spec remains – 'flex-align' applies to flexbox items, while 'box-align' of the old spec applied to flexbox.</li>

				<li>Added definition for where is 'before' and where is 'after'</li>

				<li>Open issue 14 for before/after to validate the definition.</li>
				
				<li>Included definition of how flexbox cross-axis size is determined in case of baseline-aligned children or mixed.</li>

				<li>Note: the core alignment algorithm copied from 2009 spec describes how auto margins work together with 'flex-align'. That algorithm is copied unchanged, proposed to adopt. It gives priority to margins over align (if I am reading it correctly): "flex-align:before; margin-top:auto" will end up being bottom-aligned in a horizontal flexbox.</li>
			</ul>
		</li>
		
		<li>Multiline flexbox
			<ul>
				<li>Copied the section on multiline flexbox from 2009 spec, adapted to fit into the current draft</li>
			</ul>
		</li>
		
		<li>'Flex-line-pack' property</li>
		
		<li>Other
			<ul>
				<li>Replaced "measure axis" with "main axis"</li>
				<li>Removed commented out intro draft</li>
			</ul>
		</li>
	</ul>

<h2 class="no-num" id="acknowledgments">Acknowledgments</h2>

	<p>[This section will contain further acknowledgments.]</p>

	<p>Thanks for feedback from James Elmore and Shinichiro Hamaji.</p>

<h2 class="no-num" id="references">References</h2>

<h3 class="no-num" id="normative">Normative references</h3>
<!--normative-->

<h3 class="no-num" id="informative">Other references</h3>
<!--informative-->

<h2 id="property" class="no-num">Property index</h2>
<!--properties-->

<h2 class="no-num" id="index">Index</h2>
<!--index-->

</body></html>
<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-declaration:"~/SGML/HTML4.decl"
sgml-default-doctype-name:"html"
sgml-minimize-attributes:t
sgml-nofill-elements:("pre" "style" "br")
sgml-live-element-indicator:t
sgml-omittag:nil
sgml-shorttag:nil
sgml-namecase-general:t
sgml-general-insert-case:lower
sgml-always-quote-attributes:t
sgml-indent-step:nil
sgml-indent-data:t
sgml-parent-document:nil
sgml-exposed-tags:nil
sgml-local-catalogs:nil
sgml-local-ecat-files:nil
End:
-->