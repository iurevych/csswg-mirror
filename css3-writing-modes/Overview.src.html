<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>CSS Writing Modes Module Level 3</title>
  <link rel="stylesheet" type="text/css" href="../default.css">
  <style type="text/css">
    object { vertical-align: middle; }
    .sidebar { float: right; background: #eee; border: solid gray; margin: 1em; }
    .landscape { height: 10em; }
    .portrait { width: 10em; }
    .sidebar .figure { margin: 1em; }
    .sidebar object { margin: 0 auto; display: block; }
    .figurepair { display: table; margin: 1em auto; }
    .figurepair .figure { display: table-cell; }
     h2 { clear: both; }
  </style>
  <link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/tr/W3C-ED.css">
</head>

<body>

<div class="head">

<!--logo-->

<h1>CSS Writing Modes Module Level 3</h1>

<h2 class="no-num no-toc">[LONGSTATUS] [DATE]</h2>
<dl>
  <dt>This version:</dt>
    <dd><a href="http://dev.w3.org/csswg/css3-text-layout/">http://dev.w3.org/csswg/css3-text-layout/</a>
  <dt>Latest version:</dt>
    <dd><a
      href="http://www.w3.org/TR/css3-text-layout/">http://www.w3.org/TR/css3-text-layout/</a></dd>
  <dt>Previous version:</dt>
    <dd><a
      href="http://www.w3.org/tr/2003/CR-css3-text-20030514/">http://www.w3.org/tr/2003/CR-css3-text-20030514/</a></dd>
  <dt>Editors:</dt>
    <dd><a href="http://fantasai.inkedblade.net/contact">Elika J. Etemad</a> (Invited Expert)</dd>
    <dd><a href="mailto:kojiishi@gluesoft.co.jp">Koji Ishii</a> (<a href="http://www.antenna.co.jp/">Antenna House</a>)</dd>
    <dd><a href="mailto:murakami@antenna.co.jp">Shinyu Murakami</a> (<a href="http://www.antenna.co.jp/">Antenna House</a>)</dd>
  <dt>Previous Editors:</dt>
    <dd><a href="mailto:paulnel@microsoft.com">Paul Nelson</a> (<a href="http://www.microsoft.com/">Microsoft</a>)</dd>
    <dd><a href="mailto:michelsu@microsoft.com">Michel Suignard</a> (<a href="http://www.microsoft.com/">Microsoft</a>)</dd>
</dl>

<!--begin-copyright-->
<p>[Here will be included the file "../copyright.inc"]</p>
<!--end-copyright-->

<hr title="Separator for header">
</div>

<h2 class="no-num no-toc" id="abstract">Abstract</h2>

  <p>This module specifies the text layout model in CSS and the properties
    that control it. It covers bidirectional and vertical text.</p>

<h2 class="no-num no-toc" id="status">Status of this document</h2>

<!--status-->

<h2 class="no-num no-toc" id="Contents">Contents</h2>

<!--toc-->

<h2 id="intro">Introduction</h2>

  <p>This module defines support for various international writing directions,
    such as left-to-right (e.g., Latin scripts), right-to-left (e.g., Hebrew
    or Arabic), bidirectional (e.g., mixing Latin with Arabic) and vertical
    (e.g., Asian scripts).</p>

  <p>Inherently bottom-to-top scripts are not handled in this version. See
    [[UTN22]] for an explanation of relevant issues.</p>

<h2 id="text-flow">Writing Modes and Terminology</h2>

  <p>A <dfn>writing mode</dfn> is defined primarily in terms of its
    <dfn>inline directionality</dfn> and <dfn>block flow direction</dfn>:

  <div class="sidebar">
    <div class="figure right">
      <object data="diagrams/text-flow-vectors-tb.svg" type="image/svg+xml"
        class="landscape"></object>
      <p class="caption">Latin-based writing mode
    </div>
      <div class="figure left">
        <object data="diagrams/text-flow-vectors-lr-reverse.svg" type="image/svg+xml"
          class="portrait"></object>
        <p class="caption">Mongolian-based writing mode
      </div>
      <div class="figure right">
        <object data="diagrams/text-flow-vectors-tb.svg" type="image/svg+xml"
          class="landscape"></object>
        <object data="diagrams/text-flow-vectors-rl.svg" type="image/svg+xml"
          class="portrait"></object>
        <p class="caption">Han-based writing mode
      </div>
  </div>

  <p>The <dfn>inline directionality</dfn> is the primary direction in which
    content is ordered on a line and defines on which sides the "start"
    and "end" of a line are. The 'direction' property specifies the
    inline directionality of an element and, together with the 'unicode-bidi'
    property and the inherent directionality of any text content, determines
    the ordering of inline-level content within a line.

  <p>The <dfn>block flow direction</dfn> is the direction in which
    block-level boxes stack  and the direction in which line boxes stack
    within a block container. The 'writing-mode' property determines the
    block flow direction.</p>

  <p>A <dfn>horizontal writing mode</dfn> is one with horizontal lines of
    text, i.e. a downward or upward block flow. A <dfn>vertical writing
    mode</dfn> is one with vertical lines of text, i.e. a leftward or
    rightward block flow. <span class="note">These terms should not be
    confused with <dfn>vertical block flow</dfn> (which is a downward or
    upward block flow) and <dfn>horizontal block flow</dfn> (which is
    leftward or rightward block flow). To avoid confusion, this
    specification avoids the latter set of terms.</span>
    The term "writing mode" is chosen because these characteristics are
    strongly associated with the layout of text.</p>

  <p>Writing systems typically have one or two native writing modes. Some
    examples are:
  <ul>
    <li>Latin-based systems are typically written using a left-to-right inline
      direction with a downward (top-to-bottom) block flow direction.
    <li>Arabic-based systems are typically written using a right-to-left
      inline direction with a downward (top-to-bottom) block flow direction.
    <li>Mongolian-based systems are typically written using a top-to-bottom
      inline direction with a rightward (left-to-right) block flow direction.
    <li>Han-based systems are commonly written using a left-to-right inline direction
      with a downward (top-to-bottom) block flow direction, <strong>or</strong>
      a top-to-bottom inline direction with a leftward (right-to-left) block
      flow direction. Many magazines and newspapers will mix these two writing
      modes on the same page.
  </ul>

  <p>Some additional characteristics, the line orientation and glyph
    orientation, are primarily used to handle scripts placed in a non-native
    writing mode. The <dfn>line orientation</dfn> determines which side of
    the line is the "top" and thus which sides are <dfn>under</dfn> or
    <dfn>over</dfn> the line. This determines the interpretation of
    alignment in the transverse dimension of the line. It also determines
    the default <dfn>glyph orientation</dfn> for scripts in a non-native
    orientation. These characteristics are controlled by the 'text-orientation'
    property.

  <p class="note">See Unicode Technical Note #22 [[UTN22]]
    (<a href="http://fantasai.inkedblade.net/style/discuss/vertical-text/paper">HTML version</a>)
    for a more in-depth introduction to writing modes and vertical text.

<h2 id="text-direction">Inline Direction and Bidirectionality</h2>

  <p>While the characters in most scripts are written from left to right,
    certain scripts are written from right to left. In some documents,
    in particular those written with the Arabic  or Hebrew script, and in
    some mixed-language contexts, text in a single (visually displayed)
    block may appear with mixed directionality. This phenomenon is called
    <span class="index-def" title="bidirectionality (bidi)"><dfn>bidirectionality</dfn></span>, or
    "bidi" for short.</p>

  <p>The Unicode standard (<a href="http://www.unicode.org/reports/tr9/">Unicode Standard Annex #9</a>) defines a complex
    algorithm for determining the proper ordering of bidirectional text. The
    algorithm consists of an implicit part based on character properties,
    as well as explicit controls for embeddings and overrides. CSS relies
    on this algorithm to achieve proper bidirectional rendering. The <span
    class="propinst-direction">'direction'</span> and <span
    class="propinst-unicode-bidi">'unicode-bidi'</span> properties allow
    authors to specify how the elements and attributes of a document
    language map to this algorithm.</p>

  <p>User agents that support bidirectional text must apply the Unicode
    bidirectional algorithm to every sequence of inline boxes uninterrupted
    by a forced (<a href="http://www.unicode.org/reports/tr9/#Bidirectional_Character_Types">bidi class B</a>)
    line break or block boundary. This sequence forms the "paragraph" unit
    in the bidirectional algorithm. The paragraph embedding level is set
    according to the value of the 'direction' property of the containing
    block rather than by the heuristic given in steps P2 and P3 of the Unicode
    algorithm.</p>

  <p>Because the directionality of a text depends on the structure and
    semantics of the document, these properties should in most cases be
    used only to map bidi information in the markup to its corresponding
    CSS styles. If a document language provides markup features to control
    bidi, authors and users should use those features and not specify CSS
    rules to override them.</p>

  <p>The HTML 4 specification ([[HTML401]], section 8.2) defines
    bidirectionality behavior for HTML elements. The HTML 4 specification
    also contains more information on bidirectionality issues.</p>

  <p class="note">Because HTML UAs can turn off CSS styling, we advise HTML 
    authors to use the HTML 'dir' attribute and &lt;bdo&gt; element to
    ensure correct bidirectional layout in the absence of a style sheet.</p>  

<h3 id="direction">Specifying Directionality: the 'direction' property</h3>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>direction</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td>ltr | rtl </td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>ltr</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>all elements</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>yes</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>N/A</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>specified value</td>
      </tr>
    </tbody>
  </table>

  <p>This property specifies the base directionality of text and elements
    on a line, and the directionality of embeddings and overrides (see
    'unicode-bidi') for the Unicode
    bidirectional algorithm. In addition, it affects the ordering of <a
    href="http://www.w3.org/TR/CSS21/tables.html">table</a> column layout,
    the direction of horizontal <a href="http://www.w3.org/TR/CSS21/visufx.html#overflow">overflow</a>,
    and the default alignment of text within a line, and other things
    that depend on the base inline directionality.</p>

  <p>Values for this property have the following meanings:</p>

  <dl>
   <dt><strong>ltr</strong></dt>
   <dd>Left-to-right directionality.</dd>
   <dt><strong>rtl</strong></dt>
   <dd>Right-to-left directionality.</dd>
  </dl>

  <p>The value of the 'direction' property on the root element is also
    propagated to the initial containing block and, together with the
    'writing-mode' property, determines the document's principal writing
    mode. (See <a href="#principal-writing-mode">below</a>.)

  <p class="note">The 'direction' property has no reordering in inline-level
    elements whose 'unicode-bidi' property's value is ''normal''.</p>

  <p class="note">The 'direction'
     property, when specified for table column elements, is not inherited by
     cells in the column since columns are not the ancestors of the cells in
     the document tree. Thus, CSS cannot easily capture the "dir" attribute
     inheritance rules described in [[HTML401]], section 11.3.2.1.

<h3 id="unicode-bidi">Embeddings and Overrides: the 'uncode-bidi' property</h3>

    <table class="propdef">
      <tbody>
        <tr>
          <th>Name:</th>
          <td><dfn>unicode-bidi</dfn></td>
        </tr>
        <tr>
          <th>Value:</th>
          <td>normal | ( embed | isolate ) || ( plaintext | bidi-override )</td>
        </tr>
        <tr>
          <th>Initial:</th>
          <td>normal</td>
        </tr>
        <tr>
          <th>Applies to:</th>
          <td>all elements, but see prose</td>
        </tr>
        <tr>
          <th>Inherited:</th>
          <td>no</td>
        </tr>
        <tr>
          <th>Percentages:</th>
          <td>N/A</td>
        </tr>
        <tr>
          <th>Media:</th>
          <td>visual</td>
        </tr>
        <tr>
          <th>Computed&#160;value:</th>
          <td>specified value</td>
        </tr>
      </tbody>
    </table>

  <p>Values for this property have the following meanings:</p>

  <dl>
    <dt><strong>normal</strong></dt>
    <dd>The element does not open an additional level of embedding with
      respect to the bidirectional algorithm. For inline-level elements,
      implicit reordering works across element boundaries.</dd>
    <dt><strong>embed</strong></dt>
    <dd>If the element is inline-level, this value
      opens an additional level of embedding with respect to the
      bidirectional algorithm. The direction of this embedding level is
      given by the 'direction'
      property. Inside the element, reordering is done implicitly. This
      corresponds to adding a LRE (U+202A; for 'direction: ltr') or RLE
      (U+202B; for 'direction: rtl') at the start of the element and a PDF
      (U+202C) at the end of the element.</dd>
    <dt><strong>bidi-override</strong></dt>
    <dd>For inline-level elements this creates an override.
      For block-level, table-cell, table-caption, or inline-block elements 
      this creates an override for inline-level descendants not within 
      another block-level, table-cell, table-caption, or inline-block 
      element. This means that inside the element, reordering is strictly in sequence
      according to the <span class="propinst-direction">'direction'</span>
      property; the implicit part of the bidirectional algorithm is
      ignored. This corresponds to adding a LRO (U+202D; for 'direction:
      ltr') or RLO (U+202E; for 'direction: rtl') at the start of the
      element and a PDF (U+202C) at the end of the element.</dd>
    <dt><strong>isolate</strong></dt>
    <dd>For the purposes of the Unicode bidirectional algorithm, the
      contents of the element are considered to be inside a separate,
      independent paragraph, and for the purpose of bidi resolution
      in its containing bidi paragraph (if any), the element itself is
      treated as if it were an Object Replacement Character (U+FFFC).
      (If the element is broken across multiple lines, then each box
      of the element is treated as an Object Replacement Character.)</dd>
    <dt><strong>plaintext</strong></dt>
    <dd><p>For the purposes of the Unicode bidirectional algorithm, the
      base directionality of each "paragraph" for which the element
      is the containing block element is determined not by the element's
      computed 'direction' as usual, but by following rules P1, P2,
      and P3 of the Unicode bidirectional algorithm. However, if no
      direction-determining character is found in step P2, then the
      value of the 'direction' property is used instead. Note this value
      has no effect on inline elements.
  </dl>

  <p>The final order of characters in each block-level element is the
    same as if the bidi control codes had been added as described above,
    markup had been stripped, and the resulting character sequence had
    been passed to an implementation of the Unicode bidirectional
    algorithm for plain text that produced the same line-breaks as the
    styled text. In this process, non-textual entities such as images are
    treated as neutral characters, unless their <span
    class="propinst-unicode-bidi">'unicode-bidi'</span> property has a
    value other than 'normal', in which case they are treated as strong
    characters in the <span class="propinst-direction">'direction'</span>
    specified for the element.</p>

  <p>Please note that in order to be able to flow inline boxes in a
    uniform direction (either entirely left-to-right or entirely
    right-to-left), more inline boxes (including anonymous inline boxes)
    may have to be created, and some inline boxes may have to be split up
    and reordered before flowing.</p>

  <p>Because the Unicode algorithm has a limit of 
    <em title="According to unicode 3.0, chapter 3, section 12, definition BD2. 
    Specifically, page 58 here: http://www.unicode.org/unicode/uni2book/ch03.pdf">
    61 levels</em> of embedding, care should be taken not to use <span
    class="propinst-unicode-bidi">'unicode-bidi'</span> with a value other
    than 'normal' unless appropriate. In particular, a value of 'inherit'
    should be used with extreme caution. However, for elements that are,
    in general, intended to be displayed as blocks, a setting of
    'unicode-bidi: isolate' is preferred to keep the element together in
    case display is changed to inline (see example below).</p>

  <p>The following example shows an XML document with bidirectional
    text. It illustrates an important design principle: document language
    designers should take bidi into account both in the language proper
    (elements and attributes) and in any accompanying style sheets. The
    style sheets should be designed so that bidi rules are separate from
    other style rules, and such rules should not be overridden by other
    style sheets so that the document language's bidi behavior is preserved.</p>

<h3 id="bidi-example">Example of Bidirectional Text</h3>

  <div class="example">
    <p>In this example, lowercase letters stand for inherently left-to-right
      characters and uppercase letters represent inherently right-to-left
      characters. The text stream is shown in logical backing store order.</p>

    <pre class="xml-example"><code class="xml">
&lt;HEBREW&gt;
  &lt;PAR&gt;HEBREW1 HEBREW2 english3 HEBREW4 HEBREW5&lt;/PAR&gt;
  &lt;PAR&gt;HEBREW6 &lt;EMPH&gt;HEBREW7&lt;/EMPH&gt; HEBREW8&lt;/PAR&gt;
&lt;/HEBREW&gt;
&lt;ENGLISH&gt;
  &lt;PAR&gt;english9 english10 english11 HEBREW12 HEBREW13&lt;/PAR&gt;
  &lt;PAR&gt;english14 english15 english16&lt;/PAR&gt;
  &lt;PAR&gt;english17 &lt;HE-QUO&gt;HEBREW18 english19 HEBREW20&lt;/HE-QUO&gt;&lt;/PAR&gt;
&lt;/ENGLISH&gt;
    </code></pre>

    <p>Since this is arbitrary XML, the style sheet is responsible for
      setting the writing direction. This is the style sheet:</p>

    <pre>
/* Rules for bidi */
HEBREW, HE-QUO  {direction: rtl; unicode-bidi: embed;}
ENGLISH         {direction: ltr; unicode-bidi: embed;} 

/* Rules for presentation */
HEBREW, ENGLISH, PAR  {display: block;}
EMPH                  {font-weight: bold;}
    </pre>

    <p>The HEBREW element is a block with a right-to-left base direction,
      the ENGLISH element is a block with a left-to-right base
      direction. The PARs are blocks that inherit the base direction from
      their parents. Thus, the first two PARs are read starting at the top
      right, the final three are read starting at the top left.  Please note
      that HEBREW and ENGLISH are chosen as element names for explicitness
      only; in general, element names should convey structure without
      reference to language.</p>

    <p>The EMPH element is inline-level, and since its value for <span
      class="propinst-unicode-bidi">'unicode-bidi'</span> is 'normal' (the
      initial value), it has no effect on the ordering of the text. The
      HE-QUO element, on the other hand, creates an embedding.</p>

    <p>The formatting of this text might look like this if the line length
      is long:</p>

    <pre class="ascii-art">
               5WERBEH 4WERBEH english3 2WERBEH 1WERBEH

                                8WERBEH <b>7WERBEH</b> 6WERBEH

english9 english10 english11 13WERBEH 12WERBEH

english14 english15 english16

english17 20WERBEH english19 18WERBEH
    </pre>

    <p>Note that the HE-QUO embedding causes HEBREW18 to be to the right
      of english19.</p>

    <p>If lines have to be broken, it might be more like this:</p>

    <pre class="ascii-art">
       2WERBEH 1WERBEH
  -EH 4WERBEH english3
                 5WERB

   -EH <b>7WERBEH</b> 6WERBEH
                 8WERB

english9 english10 en-
glish11 12WERBEH
13WERBEH

english14 english15
english16

english17 18WERBEH
20WERBEH english19
    </pre>

    <p>Because HEBREW18 must be read before english19, it is on the line
      above english19. Just breaking the long line from the earlier
      formatting would not have worked. Note also that the first syllable
      from english19 might have fit on the previous line, but hyphenation of
      left-to-right words in a right-to-left context, and vice versa, is
      usually suppressed to avoid having to display a hyphen in the middle
      of a line.</p>

  </div><!-- example -->

<h3 id="bidi-box-model">Box model for inline elements in bidirectional context</h3>
<!-- CSS2.1 8.6 -->
  <p>For each line box, UAs must take the inline boxes generated for each
    element and render the margins, borders and padding in visual order
    (not logical order).

  <p>When the element's 'direction' property is ''ltr'', the left-most
    generated box of the first line box in which the element appears
    has the left margin, left border and left padding, and the right-most
    generated box of the last line box in which the element appears has
    the right padding, right border and right margin.

  <p>When the element's 'direction' property is ''rtl'', the right-most
    generated box of the first line box in which the element appears has
    the right padding, right border and right margin, and the left-most
    generated box of the last line box in which the element appears has
    the left margin, left border and left padding.

<h2 id="writing-mode">Block Flow Direction: the 'writing-mode' property</h2>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>writing-mode</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td>horizontal-tb | vertical-rl | vertical-lr | horizontal-bt</td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>horizontal-tb</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>All elements except table row groups, table column groups, table rows, and table columns</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>yes</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>N/A</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>specified value</td>
      </tr>
    </tbody>
  </table>

  <p>This property sets the block flow direction. Possible values:</p>

  <dl>
    <dt>horizontal-tb</dt>
    <dd>Top-to-bottom block flow. The writing mode is horizontal.</dd>
    <dt>vertical-rl</dt>
    <dd>Right-to-left block flow. The writing mode is vertical.</dd>
    <dt>vertical-lr</dt>
    <dd>Left-to-right block flow. The writing mode is vertical.</dd>
    <dt>horizontal-bt</dt>
    <dd>Bottom-to-top block flow. The writing mode is horizontal.</dd>
  </dl>

  <p>SVG1.1 [[!SVG11]] defines some additional values: ''lr'',
    ''lr-tb'', ''rl'', ''rl-tb'', ''tb'', and ''tb-rl''. These values
    are <em>deprecated</em> in any context except SVG1 documents.
    Implementations that wish to support them in the context of CSS
    must treat these values as follows:

  <table class="data">
    <thead>
      <tr><th>SVG1</th> <th>CSS</th></tr>
    </thead>
    <tbody>
      <tr><td>lr</td> <td rowspan=3>horizontal-tb</td></tr>
      <tr><td>lr-tb</td></tr>
      <tr><td>rl</td></tr>
      <tr><td>tb</td> <td rowspan=2>vertical-rl</td></tr>
      <tr><td>tb-rl</td></tr>
    </tbody>
  </table>

  <p class="note">In SVG1.1, these values set the <dfn>inline progression
    direction</dfn>, in other words, the direction the current text position
    advances each time a glyph is added. This is a geometric process that
    happens <em>after</em> bidi reordering, and thus has no effect on the
    interpretation of the 'direction' property (which is independent of
    'writing-mode'). (See <a href="http://www.w3.org/TR/SVG/text.html#RelationshipWithBiDirectionality">Relationship
    with bidirectionality</a>. [[!SVG11]]) There are varying interpretations
    on whether this process causes "writing-mode: rl" to merely shift the
    text string or reverse the order of all glyphs in the text.</p>

  <p class="issue">See <a href="test-writing-mode-direction.svg">this demo</a>
    to check out your implementation's interpretation! (Note that most
    SVG implementations don't support the 'direction' property, and
    thus your results may be skewed on that account. Examine the red
    line of text: if the numbers are not in reverse order, your
    implementation doesn't support "direction: rtl".)</p>

  <p>The 'writing-mode' property determines the direction of block flow.
    This determines the progression of block-level boxes in a block formatting
    context; the progression of line boxes in a block container that contains
    inlines; and the progression of rows in a table.
    As a result it also determines which side of a box is its <dfn>before</dfn>
    edge (i.e. the edge that comes earlier in the progression) and which side
    is its <dfn>after</dfn> edge (i.e. the edge that comes later in the
    progression).

  <p>The 'writing-mode' property, by virtue of determining the stacking
    direction of line boxes, determines whether line boxes are horizontal
    or vertical. However, it does not determine the orientation of the
    line boxes' contents or the start and end sides of the line. See
    <a href="line-orientation">Line orientation</a>.

  <p>When set on the root element, the 'writing-mode' property together
    with the 'direction' property determines the
    <dfn id="principal-writing-mode">principal writing mode</dfn>
    of the document. This writing mode is used, for example,
    to determine the default page progression direction. See [[CSS3PAGE]]
    The 'writing-mode' value of the root element is also propagated to
    the initial containing block and sets the block flow direction of the
    initial block formatting context.

  <p>If an element has a different block flow direction than its containing
    block:
  <ul>
   <li>If the element has a specified 'display' of ''inline'', its 'display'
     computes to 'inline-block'. [[!CSS21]]
   <li>If the element has a specified 'display' of ''run-in'', its 'display'
     computes to 'block'. [[!CSS21]]
  </ul>
  <p>If such an element is a block container, then it establishes a new
    block formatting context.

<h3>Box Model in Vertical Writing Modes</h3>

  <p>Box layout in vertical writing modes is exactly analogous to layout in
    the horizontal writing modes by using the following principles:</p>

  <ul>
    <li>Calculations that refer to the width use height instead, and vice
        versa.</li>
    <li>Calculations that refer to the '*-left' and '*-right' box properties
        (border, margin, padding, outline) use '*-top' and '*-bottom'
        instead, and vice versa.
    <li>In right-to-left block flow '*-right' is analogous to top-to-bottom's
        '*-top'; in left-to-right block flow '*-left' is analogous to
        top-to-bottom's '*-top'.</li>
    <li>Layout effects that depend on the directionality to choose between
        left and right (e.g. overflow, overconstraint resolution, the initial
        value for 'text-align', table column ordering)
        are abstracted to the <i>start</i> and <i>end</i> sides and mapped
        appropriately.</li>
  </ul>

  <p>For features such as text alignment, floating, and list marker positioning,
    that primarily reference the left or right sides of the line box or
    its longitudinal parallels and therefore have no top or bottom equivalent,
    the line left and line right sides are used as the reference for the left
    and right sides respectively. (See Line orientation, below.)

  <p>Likewise for features such as underlining, overlining, and baseline alignment
    (the unfortunately-named 'vertical-align'), that primarily reference the
    top or bottom sides of the linebox or its transversal parallels and
    therefore have no left or right equivalent, the over and under sides are
    used as the reference for the top and bottom sides respectively.

<h3>Boxes with Orthogonal Writing Mode</h3>

  <p>When an element has a different 'writing-mode' from its
    containing block two cases are possible:
  <em class="issue">These descriptions need work</em>
  <ul>
    <li>The two writing modes are perpendicular to each other. (For
      example, 'tb' and 'lr'). In such cases, <span class="issue">detail
      calculation of width/height and determination of containing block dim</span></li>
    <li>The two writing modes are parallel to each other. (For example,
      'rl' and 'lr').</li>
  </ul>


  <div class="example">
    <p>In the following example, two blocks elements (1 and 3) separated
      by an image (2) are presented in various flow writing modes.</p>

    <p>Here is a diagram of horizontal writing mode (<code>writing-mode: horizontal-tb</code>):</p>

    <p><img alt="Diagram of horizontal layout: blocks 1, 2, and 3 are stacked top-to-bottom"
            src="horizontal.png" width="219" height="300" /></p>

    <p>Here is a diagram for the right-to-left vertical writing mode commonly
      used in East Asia (<code>writing-mode: vertical-rl</code>):</p>

    <p><img alt="Diagram of a right-to-left vertical layout: blocks 1, 2,
                  and 3 are arranged side by side from right to left"
              src="vertical-rl.png" height="191" width="297" /></p>

    <p>And finally, here is a diagram for the left-to-right vertical
      writing mode used for Uighur and Mongolian (<code>writing-mode: lr</code>):</p>

    <p><img alt="Diagram of left-to-right vertical layout: blocks 1, 2,
                  and 3 are arranged side by side from left to right"
            src="vertical-lr.png" height="191" width="300" /></p>
  </div>

<h2 id="line-orientation">Line Orientation</h2>

  <!-- <p>The block flow direction given by 'writing-mode' determines only the
    ordering and placement of the line boxes -->

  <h3 id="line-directions">Line-based Directions</h3>

  <p>Every line box has an orientation. Whether its orientation is horizontal
    or vertical is determined by the 'writing-mode' property. Given that,
    which side is its "top", or <em>over</em> edge, is determined by the
    'text-orientation' property on its containing block, and is independent
    of the block flow direction.

  <p>In addition to its <dfn>over</dfn> (ascender side) and <dfn>under</dfn>
    (descender side) edges, a line box, even a vertically-oriented one, also
    has a "left" and "right" side, which we will call the <dfn>line left</dfn>
    and <dfn>line right</dfn> sides of the box to distinguish from the physical
    left and physical right sides of the box.

    <div class="figure">
      <object data="diagrams/line-orient-up.svg" type="image/svg+xml"
        class="landscape"></object>
      <p class="caption">Line orientation compass</p>
    </div>

  <p>The <dfn>start</dfn> edge of a box is nominally the edge from which
    text of its primarily directionality will start. For boxes with
    a used 'direction' value of ''ltr'', this means the <i>line left</i>
    edge. For boxes with a used 'direction' value of ''rtl'', this means
    the <i>line right</i> edge. The edge opposite the start edge is the
    <dfn>end</dfn> edge.

  <p>These directional mappings exist even for boxes that do not contain any
    line boxes: they are calculated by the values of the 'writing-mode',
    'text-orientation', and 'direction' properties only.

  <p class="note">Note that determining the <i>start</i> and <i>end</i>
    edges of a box depends not only on its 'writing-mode' and 'direction'
    properties, but also its 'text-orientation' property.</p>

  <div class="figurepair">
    <div class="figure">
      <object data="diagrams/line-orient-right.svg" type="image/svg+xml"
        class="portrait"></object>
      <p class="caption">Typical orientation in vertical</p>
    </div>

    <div class="figure">
      <object data="diagrams/line-orient-left.svg" type="image/svg+xml"
        class="portrait"></object>
      <p class="caption">Line orientation with ''text-orientation: rotate-left''</p>
    </div>
  </div>

  <p class="note">Note also that while the <i>over</i> and <i>under</i>
    directions often map to the same directions as <a href="#before">before</a>
    and <a href="#after">after</a> respectively, this mapping is reversed
    for some combinations of 'writing-mode' and 'text-orientation'.

  <h3 id="text-orientation">Orienting Text: the 'text-orientation' property</h3>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>text-orientation</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td>vertical-right | upright | rotate-right | rotate-left | rotate-normal</td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>vertical-right</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>all elements except table row groups, rows, column groups, and columns</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>yes</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>N/A</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>specified value</td>
      </tr>
    </tbody>
  </table>

  <p>This property specifies the orientation of characters in a non-native
    'writing-mode' and sets the orientation of the line. Current values only
    have an effect in vertical writing  modes. Values have the following
    meanings:</p>

  <dl>
    <dt><dfn>vertical-right</dfn></dt>
    <dd><p>In vertical writing modes, grapheme clusters from scripts that
      do not have an intrinsic vertical orientation are rotated 90&deg;
      clockwise from their standard orientation in horizontal text.
      When available, vertical glyph variants and vertical font metrics
      are used to set all punctuation and characters from any script
      that is not rotated.
      This value is typical for layout of primarily vertical-script
      text.
    <dt><dfn>upright</dfn></dt>
    <dd><p>In vertical writing modes, grapheme clusters that do not have an
      intrinsic vertical orientation are rendered upright, i.e. in their
      standard horizontal orientation. Shaping characters are shaped in
      their isolated forms. When available, vertical glyph variants and
      vertical font metrics are used to set the text. The UA should
      synthesize vertical font metrics for grapheme clusters that do not
      have any.
      <p>For the purposes of bidi reordering, this value causes all
      characters to be treated as strong LTR.
      This value causes the used value of 'direction' to be ''ltr''.
    <dt><dfn>rotate-right</dfn></dt>
    <dd><p>In vertical writing modes, this causes text to be set as if
      in a horizontal layout (using horizontal glyph variants and metrics),
      but rotated 90&deg; clockwise.
      This value is typical for ''vertical-rl'' text in a primarily
      horizontal-script document.
    <dt><dfn>rotate-left</dfn></dt>
    <dd><p>In vertical writing modes, this causes text to be set as if
      in a horizontal layout (using horizontal glyph variants and metrics),
      but rotated 90&deg; counter-clockwise.
      This value is typical for ''vertical-lr'' text in a primarily
      horizontal-script document.
      <p>If set on a non-replaced inline whose parent is not ''rotate-left'',
      this forces ''isolate'' to be added to the computed value of 'unicode-bidi'.
      Layout of text is exactly as for ''rotate-right'' except that the
      entire text content and baseline table of the element is mirrored:
      each box of the inline is mirrored around a vertical axis such that
      its content box does not move. (However the contents of atomic
      inlines are not mirrored; only their alignment is changed.)
      Similarly, if a child of the element has a 'text-orientation' value
      other than ''rotate-left'', an analogous transformation is applied.
    <dt><dfn>rotate-normal</dfn></dt>
    <dd><p>This value is equivalent to ''rotate-right'' in ''vertical-rl''
      writing mode and equivalent to ''rotate-left'' in ''vertical-lr''
      writing mode.
  </dl>

  <p>[[!SVG11]] defines 'glyph-orientation-vertical' and 'glyph-orientation-horizontal'
    properties that were intended to control text orientation. These
    properties are <em>deprecated</em> and do not apply to non-SVG elements.
    Implementations that wish to support these properties in conjunction with
    'text-orientation' must introduce an ''auto'' value for 'text-orientation',
    which is set by the UA default style sheet on all
    <a href="http://www.w3.org/TR/SVG/intro.html#TermTextContentElement">SVG
    text content elements</a> and which indicates that the SVG
    'glyph-orientation-vertical' and 'glyph-orientation-horizontal' behavior
    controls the layout of text. In all other contexts the ''auto'' behavior
    is the same as for ''right''.

  <p class="issue">Add appendix that describes interaction with OpenType features and font layout?</p>

<h2 id="text-combine">Glyph Composition: the 'text-combine' property</h2>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>text-combine</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td>none | cluster | upright</td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>none</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>non-replaced inline elements</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>no</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>N/A</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>specified value</td>
      </tr>
    </tbody>
  </table>

  <p>This property allows the combination of multiple characters into the
    space of a single character. For text layout purposes, e.g. bidi
    ordering, line-breaking, emphasis marks, text-decoration, etc. the
    resulting composition is treated as a single glyph representing the
    Object Replacement Character U+FFFC. Values have the following
    meanings:</p>

  <dl>
    <dt><dfn title="text-combine:none">none</dfn>
    <dd>No special processing.</dd>
    <dt><dfn title="text-combine:cluster">cluster</dfn>
    <dd>Display the text contents of the element in a single 1em square
      using the Japanese "kumimoji" rules. [[JISX4051]] The baseline of
      the composition should be chosen to either match the baseline
      of a typical ideographic character in the element's font, or to
      center the composition between the content edges of its parent
      inline box.
      <span class="issue">This doesn't appear in the JLReq document.</span>
    </dd>
    <dt><dfn title="text-combine:upright">upright</dfn>
    <dd><p>In vertical writing mode, attempt to display the text contents
      of the element horizontally within the vertical line box, ideally
      within the space of one ideographic character (1em square), as follows:
    <p>If the UA has compressed glyphs available for the contents of the
      element, then it should use those glyphs to attempt sizing the
      contents to 1em square. For example, a single-digit number should
      use a fullwidth glyph, a two digit number should use halfwidth or
      proportional glyphs, a three-digit number use 1/3-em glyphs (if
      available, else halfwidth glyphs), etc. The glyphs are stacked
      horizontally (similar to the contents of an inline-box with a
      horizontal writing mode and a line-height of 1em) and the baseline
      of the resulting composition chosen such that it is centered between
      the content edges of its parent inline box.
    <p>If the length of the element's contents exceeds the element's used
      line-height, then its contents are instead rendered as if
      ''text-combine'' were ''none''. This fallback behavior is also
      triggered if the element contains anything other than text.
    <p>In horizontal mode this value is equivalent to ''none''.
    </dd>
  </dl>

  <div class="example">
    <p>In East Asian documents, the ''text-combine: upright'' effect is often
      used to display Latin-based strings such as components of a date or
      letters of an initialism, always in a horizontal writing mode
      regardless of the writing mode of the line:</p>

    <div class="figure">
      <p><img alt="Diagram of tate-chu-yoko, showing the two digits of a date
                   set halfwidth side-by-side in a vertical column of text"
              class="example" src="tate-chu-yoko.png">
      <p>Example of horizontal-in-vertical <i lang="ja">tate-chu-yoko</i></p>
    </div>

    <p>In Japanese, this effect is known as <i lang="ja">tate-chu-yoko</i>.
  </div>

<h2 id="logical-directional">Logical directional properties and values</h2>

  <p class="issue">NOTE: This is only a proposal under discussion.</p>

<h3 id="logical-terminology">Terminology</h3>

  <p>In this section we use the following terminology about directional properties:</p>
  <dl>
    <dt>logical properties</dt><dd>the properties regarding the direction relative to the writing-mode (e.g., margin-before)</dd>
    <dt>physical properties</dt><dd>the properties regarding the physical direction (e.g., margin-top)</dd>
    <dt>corresponding properties</dt><dd>the pair of a logical property and its corresponding physical property.</dd>
  </dl>
  
  <p>The dimensions of a box are designated as follows:</p>
  <dl>
    <dt>logical width<dt><dd>the dimension in the inline direction
      (=width in horizontal writing-mode; height in vertical writing-mode)</dd>
    <dt>logical height<dt><dd>the dimension in the block direction
      (=height in horizontal writing-mode; width in vertical writing-mode)</dd>
  </dl>

  <div class="example">
    <p>An English (LTR-TB) block:</p>
    <pre class="ascii-art">
                  &lt;---- width / logical width ---&gt;

                             top side/
                            before side
                  +------------------------------+                  A
      left side/  |   ---inline direction --->   |  right side/     |
      start side  |  |                           |  end side        |
                  |  | block      * horizontal * |                height/
                  |  | direction  *writing mode* |            logical height
                  |  V                           |                  |
                  +------------------------------+                  V
                             bottom side/
                              after side
    </pre>
  </div>
  <div class="example">
    <p>A vertical Japanese block (TTB-RL):</p>
    <pre class="ascii-art">
                  &lt;--- width / logical height ---&gt;

                             top side/
                            start side
                  +------------------------------+                  A
      left side/  |    &lt;---block direction---    |  right side/     |
      after side  |                           |  |  before side     |
                  |  *  vertical  *     inline|  |                height/
                  |  *writing mode*  direction|  |             logical width
                  |                           V  |                  |
                  +------------------------------+                  V
                            bottom side/
                             end side
    </pre>
  </div>

<h3 id="logical-to-physical">Logical-to-Physical Mappings</h3>

  <p>The mappings of logical properties into physical properties are as follows:</p>

  <div class="figure">
    <table border="1" style="border-collapse: collapse" cellpadding="0" cellspacing="0" width="100%">
      <tr>
        <th rowspan="3">logical directions</th>
        <th colspan="6">corresponding physical directions for each writing-mode</th>
      </tr>
      <tr>
        <th colspan="2">horizontal-tb</th>
        <th colspan="2">vertical-rl</th>
        <th colspan="2">vertical-lr</th>
      </tr>
      <tr>
        <th>ltr</th>
        <th>rtl</th>
        <th>ltr</th>
        <th>rtl</th>
        <th>ltr</th>
        <th>rtl</th>
      </tr>
      <tr>
        <td>start</td>
        <td>left</td>
        <td>right</td>
        <td>top</td>
        <td>bottom</td>
        <td>top</td>
        <td>bottom</td>
      </tr>
      <tr>
        <td>end</td>
        <td>right</td>
        <td>left</td>
        <td>bottom</td>
        <td>top</td>
        <td>bottom</td>
        <td>top</td>
      </tr>
      <tr>
        <td>before</td>
        <td colspan="2">top</td>
        <td colspan="2">right</td>
        <td colspan="2">left</td>
      </tr>
      <tr>
        <td>after</td>
        <td colspan="2">bottom</td>
        <td colspan="2">left</td>
        <td colspan="2">right</td>
      </tr>
      <tr>
        <td>logical-width</td>
        <td colspan="2">width</td>
        <td colspan="4">height</td>
      </tr>
      <tr>
        <td>logical-height</td>
        <td colspan="2">height</td>
        <td colspan="4">width</td>
      </tr>
      <tr>
        <td>over</td>
        <td colspan="2">top</td>
        <td colspan="4">right</td>
      </tr>
      <tr>
        <td>under</td>
        <td colspan="2">bottom</td>
        <td colspan="4">left</td>
      </tr>
    </table>
  </div>

  <p class="note">When 'text-orientation' property is ''rotate-left'',
    this table does not apply.</p>

<h4 id="logical-map-using">Logical-to-Physical Mappings Using The Values of Other Elements</h4>

  <p>The logical-to-physical mappings use the value of 'writing-mode',
    'direction', and 'text-orientation' properties,
    and therefore these values must be evaluated first.</p>

  <p>In most cases, the values of the element are used.
    However, there is a case where the values of different element should be used.</p>
  <p>It is when a logical direction is of its parent block.
    One example of such properties is 'float' property;
    ''float: left'' means ''left'' in the parent block, not in the element itself,
    and this difference becomes obvious when 'writing-mode' is different from the parent.</p>

  <p>The following [[!CSS21]] properties use the 'direction', 'writing-mode',
    and 'text-orientation' values of the parent element:</p>

  <ul>
    <li>'margin-start', 'margin-end', 'margin-before', 'margin-after'</li>
    <li>'margin'</li>
    <li>'offset-start', 'offset-end', 'offset-before', 'offset-after'</li>
    <li>'float'</li>
    <li>'clear'</li>
    <li>'caption-side'</li>
  </ul>

  <p>When these properties are applied to the root element,
    the values of the root element are used.</p>

  <p class="note">The parent element is used instead of the containing block,
    because the benefit of using the containing block is very rare,
    but the cost to implement it is rather high.</p>

  <p class="issue">Side captions having different text flow than tables can be challenging;
    which side margin-before should apply?</p>

<h3 id="logical-prop">Additional Logical Properties: 'margin-before', 'logical-width', etc.</h3>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>margin-before</dfn>, <dfn>margin-after</dfn>, <dfn>margin-start</dfn>, <dfn>margin-end</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td><var>&lt;length&gt;</var> | <var>&lt;percentage&gt;</var> | auto</td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>0</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>same as 'margin'</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>no</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>logical-width of containing block</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>the percentage as specified or the absolute length or 'auto' (see text)</td>
      </tr>
    </tbody>
  </table>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>padding-before</dfn>, <dfn>padding-after</dfn>, <dfn>padding-start</dfn>, <dfn>padding-end</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td><var>&lt;length&gt;</var> | <var>&lt;percentage&gt;</var></td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>0</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>all elements </td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>no</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>logical-width of containing block</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>&lt;length&gt; (see text)</td>
      </tr>
    </tbody>
  </table>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>border-before-width</dfn>, <dfn>border-after-width</dfn>, <dfn>border-start-width</dfn>, <dfn>border-end-width</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td><var>&lt;border-width&gt;</var></td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>medium</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>all elements</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>no</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>logical-width of containing block</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>absolute length; '0' if the border style is 'none' or 'hidden' (see text)</td>
      </tr>
    </tbody>
  </table>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>border-before-style</dfn>, <dfn>border-after-style</dfn>, <dfn>border-start-style</dfn>, <dfn>border-end-style</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td><var>&lt;border-style&gt;</var></td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>none</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>all elements</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>no</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>N/A</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>specified value (see text)</td>
      </tr>
    </tbody>
  </table>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>border-before-color</dfn>, <dfn>border-after-color</dfn>, <dfn>border-start-color</dfn>, <dfn>border-end-color</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td><var>&lt;color&gt;</var></td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>currentcolor</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>all elements</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>no</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>N/A</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>the computed color (see text)</td>
      </tr>
    </tbody>
  </table>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>border-before</dfn>, <dfn>border-after</dfn>, <dfn>border-start</dfn>, <dfn>border-end</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td><var>&lt;border-width&gt;</var> || <var>&lt;border-style&gt;</var> || <var>&lt;color&gt;</var></td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>(see individual properties)</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>all elements</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>no</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>see individual properties</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>see individual properties </td>
      </tr>
    </tbody>
  </table>

  <p class="issue">Should we add corresponding logical properties for
    border-top-right-radius, border-bottom-right-radius, border-top-left-radius, border-top-left-radius,
    and border-radius?</p>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>offset-before</dfn>, <dfn>offset-after</dfn>, <dfn>offset-start</dfn>, <dfn>offset-end</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td><var>&lt;length&gt;</var> | <var>&lt;percentage&gt;</var> | auto</td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>auto</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>positioned elements</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>no</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>logical-width, resp. logical-height of containing block</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>same as box offsets: 'top', 'right', 'bottom', 'left' properties
          except that directions are logical</td>
      </tr>
    </tbody>
  </table>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>logical-width</dfn>, <dfn>logical-height</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td><var>&lt;length&gt;</var> | <var>&lt;percentage&gt;</var> | auto</td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>auto</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>same as 'width' and 'height'</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>no</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>logical-width, resp. logical-height of containing block</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>the percentage as specified or the absolute length or 'auto' (see text)</td>
      </tr>
    </tbody>
  </table>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>min-logical-width</dfn>, <dfn>min-logical-height</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td><var>&lt;length&gt;</var> | <var>&lt;percentage&gt;</var></td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>0</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>same as 'width' and 'height'</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>no</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>logical-width, resp. logical-height of containing block</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>the percentage as specified or the absolute length (see text)</td>
      </tr>
    </tbody>
  </table>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>max-logical-width</dfn>, <dfn>max-logical-height</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td><var>&lt;length&gt;</var> | <var>&lt;percentage&gt;</var> | none</td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>none</td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>same as 'width' and 'height'</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>no</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>logical-width, resp. logical-height of containing block</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>the percentage as specified or the absolute length or 'none' (see text)</td>
      </tr>
    </tbody>
  </table>

  <p>These properties are writing-mode relative (logical) equivalents of the corresponding physical properties.</p>
  <p>The computed value of a logical property affects the computed value of the corresponding physical property, and vice versa.</p>
  <p>For example, if the writing-mode of the element is horizontal-tb, the computed value of the 'margin-before' overrides the 'margin-top'.</p>
  <p>If both logical and physical properties are specified on the same element, these corresponding properties are treated as same property and then normal cascading rules are applied.</p>
  <p>The 'writing-mode', 'direction', and 'text-orientation' values of the element
    or of the parent element are used for the mapping of corresponding properties
    and therefore must be evaluated first.</p>

  <p class="issue">an idea is to allow ''margin: start 2em end 1em'' instead of these properties</p>
  <p class="issue">another idea is to allow ''margin: logical unspecified 1em unspecified 2em'' instead of these properties</p>

<h3 id="logical-shorthand-keyword">Shorthand Properties with ''logical'' Keyword</h3>

  <p>Shorthand properties for the <a href="#logical-prop">additional logical properties</a> are physical by default.
    But authors can specify ''logical'' keyword to indicate that the values are logical.</p>

  <p class="issue">other candidates of the keyword are: ''script'', ''writing-mode'', ''beas'',
    or the value itself (e.g., ''vertical-lr-ltr'')</p>

  <p>The following [[!CSS21]] properties are applicable to this case:</p>

  <ul>
    <li>'margin'</li>
    <li>'padding'</li>
    <li>'border-color'</li>
    <li>'border-style'</li>
    <li>'border-width'</li>
  </ul>

  <p>The rules to set one to four values are similar to the rules for physical properties.</p>
  <ul>
    <li>If only one value is set, the value applies to all four logical sides.</li>
    <li>If two values are set, the first is for before and after,
      the second is for end and start.</li>
    <li>If three values are set, the first is for before,
      the second is for end and start,
      and the third is for after.</li>
    <li>If four values are set,
      the order they are applied is before, end, after, and start.</li>
  </ul>

  <div class="example">
    <p>In the following example, all logical margins will be set,
      and the values will be applied in before/end/after/start order.</p>
    <pre><code class="css">
<!-- -->blockquote { margin: logical 1em 2em 3em 4em; }
<!----></code></pre>
  </div>

<h3 id="logical-value">Logical Directional Values: before, after, start, end</h3>

  <p>Properties that accept physical directional values (''top'', ''bottom'', ''left'', or ''right'')
    should also accept logical directional values (''before'', ''after'', ''start'', or ''end'').
    In such case, the logical values are treated as corresponding physical values.
    The writing-mode value of the element is used for the the mapping of logical into physical values and therefore must be evaluated first.</p>

<h4 id="logical-value-map">Logical Directional Values with Mappings</h4>

  <p>In addition to accepting logical directional values,
    there are some cases where physical directional values must be mapped
    to the corresponding logical directional values first.</p>

  <p>In vertical text flow,
    properties that accept ''left'' or ''right'' but neither ''top'' nor ''bottom'',
    or ''top'' or ''bottom'' but neither ''left'' nor ''right'' cannot be interpreted.
    The 'text-align' property, for instance, is supposed to work for inline direction,
    but ''left'' in inline direction does not exist in vertical text flow.</p>
  <p>In such cases, following mappings occur:</p>

  <ul>
    <li>Properties that accept ''left'' or ''right'' but neither ''top'' nor ''bottom''
      <ul>
        <li>''left'' maps to line left</li>
        <li>''right'' maps to line right</li>
      </ul>
    </li>
    <li>Properties that accept ''top'' or ''bottom'' but neither ''left'' nor ''right''
      <ul>
        <li>''top'' maps to ''over''</li>
        <li>''bottom'' maps to ''under''</li>
      </ul>
    </li>
  </ul>

  <p>The following [[!CSS21]] properties are applicable to this case:</p>
  
  <ul>
    <li>'float'</li>
    <li>'clear'</li>
    <li>'vertical-align' <span class="note">other values than ''top'' and ''bottom'' are <a href="#logical-only">logical-only</a></span>
      <span class="issue">should also add ''text-over'' and ''text-under''?</span></li>
    <li>'text-align'</li>
    <li>'caption-side' <span class="note">special handling may be required, see <a href="#caption-side-prop">below</a></span></li>
  </ul>
  <p class="issue">float needs coordination with GCPM where it defines page floats</p>

<h4 id="logical-value-no-map">Logical Directional Values without Mappings</h4>

  <p>If a property can accept any of the four directional values,
    it accepts logical values as noted above,
    but physical values remain physical.</p>

  <p>The following [[!CSS21]] properties are applicable to this case:</p>
  
  <ul>
    <li>'background-position'</li>
  </ul>

  <p class="issue">'resize' accepts ''horizontal'' and ''vertical'', and these terminologies should be physical.
    should we add ''resize-x'' and ''resize-y'' as logical values?</p>

<h3 id="logical-only">Logical-Only Properties</h3>

  <p>Properties that are defined relative to the text flow are always logical.</p>

  <p>The following [[!CSS21]] and [[!CSS3COL]] properties are applicable to this case:</p>

  <ul>
    <li>'line-height'</li>
    <li>'vertical-align' <span class="note">this property <a href="#logical-value-map">accepts logical values</a> as well</span></li>
    <li>'border-spacing'</li>
    <li>'background-repeat' <span class="note">special handling is required, see <a href="#background-repeat-prop">below</a></span></li>
    <li>'text-indent'</li>
    <li>'text-decoration'</li>
    <li>'overflow-x'</li>
    <li>'overflow-y'</li>
    <li>'column-width'</li>
    <li>'column-rule-width'</li>
  </ul>

<!--
<h3 id="logical-xy">Logical-XY Properties</h3>

  <p>The Logical-XY properties are similar to logical properties,
    except that they are not affected by the inline direction.
    They are affected only by the block flow direction.</p>

  <p>The following properties (but not limited to) are applicable to this case:</p>

  <ul>
    <li>'clip'</li>
  </ul>
-->

<h3 id="physical-only">Physical-Only Properties</h3>

  <p>Some properties are always physical
    and are not affected by the text flows.</p>

  <p>The following [[!CSS21]] and [[!CSS3BG]] properties are applicable to this case:</p>

  <ul>
    <li>'clip'</li>
    <li>'box-shadow'</li>
  </ul>

<h3 id="caption-side-prop">The 'caption-side' property</h3>

  <p>If the UA does not support side captions,
    this property maps ''top'' to ''before'', and ''bottom'' to ''after''.</p>

  <p>If the UA supports side captions,
    the UA should consider this property as part of <a href="#logical-value-no-map">logical directional values without mappings</a>
    and therefore should not map physical directional values.</p>

<h3 id="background-and-borders">Background and Borders</h3>

  <p>[[!CSS3BG]] is handled separately because it can fill an area with specified images,
    and the area to fill can be rotated or flipped depending on the text flow.</p>

  <p>Swapping axes without transforming images can bring contradictions
    to properties like 'background-image-size',
    where length is defined in the image coordinates
    while percentage is defined in the document coordinates.</p>

<h4 id="background-image-transform-prop">Background Image Transform: The 'background-image-transform' property</h4>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>background-image-transform</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td>logical | physical | rotate</td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>rotate <span class="issue">is this the right default? we need to investigate which is more common</span></td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>All elements, except internal table elements when 'border-collapse' is ''collapse''</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>yes</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>N/A</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>as specified</td>
      </tr>
    </tbody>
  </table>

  <p>This property defines whether background images are transformed to match to the value of 'writing-mode' property,
    and also related properties are logical or physical.
    Values have the following meanings:</p>

  <dl>
    <dt><strong>logical</strong></dt>
    <dd>The values for the 'background-size' property are logical.
      The background images are transformed to match to the logical axis.</dd>
    <dt><strong>physical</strong></dt>
    <dd>The values for the 'background-size' property are physical.
      The background images remain unchanged.</dd>
    <dt><strong>rotate</strong></dt>
    <dd>Similar to ''logical'', except that the inline direction is ignored.
      The result is affected only by the block flow direction.</dd>
  </dl>

<h4 id="background-repeat-prop">The 'background-repeat' property</h4>

  <p>The value ''repeat-x'' and ''repeat-y'' are <a href="#logical-only">Logical-Only</a>,
    but this property can also accept double values to specify horizontal and vertical behaviors separately.
    In that case, the double values are considered logical if '&#39;logical&#39;' keyword is specified,
    otherwise physical.</p>

  <p class="issue">should also add repeat-horizontal and repeat-vertical for the physical value?</p>

<h4 id="border-image-transform-prop">Border Image Transform: The 'border-image-transform' property</h4>

  <table class="propdef">
    <tbody>
      <tr>
        <th>Name:</th>
        <td><dfn>border-image-transform</dfn></td>
      </tr>
      <tr>
        <th>Value:</th>
        <td>logical | physical | rotate</td>
      </tr>
      <tr>
        <th>Initial:</th>
        <td>rotate <span class="issue">is this the right default?</span></td>
      </tr>
      <tr>
        <th>Applies to:</th>
        <td>All elements, except internal table elements when 'border-collapse' is ''collapse''</td>
      </tr>
      <tr>
        <th>Inherited:</th>
        <td>yes</td>
      </tr>
      <tr>
        <th>Percentages:</th>
        <td>N/A</td>
      </tr>
      <tr>
        <th>Media:</th>
        <td>visual</td>
      </tr>
      <tr>
        <th>Computed&#160;value:</th>
        <td>as specified</td>
      </tr>
    </tbody>
  </table>

  <p>This property defines whether border images are transformed to match to the value of 'writing-mode' property,
    and also related properties are logical or physical.
    Values have the following meanings:</p>

  <dl>
    <dt><strong>logical</strong></dt>
    <dd>The values for the border-image-* properties are logical.
      The border images are transformed to match to the logical axis.</dd>
    <dt><strong>physical</strong></dt>
    <dd>The values for the border-image-* properties are physical.
      The border images remain unchanged.</dd>
    <dt><strong>rotate</strong></dt>
    <dd>Similar to ''logical'', except that the inline direction is ignored.
      The result is affected only by the block flow direction.</dd>
  </dl>

  <p>The following properties use the value of this property to determine how directional mappings are done:</p>

  <ul>
    <li>'border-image-slice'</li>
    <li>'border-image-width'</li>
    <li>'border-image-outset'</li>
    <li>'border-image-repeat'</li>
    <li>'border-image'</li>
  </ul>
  

<h3 id="logical-attributes">HTML Logical Attributes</h3>

<h4 id="logical-attributes-html5">HTML5 Logical Attributes</h4>

  <p>Following attributes of [[!HTML5]] are logical except noted below:</p>

  <ul>
    <li>width</li>
    <li>height</li>
  </ul>

  <p>These attributes remain physical
    if the content of the element is not affected by the value of 'writing-mode' or 'direction' property.</p>

  <p>Most embedded contents are not affected by the value of 'writing-mode' nor 'direction',
    and therefore these attributes remain physical.
    Examples of such elements (but not limited to) are img, iframe, embed, object, applet, video, canvas, and svg.</p>

  <p>Form elements and MathML elements contain text,
    therefore the contents should be affected by the value of 'writing-mode' and 'direction' property,
    and these attributes are logical.
    The UA may, however, choose not to rotate nor flip these elements in vertical text flow if it is not capable,
    and in that case, these attributes remain physical.</p>
    <p class="issue">when not to rotate form elements/MathML,
      should treat them as images (always upright)
      or to force writing-mode to always calculate to horizontal-tb?</p>

<h4 id="logical-attributes-html401">HTML 4.01 Logical Attributes</h4>

  <p>More attributes are defined in [[!HTML401]] that should be logical,
    although the use of these attributes are deprecated.</p>

  <p>The following attributes behave the same way as their corresponding CSS properties:</p>

  <ul>
    <li>align</li>
    <li>clear</li>
    <li>valign</li>
  </ul>

  <p>The following attributes are logical and use the value of 'writing-mode' of the element.</p>

  <ul>
    <li>size (of hr element)</li>
  </ul>

  <p>The following attributes are logical and use the value of 'writing-mode' of the parent of the element.</p>

  <ul>
    <li>hspace</li>
    <li>vspace</li>
    <li>marginwidth</li>
    <li>marginheight</li>
  </ul>

<h3 id="logical-page">Logical Page Directions</h3>

  <p>Page progression is determined by the value of 'writing-mode' property on the root element
    as defined in [[!CSS3PAGE]].
    Physical directions are defined in the specification,
    but logical directions are also supported.</p>

  <p>The properties that accept ''left'' and ''right'' as page directions
    should also accept ''recto'' and ''verso'' logical page directions.</p>

  <p class="issue">recto/verso or even/odd or even-page/odd-page?
    which side would we want if page-break-before changes the first page?</p>

  <p>The page number used to determine whether a page is even or odd
    is the physical page count starting from 1,
    and is typically different from the page number printed on the page.
    In other words, if a page is on the same side as the first page,
    it is an odd page.</p>

  <p>The following [[!CSS21] and [[!CSS3COL]] properties are applicable to this case:</p>
  
  <ul>
    <li>'page-break-after'</li>
    <li>'page-break-before'</li>
    <li>'break-after'</li>
    <li>'break-before'</li>
  </ul>

<h4 id="logical-page-selector">Logical Page Selectors</h4>

  <p>Logial page selectors are added to support logical directions to define margin boxes.
    Authors typically place page numbers using physical placements,
    but they may place chapter names in the margin boxes of odd pages.</p>

  <p>Following selectors are added to support this scenario:</p>

  <ul>
    <li>''@page :recto''</li>
    <li>''@page :verso''</li>
  </ul>

  <p>When both physical and logical selectors are specified,
    they cascade, with specificity equal to :left and :right.</p>

<h2 id="acknowledgements">Acknowledgements</h2>

<p>Martin Heijdra, Paul Nelson, Michel Suignard, Steve Zilles</p>

<h2 id="bidi-html">Appendix B: Bidi Rules for HTML</h2>

<p>The style sheet rules that would achieve the bidi behaviors specified
in [[HTML401]] for the HTML Strict doctype are given below:
  <pre>
/* HTML dir attribute creates an embedding */
*[dir="ltr"]    { direction: ltr; unicode-bidi: embed; }
*[dir="rtl"]    { direction: rtl; unicode-bidi: embed; }

/* BDO element creates an override */
bdo[dir="ltr"]  { direction: ltr; unicode-bidi: bidi-override; }
bdo[dir="rtl"]  { direction: rtl; unicode-bidi: bidi-override; }

/* HTML4.01:8.2.6 - preserve bidi behavior if 'display' is changed */
html, body,
div, address, blockquote, p,
ul, ol, li, dl, dt, dd,
fieldset, form,
h1, h2, h3, h4, h5, h6,
{ unicode-bidi: isolate; }
  </pre>

</body>
</html>
